-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = jairo,pkg_planning,public;




CREATE OR REPLACE PROCEDURE jairo.pkg_planning_sp_create_expenses (P_ID_USER bigint,P_ID_FUNCIONARIO bigint,P_ID_ENTIDAD bigint,P_ID_DEPTO text,P_ID_ANHO bigint,P_ID_PBANCARIA bigint,P_MOTIVO text, P_TIPO text, P_ID_MONEDA bigint,P_ID_ACTIVIDAD bigint,P_TRAMITE_PAGO text,P_SERIE text,P_NUMERO text,P_IMPORTE bigint,P_IMPORTE_ME bigint, P_FECHA timestamp(0), L_ID_DOCUMENTO OUT bigint,L_ERROR OUT bigint,L_MSGERROR OUT text) AS $body$
DECLARE


            L_ID_DOCPROCESO bigint;
            L_ID_DPROCESO bigint := 1; --PASO 1
            L_CODIGO varchar(10) := 'REGDOC';
            L_ESTADO varchar(1) := '1';
            L_NUMERO_DOC varchar(10);

BEGIN
            SELECT COALESCE(MAX(ID_DOCUMENTO),0)+1 INTO STRICT L_ID_DOCUMENTO FROM ELISEO.CAJA_DOCUMENTO;

            SELECT LPAD(MAX((NUMERO_DOC)::numeric )+1,10,0) INTO STRICT L_NUMERO_DOC FROM ELISEO.CAJA_DOCUMENTO;

            INSERT INTO ELISEO.CAJA_DOCUMENTO(ID_DOCUMENTO,ID_USER,ID_PERSONA,ID_MONEDA,ID_ENTIDAD,ID_DEPTO,ID_ANHO,ID_PBANCARIA,ID_ACTIVIDAD,SERIE,NUMERO,FECHA,IMPORTE,IMPORTE_ME,MOTIVO,TIPO,CODIGO,ESTADO,NUMERO_DOC,TRAMITE_PAGO)
            VALUES (L_ID_DOCUMENTO,P_ID_USER,P_ID_FUNCIONARIO,P_ID_MONEDA,P_ID_ENTIDAD,P_ID_DEPTO,P_ID_ANHO,P_ID_PBANCARIA,P_ID_ACTIVIDAD,P_SERIE,P_NUMERO,P_FECHA,P_IMPORTE,P_IMPORTE_ME,P_MOTIVO,P_TIPO,L_CODIGO,L_ESTADO,L_NUMERO_DOC,P_TRAMITE_PAGO);

            SELECT COALESCE(MAX(ID_DOCPROCESO),0)+1 INTO STRICT L_ID_DOCPROCESO FROM ELISEO.CAJA_DOCUMENTO_PROCESO;

            INSERT INTO ELISEO.CAJA_DOCUMENTO_PROCESO(ID_DOCPROCESO,ID_DOCUMENTO,ID_DPROCESO,ID_USER,FECHA,MOTIVO)
            VALUES (L_ID_DOCPROCESO,L_ID_DOCUMENTO,L_ID_DPROCESO,P_ID_USER,clock_timestamp(),P_MOTIVO);
            L_ERROR := 0;
            L_MSGERROR := 'OK';
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE jairo.pkg_planning_sp_create_expenses (P_ID_USER bigint,P_ID_FUNCIONARIO bigint,P_ID_ENTIDAD bigint,P_ID_DEPTO text,P_ID_ANHO bigint,P_ID_PBANCARIA bigint,P_MOTIVO text, P_TIPO text, P_ID_MONEDA bigint,P_ID_ACTIVIDAD bigint,P_TRAMITE_PAGO text,P_SERIE text,P_NUMERO text,P_IMPORTE bigint,P_IMPORTE_ME bigint, P_FECHA timestamp(0), L_ID_DOCUMENTO OUT bigint,L_ERROR OUT bigint,L_MSGERROR OUT text) FROM PUBLIC;
