-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = jairo,pkg_planning,public;




CREATE OR REPLACE PROCEDURE jairo.pkg_planning_sp_iniciativa_actividad_seat (P_ID_MAPA_INICIATIVA bigint,P_ID_FONDO bigint,P_ID_CUENTAAASI text,P_ID_RESTRICCION text,P_ID_CTACTE text,P_DEPTO text,P_DC text,P_ERROR OUT bigint,P_MSGERROR OUT text) AS $body$
DECLARE

        L_ID_ACTIVIDAD bigint;
        L_ID_FONDO bigint;
        L_DEPTO varchar(10);
        L_ID_ASIENTO bigint;
        L_ID_RESTRICCION varchar(50);
        L_ID_CUENTAAASI varchar(10);
        L_ID_CTACTE varchar(20);
        L_DC varchar(1);
        L_IMPORTE bigint;
        L_CANT bigint :=0;

        CASI CURSOR FOR
        SELECT
                ID_ACTIVIDAD,PRESUPUESTO
        FROM SGE_ACTIVIDAD WHERE ID_MAPA_INICIATIVA = P_ID_MAPA_INICIATIVA 
        AND coalesce(PRESUPUESTO,0) > 0;

    
BEGIN
        P_ERROR :=0;
        IF P_ERROR = 0 THEN

            
            OPEN CASI;
                FETCH CASI INTO L_ID_ACTIVIDAD,L_IMPORTE;
                WHILE CASI%FOUND LOOP

                    IF P_DC='C' THEN
                        L_IMPORTE:=L_IMPORTE*(1);
                        --P_IMPORTE_ME:=P_IMPORTE_ME*(1);
                    ELSE
                        L_IMPORTE := L_IMPORTE;
                        --P_IMPORTE_ME := P_IMPORTE_ME;
                    END IF;

                    IF L_IMPORTE<>0 THEN
                        INSERT INTO SGE_ASIENTO( ID_ACTIVIDAD,ID_FONDO,ID_CUENTAAASI,ID_RESTRICCION,ID_CTACTE,ID_DEPTO,DC,IMPORTE
                        ) VALUES (L_ID_ACTIVIDAD,P_ID_FONDO,P_ID_CUENTAAASI,P_ID_RESTRICCION,P_ID_CTACTE,P_DEPTO,P_DC,L_IMPORTE);
                    END IF;

                FETCH CASI INTO L_ID_ACTIVIDAD,L_IMPORTE;

            END LOOP;
            CLOSE CASI;

            P_ERROR :=0;
        END IF;
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE jairo.pkg_planning_sp_iniciativa_actividad_seat (P_ID_MAPA_INICIATIVA bigint,P_ID_FONDO bigint,P_ID_CUENTAAASI text,P_ID_RESTRICCION text,P_ID_CTACTE text,P_DEPTO text,P_DC text,P_ERROR OUT bigint,P_MSGERROR OUT text) FROM PUBLIC;
