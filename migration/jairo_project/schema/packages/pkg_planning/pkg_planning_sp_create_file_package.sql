-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = jairo,pkg_planning,public;




CREATE OR REPLACE PROCEDURE jairo.pkg_planning_sp_create_file (P_ID_PEDIDO bigint,P_ID_PCOMPRA bigint,P_NOMBRE text,P_FORMATO text,P_URL text,P_TIPO text,P_MODO text,P_TAMANHO bigint,P_ORIGEN text) AS $body$
DECLARE

        L_ID_PFILE bigint;

        
BEGIN
            IF P_ORIGEN = '1' THEN  --COMPROBANTES
            SELECT coalesce(MAX(ID_PFILE),0)+1 INTO STRICT L_ID_PFILE FROM ELISEO.PEDIDO_FILE;
            INSERT INTO ELISEO.PEDIDO_FILE(ID_PFILE,ID_PEDIDO,ID_PCOMPRA,NOMBRE,FORMATO,URL,FECHA,TIPO,TAMANHO,ESTADO) VALUES (L_ID_PFILE,P_ID_PEDIDO,P_ID_PCOMPRA,P_NOMBRE,P_FORMATO,P_URL,clock_timestamp(),P_MODO,P_TAMANHO,'0');
            ELSE  --GASTOS
            SELECT coalesce(MAX(ID_DFILE),0)+1 INTO STRICT L_ID_PFILE FROM ELISEO.CAJA_DOCUMENTO_FILE;
            INSERT INTO ELISEO.CAJA_DOCUMENTO_FILE(ID_DFILE,ID_DOCUMENTO,NOMBRE,FORMATO,URL,FECHA,TIPO,TAMANHO,ESTADO) VALUES (L_ID_PFILE,P_ID_PEDIDO,P_NOMBRE,P_FORMATO,P_URL,clock_timestamp(),P_TIPO,P_TAMANHO,'1');

            END IF;
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE jairo.pkg_planning_sp_create_file (P_ID_PEDIDO bigint,P_ID_PCOMPRA bigint,P_NOMBRE text,P_FORMATO text,P_URL text,P_TIPO text,P_MODO text,P_TAMANHO bigint,P_ORIGEN text) FROM PUBLIC;
