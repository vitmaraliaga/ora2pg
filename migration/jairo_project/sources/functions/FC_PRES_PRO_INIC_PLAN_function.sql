-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = jairo,public;
\set ON_ERROR_STOP ON

FUNCTION       FC_PRES_PRO_INIC_PLAN(
    P_ID_MAPA_INICIATIVA IN JAIRO.SGE_MAPA_INICIATIVA.ID_MAPA_INICIATIVA%TYPE,
    P_SEMESTRE IN NUMBER DEFAULT NULL
) RETURN NUMBER IS

    P_RESULT     NUMBER := 0.0;
    P_PERIODO_I  NUMBER := NULL;
    P_PERIODO_II NUMBER := NULL;

BEGIN

    IF P_SEMESTRE = 1 THEN
        P_PERIODO_I := 1;
        P_PERIODO_II := 0;
    ELSIF P_SEMESTRE = 2 THEN
        P_PERIODO_I := 0;
        P_PERIODO_II := 1;
    END IF;

    SELECT SUM(SAP.IMPORTE)
    INTO P_RESULT
    FROM JAIRO.SGE_ACTIVIDAD_PPTO SAP
             INNER JOIN JAIRO.SGE_ACTIVIDAD SA ON SAP.ID_ACTIVIDAD = SA.ID_ACTIVIDAD
             INNER JOIN JAIRO.SGE_MAPA_INICIATIVA_DETALLE SMID ON SA.ID_INICIATIVA_DETALLE = SMID.ID_INICIATIVA_DETALLE
    WHERE SMID.ID_MAPA_INICIATIVA = P_ID_MAPA_INICIATIVA
      AND SMID.TIPO = 1 -- Plan de iniciativa
      AND SMID.ID_SEMESTRE_I = P_PERIODO_I
      AND SMID.ID_SEMESTRE_II = P_PERIODO_II;


    RETURN P_RESULT;
END FC_PRES_PRO_INIC_PLAN;

