-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_aviso_fin_contrato (id_entidad, id_depto_padre, id_trabajador, id_persona, apellidonombre, num_documento, siglas, nombre, puesto, fecha_fin_previsto, condicion_laboral, id_perfil_puesto_jefe, tipo_asignar, id_perfil_puesto_area, id_tipo_jefe, id_puesto, id_perfil_puesto, id_condicion_laboral, id_sedearea, id_tipodocumento, ndias, correo, correo_inst, fecha_inicio, id_tipo_contrato, id_contrato, id_situacion_trabajador, email) AS select
a.id_entidad, 
sa.id_depto_padre,
a.id_trabajador, 
a.id_persona, 
a.apellidonombre,
a.num_documento,
td.siglas, 
sa.nombre, 
pp.puesto,
a.fecha_fin_previsto, 
cl.nombre as condicion_laboral,
pp.ID_PERFIL_PUESTO_JEFE,
pp.TIPO_ASIGNAR,
pp.ID_PERFIL_PUESTO_AREA,
pp.ID_TIPO_JEFE,
pp.ID_PUESTO,
pp.id_perfil_puesto,
a.id_condicion_laboral,
sa.id_sedearea,
td.id_tipodocumento,
((date_trunc('day', a.fecha_fin_previsto) - date_trunc('day', statement_timestamp()))+1) AS NDIAS,
a.CORREO,
a.CORREO_INST,
a.FECHA_INICIO,
a.ID_TIPO_CONTRATO,
a.ID_CONTRATO,
a.id_situacion_trabajador,
pp.email
FROM enoc.vw_trabajador  a, 
eliseo.vw_sede_area sa, 
enoc.vw_perfil_puesto pp,
moises.tipo_documento td, 
moises.condicion_laboral cl
where a.id_perfil_puesto=pp.id_perfil_puesto
and a.id_sedearea=sa.id_sedearea
and a.id_tipodocumento=td.id_tipodocumento
and a.id_condicion_laboral=cl.id_condicion_laboral
and (a.fecha_fin_previsto IS NOT NULL AND a.fecha_fin_previsto::text <> '');

