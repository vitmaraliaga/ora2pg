-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_acceso_nivel (usuario, id_persona, id_trabajador, id_acceso_nivel, id_tipo_nivel_vista, id_modulo, id_entidad, id_entidad_filter, id_depto, id_area, id_tipo_nivel_area, codigo, nombre_nivel, comentario, nivelhijo) AS select
 'S' as usuario,
 b.id_persona,
 b.id_trabajador,
 a.id_acceso_nivel,
 a.id_tipo_nivel_vista,
 a.id_modulo,
 a.id_entidad,
  a.id_entidad AS id_entidad_filter,
 substr(c.id_depto,1,1) as id_depto,
 c.id_area,
 a.id_tipo_nivel_area,
 d.codigo,
 e.nombre as nombre_nivel,
 e.comentario,
 f.nivelhijo
 FROM ELISEO.lamb_acceso_nivel a
 inner join moises.trabajador b 
 on a.id_trabajador=b.id_trabajador
 and  b.id_entidad=a.id_entidad
 inner join eliseo.org_sede_area c
 on b.id_sedearea=c.id_sedearea
 inner join eliseo.lamb_modulo d
 on a.id_modulo=d.id_modulo
 inner join eliseo.tipo_nivel_vista e
 on e.id_tipo_nivel_vista=a.id_tipo_nivel_vista
 left join eliseo.tipo_nivel_area f
 on f.id_tipo_nivel_area=a.id_tipo_nivel_area
 
union

 select 
 'N' as usuario,
 b.id_persona,
 b.id_trabajador,
 a.id_acceso_nivel,
 a.id_tipo_nivel_vista,
 a.id_modulo,
 a.id_entidad,
 CASE WHEN  (c.id_depto IS NOT NULL AND c.id_depto::text <> '') THEN c.id_entidad_depto else c.id_entidad end as id_entidad_filter,
 c.id_depto,
 c.id_area,
 c.id_tipo_nivel_area,
 d.codigo,
 null as nombre_nivel,
 null as comentario,
  f.nivelhijo
 from eliseo.lamb_acceso_nivel a 
 inner join moises.trabajador b 
 on a.id_trabajador=b.id_trabajador
 and  b.id_entidad=a.id_entidad
 inner join eliseo.lamb_acceso_nivel_det c
 on a.id_acceso_nivel=c.id_acceso_nivel
 inner join eliseo.lamb_modulo d 
 on a.id_modulo=d.id_modulo
 left join eliseo.tipo_nivel_area f
 on f.id_tipo_nivel_area=c.id_tipo_nivel_area;

