-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = enoc,pkg_desempeno,public;




CREATE OR REPLACE PROCEDURE enoc.pkg_desempeno_sp_generar_puntaje_grupal (P_ID_DESEMPENO bigint, P_ID_DEPTO text,P_ID_PARTICIPANTE bigint,P_ID_TIPO text,P_ID_USER_REG bigint,P_ERROR OUT bigint, P_MSGERROR out text) AS $body$
DECLARE

        l_contar bigint;
        l_error bigint:=0;
        l_msgerror varchar(200):='';

         curPart CURSOR FOR
         SELECT A.ID_PARTICIPANTE
         FROM ENOC.DES_PARTICIPANTE A, ENOC.VW_ENT_DEP_AREA_CCOSTO B
         WHERE A.ID_SEDEAREA=B.ID_SEDEAREA
         AND A.ID_DESEMPENO=P_ID_DESEMPENO
         AND CASE WHEN (P_ID_DEPTO IS NOT NULL AND P_ID_DEPTO::text <> '') AND P_ID_DEPTO != '0' THEN B.ID_DEPTO_PADRE ELSE '0' END =  CASE WHEN (P_ID_DEPTO IS NOT NULL AND P_ID_DEPTO::text <> '') THEN P_ID_DEPTO ELSE '0' END
         AND CASE WHEN P_ID_PARTICIPANTE  <> 0 THEN A.ID_PARTICIPANTE  ELSE 0 END =  CASE WHEN P_ID_PARTICIPANTE  <> 0 THEN P_ID_PARTICIPANTE ELSE 0 END 
         ORDER BY A.ID_PARTICIPANTE;

      
BEGIN 
      
        FOR curI in curPart LOOP
        BEGIN
          CALL enoc.pkg_desempeno_sp_generar_puntaje(curI.ID_PARTICIPANTE,P_ID_TIPO,P_ID_USER_REG,l_error, l_msgerror);
        END;
        END LOOP;

        P_ERROR:=l_error;
        P_MSGERROR:=l_msgerror;
      END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enoc.pkg_desempeno_sp_generar_puntaje_grupal (P_ID_DESEMPENO bigint, P_ID_DEPTO text,P_ID_PARTICIPANTE bigint,P_ID_TIPO text,P_ID_USER_REG bigint,P_ERROR OUT bigint, P_MSGERROR out text) FROM PUBLIC;
