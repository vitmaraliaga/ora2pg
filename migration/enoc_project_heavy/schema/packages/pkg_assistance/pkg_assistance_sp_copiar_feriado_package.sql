-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = enoc,pkg_assistance,public;




CREATE OR REPLACE PROCEDURE enoc.pkg_assistance_sp_copiar_feriado (P_ID_ANHO_DE bigint,P_ID_ANHO_A bigint,P_ERROR OUT bigint,P_MSGERROR out text) AS $body$
DECLARE

        l_contar bigint;
        l_error bigint:=0;
        l_msgerror varchar(200):='';
        l_id bigint;

BEGIN
        select coalesce(max(ID_FERIADO),0) into STRICT l_id from ENOC.plla_feriados;

        INSERT INTO ENOC.plla_feriados(
          ID_FERIADO,
          FECHA,
          NOMBRE,
          ID_TIPO_FERIADO
        )
        SELECT (row_number() OVER ( PARTITION BY to_char(A.fecha,'YYYY')  ORDER BY A.FECHA ASC )) + l_id AS ID_FERIADO ,
        to_date(P_ID_ANHO_A::text||'-'||TO_CHAR(A.FECHA,'MM-DD'),'YYYY-MM-DD'),
        A.NOMBRE,
        A.ID_TIPO_FERIADO 
        FROM ENOC.plla_feriados A, ENOC.PLLA_TIPO_FERIADO B
        WHERE A.ID_TIPO_FERIADO=B.ID_TIPO_FERIADO
        AND B.CODIGO='FN'
        AND (TO_CHAR(A.FECHA,'YYYY'))::numeric =P_ID_ANHO_DE
        AND to_date(2022::text||'-'||TO_CHAR(A.FECHA,'MM-DD'),'YYYY-MM-DD') NOT IN (
          SELECT FECHA FROM ENOC.plla_feriados
          WHERE (TO_CHAR(FECHA,'YYYY'))::numeric =P_ID_ANHO_A 
        );

        P_ERROR:=l_error;
        P_MSGERROR:= l_msgerror;
      END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enoc.pkg_assistance_sp_copiar_feriado (P_ID_ANHO_DE bigint,P_ID_ANHO_A bigint,P_ERROR OUT bigint,P_MSGERROR out text) FROM PUBLIC;
