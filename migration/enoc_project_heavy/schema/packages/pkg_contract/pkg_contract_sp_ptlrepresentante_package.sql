-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = enoc,pkg_contract,public;




CREATE OR REPLACE PROCEDURE enoc.pkg_contract_sp_ptlrepresentante (P_ID_CONTRATO bigint, P_PARAMETRO text,P_PARAMETRO_RET OUT text, P_ERROR OUT bigint,P_MSGERROR out text) AS $body$
DECLARE

        l_contar bigint;
        l_error bigint:=0;
        l_msgerror varchar(200):='';
        l_parametro text:='';
        l_id_persona bigint;
        l_id_entidad bigint;
        l_id_depto varchar(10):='';

        l_id_rep bigint;
        l_cargo_rep varchar(50):='';
        l_asiento_rep varchar(50):='';
        l_partida_rep varchar(50):='';
        l_nombreapellido varchar(250):='';
        l_num_documento varchar(80):='';
        l_firma varchar(150):='';
        l_url_firma varchar(150):='';
        l_url varchar(150);

BEGIN
      
        SELECT id_persona,id_entidad,id_depto into STRICT l_id_persona,l_id_entidad,l_id_depto from plla_contrato where id_contrato=P_ID_CONTRATO;

        SELECT count(*) into STRICT l_contar FROM ENOC.PLLA_CONFIG_REP  WHERE id_entidad=l_id_entidad AND id_depto=l_id_depto;
        if l_contar>0 then
          SELECT ID_REP,CARGO_REP,ASIENTO_REP,PARTIDA_REP into STRICT l_id_rep,l_cargo_rep,l_asiento_rep,l_partida_rep FROM ENOC.PLLA_CONFIG_REP  WHERE id_entidad=l_id_entidad AND id_depto=l_id_depto;

          select a.nombreapellido,b.siglas||': '||a.num_documento, a.firma into STRICT l_nombreapellido,l_num_documento,l_firma from enoc.vw_persona_natural a, moises.tipo_documento b
          where a.ID_TIPODOCUMENTO=b.ID_TIPODOCUMENTO and  a.id_persona=l_id_rep;


          case P_PARAMETRO
           when 'REP_CARGO' then
            l_parametro:=l_cargo_rep;
           when 'REP_NOMAPE' then
            l_parametro:=l_nombreapellido;
           when 'REP_DOCUMENTO' then
            l_parametro:=l_num_documento;
          when 'REP_ASIENTO' then
            l_parametro:=l_asiento_rep;
          when 'REP_PARTIDA' then
            l_parametro:=l_partida_rep;
          when 'REP_FIRMA' then
            l_parametro:=l_firma;
           else
            l_parametro:='';
         end case;
        end if;
        P_ERROR:=l_error;
        P_MSGERROR:=l_msgerror;
        P_PARAMETRO_RET:=l_parametro;
      END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enoc.pkg_contract_sp_ptlrepresentante (P_ID_CONTRATO bigint, P_PARAMETRO text,P_PARAMETRO_RET OUT text, P_ERROR OUT bigint,P_MSGERROR out text) FROM PUBLIC;
