-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON

function           FC_MOTIVO_ASIST_MENSUAL(P_ID_TRABAJADOR NUMBER,P_FECHA date) RETURN VARCHAR2
IS
l_dato VARCHAR(10):='A';
l_contar number:=0;
l_contar_fer_ins number:=0;
l_contar_fer number:=0;
l_contar_mar number:=0;
l_fecha date;
l_anho number;
l_mes number;
l_dia number;
l_nrodia number;
l_codigo varchar(10);
l_id_entidad number;
l_id_area number;
l_id_depto varchar2(10);
l_id_tipo_horario number:=0;

BEGIN
    
    l_fecha:= TO_DATE(TO_CHAR(P_FECHA, 'MM/DD/YYYY'), 'MM/DD/YYYY');
    
    select 
    to_number(to_char(l_fecha,'YYYY')),to_number(to_char(l_fecha,'MM')),to_number(to_char(l_fecha,'DD')), to_number(TO_CHAR(l_fecha, 'D', 'NLS_DATE_LANGUAGE=ENGLISH'))
    into 
    l_anho,l_mes,l_dia,l_nrodia 
    from dual;
    
    --licencia y permiso
    select count(*) into l_contar from enoc.VW_LICENCIA_PERMISO_ASIST 
      where id_trabajador=P_ID_TRABAJADOR
      and periodo='D'
      and id_estado_lica_per not in('00','04')
      --and id_estado_lica_per in('03')
      AND (l_fecha between fecha_desde and fecha_hasta);
    
    
    if l_contar>0 then
       l_dato:='PLD';
       GOTO SALIDA;
    end if;
    --vacaciones
    select count(*) into l_contar from enoc.vw_rol_vacacional
    where id_trabajador=P_ID_TRABAJADOR
    and condicion='P'
    --AND ID_PERIODO_VAC_TRAB IN ('02')
    AND (l_fecha between fecha_ini and fecha_fin);
    
    if l_contar>0 then
       l_dato:='V';
       GOTO SALIDA;
    end if;
       
   <<SALIDA>>
	RETURN(l_dato);
END;

