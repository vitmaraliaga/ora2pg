-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_contrato_plantilla (fec_actual, id_contrato, id_entidad, nom_empresa, empresa_ruc, id_depto, id_persona, id_trabajador, id_sedearea, id_perfil_puesto, id_tipo_tiempo_trabajo, id_condicion_laboral, tipo, id_contrato_parent, id_solic_reque, id_solic_req_candidato, fecha_ini, fecha_fin, fecha_ini_f, fecha_fin_f, cv_url, menoredad, menoredad_url, plancap_url, tipo_pago, id_escala_salarial, sueldo, pje_fmr, id_tipo_regimen_laboral, id_tipo_ocupacion, id_tipo_contrato, id_tipo_sctr_pension, sujregalt, sujjortramax, sujjorhornoc, essindicalizado, id_periodo_remu, exotacat, id_situacion_trabajador, id_tipo_pago, id_tipo_categ_ocupa, id_situacion_especial, id_tipo_doble_trib, id_contrato_plantilla, id_estado_cont_depto, observacion, contrato, contarto_url, tregistro_url, id_user_reg, fecha_reg, id_user_mod, fecha_mod, id_licencia_permiso, fecha_inicio_misionero, misionero_url, id_tipo_status, id_grupo_planilla, id_puesto_remp, nombre, paterno, materno, nom_ape, id_tipopais, id_tipodocumento, num_documento, tipo_num, sexo, fec_nacimiento, telefono, celular, correo, id_perfil_puesto_jefe, puesto, id_grupo_escala, id_parent, id_area, subarea, grado_acad, tipodocumento, siglastd, puesto_remp, lic_motivo, area, sueldo_texto, domicilio, tipo_asignar, nacionalidad, genero, fec_nac) AS SELECT 
  (select REGEXP_REPLACE(to_char(sysdate,'day')||' '||to_char(sysdate,'DD')||' de '||to_char(sysdate,'month')||'del '||to_char(sysdate,'YYYY'),
'[[:space:]]{2,}', ' ') FROM dual) AS FEC_ACTUAL,
A.ID_CONTRATO,
A.ID_ENTIDAD, 
ELISEO.FC_EMPRESA_NOMBRE(A.ID_ENTIDAD,'1') AS NOM_EMPRESA,
ELISEO.FC_EMPRESA_RUC(A.ID_ENTIDAD) AS EMPRESA_RUC,
A.ID_DEPTO,
A.ID_PERSONA,
T.ID_TRABAJADOR,
A.ID_SEDEAREA,
A.ID_PERFIL_PUESTO,
A.ID_TIPO_TIEMPO_TRABAJO,
A.ID_CONDICION_LABORAL,
A.TIPO,
A.ID_CONTRATO_PARENT,
A.ID_SOLIC_REQUE,
A.ID_SOLIC_REQ_CANDIDATO,
A.FECHA_INI,
A.FECHA_FIN,
TO_CHAR(A.FECHA_INI,'DD/MM/YYYY') AS FECHA_INI_F,
TO_CHAR(A.FECHA_FIN,'DD/MM/YYYY') AS FECHA_FIN_F,
A.CV_URL,
A.MENOREDAD,
A.MENOREDAD_URL,
A.PLANCAP_URL,
A.TIPO_PAGO,
A.ID_ESCALA_SALARIAL,
CASE WHEN A.ID_CONDICION_LABORAL ='M' THEN (A.PJE_FMR/100)*ES.FMR ELSE  A.SUELDO END AS SUELDO,
A.PJE_FMR,
A.ID_TIPO_REGIMEN_LABORAL,
A.ID_TIPO_OCUPACION,
A.ID_TIPO_CONTRATO,
A.ID_TIPO_SCTR_PENSION,
A.SUJREGALT,
A.SUJJORTRAMAX,
A.SUJJORHORNOC,
A.ESSINDICALIZADO,
A.ID_PERIODO_REMU,
A.EXOTACAT,
A.ID_SITUACION_TRABAJADOR,
A.ID_TIPO_PAGO,
A.ID_TIPO_CATEG_OCUPA,
A.ID_SITUACION_ESPECIAL,
A.ID_TIPO_DOBLE_TRIB,
A.ID_CONTRATO_PLANTILLA,
A.ID_ESTADO_CONT_DEPTO,
A.OBSERVACION,
A.CONTRATO,
A.CONTARTO_URL,
A.TREGISTRO_URL,
A.ID_USER_REG,
A.FECHA_REG,
A.ID_USER_MOD,
A.FECHA_MOD,
A.ID_LICENCIA_PERMISO,
A.FECHA_INICIO_MISIONERO,
A.MISIONERO_URL,
A.ID_TIPO_STATUS,
A.ID_GRUPO_PLANILLA,
A.ID_PUESTO_REMP,
T.NOMBRE,
T.PATERNO,
T.MATERNO,
T.NOMBRE||' '||T.PATERNO||' '||T.MATERNO AS NOM_APE,
T.ID_TIPOPAIS,
T.ID_TIPODOCUMENTO,
T.NUM_DOCUMENTO,
TD.SIGLAS||': '||T.NUM_DOCUMENTO AS TIPO_NUM,
T.SEXO,
T.FEC_NACIMIENTO,
T.TELEFONO,
T.CELULAR,
T.CORREO,
PP.ID_PERFIL_PUESTO_JEFE,
P.NOMBRE AS PUESTO,
P.ID_GRUPO_ESCALA,
AR.ID_PARENT,
AR.ID_AREA,
AR.NOMBRE AS SUBAREA,
SE.NOMBRE AS GRADO_ACAD,
TD.NOMBRE AS TIPODOCUMENTO,
TD.SIGLAS AS SIGLASTD,
PPP.NOMBRE AS PUESTO_REMP,
TS.NOMBRE AS LIC_MOTIVO,
ARA.NOMBRE AS AREA,
ELISEO.FC_NUMERO_TEXTO(CASE WHEN A.ID_CONDICION_LABORAL ='M' THEN (A.PJE_FMR/100)*ES.FMR ELSE  A.SUELDO END) AS SUELDO_TEXTO,
(SELECT X.DIRECCION FROM MOISES.PERSONA_DIRECCION X WHERE X.ID_PERSONA=A.ID_PERSONA AND X.ID_TIPODIRECCION=4 AND X.ID_TIPOVIA IS NOT null AND X.ES_ACTIVO=1 AND ROWNUM=1) AS DOMICILIO,
PP.TIPO_ASIGNAR,
TPA.GENTILICIO AS NACIONALIDAD,
case when T.SEXO=1 then 'Masculino' when T.SEXO=2 then 'Femenino' else '' end as genero,
to_char(T.FEC_NACIMIENTO,'DD/MM/YYYY') as FEC_NAC
FROM ENOC.PLLA_CONTRATO A 
INNER JOIN ENOC.VW_TRABAJADOR T
ON T.ID_PERSONA=A.ID_PERSONA
AND A.ID_ENTIDAD=T.ID_ENTIDAD
INNER JOIN ENOC.PLLA_PERFIL_PUESTO PP
ON PP.ID_PERFIL_PUESTO=A.ID_PERFIL_PUESTO
INNER JOIN ENOC.PLLA_PUESTO P
ON P.ID_PUESTO=PP.ID_PUESTO
INNER JOIN ELISEO.ORG_SEDE_AREA SA
ON SA.ID_SEDEAREA=A.ID_SEDEAREA
INNER JOIN ELISEO.ORG_AREA AR
ON AR.ID_AREA=SA.ID_AREA
LEFT JOIN MOISES.SITUACION_EDUCATIVA  SE
ON SE.ID_SITUACION_EDUCATIVO=T.ID_SITUACION_EDUCATIVO
LEFT JOIN MOISES.TIPO_DOCUMENTO TD
ON TD.ID_TIPODOCUMENTO=T.ID_TIPODOCUMENTO
LEFT JOIN ENOC.PLLA_PUESTO PPP
ON PPP.ID_PUESTO=A.ID_PUESTO_REMP
LEFT JOIN ENOC.PLLA_LICENCIA_PERMISO LI
ON LI.ID_LICENCIA_PERMISO=A.ID_LICENCIA_PERMISO
LEFT JOIN ENOC.PLLA_CONCEPTO_PERM_LIC TS
ON TS.ID_CONCEPTO_PERM_LIC=LI.ID_CONCEPTO_PERM_LIC
LEFT JOIN ENOC.PLLA_PERFIL_PUESTO PPA
ON PPA.ID_PERFIL_PUESTO=PP.ID_PERFIL_PUESTO_AREA
LEFT JOIN ELISEO.ORG_AREA ARA
ON ARA.ID_AREA=PPA.ID_AREA
LEFT JOIN ENOC.PLLA_ESCALA_SALARIAL ES
ON ES.ID_ESCALA_SALARIAL =  A.ID_ESCALA_SALARIAL
LEFT JOIN MOISES.TIPO_PAIS TPA
ON T.ID_TIPOPAIS=TPA.ID_TIPOPAIS;

