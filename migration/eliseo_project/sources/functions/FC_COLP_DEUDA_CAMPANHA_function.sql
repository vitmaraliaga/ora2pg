-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

FUNCTION        FC_COLP_DEUDA_CAMPANHA(P_ID_ASISTENTE_CAMPANHA NUMBER, P_ID_COLPORTOR NUMBER) RETURN NUMBER
IS
l_monto number(10,2):=0.00;
l_total_vendido number(10,2):=0.00;
l_total_depositado number(10,2):=0.00;
l_contar int:=0;
BEGIN

		SELECT ROUND(NVL(SUM(COD.CANTIDAD * COD.PRECIO) + SUM(COD.CANTIDAD * COD.PRECIO)*(10/100),0),2) INTO l_total_vendido
		FROM COLP_OPERACION CO 
		INNER JOIN COLP_OPERACION_DETALLE COD ON
			CO.ID_OPERACION = COD.ID_OPERACION
		WHERE CO.ID_ASISTENTE_CAMPANHA = P_ID_ASISTENTE_CAMPANHA AND CO.ID_COLPORTOR = P_ID_COLPORTOR AND CO.ID_TIPOOPERACION = 2 AND CO.ESTADO = '1';

		SELECT NVL(ROUND(SUM(DEP.MONTO),2),0) INTO l_total_depositado
		FROM COLP_DEPOSITO_COLP DEP
		WHERE DEP.ID_ASISTENTE_CAMPANHA = P_ID_ASISTENTE_CAMPANHA AND DEP.ID_COLPORTOR = P_ID_COLPORTOR;  

		l_monto:= l_total_vendido - l_total_depositado;

RETURN (l_monto);
END;

