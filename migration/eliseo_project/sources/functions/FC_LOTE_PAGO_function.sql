-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

FUNCTION        FC_LOTE_PAGO(P_ID_COMPRA INT) RETURN VARCHAR2 AS
L_NOMBRE VARCHAR2(100);
L_LOTE_PAGO VARCHAR2(100);
    
    CURSOR LOTE IS 
    SELECT DISTINCT D.LOTE INTO L_NOMBRE
    FROM COMPRA A JOIN CAJA_PAGO_COMPRA B ON A.ID_COMPRA = B.ID_COMPRA 
    JOIN CAJA_PAGO C ON B.ID_PAGO = C.ID_PAGO
    JOIN CONTA_VOUCHER D ON C.ID_VOUCHER = D.ID_VOUCHER
    WHERE A.ID_COMPRA = P_ID_COMPRA
    AND D.LOTE like'MB%';
BEGIN
        
    OPEN LOTE;
        FETCH LOTE INTO L_NOMBRE;

        WHILE LOTE%FOUND LOOP

            L_LOTE_PAGO := L_NOMBRE||' '||L_LOTE_PAGO;

            FETCH LOTE INTO L_NOMBRE;

        END LOOP;
    CLOSE LOTE;  
	 
        RETURN(L_LOTE_PAGO);

END;

