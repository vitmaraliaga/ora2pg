-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

FUNCTION fn_Split(
  iv_Texto IN VARCHAR2 )
RETURN fn_Split_pkg.tt_v_Tabla_type PIPELINED
AS
  v_Texto      VARCHAR2(4000) := iv_Texto;
  v_sSeparador CHAR(1)        := ',';
  v_sItem      VARCHAR2(255);
  v_iPos       NUMBER(10,0);
  v_temp       NUMBER(1, 0) := 0;
  v_temp_1 SYS_REFCURSOR;
  v_temp_2 TT_V_TABLA%ROWTYPE;
BEGIN
  v_Texto     := RTRIM(LTRIM(v_Texto)) ;
  v_iPos      := INSTR(v_Texto, v_sSeparador) ;
  WHILE v_iPos > 0
  LOOP
    DECLARE
      v_temp NUMBER(1, 0) := 0;
    BEGIN
      v_sItem := NULLIF(RTRIM(LTRIM(SUBSTR(v_Texto, 1, v_iPos - 1))), ' ') ;
      v_Texto := SUBSTR(v_Texto, v_iPos || LENGTH(v_sSeparador), LENGTH(v_Texto)) ;
      v_iPos  := INSTR(v_Texto, v_sSeparador) ;
      BEGIN
        SELECT 1
        INTO v_temp
        FROM DUAL
        WHERE NOT v_sItem IS NULL
        AND NOT EXISTS
          ( SELECT ITEM FROM tt_v_Tabla WHERE ITEM = v_sItem AND ROWNUM <= 1
          );
      EXCEPTION
      WHEN OTHERS THEN
        NULL;
      END;
      IF v_temp = 1 THEN
        INSERT INTO tt_v_Tabla VALUES
          ( v_sItem
          );
      END IF;
    END;
  END LOOP;
  BEGIN
    SELECT 1
    INTO v_temp
    FROM DUAL
    WHERE NOT NULLIF(v_Texto, ' ') IS NULL
    AND NOT EXISTS
      ( SELECT ITEM FROM tt_v_Tabla WHERE ITEM = v_Texto AND ROWNUM <= 1
      );
  EXCEPTION
  WHEN OTHERS THEN
    NULL;
  END;
  IF v_temp = 1 THEN
    INSERT INTO tt_v_Tabla VALUES
      ( v_Texto
      );
  END IF;
  OPEN v_temp_1 FOR SELECT * FROM tt_v_Tabla;
  LOOP
    FETCH v_temp_1 INTO v_temp_2;
    EXIT
  WHEN v_temp_1%NOTFOUND;
    PIPE ROW ( v_temp_2 );
  END LOOP;
EXCEPTION
WHEN OTHERS THEN
  utils.handleerror(SQLCODE,SQLERRM);
END;

