-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_persona_natural_trabajador (id_persona, paterno, materno, nombre, sexo, fec_nacimiento, nom_persona, id_tipodocumento, num_documento, id_entidad, id_depto, id_cargo, cargo, estado) AS SELECT DISTINCT
          Persona.ID_PERSONA,
          Persona.PATERNO,
          Persona.MATERNO,
          Persona.NOMBRE,
          Persona_Natural.SEXO,
          Persona_Natural.FEC_NACIMIENTO,
             UPPER (
                   NVL (Persona.PATERNO || ' ', '')
                || NVL (Persona.MATERNO || ', ', ''))
          || Persona.NOMBRE
             AS NOM_PERSONA,
          Persona_Documento.ID_TIPODOCUMENTO,
          Persona_Documento.NUM_DOCUMENTO,
          APS_TRABAJADOR.ID_ENTIDAD,
          APS_TRABAJADOR.ID_DEPTO,
          APS_TRABAJADOR.ID_CARGO,
          APS_CARGO.NOMBRE AS CARGO,
          APS_EMPLEADO.ESTADO
     FROM moises.persona
          INNER JOIN moises.Persona_Natural
             ON Persona.ID_PERSONA = Persona_Natural.ID_PERSONA
          INNER JOIN moises.Persona_Documento
             ON Persona.ID_PERSONA = Persona_Documento.ID_PERSONA
          INNER JOIN APS_TRABAJADOR
             ON PERSONA.ID_PERSONA = APS_TRABAJADOR.ID_PERSONA
          INNER JOIN APS_EMPLEADO
             ON     APS_TRABAJADOR.ID_PERSONA = APS_EMPLEADO.ID_PERSONA
                AND APS_TRABAJADOR.ID_ENTIDAD = APS_EMPLEADO.ID_ENTIDAD
          INNER JOIN APS_CARGO
             ON     APS_TRABAJADOR.ID_CARGO = APS_CARGO.ID_CARGO
                AND CASE
                       WHEN NVL (Persona_Natural.ID_TIPOPAIS, 176) = 176
                       THEN
                          1
                       ELSE
                          4
                    END = Persona_Documento.ID_TIPODOCUMENTO;

