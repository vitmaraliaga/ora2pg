-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_colportor_kardex_producto (id_almacen, id_campanha, id_asistente, id_asistente_campanha, id_rcategoria, id_colportor, fecha, id_articulo, precio, entrada, salida) AS SELECT A.ID_ALMACEN, A.ID_CAMPANHA, A.ID_ASISTENTE, A.ID_ASISTENTE_CAMPANHA, A.ID_RCATEGORIA, A.ID_COLPORTOR, O.FECHA,
	OD.ID_ARTICULO, OD.PRECIO, OD.CANTIDAD AS ENTRADA, NULL AS SALIDA 
FROM VW_COLP_INSCRIPCION A
INNER JOIN COLP_OPERACION O ON
	A.ID_ASISTENTE_CAMPANHA = O.ID_ASISTENTE_CAMPANHA AND 
	A.ID_COLPORTOR = O.ID_COLPORTOR AND 
	O.ID_TIPOOPERACION = 1 AND --ENTREGADO
	O.ESTADO = '1' --NO ESTA ELIMINADO
INNER JOIN COLP_OPERACION_DETALLE OD ON
	O.ID_OPERACION = OD.ID_OPERACION
UNION ALL
SELECT A.ID_ALMACEN, A.ID_CAMPANHA, A.ID_ASISTENTE, A.ID_ASISTENTE_CAMPANHA, A.ID_RCATEGORIA, A.ID_COLPORTOR, O.FECHA,
	OD.ID_ARTICULO, OD.PRECIO, NULL AS ENTRADA, OD.CANTIDAD AS SALIDA 
FROM VW_COLP_INSCRIPCION A
INNER JOIN COLP_OPERACION O ON
	A.ID_ASISTENTE_CAMPANHA = O.ID_ASISTENTE_CAMPANHA AND 
	A.ID_COLPORTOR = O.ID_COLPORTOR AND 
	O.ID_TIPOOPERACION IN (2,3,4) AND
	O.ESTADO = '1' --NO ESTA ELIMINADO
INNER JOIN COLP_OPERACION_DETALLE OD ON
	O.ID_OPERACION = OD.ID_OPERACION

ORDER BY FECHA DESC;

