-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_sales_advances (id_entidad, id_depto, id_anho, id_mes, id_persona, id_cliente, id_voucher, id_moneda, serie, numero, fecha, glosa, importe, importe_me, dc) AS SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          A.ID_PERSONA,
          A.ID_CLIENTE,
          A.ID_VOUCHER,
          A.ID_MONEDA,
          A.SERIE,
          A.NUMERO,
          A.FECHA,
          A.GLOSA,
          A.IMPORTE,
          A.IMPORTE_ME,
          B.DC
     FROM VENTA_TRANSFERENCIA A
          JOIN VENTA_TRANSFERENCIA_DETALLE B
             ON A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
    WHERE ESTADO = '1' AND ES_ANTICIPO = 'S' AND B.DC = 'D'
   UNION ALL
   SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          A.ID_PERSONA,
          A.ID_CLIENTE,
          A.ID_VOUCHER,
          A.ID_MONEDA,
          A.SERIE,
          A.NUMERO,
          A.FECHA,
          A.GLOSA,
          (A.IMPORTE * -1) AS IMPORTE,
          (A.IMPORTE_ME * -1) AS IMPORTE_ME,
          B.DC
     FROM VENTA_TRANSFERENCIA A
          JOIN VENTA_TRANSFERENCIA_DETALLE B
             ON A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
    WHERE ESTADO = '1' AND ES_ANTICIPO = 'S' AND B.DC = 'C';

