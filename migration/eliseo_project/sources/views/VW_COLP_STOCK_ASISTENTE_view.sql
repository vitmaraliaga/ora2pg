-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_colp_stock_asistente (id_almacen, id_campanha, id_asistente, id_asistente_campanha, estado, id_articulo, precio, stock_actual, stock_retenido) AS SELECT DISTINCT AKP.ID_ALMACEN, AKP.ID_CAMPANHA, AKP.ID_ASISTENTE, AKP.ID_ASISTENTE_CAMPANHA, AAA.ESTADO, AKP.ID_ARTICULO, 
	(SELECT ROUND(AVG(PRECIO),2) FROM VW_COLP_ASISTENTE_KARDEX_PROD WHERE ID_ASISTENTE_CAMPANHA=AKP.ID_ASISTENTE_CAMPANHA AND ID_ARTICULO=AKP.ID_ARTICULO) AS PRECIO,
	(SELECT SUM(NVL(ENTRADA, 0)) - SUM(NVL(SALIDA, 0)) FROM VW_COLP_ASISTENTE_KARDEX_PROD WHERE ID_ASISTENTE_CAMPANHA=AKP.ID_ASISTENTE_CAMPANHA AND ID_ARTICULO=AKP.ID_ARTICULO) AS STOCK_ACTUAL,
	(SELECT NVL(SUM(ENTRADA),0) - NVL(SUM(SALIDA),0) FROM VW_COLPORTOR_KARDEX_PRODUCTO WHERE ID_ASISTENTE_CAMPANHA = AKP.ID_ASISTENTE_CAMPANHA AND ID_ARTICULO = AKP.ID_ARTICULO) AS STOCK_RETENIDO
FROM VW_COLP_ASISTENTE_KARDEX_PROD AKP
INNER JOIN COLP_ASISTENTE_CAMPANHA AAA ON AKP.ID_ASISTENTE_CAMPANHA = AAA.ID_ASISTENTE_CAMPANHA
--WHERE AAA.ESTADO = '1'
--ORDER BY AKP.ID_ARTICULO
;

