-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_area (id_area, id_parent, id_entidad, id_tipoarea, nombre, nivel, izquierda, derecha, orden, estado, codigo, tienehijo, tipo_area, tipo_area_codigo, num_dep, num_respon, nivelhijo) AS SELECT 
A.ID_AREA,
A.ID_PARENT,
A.ID_ENTIDAD,
A.ID_TIPOAREA,
A.NOMBRE,
A.NIVEL,
A.IZQUIERDA,
A.DERECHA,
A.ORDEN,
A.ESTADO,
A.CODIGO,
(SELECT COUNT(*) FROM ORG_AREA X WHERE X.ID_PARENT=A.ID_AREA ) AS TIENEHIJO,
B.NOMBRE AS TIPO_AREA,
B.CODIGO AS TIPO_AREA_CODIGO,
(SELECT count(*) FROM ORG_SEDE_AREA SA  WHERE SA.ID_AREA = A.id_area) AS NUM_DEP,
(SELECT count(AR.ID_SEDEAREA) FROM ORG_SEDE_AREA SA, ORG_AREA_RESPONSABLE AR  WHERE SA.ID_SEDEAREA=AR.ID_SEDEAREA AND SA.ID_ENTIDAD=A.ID_ENTIDAD AND  SA.ID_AREA = A.id_area  ) AS NUM_RESPON,
A.NIVELHIJO
FROM ORG_AREA A ,TIPO_AREA B
WHERE A.ID_TIPOAREA=B.ID_TIPOAREA;

