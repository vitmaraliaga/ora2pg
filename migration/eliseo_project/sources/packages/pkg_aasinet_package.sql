-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE PACKAGE        PKG_AASINET AS

    FUNCTION FC_GLOSA(
        P_ID_ASIENTO IN NUMBER)
        RETURN VARCHAR2;

END PKG_AASINET;


CREATE OR REPLACE PACKAGE BODY        PKG_AASINET AS

    FUNCTION
        FC_GLOSA(P_ID_ASIENTO IN NUMBER) RETURN VARCHAR2 IS

        P_DESCRIPCION VARCHAR2(500);

    BEGIN

        IF P_ID_ASIENTO IS NOT NULL THEN

            BEGIN

                SELECT SUBSTR(ELISEO.PKG_PURCHASES.FC_RUC(C.ID_PROVEEDOR)
                                  || '/' ||
                              (C.SERIE || '-' || C.NUMERO)
                                  || '/' ||
                              nvl(CD.DETALLE,
                                  (select pr.motivo
                                   from pedido_compra pc,
                                        pedido_registro pr
                                   where pc.id_compra = c.id_compra
                                     and pc.id_pedido = pr.id_pedido)), 1, 59)
                INTO P_DESCRIPCION

                FROM ELISEO.CONTA_ASIENTO CA
                         JOIN ELISEO.COMPRA C ON C.ID_COMPRA = CA.ID_ORIGEN
                         LEFT JOIN ELISEO.COMPRA_DETALLE CD ON CD.ID_COMPRA = C.ID_COMPRA
                WHERE CA.ID_ASIENTO = P_ID_ASIENTO;
            EXCEPTION
                WHEN NO_DATA_FOUND THEN
                    P_DESCRIPCION := NULL;
            END;


        ELSE
            P_DESCRIPCION := NULL;
        END IF;

        RETURN P_DESCRIPCION;

    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('ERROR EN FC_GLOSA: ' || SQLERRM);
    END FC_GLOSA;


END PKG_AASINET;