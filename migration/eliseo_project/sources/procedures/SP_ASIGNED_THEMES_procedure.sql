-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

PROCEDURE SP_ASIGNED_THEMES(P_DATO NUMBER) IS
    P_ID NUMBER;
    P_ENTIDAD NUMBER;
    P_DEPTO VARCHAR2(10);
    P_CANT NUMBER;
    
    CURSOR USERSS IS
    SELECT DISTINCT A.ID,B.ID_ENTIDAD,C.ID_DEPTO
    FROM USERS A, CONTA_ENTIDAD_USUARIO B, LAMB_USERS_DEPTO C
    WHERE A.ID = B.ID_PERSONA
    AND B.ID_PERSONA = C.ID
    AND LENGTH(C.ID_DEPTO) = '1';
    
    BEGIN
        
        OPEN USERSS;
            FETCH USERSS INTO P_ID,P_ENTIDAD,P_DEPTO;
            WHILE USERSS%FOUND LOOP
        

                SELECT COUNT(*) INTO P_CANT
                FROM  LAMB_ENTIDAD_DEPTO_CONFIG
                WHERE ID = P_ID
                AND ID_ENTIDAD = P_ENTIDAD
                AND ID_DEPTO = P_DEPTO
                AND ID_MODULO = 6
                AND ID_TEMA = 8;

                IF P_CANT = 0 THEN
                    SELECT COUNT(*) INTO P_CANT FROM LAMB_USERS_DEPTO
                    WHERE ID = P_ID
                    AND ID_ENTIDAD = P_ENTIDAD
                    AND ID_DEPTO = P_DEPTO;
                    IF P_CANT = 0 THEN
                        P_CANT := P_CANT;
                    ELSE
                        INSERT INTO LAMB_ENTIDAD_DEPTO_CONFIG(ID,ID_ENTIDAD,ID_DEPTO,ID_MODULO,ID_TEMA,FECHA)VALUES(P_ID,P_ENTIDAD,P_DEPTO,6,8,SYSDATE);
                    END IF;
                END IF;
        
            FETCH USERSS INTO P_ID,P_ENTIDAD,P_DEPTO;
                
            END LOOP;
        CLOSE USERSS;

END;

