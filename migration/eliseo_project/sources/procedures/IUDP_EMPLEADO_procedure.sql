-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

PROCEDURE        IUDP_EMPLEADO (

P_Modo int, P_ID_ENTIDAD int, P_ID_PERSONA int, P_ID_CONTRATO int, P_ID_REGIMENLABORAL int, P_ES_DISCAPACITADO VARCHAR2, P_FEC_INICIOAFP varchar2, P_FEC_INICIOONP varchar2, P_ID_CATEGORIAOCUPACIONAL int,
                                      P_ID_TIPOCONTRATO int, P_ID_TIPOPAGO int, P_ID_PAGOPERIODO int, P_ID_TIPOJORNADA int, P_ID_REGIMENSALUD int, P_ID_TIPOCESE int, P_COD_EPS varchar2, P_COD_APS varchar2, 
                                      P_COD_ASISTENCIA int, P_FEC_INICIO varchar2, P_FEC_TERMINO varchar2, P_FEC_ENTIDAD varchar2, P_FEC_MISIONERO varchar2,P_ENTIDADDEPTO varchar2,P_LICENCIA_ACTIVO_CODE varchar2, P_FONDO VARCHAR2
) AS

  S_CANTIDAD INT;
 L_ID_ENTIDAD VARCHAR2(8 byte);
  L_ID_DEPTO VARCHAR2(8 byte);
  L_ESTADO VARCHAR2(2 byte);
BEGIN

  IF P_Modo = 0 THEN

  
  S_CANTIDAD := 0;
  SELECT COUNT(*) INTO S_CANTIDAD FROM APS_TRABAJADOR WHERE ID_PERSONA = P_ID_PERSONA;
  
  IF S_CANTIDAD = 0 THEN 
  		INSERT INTO APS_TRABAJADOR (ID_PERSONA, ID_REGIMENLABORAL, ES_DISCAPACITADO, FEC_INICIOAFP, FEC_INICIOONP)
        VALUES (P_ID_PERSONA, 2, P_ES_DISCAPACITADO, to_date(P_FEC_INICIOAFP,'yyyy-mm-dd'), to_date(P_FEC_INICIOONP,'yyyy-mm-dd'));
  ELSE
      UPDATE APS_TRABAJADOR SET
        ID_REGIMENLABORAL = P_ID_REGIMENLABORAL,
        ES_DISCAPACITADO  = P_ES_DISCAPACITADO,
        FEC_INICIOAFP     = to_date(P_FEC_INICIOAFP,'yyyy-mm-dd'),
        FEC_INICIOONP     = to_date(P_FEC_INICIOONP,'yyyy-mm-dd')
      WHERE ID_PERSONA = P_ID_PERSONA;
  END IF;

  SELECT SUBSTR(P_ENTIDADDEPTO, 1, INSTR(P_ENTIDADDEPTO, '-')-1),
       SUBSTR(P_ENTIDADDEPTO, INSTR(P_ENTIDADDEPTO, '-')+1)
       into L_ID_DEPTO,L_ESTADO
  FROM dual;
  
  IF P_FEC_TERMINO IS  NULL THEN
    UPDATE APS_TRABAJADOR SET
        ID_ENTIDAD = P_ID_ENTIDAD,
        ID_DEPTO  = L_ID_DEPTO
      WHERE ID_PERSONA = P_ID_PERSONA;
  END IF;
  
  S_CANTIDAD := 0;
  
  SELECT COUNT(*) INTO S_CANTIDAD FROM APS_EMPLEADO WHERE ID_ENTIDAD = P_ID_ENTIDAD AND ID_PERSONA = P_ID_PERSONA AND ID_CONTRATO = P_ID_CONTRATO;
  
  IF S_CANTIDAD = 0 THEN 
      INSERT INTO APS_EMPLEADO (ID_ENTIDAD, ID_PERSONA, ID_CONTRATO, ID_CATEGORIAOCUPACIONAL, ID_TIPOCONTRATO, ID_TIPOPAGO, ID_PAGOPERIODO, ID_TIPOJORNADA, ID_REGIMENSALUD, ID_RUC, ID_TIPOCESE, COD_APS, COD_ASISTENCIA, FEC_INICIO, FEC_TERMINO, FEC_ENTIDAD, FEC_MISIONERO,ID_DEPTO,ESTADO, LICENCIA_ACTIVO_CODE, FONDO)
        VALUES (P_ID_ENTIDAD, P_ID_PERSONA, P_ID_CONTRATO, P_ID_CATEGORIAOCUPACIONAL, P_ID_TIPOCONTRATO, P_ID_TIPOPAGO, P_ID_PAGOPERIODO, P_ID_TIPOJORNADA, P_ID_REGIMENSALUD, NULLIF(P_COD_EPS, ''), NULLIF(P_ID_TIPOCESE, 0), P_COD_APS, P_COD_ASISTENCIA, to_date(P_FEC_INICIO,'yyyy-mm-dd"T"HH24:MI:SS'), to_date(P_FEC_TERMINO,'yyyy-mm-dd"T"HH24:MI:SS') , to_date(P_FEC_ENTIDAD,'yyyy-mm-dd"T"HH24:MI:SS') , to_date(P_FEC_MISIONERO,'yyyy-mm-dd"T"HH24:MI:SS'),L_ID_DEPTO,L_ESTADO,
       P_LICENCIA_ACTIVO_CODE, P_FONDO);
  ELSE
	UPDATE APS_EMPLEADO SET
        ID_CATEGORIAOCUPACIONAL = P_ID_CATEGORIAOCUPACIONAL,
        ID_TIPOCONTRATO         = P_ID_TIPOCONTRATO,
        ID_TIPOPAGO             = P_ID_TIPOPAGO,
        ID_PAGOPERIODO          = P_ID_PAGOPERIODO,
        ID_TIPOJORNADA          = P_ID_TIPOPAGO,
        ID_REGIMENSALUD         = P_ID_REGIMENSALUD,
        ID_RUC                  = NULLIF(P_COD_EPS, ''),
        ID_TIPOCESE             = NULLIF(P_ID_TIPOCESE, 0),
        FEC_INICIO              = to_date(P_FEC_INICIO,'yyyy-mm-dd'),
        FEC_TERMINO             = to_date(P_FEC_TERMINO,'yyyy-mm-dd'),
        FEC_ENTIDAD             = to_date(P_FEC_ENTIDAD,'yyyy-mm-dd'),
        FEC_MISIONERO           = to_date(P_FEC_MISIONERO,'yyyy-mm-dd'),
        COD_ASISTENCIA          = P_COD_ASISTENCIA,
        ID_DEPTO                = L_ID_DEPTO,
        ESTADO                  = L_ESTADO,
        LICENCIA_ACTIVO_CODE    = P_LICENCIA_ACTIVO_CODE,
        FONDO    				= P_FONDO
      WHERE ID_ENTIDAD = P_ID_ENTIDAD
        AND ID_PERSONA = P_ID_PERSONA
        AND ID_CONTRATO = P_ID_CONTRATO;
  END IF;  
  
  END IF; 
END;

