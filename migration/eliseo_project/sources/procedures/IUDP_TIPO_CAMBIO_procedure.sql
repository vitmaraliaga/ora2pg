-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

PROCEDURE        iudp_Tipo_Cambio (P_Modo IN int, P_ID_MONEDA IN int, P_NOMBRE IN varchar2, P_FECHA IN varchar2, P_COS_COMPRA IN NUMBER, P_COS_VENTA IN NUMBER) AS
 	S_CANTIDAD            INT;
	S_ID_MONEDA            INT;
	S_COS_VENTA			NUMBER;
	S_FECHA				DATE;
    
 BEGIN
	 
IF P_Modo = 0 THEN

	S_FECHA := to_date(P_FECHA,'yyyy-mm-dd"T"HH24:MI:SS');

	S_COS_VENTA := CASE WHEN P_COS_VENTA = 0 THEN P_COS_COMPRA ELSE P_COS_VENTA END;
	S_ID_MONEDA := P_ID_MONEDA;
	IF S_ID_MONEDA = 0 THEN 
		SELECT ID_MONEDA INTO S_ID_MONEDA FROM CONTA_MONEDA WHERE NOMBRE = P_NOMBRE;
	END IF;
    
    SELECT COUNT(*) INTO S_CANTIDAD FROM TIPO_CAMBIO WHERE ID_MONEDA = S_ID_MONEDA AND FECHA = S_FECHA; 
    
    IF S_CANTIDAD = 0 THEN
    
    	NULL;
    
      INSERT INTO Tipo_Cambio (ID_MONEDA, FECHA, COS_COMPRA, COS_VENTA, COS_DENOMINACIONAL )
        VALUES (S_ID_MONEDA, S_FECHA, P_COS_COMPRA, S_COS_VENTA, S_COS_VENTA);
        
    
    ELSE
    
        	NULL;
        
      UPDATE Tipo_Cambio SET
        COS_COMPRA = P_COS_COMPRA,
        COS_VENTA = S_COS_VENTA,
        COS_DENOMINACIONAL = S_COS_VENTA
      WHERE ID_MONEDA = S_ID_MONEDA
        AND FECHA = S_FECHA;
	    
    END IF;  

  END IF;

   
 end;

