-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_colp_stock_colportor (id_almacen, id_campanha, id_colportor, id_articulo, id_rcategoria, id_asistente_campanha, precio, stock_actual) AS SELECT DISTINCT CKP.ID_ALMACEN, CKP.ID_CAMPANHA, CKP.ID_COLPORTOR, CKP.ID_ARTICULO, CKP.ID_RCATEGORIA, CKP.ID_ASISTENTE_CAMPANHA,
(SELECT round((AVG(PRECIO))::numeric,2) 
	FROM VW_COLPORTOR_KARDEX_PRODUCTO 
	WHERE ID_ASISTENTE_CAMPANHA=CKP.ID_ASISTENTE_CAMPANHA AND ID_COLPORTOR=CKP.ID_COLPORTOR AND ID_ARTICULO=CKP.ID_ARTICULO)  AS PRECIO, 
(SELECT SUM(coalesce(ENTRADA, 0))-SUM(coalesce(SALIDA, 0)) 
	FROM VW_COLPORTOR_KARDEX_PRODUCTO 
	WHERE ID_ASISTENTE_CAMPANHA=CKP.ID_ASISTENTE_CAMPANHA AND ID_COLPORTOR=CKP.ID_COLPORTOR AND ID_ARTICULO=CKP.ID_ARTICULO)  AS STOCK_ACTUAL
FROM VW_COLPORTOR_KARDEX_PRODUCTO CKP;

