-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_venta_despacho_mov (id_entidad, id_depto, id_anho, id_mes, id_venta, id_articulo, id_vdetalle, id_almacen, detalle, cantidad, cantidad_inicial, precio, importe) AS SELECT
	A.ID_ENTIDAD,
	A.ID_DEPTO,
	A.ID_ANHO,
	A.ID_MES,
	A.ID_VENTA,
	B.ID_ARTICULO,
	B.ID_VDETALLE,
	B.ID_ALMACEN ,
	C.NOMBRE AS DETALLE,
	B.CANTIDAD,
	B.CANTIDAD AS CANTIDAD_INICIAL,
	B.PRECIO,
    B.IMPORTE
FROM ELISEO.VENTA A INNER JOIN ELISEO.VENTA_DETALLE B ON A.ID_VENTA = B.ID_VENTA 
INNER JOIN ELISEO.INVENTARIO_ARTICULO C ON B.ID_ARTICULO =C.ID_ARTICULO 
WHERE A.ESTADO ='1' AND A.ES_AUTOENTREGA ='0'

UNION ALL

SELECT  
  		 A.ID_ENTIDAD,
  		 A.ID_DEPTO,
  		 A.ID_ANHO,
         A.ID_MES,
         A.ID_VENTA,
         B.ID_ARTICULO,
         B.ID_VDETALLE,
         A.ID_ALMACEN ,
         C.NOMBRE AS DETALLE,
         (B.CANTIDAD*-1) AS CANTIDAD,
         0 AS CANTIDAD_INICIAL,
         (B.PRECIO*-1) AS PRECIO,
         (B.IMPORTE*-1) AS IMPORTE
   FROM eliseo.VENTA_MOVIMIENTO A 
   	INNER JOIN eliseo.VENTA_MOVIMIENTO_DETALLE B ON A.ID_VMOVIMIENTO = B.ID_VMOVIMIENTO
   	INNER JOIN ELISEO.INVENTARIO_ARTICULO C ON B.ID_ARTICULO =C.ID_ARTICULO 
   	WHERE A.ESTADO ='1';

