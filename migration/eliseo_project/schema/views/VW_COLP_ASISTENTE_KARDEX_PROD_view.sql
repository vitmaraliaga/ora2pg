-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_colp_asistente_kardex_prod (id_almacen, id_campanha, id_asistente, id_asistente_campanha, id_rcategoria, fecha, id_articulo, precio, entrada, salida, motivo) AS SELECT A.ID_ALMACEN, A.ID_CAMPANHA, A.ID_ASISTENTE, A.ID_ASISTENTE_CAMPANHA, A.ID_RCATEGORIA, P.FECHA, PD.ID_ARTICULO, PD.PRECIO,
	PD.CANT_RECIBIDA AS ENTRADA, NULL AS SALIDA, 'Recepción Sucursal' AS MOTIVO
FROM COLP_ASISTENTE_CAMPANHA A
INNER JOIN COLP_PEDIDO P ON
	A.ID_ALMACEN = P.ID_ALMACEN_ORIGEN AND
	A.ID_CAMPANHA = P.ID_CAMPANHA AND 
	A.ID_ASISTENTE_CAMPANHA = P.ID_ASISTENTE_CAMPANHA AND
	P.ID_ESTADO = 6 --RECIBIDO
INNER JOIN COLP_PEDIDO_DETALLE PD ON
	P.ID_PEDIDO = PD.ID_PEDIDO

UNION ALL
(SELECT A.ID_ALMACEN, A.ID_CAMPANHA, A.ID_ASISTENTE, A.ID_ASISTENTE_CAMPANHA, A.ID_RCATEGORIA, O.FECHA, OD.ID_ARTICULO, OD.PRECIO,
	NULL AS ENTRADA, OD.CANTIDAD AS SALIDA, 'Entrega a colportor' AS MOTIVO
FROM COLP_ASISTENTE_CAMPANHA A
INNER JOIN COLP_OPERACION O ON
	A.ID_ASISTENTE_CAMPANHA = O.ID_ASISTENTE_CAMPANHA AND
	O.ID_TIPOOPERACION = 1 AND  --ENTREGADO
	O.ESTADO = '1' --NO ESTA ELIMINADO
INNER JOIN COLP_OPERACION_DETALLE OD ON
	O.ID_OPERACION = OD.ID_OPERACION

UNION ALL

SELECT A.ID_ALMACEN, A.ID_CAMPANHA, A.ID_ASISTENTE, A.ID_ASISTENTE_CAMPANHA, A.ID_RCATEGORIA, O.FECHA, OD.ID_ARTICULO, OD.PRECIO,
	OD.CANTIDAD AS ENTRADA, NULL AS SALIDA, 'Devolución Interna' AS MOTIVO
FROM COLP_ASISTENTE_CAMPANHA A
INNER JOIN COLP_OPERACION O ON
	A.ID_ASISTENTE_CAMPANHA = O.ID_ASISTENTE_CAMPANHA AND
	O.ID_TIPOOPERACION = 3 AND  --DEVOLUCION INTERNA
	O.ESTADO = '1' --NO ESTA ELIMINADO
INNER JOIN COLP_OPERACION_DETALLE OD ON
	O.ID_OPERACION = OD.ID_OPERACION
)


ORDER BY FECHA DESC;

