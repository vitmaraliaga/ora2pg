-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_sales_articulo_saldo_col (id_entidad, id_depto, id_anho, id_articulo, id_cliente, id_sucursal, importe, importe_me, debe, haber, saldo_debe) AS SELECT
	ID_ENTIDAD,ID_DEPTO,ID_ANHO, ID_ARTICULO, ID_CLIENTE,ID_SUCURSAL,
    SUM(IMPORTE) IMPORTE,
    SUM(IMPORTE_ME) IMPORTE_ME,
    SUM(CASE WHEN IMPORTE > 0 THEN IMPORTE ELSE 0 END) DEBE,
    SUM(CASE WHEN IMPORTE > 0 THEN 0 ELSE IMPORTE END) HABER,
    --SUM(CASE WHEN IMPORTE > 0 THEN (CASE WHEN DOCUMENTO_MOV ='Dev.' THEN (-1)*IMPORTE ELSE importe END) ELSE 0 END) SALDO_DEBE -- Agregado por @vitmaraliaga
    SUM(CASE WHEN DOCUMENTO_MOV = 'Dev.' THEN 0 ELSE CASE WHEN IMPORTE > 0 THEN IMPORTE ELSE 0 END END ) AS SALDO_DEBE
    --,SUM(TOTAL) TOTAL
    --,SUM(TOTAL_ME) TOTAL_ME 
	FROM VW_SALES_DETAIL_MOV_COL
	GROUP BY ID_ENTIDAD,ID_DEPTO,ID_ANHO,ID_ARTICULO,ID_CLIENTE,ID_SUCURSAL;

