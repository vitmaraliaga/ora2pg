-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_conta_diario (id_diario, id_diario_detalle, id_empresa, id_entidad, id_anho, id_mes, id_tipoasiento, cod_aasi, fec_asiento, fec_digitado, fec_contabilizado, nom_digitador, nom_contador, id_fondo, id_tipoplan, id_cuentaaasi, id_restriccion, id_ctacte, id_depto, num_aasi, comentario, observacion, cos_valor, cos_dolar, codigo, orden, lote, debe, haber) AS SELECT
  CONTA_DIARIO.ID_DIARIO,
  CONTA_DIARIO_DETALLE.ID_DIARIO_DETALLE,
  CONTA_ENTIDAD.ID_EMPRESA,
  CONTA_DIARIO.ID_ENTIDAD,
  CONTA_DIARIO.ID_ANHO,
  CONTA_DIARIO.ID_MES,
  CONTA_DIARIO.ID_TIPOASIENTO,
  CONTA_DIARIO.COD_AASI,
  CONTA_DIARIO.FEC_ASIENTO,
  CONTA_DIARIO.FEC_DIGITADO,
  CONTA_DIARIO.FEC_CONTABILIZADO,
  CONTA_DIARIO.NOM_DIGITADOR,
  CONTA_DIARIO.NOM_CONTADOR,
  CONTA_DIARIO_DETALLE.ID_FONDO,
  CONTA_DIARIO_DETALLE.ID_TIPOPLAN,
  CONTA_DIARIO_DETALLE.ID_CUENTAAASI,
  CONTA_DIARIO_DETALLE.ID_RESTRICCION,
  CONTA_DIARIO_DETALLE.ID_CTACTE,
  CONTA_DIARIO_DETALLE.ID_DEPTO,
  CONTA_DIARIO_DETALLE.NUM_AASI,
  CONTA_DIARIO_DETALLE.COMENTARIO,
  CONTA_DIARIO_DETALLE.OBSERVACION,
  CONTA_DIARIO_DETALLE.COS_VALOR,
  CONTA_DIARIO_DETALLE.COS_DOLAR,
  CONTA_DIARIO.ID_TIPOASIENTO || ' ' || CAST(CONTA_DIARIO.COD_AASI AS varchar(10)) || '-' || CONTA_DIARIO_DETALLE.NUM_AASI AS CODIGO,
    coalesce(Orden.ORDEN, 1) AS ORDEN,
  CAST(CONTA_DIARIO.ID_ENTIDAD AS varchar(10)) || '-' || CONTA_DIARIO.ID_TIPOASIENTO || ' ' || CAST(CONTA_DIARIO.COD_AASI AS varchar(10)) AS LOTE,
  CASE WHEN CONTA_DIARIO_DETALLE.COS_VALOR > 0 THEN ABS(round((CONTA_DIARIO_DETALLE.COS_VALOR)::numeric, 2)) ELSE 0 END AS DEBE,
  CASE WHEN CONTA_DIARIO_DETALLE.COS_VALOR < 0 THEN ABS(round((CONTA_DIARIO_DETALLE.COS_VALOR)::numeric, 2)) ELSE 0 END AS HABER
FROM CONTA_ENTIDAD
INNER JOIN CONTA_DIARIO ON
  CONTA_ENTIDAD.ID_ENTIDAD = CONTA_DIARIO.ID_ENTIDAD
INNER JOIN CONTA_DIARIO_DETALLE ON
  CONTA_DIARIO.ID_ENTIDAD = CONTA_DIARIO_DETALLE.ID_ENTIDAD AND
  CONTA_DIARIO.ID_DIARIO = CONTA_DIARIO_DETALLE.ID_DIARIO
LEFT JOIN(
  SELECT
    'BB%' AS ID_TIPOASIENTO,
    0 AS ORDEN

  
UNION

  SELECT
    'EA%' AS ID_TIPOASIENTO,
    8 AS ORDEN
  
  
UNION

  SELECT
    'EB%' AS ID_TIPOASIENTO,
    9 AS ORDEN 
  ) Orden ON
  CONTA_DIARIO.ID_TIPOASIENTO LIKE Orden.ID_TIPOASIENTO 
WHERE CONTA_DIARIO.ID_TIPOASIENTO <> 'AJ';

