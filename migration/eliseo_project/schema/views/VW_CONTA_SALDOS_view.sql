-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_conta_saldos (id_empresa, id_entidad, id_anho, id_mes, id_depto, id_fondo, id_tipoplan, id_cuentaaasi, id_restriccion, id_ctacte, debe, haber, saldo) AS SELECT
  CONTA_ENTIDAD.ID_EMPRESA,
  CONTA_DIARIO.ID_ENTIDAD,
  CONTA_DIARIO.ID_ANHO,
  CONTA_DIARIO.ID_MES,
  CONTA_DIARIO_Detalle.ID_DEPTO,
  CONTA_DIARIO_Detalle.ID_FONDO,
  CONTA_DIARIO_Detalle.ID_TIPOPLAN,
  CONTA_DIARIO_Detalle.ID_CUENTAAASI,
  CONTA_DIARIO_Detalle.ID_RESTRICCION,
  CONTA_DIARIO_Detalle.ID_CTACTE,
  SUM(CASE WHEN CONTA_DIARIO_DETALLE.COS_VALOR > 0 THEN ABS(round((CONTA_DIARIO_DETALLE.COS_VALOR)::numeric, 2)) ELSE 0 END) AS DEBE,
  SUM(CASE WHEN CONTA_DIARIO_DETALLE.COS_VALOR < 0 THEN ABS(round((CONTA_DIARIO_DETALLE.COS_VALOR)::numeric, 2)) ELSE 0 END) AS HABER,
  SUM(CASE WHEN CONTA_DIARIO_DETALLE.COS_VALOR > 0 THEN ABS(round((CONTA_DIARIO_DETALLE.COS_VALOR)::numeric, 2)) ELSE 0 END) - SUM(CASE WHEN CONTA_DIARIO_DETALLE.COS_VALOR < 0 THEN ABS(round((CONTA_DIARIO_DETALLE.COS_VALOR)::numeric, 2)) ELSE 0 END) AS SALDO
FROM CONTA_ENTIDAD
INNER JOIN CONTA_DIARIO ON
  CONTA_ENTIDAD.ID_ENTIDAD = CONTA_DIARIO.ID_ENTIDAD
INNER JOIN CONTA_DIARIO_DETALLE ON
  CONTA_DIARIO.ID_ENTIDAD = CONTA_DIARIO_Detalle.ID_ENTIDAD AND
  CONTA_DIARIO.ID_DIARIO = CONTA_DIARIO_Detalle.ID_DIARIO
WHERE NOT CONTA_DIARIO.ID_TIPOASIENTO LIKE 'EA%'
  AND NOT CONTA_DIARIO.ID_TIPOASIENTO LIKE 'EB%'
  AND NOT CONTA_DIARIO.ID_TIPOASIENTO LIKE 'AJ%'
GROUP BY
  CONTA_ENTIDAD.ID_EMPRESA,
  CONTA_DIARIO.ID_ENTIDAD,
  CONTA_DIARIO.ID_ANHO,
  CONTA_DIARIO.ID_MES,
  CONTA_DIARIO_Detalle.ID_DEPTO,
  CONTA_DIARIO_Detalle.ID_FONDO,
  CONTA_DIARIO_Detalle.ID_TIPOPLAN,
  CONTA_DIARIO_Detalle.ID_CUENTAAASI,
  CONTA_DIARIO_Detalle.ID_RESTRICCION,
  CONTA_DIARIO_Detalle.ID_CTACTE;

