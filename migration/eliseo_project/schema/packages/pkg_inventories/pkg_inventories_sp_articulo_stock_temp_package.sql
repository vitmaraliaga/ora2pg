-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_inventories,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_inventories_sp_articulo_stock_temp (P_ID_ALMACEN bigint, P_ID_ARTICULO bigint, P_ID_ANHO bigint, P_STOCK_T OUT bigint, P_MSN OUT text) AS $body$
DECLARE

        L_ARTICULO bigint;

BEGIN
            
            SELECT 
                    COUNT(B.ID_ARTICULO) INTO STRICT L_ARTICULO
            FROM INVENTARIO_MOVIMIENTO A,INVENTARIO_DETALLE B
            WHERE A.ID_MOVIMIENTO = B.ID_MOVIMIENTO
            AND A.ID_ALMACEN = P_ID_ALMACEN
            AND A.ID_ANHO = P_ID_ANHO
            AND B.ID_ARTICULO = P_ID_ARTICULO
            AND TO_CHAR(A.FECHA,'DD/MM/YYYY') = TO_CHAR(clock_timestamp(),'DD/MM/YYYY')
            AND A.ESTADO = '0'
            AND B.ESTADO = '0';

            IF L_ARTICULO = 0 THEN
                P_STOCK_T := 0;
                P_MSN := 'ARTICULO NO TIENE DATOS';
            ELSE
                SELECT
                        coalesce(SUM(B.CANTIDAD),0) INTO STRICT P_STOCK_T
                FROM INVENTARIO_MOVIMIENTO A,INVENTARIO_DETALLE B
                WHERE A.ID_MOVIMIENTO = B.ID_MOVIMIENTO
                AND A.ID_ALMACEN = P_ID_ALMACEN
                AND A.ID_ANHO = P_ID_ANHO
                AND B.ID_ARTICULO = P_ID_ARTICULO
                AND TO_CHAR(A.FECHA,'DD/MM/YYYY') = TO_CHAR(clock_timestamp(),'DD/MM/YYYY')
                AND A.ESTADO = '0'
                AND B.ESTADO = '0';

                P_MSN := 'STOCK MAYOR A 0';
            END IF;
        END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_inventories_sp_articulo_stock_temp (P_ID_ALMACEN bigint, P_ID_ARTICULO bigint, P_ID_ANHO bigint, P_STOCK_T OUT bigint, P_MSN OUT text) FROM PUBLIC;
