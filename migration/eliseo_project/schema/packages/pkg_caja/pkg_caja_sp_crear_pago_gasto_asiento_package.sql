-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_caja,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_caja_sp_crear_pago_gasto_asiento (P_ID_FONDO bigint,P_ID_DEPTO text,P_ID_CUENTAAASI text, P_ID_RESTRICCION text,P_ID_CTACTE text, P_IMPORTE bigint,P_IMPORTE_ME bigint,P_IS_DC text, P_DESCRIPCION text, P_ID_PGASTO bigint,P_ERROR OUT bigint, P_ID_GASIENTO INOUT bigint ) AS $body$
DECLARE

        L_EDITABLE varchar(1) := 'S';
        -- L_ID_PARENT numeric := NULL;
        L_ID_TIPOREGISTRO varchar(1) := 'D';
        -- L_DC varchar(1) := NULL;
        -- L_DC_HIJO varchar(1) := NULL;
        -- L_DC_HIJO_CONTRA varchar(1) := NULL;
        L_IMPORTE bigint := 0;
        L_IMPORTE_ME bigint := 0;
        L_IS_DC varchar(10) := '';

        l_id_gasiento bigint;
        l_error bigint:=0;

BEGIN
        l_error:=0;
		L_IS_DC := P_IS_DC;
       	IF L_IS_DC = 'False' OR L_IS_DC = 'false' THEN  -- Arreglo para evitar errores 
       		L_IS_DC := 'D';
       	END IF;
       	
        IF L_IS_DC = 'C' THEN
            L_IMPORTE := (P_IMPORTE)*(-1);
            L_IMPORTE_ME := (P_IMPORTE_ME)*(-1);
        ELSE
            L_IMPORTE := P_IMPORTE;
            L_IMPORTE_ME := P_IMPORTE_ME;
        END IF;

        if l_error=0 then
            --SELECT NVL(MAX(ID_GASIENTO),0)+1 INTO l_id_gasiento FROM CAJA_PAGO_GASTO_ASIENTO;
            INSERT INTO CAJA_PAGO_GASTO_ASIENTO(
                --ID_GASIENTO, 
                ID_PGASTO, ID_CUENTAAASI, ID_RESTRICCION, ID_CTACTE, ID_FONDO, 
                ID_DEPTO, IMPORTE, IMPORTE_ME, DESCRIPCION, EDITABLE, ID_PARENT, ID_TIPOREGISTRO, DC, AGRUPA)
            VALUES (
                --l_id_gasiento, 
                P_ID_PGASTO, P_ID_CUENTAAASI, P_ID_RESTRICCION, P_ID_CTACTE, P_ID_FONDO,
                P_ID_DEPTO, L_IMPORTE, L_IMPORTE_ME, 
                SUBSTR(P_DESCRIPCION,0,50),
                L_EDITABLE, null, L_ID_TIPOREGISTRO, L_IS_DC, 'N') RETURNING ID_GASIENTO INTO l_id_gasiento;
        end if;

        P_ID_GASIENTO :=l_id_gasiento;
        P_ERROR:=l_error;
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_caja_sp_crear_pago_gasto_asiento (P_ID_FONDO bigint,P_ID_DEPTO text,P_ID_CUENTAAASI text, P_ID_RESTRICCION text,P_ID_CTACTE text, P_IMPORTE bigint,P_IMPORTE_ME bigint,P_IS_DC text, P_DESCRIPCION text, P_ID_PGASTO bigint,P_ERROR OUT bigint, P_ID_GASIENTO INOUT bigint ) FROM PUBLIC;
