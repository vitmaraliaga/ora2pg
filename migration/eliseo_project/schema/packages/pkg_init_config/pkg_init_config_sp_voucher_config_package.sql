-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_init_config,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_init_config_sp_voucher_config (P_ID_ENTIDAD bigint,P_ID_DEPTO text, P_ID_ANHO bigint, P_ERROR OUT bigint,P_MSGERROR out text) AS $body$
DECLARE

        l_contar bigint := 0;
        l_id_entidad_base bigint := 72122;
        l_id_depto_base varchar(15) := '121211';
        l_id_user bigint := 7932;
        l_id_sistemaexterno bigint;

        datos_base CURSOR FOR
        SELECT * from conta_voucher_config
        where id_entidad = l_id_entidad_base
        and id_depto = l_id_depto_base
        and id_anho = P_ID_ANHO;


BEGIN
        FOR dato_base in datos_base LOOP

            select count(1) into STRICT l_contar from conta_voucher_config
                where id_entidad = P_ID_ENTIDAD
                and id_depto = P_ID_DEPTO
                and id_anho = P_ID_ANHO
                and id_tipoasiento = dato_base.id_tipoasiento
                and id_tipovoucher = dato_base.id_tipovoucher;

            select max(id_sistemaexterno) into STRICT l_id_sistemaexterno
            from eliseo.sistema_externo 
            where id_entidad = P_ID_ENTIDAD
            and id_depto = P_ID_DEPTO 
            and id_tipoasiento = dato_base.id_tipoasiento;


            if l_contar = 0 then
                insert into conta_voucher_config(
                    ID_ENTIDAD,
                    ID_DEPTO,
                    ID_TIPOASIENTO,
                    ID_ANHO,
                    ID_MODULO,
                    FECHA,
                    AUTOMATICO,
                    NOMBRE,
                    ID_TIPOVOUCHER,
                    ID_SISTEMAEXTERNO,
                    ID_TIPOASIENTO_PARENT
                )
                values (
                    P_ID_ENTIDAD,
                    P_ID_DEPTO,
                    dato_base.id_tipoasiento,
                    P_ID_ANHO,
                    dato_base.ID_MODULO,
                    dato_base.FECHA,
                    dato_base.AUTOMATICO,
                    dato_base.NOMBRE,
                    dato_base.id_tipovoucher,
                    l_id_sistemaexterno,
                    dato_base.ID_TIPOASIENTO_PARENT
                );
                RAISE NOTICE 'conta_voucher_config creado';
            else
                RAISE NOTICE 'conta_voucher_config existente';
            end if;

        end loop;
        P_ERROR := 0;
        P_MSGERROR := 'Sistema externo revisado y actualizado';
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_init_config_sp_voucher_config (P_ID_ENTIDAD bigint,P_ID_DEPTO text, P_ID_ANHO bigint, P_ERROR OUT bigint,P_MSGERROR out text) FROM PUBLIC;
