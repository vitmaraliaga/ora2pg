-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_human_talent,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_human_talent_sp_correo_persona (P_ID_ENTIDAD bigint,P_ID_PERSONA bigint, P_ID_ANHO bigint,P_ID_MES bigint,P_EMAIL text) AS $body$
DECLARE

    l_contar bigint:=0;
    l_id_virtual bigint;

  
BEGIN
  
    select count(*) into STRICT l_contar from moises.PERSONA_VIRTUAL  WHERE  ID_PERSONA=P_ID_PERSONA AND ID_TIPOVIRTUAL=1; --and GTH=1;
    IF l_contar=0 THEN
      INSERT INTO moises.PERSONA_VIRTUAL(
      ID_VIRTUAL,
      ID_PERSONA,
      ID_TIPOVIRTUAL,
      DIRECCION,
      COMENTARIO,
      GTH
      )VALUES (
      1,
      P_ID_PERSONA,
      1,
      P_EMAIL,
      '',
      1
      );

    END IF;

    --UPDATE APS_PLANILLA_BOLETA SET CORREO=P_EMAIL WHERE ID_ENTIDAD=P_ID_ENTIDAD AND  ID_PERSONA=P_ID_PERSONA AND CORREO IS NULL;
    
    --UPDATE APS_PLANILLA_BOLETA SET CORREO=P_EMAIL WHERE ID_ENTIDAD=P_ID_ENTIDAD AND  ID_PERSONA=P_ID_PERSONA AND ID_ANHO=P_ID_ANHO AND ID_MES=P_ID_MES;
  END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_human_talent_sp_correo_persona (P_ID_ENTIDAD bigint,P_ID_PERSONA bigint, P_ID_ANHO bigint,P_ID_MES bigint,P_EMAIL text) FROM PUBLIC;
