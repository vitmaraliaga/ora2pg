-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_pstoplanilla,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_pstoplanilla_sp_gen_psto_det_dist_plla (P_ID_PRESUPUESTO bigint) AS $body$
DECLARE



      l_mes bigint;
      l_mes_d varchar(2);
      l_sql varchar(3000);

    
BEGIN
       
      
      DELETE FROM PSTO_PRESUPUESTO_DET_DIST WHERE ID_PRESUPUESTO=P_ID_PRESUPUESTO;

      
       l_mes:=1;

       
        
       while l_mes<=12 loop
         
         l_sql:='INSERT INTO PSTO_PRESUPUESTO_DET_DIST(ID_PRESUPUESTO_DET,ID_PRESUPUESTO,ID_MES,IMPORTE,PORCENTAJE,MESES) ';
         l_sql:=l_sql||'SELECT B.ID_PRESUPUESTO_DET,B.ID_PRESUPUESTO,'||l_mes::text||' AS ID_MES,B.MES'||l_mes::text||',0 AS PORCENTAJE,';
         l_sql:=l_sql||'CASE WHEN B.MES1>0 THEN 1 ELSE 0 END+CASE WHEN B.MES2>0 THEN 1 ELSE 0 END+CASE WHEN B.MES3>0 THEN 1 ELSE 0 END+';
         l_sql:=l_sql||'CASE WHEN B.MES4>0 THEN 1 ELSE 0 END+CASE WHEN B.MES5>0 THEN 1 ELSE 0 END+CASE WHEN B.MES6>0 THEN 1 ELSE 0 END+';
         l_sql:=l_sql||'CASE WHEN B.MES7>0 THEN 1 ELSE 0 END+CASE WHEN B.MES8>0 THEN 1 ELSE 0 END+CASE WHEN B.MES9>0 THEN 1 ELSE 0 END+';
         l_sql:=l_sql||'CASE WHEN B.MES10>0 THEN 1 ELSE 0 END+CASE WHEN B.MES11>0 THEN 1 ELSE 0 END+CASE WHEN B.MES12>0 THEN 1 ELSE 0 END AS MESES ';
         l_sql:=l_sql||'FROM PSTO_PRESUPUESTO_DET B  WHERE B.ID_PRESUPUESTO=:PARAMETRO AND B.MES'||l_mes::text||'>0';

         EXECUTE l_sql USING P_ID_PRESUPUESTO;
        l_mes:=l_mes+1;
      end loop;

           
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_pstoplanilla_sp_gen_psto_det_dist_plla (P_ID_PRESUPUESTO bigint) FROM PUBLIC;
