-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_presupuesto,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_presupuesto_sp_eliminar_presupuesto (P_ID_PRESUPUESTO bigint,P_ID_PERSONA bigint) AS $body$
BEGIN
        INSERT INTO PSTO_PRESUPUESTO_ELIMINAR(
            ID,
            ID_PRESUPUESTO,
            ID_ENTIDAD,
            ID_ANHO, 
            ID_EVENTO,
            ID_PSTONEGOCIO,
            ID_EJE,
            ID_DEPTO,
            ID_PERSONA,
            DESCRIPCION,
            FECHA, 
            TOTAL_INGRESO,
            TOTAL_GASTO, 
            ESTADO,
            MOTIVO,
            ID_PERONA_ELIM, 
            FECHA_ELIM 
            )
        SELECT 
            TO_CHAR(clock_timestamp(),'YYYYMMDDHH24MISS'),
            ID_PRESUPUESTO,
            ID_ENTIDAD, 
            ID_ANHO, 
            ID_EVENTO,
            ID_PSTONEGOCIO,
            ID_EJE,
            ID_DEPTO,
            ID_PERSONA,
            DESCRIPCION,
            FECHA, 
            TOTAL_INGRESO,
            TOTAL_GASTO, 
            ESTADO,
            MOTIVO,
            P_ID_PERSONA,
            clock_timestamp()
          FROM PSTO_PRESUPUESTO
        WHERE ID_PRESUPUESTO = P_ID_PRESUPUESTO;

        DELETE FROM PSTO_ASIENTO_DET
                WHERE ID_ASIENTO IN (
                    SELECT ID_ASIENTO FROM PSTO_ASIENTO WHERE ID_PRESUPUESTO=P_ID_PRESUPUESTO 
                );

        
        DELETE FROM PSTO_ASIENTO
                WHERE ID_PRESUPUESTO = P_ID_PRESUPUESTO;

        DELETE FROM PSTO_PRESUPUESTO_DET_DIST
        WHERE ID_PRESUPUESTO  = P_ID_PRESUPUESTO;

        DELETE FROM PSTO_PRESUPUESTO_DET
                WHERE ID_PRESUPUESTO = P_ID_PRESUPUESTO;

        
        DELETE  FROM PSTO_PRESUPUESTO
                WHERE ID_PRESUPUESTO = P_ID_PRESUPUESTO;

    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_presupuesto_sp_eliminar_presupuesto (P_ID_PRESUPUESTO bigint,P_ID_PERSONA bigint) FROM PUBLIC;
