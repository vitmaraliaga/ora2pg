-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION eliseo.fc_saldo_comprobante (P_ANIO integer,P_ID_CLIENTE integer, P_ID_VENTA integer) RETURNS bigint AS $body$
DECLARE

    SALDO decimal(10,2);		

    
BEGIN

    DECLARE
    
    L_TOTAL decimal(10,2);

    BEGIN

        SELECT SUM(TOTAL) INTO STRICT L_TOTAL FROM VW_SALES_MOV  WHERE ID_ANHO = P_ANIO AND ID_CLIENTE = P_ID_CLIENTE AND ID_VENTA = P_ID_VENTA;

        IF L_TOTAL = 0 THEN
            --SELECT TOTAL INTO SALDO FROM VENTA WHERE ID_ANHO = P_ANIO AND ID_CLIENTE = P_ID_CLIENTE AND ID_VENTA = P_ID_VENTA;
            SELECT ABS(SUM(TOTAL)) INTO STRICT SALDO FROM VW_SALES_MOV  WHERE ID_ANHO = P_ANIO AND ID_CLIENTE = P_ID_CLIENTE AND ID_VENTA = P_ID_VENTA AND TOTAL < 0;
        ELSE
            SALDO := 0;
        END IF;
        RETURN SALDO;
    END;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eliseo.fc_saldo_comprobante (P_ANIO integer,P_ID_CLIENTE integer, P_ID_VENTA integer) FROM PUBLIC;

