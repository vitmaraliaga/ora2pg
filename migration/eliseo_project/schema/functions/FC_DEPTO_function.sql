-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION eliseo.fc_depto (p_entidad integer,p_anho integer) RETURNS text AS $body$
DECLARE

s_depto varchar(20);
s_resul text;

depto CURSOR FOR
/*select id_depto from CONTA_Entidad_Depto 
where ID_ENTIDAD = p_entidad
and es_grupo = 0
order by id_depto;*/
/*SELECT
vw_conta_diario.id_depto
FROM vw_conta_Diario
INNER JOIN CONTA_Cta_Denominacional ON
vw_conta_Diario.ID_TIPOPLAN = conta_Cta_Denominacional.ID_TIPOPLAN AND
vw_conta_Diario.ID_CUENTAAASI = conta_Cta_Denominacional.ID_CUENTAAASI AND
vw_conta_Diario.ID_RESTRICCION = conta_Cta_Denominacional.ID_RESTRICCION
LEFT JOIN Tipo_Cta_Corriente ON
conta_Cta_Denominacional.ID_TIPOCTACTE = Tipo_Cta_Corriente.ID_TIPOCTACTE
LEFT JOIN CONTA_Empresa_Cta ON
vw_conta_Diario.ID_EMPRESA = CONTA_Empresa_Cta.ID_EMPRESA AND
vw_conta_Diario.ID_TIPOPLAN = CONTA_Empresa_Cta.ID_TIPOPLAN AND
vw_conta_Diario.ID_CUENTAAASI = CONTA_Empresa_Cta.ID_CUENTAAASI AND
vw_conta_Diario.ID_RESTRICCION = CONTA_Empresa_Cta.ID_RESTRICCION AND
vw_conta_Diario.ID_ANHO = CONTA_Empresa_Cta.ID_ANHO
WHERE vw_conta_Diario.ID_EMPRESA = 201 AND
7124 IN (-1, vw_conta_Diario.ID_ENTIDAD) AND
vw_conta_Diario.ID_ANHO = p_anho --AND
--vw_conta_Diario.ID_MES = 3     	    
group by vw_conta_diario.id_depto	  
ORDER BY 1;*/
 SELECT id_depto from conta_entidad_depto
    where id_entidad = p_entidad
    and es_grupo = 0
    and length(id_depto) = 8
    order by id_depto;


BEGIN
    open depto;
	fetch depto into
		s_depto;
	while depto%found loop
        s_resul := s_resul||','||'['||s_depto||']';

        fetch depto into
            s_depto;
        end loop;
	close depto;	
	
	RETURN(s_resul);
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eliseo.fc_depto (p_entidad integer,p_anho integer) FROM PUBLIC;

