-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION eliseo.fc_lote_pago (P_ID_COMPRA integer) RETURNS varchar AS $body$
DECLARE

L_NOMBRE varchar(100);
L_LOTE_PAGO varchar(100);

    LOTE CURSOR FOR 
    SELECT DISTINCT D.LOTE
    FROM COMPRA A JOIN CAJA_PAGO_COMPRA B ON A.ID_COMPRA = B.ID_COMPRA 
    JOIN CAJA_PAGO C ON B.ID_PAGO = C.ID_PAGO
    JOIN CONTA_VOUCHER D ON C.ID_VOUCHER = D.ID_VOUCHER
    WHERE A.ID_COMPRA = P_ID_COMPRA
    AND D.LOTE like'MB%';

BEGIN

    OPEN LOTE;
        FETCH LOTE INTO L_NOMBRE;

        WHILE LOTE%FOUND LOOP

            L_LOTE_PAGO := L_NOMBRE||' '||L_LOTE_PAGO;

            FETCH LOTE INTO L_NOMBRE;

        END LOOP;
    CLOSE LOTE;
	 
        RETURN(L_LOTE_PAGO);

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eliseo.fc_lote_pago (P_ID_COMPRA integer) FROM PUBLIC;

