-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE eliseo.iudp_tipo_cambio (P_Modo integer, P_ID_MONEDA integer, P_NOMBRE text, P_FECHA text, P_COS_COMPRA bigint, P_COS_VENTA bigint) AS $body$
DECLARE

 	S_CANTIDAD            integer;
	S_ID_MONEDA            integer;
	S_COS_VENTA			bigint;
	S_FECHA				timestamp(0);

 
BEGIN
	 
IF P_Modo = 0 THEN

	S_FECHA := to_date(P_FECHA,'yyyy-mm-dd"T"HH24:MI:SS');

	S_COS_VENTA := CASE WHEN P_COS_VENTA = 0 THEN P_COS_COMPRA ELSE P_COS_VENTA END;
	S_ID_MONEDA := P_ID_MONEDA;
	IF S_ID_MONEDA = 0 THEN
		SELECT ID_MONEDA INTO STRICT S_ID_MONEDA FROM CONTA_MONEDA WHERE NOMBRE = P_NOMBRE;
	END IF;

    SELECT COUNT(*) INTO STRICT S_CANTIDAD FROM TIPO_CAMBIO WHERE ID_MONEDA = S_ID_MONEDA AND FECHA = S_FECHA;
    
    IF S_CANTIDAD = 0 THEN
    
    	NULL;

      INSERT INTO Tipo_Cambio(ID_MONEDA, FECHA, COS_COMPRA, COS_VENTA, COS_DENOMINACIONAL )
        VALUES (S_ID_MONEDA, S_FECHA, P_COS_COMPRA, S_COS_VENTA, S_COS_VENTA);

    
    ELSE
    
        	NULL;

      UPDATE Tipo_Cambio SET
        COS_COMPRA = P_COS_COMPRA,
        COS_VENTA = S_COS_VENTA,
        COS_DENOMINACIONAL = S_COS_VENTA
      WHERE ID_MONEDA = S_ID_MONEDA
        AND FECHA = S_FECHA;
	
    END IF;

  END IF;


 end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.iudp_tipo_cambio (P_Modo integer, P_ID_MONEDA integer, P_NOMBRE text, P_FECHA text, P_COS_COMPRA bigint, P_COS_VENTA bigint) FROM PUBLIC;

