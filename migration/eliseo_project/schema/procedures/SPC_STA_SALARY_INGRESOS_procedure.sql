-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE eliseo.spc_sta_salary_ingresos ( p_id_entidad integer, p_id_anho integer, p_id_mes integer, p_id_persona integer, p_tipo text, OUT CURSOR REFCURSOR ) AS $body$
DECLARE


    l_ingresos decimal(38,2);


BEGIN
    DELETE FROM TT_TABLE_AUX;
/*
    OPEN cursor FOR 
    select 
      p.fec_pago as fecha,a.NOMBRE as comentario, p.COS_VALOR as valor
      from
      VW_APS_PLANILLA p, APS_CONCEPTO_PLANILLA a
      where p.ID_CONCEPTOAPS=a.ID_CONCEPTOAPS
      and p.ID_ENTIDAD=p_id_entidad
      and p.ID_ANHO=p_id_anho
      and p.ID_MES= p_id_mes
      and p.ID_PERSONA=p_id_persona
      and a.ID_TIPOCONCEPTOAPS not in (100,200)
      and (
        P.ID_CONCEPTOAPS like '10%'
        or P.ID_CONCEPTOAPS like '11%'
        or P.ID_CONCEPTOAPS like '12%'
        or P.ID_CONCEPTOAPS like '13%'
        or P.ID_CONCEPTOAPS like '14%'
        or P.ID_CONCEPTOAPS like '2%'
        or P.ID_CONCEPTOAPS like '3%'
        or P.ID_CONCEPTOAPS like '7%'
      )
      and not P.ID_CONCEPTOAPS like '7600%';
*/
      OPEN CURSOR FOR 
    SELECT TO_CHAR(fecha,'DD/MM/YY') AS fecha, comentario, sum(valor) as valor from (SELECT 
                case p.ID_CONCEPTOAPS
                when 1500 then 1500
                when 1501 then 1500
                when 1508 then 1500 
                when 3000 then 3000 
                when 3079 then 3000 
                when 3080 then 3000
                when 3090 then 3000 
                when 3095 then 3000 
                when 3097 then 3000 
                when 3100 then 3000 
                when 3102 then 3000 
                when 3121 then 3000 
                when 3122 then 3000 
                when 3126 then 3000 
                when 3145 then 3000 
                when 3151 then 3000 
                when 3156 then 3000 
                when 3157 then 3000 
                when 3170 then 3000 
                when 3171 then 3000 
                when 3212 then 3000 
                when 3216 then 3000 
                when 3220 then 3000 
                when 3222 then 3000 
                when 3224 then 3000 
                when 3228 then 3000 
                when 3246 then 3000 
                else a.ID_CONCEPTOAPS end as codigo, 
                p.fec_pago as fecha,                 
                case p.ID_CONCEPTOAPS
                when 1500 then 'AFP' 
                when 1501 then 'AFP' 
                when 1508 then 'AFP' 
                when 1126 then 'Depreciación' 
                when 1147 then 'Bono de Alimentos' 
                when 7600 then 'Des. Ayuda alquiler' 
                
                when 3000 then 'Gratificación' 
                when 3079 then 'Gratificación' 
                when 3080 then 'Gratificación' 
                when 3090 then 'Gratificación' 
                when 3095 then 'Gratificación' 
                when 3097 then 'Gratificación' 
                when 3100 then 'Gratificación' 
                when 3102 then 'Gratificación' 
                when 3121 then 'Gratificación' 
                when 3122 then 'Gratificación' 
                when 3126 then 'Gratificación' 
                when 3145 then 'Gratificación' 
                when 3151 then 'Gratificación' 
                when 3156 then 'Gratificación' 
                when 3157 then 'Gratificación' 
                when 3170 then 'Gratificación' 
                when 3171 then 'Gratificación' 
                when 3212 then 'Gratificación' 
                when 3216 then 'Gratificación' 
                when 3220 then 'Gratificación' 
                when 3222 then 'Gratificación' 
                when 3224 then 'Gratificación' 
                when 3228 then 'Gratificación' 
                when 3246 then 'Gratificación' 

                else a.NOMBRE end as comentario, 
                p.COS_VALOR as valor
                from
                VW_APS_PLANILLA p, APS_CONCEPTO_PLANILLA a
                where p.ID_CONCEPTOAPS=a.ID_CONCEPTOAPS
                and p.ID_ENTIDAD=p_id_entidad
                and p.ID_ANHO=p_id_anho
                and p.ID_MES= p_id_mes
                and p.ID_PERSONA=p_id_persona
                and a.ID_TIPOCONCEPTOAPS not in (100,200)
                and (
                  P.ID_CONCEPTOAPS like '10%'
                  or P.ID_CONCEPTOAPS like '11%'
                  or P.ID_CONCEPTOAPS like '12%'
                  or P.ID_CONCEPTOAPS like '13%'
                  or P.ID_CONCEPTOAPS like '14%'
                  or P.ID_CONCEPTOAPS like '2%'
                  or P.ID_CONCEPTOAPS like '3%'
                  or P.ID_CONCEPTOAPS like '7%'
                )
                and not P.ID_CONCEPTOAPS like '7600%'
                AND coalesce(p.FEC_SALIDA::text, '') = '' 
                AND ID_TIPOPLANILLA = 98626 -- SOLO ingresos de la boleta de pagos (tipo de planilla) contra_cheque
 
                ) a  
        group by codigo, fecha, comentario
        order by codigo;

  
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.spc_sta_salary_ingresos ( p_id_entidad integer, p_id_anho integer, p_id_mes integer, p_id_persona integer, p_tipo text, OUT CURSOR REFCURSOR ) FROM PUBLIC;

