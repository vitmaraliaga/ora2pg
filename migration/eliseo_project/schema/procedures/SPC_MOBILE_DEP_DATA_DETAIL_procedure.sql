-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE eliseo.spc_mobile_dep_data_detail ( p_id_entidad integer, p_id_anho integer, p_id_depto integer, OUT CURSOR REFCURSOR ) AS $body$
DECLARE


    l_ingresos decimal(38,2);


BEGIN
    DELETE FROM TT_TABLE_AUX;


    OPEN CURSOR FOR
    SELECT
                    to_char(FEC_ASIENTO,'dd/mm/yy') AS FECHA,
                    COMENTARIO as COMENTARIO,
                    COS_VALOR as valor
                from VW_CONTA_DIARIO
                where ID_ENTIDAD = p_id_entidad
                and ID_ANHO = p_id_anho
                and ID_DEPTO = p_id_depto
                and (
                  id_cuentaaasi in (
                    SELECT id_cuentaaasi from CONTA_CTA_DENOMINACIONAL
                      where id_cuentaaasi like '3%' 
                      --and es_grupo = 0
                      and ES_ACREEDORA = 0
                      and ID_CUENTAAASI NOT IN ('3196230', '3196298') 
                  )
                  or 
                  id_cuentaaasi in (
                    select id_cuentaaasi from CONTA_CTA_DENOMINACIONAL
                      where id_cuentaaasi like '4%' 
                      and es_grupo = 0
                      and ES_ACREEDORA = 0
                  )
                  or (id_cuentaaasi in (
                    select id_cuentaaasi from CONTA_CTA_DENOMINACIONAL
                      where id_cuentaaasi like '6%' 
                      and es_grupo = 0
                      and ES_ACREEDORA = 0
                  )  
                  and not ID_TIPOASIENTO in ('IN','EA')
                  )
                ) 
                order by FEC_ASIENTO asc
;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.spc_mobile_dep_data_detail ( p_id_entidad integer, p_id_anho integer, p_id_depto integer, OUT CURSOR REFCURSOR ) FROM PUBLIC;

