-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = caleb,public;
\set ON_ERROR_STOP ON

function       FT_MATRICULA(p_id_persona_inscripcion in VARCHAR2) 
return number

is
  cant_persona_ins number;

begin  

	SELECT count(ID_PERSONA_INSCRIPCION)into cant_persona_ins
	FROM (
		SELECT DISTINCT  api.ID_PERSONA_INSCRIPCION ,  pd2.ID_PERSONA , acpp.ID_PLAN_PROGRAMA 
		FROM caleb.ADM_PERSONA_INSCRIPCION api 
		INNER JOIN caleb.ADM_CONV_PLAN_PROGRAMA acpp on api.ID_CONV_PLAN_PROGRAMA = acpp.ID_CONV_PLAN_PROGRAMA 
		INNER JOIN caleb.ADM_CONVOCATORIA_DET acd ON acpp.ID_CONVOCATORIA_DET = acd.ID_CONVOCATORIA_DET 
		INNER JOIN caleb.ADM_CONVOCATORIA ac ON acd.ID_CONVOCATORIA  = ac.ID_CONVOCATORIA 
		inner JOIN david.ACAD_PLAN_PROGRAMA app ON app.ID_PLAN_PROGRAMA =acpp.ID_PLAN_PROGRAMA 
		inner JOIN david.VW_ACAD_PROGRAMA_ESTUDIO vape ON vape.ID_PROGRAMA_ESTUDIO =app.ID_PROGRAMA_ESTUDIO
		INNER JOIN genesis.PERSONA p ON api.ID_PERSONA = p.ID_PERSONA 
		INNER JOIN genesis.PERSONA_DOCUMENTO pd ON p.ID_PERSONA = pd.ID_PERSONA 
		INNER JOIN MOISES.PERSONA_DOCUMENTO pd2 ON pd.NUM_DOCUMENTO = pd2.NUM_DOCUMENTO
		INNER JOIN david.ACAD_ALUMNO_CONTRATO aac ON pd2.ID_PERSONA = aac.ID_PERSONA 
		INNER JOIN david.ACAD_SEMESTRE_PROGRAMA asp ON aac.ID_SEMESTRE_PROGRAMA = asp.ID_SEMESTRE_PROGRAMA 
													AND vape.ID_PROGRAMA_ESTUDIO = asp.ID_PROGRAMA_ESTUDIO
													AND ac.ID_SEMESTRE <= asp.ID_SEMESTRE 
		WHERE 
		pd.ES_ACTIVO = '1' 
		AND  pd.NUM_DOCUMENTO IS NOT NULL
		AND api.ID_PERSONA_INSCRIPCION = p_id_persona_inscripcion
        ) 
    WHERE rownum=1 ;

  return cant_persona_ins;

end;

