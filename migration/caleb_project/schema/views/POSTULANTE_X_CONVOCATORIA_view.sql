-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = caleb,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW postulante_x_convocatoria (id_programa_estudio, convocatoria, nivel_ensenanza, unidad_academica, carrera, preinscrito, inscrito, ingreso, no_ingreso, reserva, cambio_carrera, renuncia) AS select ID_PROGRAMA_ESTUDIO,CONVOCATORIA,NIVEL_ENSENANZA,UNIDAD_ACADEMICA,CARRERA,PREINSCRITO,INSCRITO,INGRESO,NO_INGRESO,RESERVA,CAMBIO_CARRERA,RENUNCIA FROM (
   SELECT
    vape.id_programa_estudio,
	ac.NOMBRE  AS convocatoria,
	tne.NOMBRE AS nivel_ensenanza,
	coalesce(vape.NOMBRE_FACULTAD,'Sin unidad acad√©mica') AS unidad_Academica, 
	coalesce(vape.NOMBRE , 'Sin carrera') AS carrera,
	api.ESTADO /*,
	count(1)  AS cantidad*/

	FROM 
	CALEB.ADM_PERSONA_INSCRIPCION api 
	INNER JOIN CALEB.ADM_CONVOCATORIA_DET acd ON acd.ID_CONVOCATORIA_DET =api.ID_CONVOCATORIA_DET 
	INNER JOIN david.TIPO_NIVEL_ENSENANZA tne ON tne.ID_NIVEL_ENSENANZA =acd.ID_NIVEL_ENSENANZA 
	INNER JOIN CALEB.ADM_CONVOCATORIA ac ON ac.ID_CONVOCATORIA = acd.ID_CONVOCATORIA 
	left JOIN caleb.ADM_CONV_PLAN_PROGRAMA acpp ON acpp.ID_CONV_PLAN_PROGRAMA = api.ID_CONV_PLAN_PROGRAMA 
	left JOIN david.ACAD_PLAN_PROGRAMA app ON app.ID_PLAN_PROGRAMA =acpp.ID_PLAN_PROGRAMA 
	left JOIN david.VW_ACAD_PROGRAMA_ESTUDIO vape ON vape.ID_PROGRAMA_ESTUDIO =app.ID_PROGRAMA_ESTUDIO
	/*GROUP BY 
	ac.NOMBRE ,tne.NOMBRE ,
	vape.NOMBRE_FACULTAD, 
	vape.NOMBRE ,
	api.ESTADO*/

)
pivot(
   count(estado)
   for estado in ('0' AS PREINSCRITO ,'1' AS INSCRITO,'2' AS INGRESO,'3' AS NO_INGRESO,'4' AS RESERVA,'5' AS  CAMBIO_CARRERA,'9' AS  RENUNCIA)
);

