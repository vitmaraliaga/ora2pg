-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_des_resultado_tipo_eval (id_participante, id_perfil_puesto_resp, id_grupo_competencia_nivel, id_tipo_evaluador, puntaje, porcentaje, id_modelo_evaluacion, descripcion, competencia, id_perfil_puesto) AS select 
a.ID_PARTICIPANTE,
a.ID_PERFIL_PUESTO_RESP,
a.ID_GRUPO_COMPETENCIA_NIVEL,
pe.ID_TIPO_EVALUADOR,
ROUND(COALESCE(avg(COALESCE(a.puntaje,0)),0),2) as puntaje,
a.porcentaje,
pp.id_modelo_evaluacion,
pp.descripcion,
null as competencia,
pp.id_perfil_puesto
FROM enoc.DES_RESULTADO a, 
enoc.des_participante_evaluador pe,enoc.plla_PERFIL_PUESTO_RESP pp
where a.id_participante_evaluador=pe.id_participante_evaluador
and a.ID_PERFIL_PUESTO_RESP=pp.ID_PERFIL_PUESTO_RESP
and coalesce(pe.TIPO_EVAL,'P')='P'
group by a.ID_PARTICIPANTE,
a.ID_PERFIL_PUESTO_RESP,
a.ID_GRUPO_COMPETENCIA_NIVEL,
pe.ID_TIPO_EVALUADOR,
a.porcentaje,
pp.id_modelo_evaluacion,
pp.descripcion,
pp.id_perfil_puesto
union
select 
a.ID_PARTICIPANTE,
a.ID_PERFIL_PUESTO_RESP,
a.ID_GRUPO_COMPETENCIA_NIVEL,
pe.ID_TIPO_EVALUADOR,
ROUND(COALESCE(avg(COALESCE(a.puntaje,0)),0),2) as puntaje,
a.porcentaje,
pp.id_modelo_evaluacion,
pp.descripcion,
pp.competencia,
pp.id_perfil_puesto
from enoc.DES_RESULTADO a, 
enoc.des_participante_evaluador pe,enoc.VW_DES_EVAL_COMPETENCIA_NIVEL pp,enoc.des_participante par
where a.id_participante_evaluador=pe.id_participante_evaluador
and a.ID_GRUPO_COMPETENCIA_NIVEL=pp.ID_GRUPO_COMPETENCIA_NIVEL
and pe.id_participante=par.id_participante
and par.id_perfil_puesto=pp.id_perfil_puesto
and coalesce(pe.TIPO_EVAL,'P')='P'
group by a.ID_PARTICIPANTE,
a.ID_PERFIL_PUESTO_RESP,
a.ID_GRUPO_COMPETENCIA_NIVEL,
pe.ID_TIPO_EVALUADOR,
a.porcentaje,
pp.id_modelo_evaluacion,
pp.descripcion,
pp.competencia,
pp.id_perfil_puesto;

