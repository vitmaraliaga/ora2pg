-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON

function                FC_VALIDAR_APROB_REQ_GRUPO(P_ID_SOLIC_REQUE NUMBER,P_ID_ESTADO_REQ_CAND VARCHAR2, P_ID_ESTADO_REQ_CAND_APROB VARCHAR2) RETURN varchar2
IS
l_contar number:=0;
l_ret varchar(600):='N';
l_contar_apro number;
l_id_modalidad_req number;
l_esdocente number;
l_id_entidad number;
l_codigo_mod varchar2(20);
l_id_situacion_trabajador varchar2(10):='0';
l_cerrado_presel number;

BEGIN
    
    SELECT coalesce(cerrado_presel, 0) INTO l_cerrado_presel from enoc.plla_solic_reque  where ID_SOLIC_REQUE=P_ID_SOLIC_REQUE;
    
    if l_cerrado_presel=0 then
      GOTO SALIDA;
    end if;
    select count(1) into l_contar
    from enoc.PLLA_SOLIC_REQ_CANDIDATO 
    where ID_SOLIC_REQUE=P_ID_SOLIC_REQUE
    and ID_ESTADO_REQ_CAND=P_ID_ESTADO_REQ_CAND;
    
    if l_contar=0 then
      GOTO SALIDA;
    end if;
    
    select count(1) into l_contar_apro
    from enoc.PLLA_SOLIC_REQ_CANDIDATO 
    where ID_SOLIC_REQUE=P_ID_SOLIC_REQUE
    and ID_ESTADO_REQ_CAND=P_ID_ESTADO_REQ_CAND
    and enoc.fc_est_aprob_req_cand(id_solic_req_candidato,P_ID_ESTADO_REQ_CAND_APROB)='S';
    
    if l_contar=l_contar_apro then
      l_ret:='S';
    end if;
        
  <<SALIDA>>
	RETURN(l_ret);
END;

