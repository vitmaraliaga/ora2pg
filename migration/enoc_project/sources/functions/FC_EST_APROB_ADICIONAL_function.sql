-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON

function            FC_EST_APROB_ADICIONAL(P_ID_ADICIONAL NUMBER, P_ID_ESTADO_ADICIONAL VARCHAR2) RETURN VARCHAR2
IS
l_dato VARCHAR2(5):='N';
l_contar int:=0;
l_id_estado_act VARCHAR2(5);
l_id_estado VARCHAR2(5);
l_id_tipo_concep_adic number;
l_orden number;
BEGIN

     SELECT ID_ESTADO_ADICIONAL, ID_TIPO_CONCEP_ADIC
     INTO l_id_estado, l_id_tipo_concep_adic
     FROM enoc.VW_ADICIONAL 
     WHERE ID_ADICIONAL=P_ID_ADICIONAL;
     
 
     SELECT COUNT(*) INTO l_contar 
     FROM enoc.PLLA_TIPO_CONCEP_ADIC_EST 
     WHERE ID_TIPO_CONCEP_ADIC=l_id_tipo_concep_adic
     AND ID_ESTADO_ADICIONAL=l_id_estado;
     
     IF l_contar>0 THEN
        
       SELECT COUNT(*) INTO l_contar 
       FROM enoc.PLLA_TIPO_CONCEP_ADIC_EST 
       WHERE ID_TIPO_CONCEP_ADIC=l_id_tipo_concep_adic
       AND ID_ESTADO_ADICIONAL=P_ID_ESTADO_ADICIONAL;
     

       IF l_contar>0 THEN
       
         select orden into l_orden from ENOC.PLLA_ESTADO_ADICIONAL
         WHERE ID_ESTADO_ADICIONAL=P_ID_ESTADO_ADICIONAL;
        
         SELECT coalesce(MAX(A.ID_ESTADO_ADICIONAL),'-') INTO l_id_estado_act 
         FROM enoc.PLLA_TIPO_CONCEP_ADIC_EST A, ENOC.PLLA_ESTADO_ADICIONAL B
         WHERE A.ID_ESTADO_ADICIONAL=B.ID_ESTADO_ADICIONAL
         AND A.ID_TIPO_CONCEP_ADIC=l_id_tipo_concep_adic
         AND B.orden<l_orden;
         
         if l_id_estado_act = l_id_estado then
            l_dato:='S';
         end if;
        END IF;
     END IF;
  
	RETURN(l_dato);
END;

