-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION enoc.fc_motivo_asist_mensual (P_ID_TRABAJADOR bigint,P_FECHA timestamp(0)) RETURNS varchar AS $body$
DECLARE

l_dato varchar(10):='A';
l_contar bigint:=0;
l_contar_fer_ins bigint:=0;
l_contar_fer bigint:=0;
l_contar_mar bigint:=0;
l_fecha timestamp(0);
l_anho bigint;
l_mes bigint;
l_dia bigint;
l_nrodia bigint;
l_codigo varchar(10);
l_id_entidad bigint;
l_id_area bigint;
l_id_depto varchar(10);
l_id_tipo_horario bigint:=0;


BEGIN

    l_fecha:= to_date(TO_CHAR(P_FECHA, 'MM/DD/YYYY'),'MM/DD/YYYY');

    select 
    (to_char(l_fecha,'YYYY'))::numeric ,(to_char(l_fecha,'MM'))::numeric ,(to_char(l_fecha,'DD'))::numeric , (TO_CHAR(l_fecha, 'D', 'NLS_DATE_LANGUAGE=ENGLISH'))::numeric 
    into STRICT 
    l_anho,l_mes,l_dia,l_nrodia 
;

    --licencia y permiso
    select count(*) into STRICT l_contar from enoc.VW_LICENCIA_PERMISO_ASIST 
      where id_trabajador=P_ID_TRABAJADOR
      and periodo='D'
      and id_estado_lica_per not in ('00','04')
      --and id_estado_lica_per in('03')
      AND (l_fecha between fecha_desde and fecha_hasta);

    
    if l_contar>0 then
       l_dato:='PLD';
--        GOTO SALIDA;
    end if;
    --vacaciones
    select count(*) into STRICT l_contar from enoc.vw_rol_vacacional
    where id_trabajador=P_ID_TRABAJADOR
    and condicion='P'
    --AND ID_PERIODO_VAC_TRAB IN ('02')
    AND (l_fecha between fecha_ini and fecha_fin);

    if l_contar>0 then
       l_dato:='V';
--        GOTO SALIDA;
    end if;

--    <<SALIDA>>
	RETURN(l_dato);
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION enoc.fc_motivo_asist_mensual (P_ID_TRABAJADOR bigint,P_FECHA timestamp(0)) FROM PUBLIC;

