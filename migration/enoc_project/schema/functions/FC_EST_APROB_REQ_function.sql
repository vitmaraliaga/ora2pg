-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION enoc.fc_est_aprob_req (P_ID_SOLIC_REQUE bigint, P_ID_ESTADO_REQ text) RETURNS varchar AS $body$
DECLARE

l_dato varchar(5):='N';
l_contar integer:=0;
l_id_estado_act varchar(5);
l_id_estado varchar(5);
l_id_tipo_paso bigint;
l_orden bigint;
l_id_entidad bigint;

BEGIN

     SELECT ID_ESTADO_REQ
     INTO STRICT l_id_estado
     FROM enoc.PLLA_SOLIC_REQUE
     WHERE ID_SOLIC_REQUE=P_ID_SOLIC_REQUE;

     select orden into STRICT l_orden from ENOC.PLLA_ESTADO_REQ
     WHERE ID_ESTADO_REQ=P_ID_ESTADO_REQ
     and vigencia=1;

     SELECT COUNT(*) INTO STRICT l_contar  
     FROM enoc.PLLA_ESTADO_REQ
     WHERE orden<l_orden
     and vigencia=1;

     IF l_contar>0 THEN
        SELECT max(ID_ESTADO_REQ) INTO STRICT l_id_estado_act 
           FROM enoc.PLLA_ESTADO_REQ
           WHERE orden<l_orden
           and vigencia=1;
           if l_id_estado_act = l_id_estado then
              l_dato:='S';
           end if;
      end if;

	RETURN(l_dato);
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION enoc.fc_est_aprob_req (P_ID_SOLIC_REQUE bigint, P_ID_ESTADO_REQ text) FROM PUBLIC;

