-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION enoc.fc_est_aprob_contrato (P_ID_ENTIDAD bigint, P_ID_DEPTO text, P_TIPO text, P_ID_ESTADO_CONT text, P_ID_ESTADO_APRO text) RETURNS varchar AS $body$
DECLARE

l_dato varchar(5):='N';
l_contar integer:=0;
l_id_estado_cont varchar(5);


BEGIN

     SELECT COUNT(*) INTO STRICT l_contar
     FROM PLLA_ESTADO_CONT_DEPTO a, PLLA_ESTADO_CONT b 
     WHERE a.ID_ESTADO_CONT=b.ID_ESTADO_CONT 
     AND  a.ID_ENTIDAD=P_ID_ENTIDAD 
     AND a.ID_DEPTO=P_ID_DEPTO 
     AND a.TIPO=P_TIPO 
     AND b.ID_ESTADO_CONT=P_ID_ESTADO_CONT;

     IF l_contar>0 THEN
       SELECT COUNT(*) INTO STRICT l_contar 
       FROM PLLA_ESTADO_CONT_DEPTO a, PLLA_ESTADO_CONT b 
       WHERE a.ID_ESTADO_CONT=b.ID_ESTADO_CONT 
       AND  a.ID_ENTIDAD=P_ID_ENTIDAD 
       AND a.ID_DEPTO=P_ID_DEPTO 
       AND a.TIPO=P_TIPO 
       AND b.ID_ESTADO_CONT=P_ID_ESTADO_APRO;

       IF l_contar>0 THEN

         SELECT MAX(b.ID_ESTADO_CONT) INTO STRICT l_id_estado_cont 
         FROM PLLA_ESTADO_CONT_DEPTO a, PLLA_ESTADO_CONT b 
         WHERE a.ID_ESTADO_CONT=b.ID_ESTADO_CONT 
         AND  a.ID_ENTIDAD=P_ID_ENTIDAD 
         AND a.ID_DEPTO=P_ID_DEPTO 
         AND a.TIPO=P_TIPO 
         AND b.ID_ESTADO_CONT<P_ID_ESTADO_APRO;

         if l_id_estado_cont = P_ID_ESTADO_CONT then
            l_dato:='S';
         end if;
        END IF;
     END IF;

	RETURN(l_dato);
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION enoc.fc_est_aprob_contrato (P_ID_ENTIDAD bigint, P_ID_DEPTO text, P_TIPO text, P_ID_ESTADO_CONT text, P_ID_ESTADO_APRO text) FROM PUBLIC;

