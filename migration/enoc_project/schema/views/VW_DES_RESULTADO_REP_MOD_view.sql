-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = enoc,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_des_resultado_rep_mod (id_participante, id_perfil_puesto_resp, id_grupo_competencia_nivel, id_modelo_evaluacion, id_desempeno_mod_eval, puntaje, porcentaje, id_desempeno, max_puntaje, descripcion, competencia, id_perfil_puesto, id_tipo_evaluador) AS select
a.ID_PARTICIPANTE,
a.ID_PERFIL_PUESTO_RESP,
a.ID_GRUPO_COMPETENCIA_NIVEL,
A.id_modelo_evaluacion,
M.ID_DESEMPENO_MOD_EVAL,
round((avg(COALESCE(a.puntaje,0)))::numeric,2) as puntaje,
a.porcentaje,
M.ID_DESEMPENO,
(SELECT COALESCE(MAX(COALESCE(X.PUNTAJE,0)),0) FROM ENOC.DES_DESEMPENO_ALTER X WHERE X.ID_DESEMPENO_MOD_EVAL= M.ID_DESEMPENO_MOD_EVAL) AS MAX_PUNTAJE,
a.descripcion,
a.competencia,
a.id_perfil_puesto,
A.id_tipo_evaluador
from ENOC.VW_DES_RESULTADO_TIPO_EVAL A, ENOC.DES_PARTICIPANTE P, ENOC.DES_DESEMPENO_MOD_EVAL M
WHERE A.ID_PARTICIPANTE=P.ID_PARTICIPANTE
AND A.id_modelo_evaluacion=M.id_modelo_evaluacion
AND P.ID_DESEMPENO=M.ID_DESEMPENO
group by a.ID_PARTICIPANTE,
a.ID_PERFIL_PUESTO_RESP,
a.ID_GRUPO_COMPETENCIA_NIVEL,
A.id_modelo_evaluacion,
M.ID_DESEMPENO_MOD_EVAL,
a.porcentaje,
M.ID_DESEMPENO,
a.descripcion,
a.competencia,
a.id_perfil_puesto,
A.id_tipo_evaluador;

