-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = enoc,pkg_compensacion,public;




CREATE OR REPLACE PROCEDURE enoc.pkg_compensacion_sp_reporte_jar ( P_ID_ENTIDAD bigint, P_ID_DEPTO text, P_ID_AREA bigint, P_ID_CONDICION_LABORAL text, P_ID_TIPO_TIEMPO_TRABAJO bigint, P_ID_ANHO bigint, P_ID_MES bigint, P_DATO text, P_RESTRINGIDO text, P_ID_ACCESO_NIVEL bigint, P_ID_AREAS_USER text, P_ID_USER bigint, OUT CURSOR REFCURSOR ) AS $body$
DECLARE

       l_query varchar(4000):='';
       l_anhomes varchar(10);
       l_id_tipo_nivel_vista bigint;
       l_fecha_rep varchar(12);

BEGIN
       if P_ID_MES<10 then
        l_anhomes:=P_ID_ANHO::text||'0'||P_ID_MES::text;
        l_fecha_rep:=P_ID_ANHO::text||'-0'||P_ID_MES::text||'-01';
      else
        l_anhomes:=P_ID_ANHO::text||P_ID_MES::text;
        l_fecha_rep:=P_ID_ANHO::text||'-'||P_ID_MES::text||'-01';
      end if;

       if P_RESTRINGIDO='S' then
          select id_tipo_nivel_vista into STRICT l_id_tipo_nivel_vista from eliseo.lamb_acceso_nivel where id_acceso_nivel=P_ID_ACCESO_NIVEL;
      end if;
      --activos
      l_query:='INSERT INTO ENOC.TT_REPORTE_JAR (ID_TRABAJADOR,
          ID_PERSONA,
          SUELDO,
          SUELDO_MEN,
          SUELDO_TOTAL,
          ID_TIPO_CATEG_OCUPA,
          HORA_SEMANA,
          HORA_MEN,
          HORA_REAL,
          TIPO_PAGO,
          FECHA_INICIO,
          FECHA_FIN_PREVISTO,
          FECHA_FIN_EFECTIVO,
          ID_SITUACION_TRABAJADOR,
          ID_CONDICION_LABORAL,
          ID_TIPO_TIEMPO_TRABAJO,
          DIAS_MEN,
          DIAS_REAL,
          F_INI,
          F_FIN,
          DIAS_VAC,
          DIAS_LIC,
          DIAS_MES,
          ID_TIPO_HORARIO) ';
      l_query:=l_query||'select 
        t.id_trabajador,
        t.id_persona,
        COALESCE(rem.sueldo,0) ,
        0,0,
        c.ID_TIPO_CATEG_OCUPA,
        case when t.ID_TIPO_TIEMPO_TRABAJO=2 then ceil(O.HORA_SEMANA/2) else case when t.ID_CONDICION_LABORAL =''PP'' then 30 else O.HORA_SEMANA end  end ,
        (case when t.ID_TIPO_TIEMPO_TRABAJO=2 then ceil(O.HORA_SEMANA/2) else  case when t.ID_CONDICION_LABORAL =''PP'' then 30 else O.HORA_SEMANA end end)*4,
        0,
        c.TIPO_PAGO, 
        t.FECHA_INICIO,
        t.FECHA_FIN_PREVISTO,
        t.FECHA_FIN_EFECTIVO,
        t.id_situacion_trabajador,
        t.ID_CONDICION_LABORAL,
        T.ID_TIPO_TIEMPO_TRABAJO,
        30,
        0,
        case when t.FECHA_INICIO<TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD'') then TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD'') else t.FECHA_INICIO end AS F_Ini,
        case when t.id_condicion_laboral in(''M'',''E'') then TRUNC(LAST_DAY(TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD''))) else
            CASE WHEN t.FECHA_FIN_PREVISTO>TRUNC(LAST_DAY(TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD''))) then TRUNC(LAST_DAY(TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD''))) else t.FECHA_FIN_PREVISTO end
        end AS F_FIN,
        0,0,0,T.ID_TIPO_HORARIO 
        from ENOC.vw_trabajador t inner join enoc.plla_contrato c on c.id_contrato=t.id_contrato
        INNER JOIN ENOC.PLLA_TIPO_CATEG_OCUPA O ON O.ID_TIPO_CATEG_OCUPA=C.ID_TIPO_CATEG_OCUPA
        inner join enoc.vw_ent_dep_area_ccosto cc on 
        cc.ID_SEDEAREA=t.ID_SEDEAREA 
        left join ENOC.PLLA_REMUNERACION rem on    
        rem.id_trabajador=t.id_trabajador and rem.vigencia=1 
        where t.id_entidad=:entidad 
        and t.id_situacion_trabajador=''1'' 
        and t.ID_CONDICION_LABORAL not in(''CND'') 
        AND to_char(case when t.FECHA_INICIO<TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD'') then TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD'') else t.FECHA_INICIO end,''YYYYMM'')=:anhomes 
        AND to_char(case when t.id_condicion_laboral in(''M'',''E'') then TRUNC(LAST_DAY(TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD''))) else
                      CASE WHEN t.FECHA_FIN_PREVISTO>TRUNC(LAST_DAY(TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD''))) then TRUNC(LAST_DAY(TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD''))) else t.FECHA_FIN_PREVISTO end
                  end,
        ''YYYYMM'')=:anhomes1 ';
      if (P_ID_DEPTO IS NOT NULL AND P_ID_DEPTO::text <> '') then
        l_query:=l_query||'and cc.id_depto_padre='''||P_ID_DEPTO||''' ';
      end if;
      if P_ID_AREA > 0 then
        l_query:=l_query||'and cc.id_area ='||P_ID_AREA||' ';
      end if;
      if (P_ID_CONDICION_LABORAL IS NOT NULL AND P_ID_CONDICION_LABORAL::text <> '') then
        l_query:=l_query||'and t.ID_CONDICION_LABORAL ='''||P_ID_CONDICION_LABORAL||''' ';
      end if;
      if P_ID_TIPO_TIEMPO_TRABAJO > 0 then
        l_query:=l_query||'and t.ID_TIPO_TIEMPO_TRABAJO ='||P_ID_TIPO_TIEMPO_TRABAJO||' ';
      end if;
      if (P_DATO IS NOT NULL AND P_DATO::text <> '') then
        l_query:=l_query||'and (upper(convert(T.nombre||'' ''||t.paterno||'' ''||t.materno||t.nombre||'' ''||t.paterno||'' ''||t.materno||t.nombre||'' ''||t.paterno||'' ''||t.materno||t.num_documento, ''us7ascii'')) like ''%''||replace(replace(upper(convert('''||P_DATO||''' , ''us7ascii'')),'','','' ''),'' '',''%'')||''%'') ';
      end if;

                  
      if P_RESTRINGIDO='S' then
            
          if l_id_tipo_nivel_vista = 3 then
              l_query:=l_query||'and cc.id_depto_padre in(select id_depto from enoc.vw_acceso_nivel where id_acceso_nivel='||P_ID_ACCESO_NIVEL::text||') ';
          end if;
          if l_id_tipo_nivel_vista = 4 then
              l_query:=l_query||'and cc.id_area in('||P_ID_AREAS_USER||') ';
          end if;
          if l_id_tipo_nivel_vista = 5 then
              l_query:=l_query||'and t.id_trabajador='||P_ID_USER::text||' ';
          end if;
      end if;

      if P_RESTRINGIDO='U' then
          l_query:=l_query||'and t.id_trabajador='||P_ID_USER::text||' ';
      end if;
      
      --DBMS_OUTPUT.PUT_LINE(l_query);
      
      EXECUTE l_query USING P_ID_ENTIDAD,l_anhomes,l_anhomes;

      --cesados
       l_query:='INSERT INTO ENOC.TT_REPORTE_JAR (ID_TRABAJADOR,
          ID_PERSONA,
          SUELDO,
          SUELDO_MEN,
          SUELDO_TOTAL,
          ID_TIPO_CATEG_OCUPA,
          HORA_SEMANA,
          HORA_MEN,
          HORA_REAL,
          TIPO_PAGO,
          FECHA_INICIO,
          FECHA_FIN_PREVISTO,
          FECHA_FIN_EFECTIVO,
          ID_SITUACION_TRABAJADOR,
          ID_CONDICION_LABORAL,
          ID_TIPO_TIEMPO_TRABAJO,
          DIAS_MEN,
          DIAS_REAL,
          F_INI,
          F_FIN,
          DIAS_VAC,
          DIAS_LIC,
          DIAS_MES,
          ID_TIPO_HORARIO) ';
      l_query:=l_query||'select 
        t.id_trabajador,
        t.id_persona,
        COALESCE(rem.sueldo,0) ,
        0,0,
        c.ID_TIPO_CATEG_OCUPA,
        case when t.ID_TIPO_TIEMPO_TRABAJO=2 then ceil(O.HORA_SEMANA/2) else case when t.ID_CONDICION_LABORAL =''PP'' then 30 else O.HORA_SEMANA end  end ,
        (case when t.ID_TIPO_TIEMPO_TRABAJO=2 then ceil(O.HORA_SEMANA/2) else  case when t.ID_CONDICION_LABORAL =''PP'' then 30 else O.HORA_SEMANA end end)*4,
        0,
        c.TIPO_PAGO, 
        t.FECHA_INICIO,
        t.FECHA_FIN_PREVISTO,
        t.FECHA_FIN_EFECTIVO,
        t.id_situacion_trabajador,
        t.ID_CONDICION_LABORAL,
        T.ID_TIPO_TIEMPO_TRABAJO,
        30,
        0,
        case when t.FECHA_INICIO<TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD'') then TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD'') else t.FECHA_INICIO end AS F_Ini,
        case when t.id_condicion_laboral in(''M'',''E'') then TRUNC(LAST_DAY(TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD''))) else
            CASE WHEN t.FECHA_FIN_PREVISTO>TRUNC(LAST_DAY(TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD''))) then TRUNC(LAST_DAY(TO_DATE('''||l_fecha_rep||''',''YYYY-MM-DD''))) else t.FECHA_FIN_PREVISTO end
        end AS F_FIN,
        0,0,0, T.ID_TIPO_HORARIO 
        from ENOC.vw_trabajador t inner join enoc.plla_contrato c on c.id_contrato=t.id_contrato
        INNER JOIN ENOC.PLLA_TIPO_CATEG_OCUPA O ON O.ID_TIPO_CATEG_OCUPA=C.ID_TIPO_CATEG_OCUPA
        inner join enoc.vw_ent_dep_area_ccosto cc on 
        cc.ID_SEDEAREA=t.ID_SEDEAREA 
        left join ENOC.PLLA_REMUNERACION rem on    
        rem.id_trabajador=t.id_trabajador and rem.vigencia=1 
        where t.id_entidad=:entidad 
        and t.id_situacion_trabajador=''0'' 
        and t.ID_CONDICION_LABORAL not in(''CND'') 
        and to_char(t.FECHA_FIN_efectivo,''YYYYMM'') =:s_anhomes ';
      if (P_ID_DEPTO IS NOT NULL AND P_ID_DEPTO::text <> '') then
        l_query:=l_query||'and cc.id_depto_padre='''||P_ID_DEPTO||''' ';
      end if;
      if P_ID_AREA > 0 then
        l_query:=l_query||'and cc.id_area ='||P_ID_AREA||' ';
      end if;
      if (P_ID_CONDICION_LABORAL IS NOT NULL AND P_ID_CONDICION_LABORAL::text <> '') then
        l_query:=l_query||'and t.ID_CONDICION_LABORAL ='''||P_ID_CONDICION_LABORAL||''' ';
      end if;
      if P_ID_TIPO_TIEMPO_TRABAJO > 0 then
        l_query:=l_query||'and t.ID_TIPO_TIEMPO_TRABAJO ='||P_ID_TIPO_TIEMPO_TRABAJO||' ';
      end if;
      if (P_DATO IS NOT NULL AND P_DATO::text <> '') then
        l_query:=l_query||'and (upper(convert(T.nombre||'' ''||t.paterno||'' ''||t.materno||t.nombre||'' ''||t.paterno||'' ''||t.materno||t.nombre||'' ''||t.paterno||'' ''||t.materno||t.num_documento, ''us7ascii'')) like ''%''||replace(replace(upper(convert('''||P_DATO||''' , ''us7ascii'')),'','','' ''),'' '',''%'')||''%'') ';
      end if;

                  
      if P_RESTRINGIDO='S' then
            
          if l_id_tipo_nivel_vista = 3 then
              l_query:=l_query||'and cc.id_depto_padre in(select id_depto from enoc.vw_acceso_nivel where id_acceso_nivel='||P_ID_ACCESO_NIVEL::text||') ';
          end if;
          if l_id_tipo_nivel_vista = 4 then
              l_query:=l_query||'and cc.id_area in('||P_ID_AREAS_USER||') ';
          end if;
          if l_id_tipo_nivel_vista = 5 then
              l_query:=l_query||'and t.id_trabajador='||P_ID_USER::text||' ';
          end if;
      end if;

      if P_RESTRINGIDO='U' then
          l_query:=l_query||'and t.id_trabajador='||P_ID_USER::text||' ';
      end if;
      
      --DBMS_OUTPUT.PUT_LINE(l_query);
      
     EXECUTE l_query USING P_ID_ENTIDAD,l_anhomes;

      --sueldo mensual
      MERGE INTO ENOC.TT_REPORTE_JAR S 
      USING(
        SELECT coalesce(sum(w.importe),0) as total,
        rr.ID_TRABAJADOR,
        coalesce(sum(w.dias),0) as dias,
        coalesce(sum(case when w.ID_TIPO_CANTIDAD=1 then  w.horas else 0 end),0) as horas
        from ENOC.PLLA_REMUNERACION_DET w , ENOC.PLLA_REMUNERACION rr
        where w.ID_REMUNERACION=rr.ID_REMUNERACION
        and  rr.ID_TRABAJADOR in (
            SELECT r.ID_TRABAJADOR from ENOC.TT_REPORTE_JAR r
            where r.TIPO_PAGO='H'
        )        
        and w.id_anho=P_ID_ANHO
        and w.id_mes=P_ID_MES 
        group by rr.ID_TRABAJADOR
      )T ON (T.ID_TRABAJADOR=S.ID_TRABAJADOR)
      WHEN  MATCHED THEN UPDATE SET  
      S.SUELDO_MEN=T.total,
      S.HORA_MEN=T.horas,
      S.HORA_REAL=T.horas,
      s.HORA_SEMANA=0,
      s.DIAS_MEN=T.dias,
      s.DIAS_REAL=T.dias;

      update ENOC.TT_REPORTE_JAR set 
      dias_mes=(to_char(date_trunc('day', ((date_trunc('month',(to_date(l_fecha_rep,'YYYY-MM-DD'))::timestamp + interval '1 month'))::timestamp(0) - 1)),'DD'))::numeric ,
      DIAS_FAL =0,
      HORAS_VAC  =0,
      HORAS_LIC  =0, 
      HORAS_FAL  =0,
      sueldo_total=sueldo+sueldo_men;

      update ENOC.TT_REPORTE_JAR set 
      dias_men=case when(f_fin-f_ini)+1 = dias_mes then 30 else (f_fin-f_ini)+1 end 
      where TIPO_PAGO='F';

      
      MERGE INTO ENOC.TT_REPORTE_JAR S 
      USING(
        SELECT 
         count(1) as DIAS,ID_TRABAJADOR
         from  ENOC.PLLA_ASISTENCIA 
         where to_char(fecha,'YYYYMM')=l_anhomes
         and id_motivo_asist in ('PLH','A','SA','DO')
         and ID_TRABAJADOR in (
              SELECT r.ID_TRABAJADOR from ENOC.TT_REPORTE_JAR r
              where r.TIPO_PAGO='F'
          )  
          group by ID_TRABAJADOR
      )T ON (T.ID_TRABAJADOR=S.ID_TRABAJADOR)
      WHEN  MATCHED THEN UPDATE SET  
      s.DIAS_REAL=T.dias;

      
      MERGE INTO ENOC.TT_REPORTE_JAR S 
      USING(
        SELECT 
         coalesce(sum(coalesce(num_horas,0)),0) as horas,ID_TRABAJADOR
         from  ENOC.PLLA_ASISTENCIA 
         where to_char(fecha,'YYYYMM')=l_anhomes
         and id_motivo_asist in ('PLH','A','SA','DO')
         and ID_TRABAJADOR in (
              SELECT r.ID_TRABAJADOR from ENOC.TT_REPORTE_JAR r,ENOC.PLLA_TIPO_HORARIO Y
              where R.ID_TIPO_HORARIO=Y.ID_TIPO_HORARIO
              AND r.TIPO_PAGO='F'
              AND coalesce(Y.CODIGO,'-') NOT IN ('HOR_DP') 
          )  
          group by ID_TRABAJADOR
      )T ON (T.ID_TRABAJADOR=S.ID_TRABAJADOR)
      WHEN  MATCHED THEN UPDATE SET  
      s.HORA_REAL=T.horas;

      MERGE INTO ENOC.TT_REPORTE_JAR S 
      USING(
        SELECT x.id_persona, sum(x.horas)*4 as horas from (
          SELECT accd.id_persona,coalesce(sum(coalesce(Accd.Hl,0)*coalesce(Accd.Factor,0)),0) as horas
          from david.vw_acad_carga_academica acc 
          inner join david.acad_carga_curso_docente accd on Accd.Id_Carga_Curso=Acc.Id_Carga_Curso
          left join(SELECT Accd.Id_Carga_Curso,max(amd.Fecha_Inicio ) fecha_inicio,min(Amd.fecha_fin) fecha_fin
                                  FROM david.Acad_Carga_Curso_Docente ACCD inner join david.Acad_Modulo_Detalle amd on Amd.Id_Modulo_Detalle=Accd.Id_Modulo_Detalle
                                  group by Accd.Id_Carga_Curso) fc on fc.Id_Carga_Curso=acc.Id_Carga_Curso
          where acc.id_escuela not in (674)
          and acc.id_facultad not in (673)
          and accd.id_persona in (
              select r.id_persona from ENOC.TT_REPORTE_JAR r,ENOC.PLLA_TIPO_HORARIO Y
              where R.ID_TIPO_HORARIO=Y.ID_TIPO_HORARIO
              AND r.TIPO_PAGO='F'
              AND coalesce(Y.CODIGO,'-')  IN ('HOR_DP') 
          ) 
          and acc.origen='O' 
          and (acc.id_facultad between 7 and 12 or acc.id_facultad=129)
          and (l_anhomes)::numeric  between (to_char(fc.fecha_inicio,'YYYYMM'))::numeric  and (to_char(fc.fecha_fin,'YYYYMM'))::numeric  
          GROUP by  accd.id_persona
          
union all

          select pc.id_persona,coalesce(sum(coalesce(apc.Horas_Laborales, 0)),0) as horas
          from  david.acad_persona_contrato pc
          inner join david.acad_persona_comision apc on apc.id_persona_contrato=pc.id_persona_contrato
          where pc.id_persona in (
              select r.id_persona from ENOC.TT_REPORTE_JAR r,ENOC.PLLA_TIPO_HORARIO Y
              where R.ID_TIPO_HORARIO=Y.ID_TIPO_HORARIO
              AND r.TIPO_PAGO='F'
              AND coalesce(Y.CODIGO,'-')  IN ('HOR_DP') 
          ) 
          and (l_anhomes)::numeric  between (to_char(apc.fecha_inicio,'YYYYMM'))::numeric  and (to_char(apc.fecha_fin,'YYYYMM'))::numeric  
          group by pc.id_persona
        )x 
        group by x.id_persona
      )T ON (T.id_persona=S.id_persona)
      WHEN  MATCHED THEN UPDATE SET  
      s.HORA_REAL=T.horas;

      MERGE INTO ENOC.TT_REPORTE_JAR S 
      USING(
        SELECT 
         count(1) as DIAS,ID_TRABAJADOR
         from  ENOC.PLLA_ASISTENCIA 
         where to_char(fecha,'YYYYMM')=l_anhomes
         and id_motivo_asist not in ('PLH','A','SA','DO')
         and ID_TRABAJADOR in (
              SELECT r.ID_TRABAJADOR from ENOC.TT_REPORTE_JAR r,ENOC.PLLA_TIPO_HORARIO Y
              where R.ID_TIPO_HORARIO=Y.ID_TIPO_HORARIO
              AND r.TIPO_PAGO='F'
              AND coalesce(Y.CODIGO,'-')  IN ('HOR_DP') 
          )  
          group by ID_TRABAJADOR
      )T ON (T.ID_TRABAJADOR=S.ID_TRABAJADOR)
      WHEN  MATCHED THEN UPDATE SET  
      s.DIAS_VAC=T.DIAS;

      update ENOC.TT_REPORTE_JAR set 
      horas_vac=DIAS_VAC*(round((hora_men/dias_men)::numeric,2)) 
      where TIPO_PAGO='F'
      and coalesce(DIAS_VAC,0)>0;

      update ENOC.TT_REPORTE_JAR set 
      hora_real=hora_real- horas_vac
      where TIPO_PAGO='F'
      and coalesce(horas_vac,0)>0;

      update ENOC.TT_REPORTE_JAR set 
      DIAS_REAL=DIAS_REAL- DIAS_VAC
      where TIPO_PAGO='F'
      and coalesce(DIAS_VAC,0)>0
      and ID_TRABAJADOR in (
              SELECT r.ID_TRABAJADOR from ENOC.TT_REPORTE_JAR r,ENOC.PLLA_TIPO_HORARIO Y
              where R.ID_TIPO_HORARIO=Y.ID_TIPO_HORARIO
              AND r.TIPO_PAGO='F'
              AND coalesce(Y.CODIGO,'-')  IN ('HOR_DP') 
      );

          
      OPEN CURSOR FOR
      SELECT 
      t.id_persona,
      t.id_trabajador,
      t.paterno,
      t.materno,
      t.nombre,
      t.sexo,
      t.apellidonombre,
      to_char(t.FEC_NACIMIENTO,'DD/MM/YYYY') as FEC_NACIMIENTO,
      t.ID_TIPODOCUMENTO,
      tdc.siglas as tipodocumento,
      t.NUM_DOCUMENTO,
      to_char(t.FECHA_INICIO,'DD/MM/YYYY') as FECHA_INICIO,
      cc.depto_padre,
      cc.ID_DEPTO,
      cc.ccosto,
      t.id_perfil_puesto,
      ppp.PUESTO,
      to_char(t.FECHA_FIN_PREVISTO,'DD/MM/YYYY') as FECHA_FIN,
      to_char(t.FECHA_FIN_efectivo,'DD/MM/YYYY') as FECHA_FIN_efectivo,
      tt.sueldo_total,
      tt.HORA_MEN,
      tt.HORA_REAL,
      tt.HORA_SEMANA,
      tt.DIAS_MEN,
      tt.DIAS_REAL,
      tt.DIAS_VAC,
      tt.horas_vac,
      tt.dias_mes,
      cc.area,
      cl.nombre as condicion_laboral,
      tr.nombre as tiempo_trabajo,
      P_ID_ANHO as id_anho,
      P_ID_MES as id_mes,
      st.nombre_corto as situacion_trabajador
      from enoc.vw_trabajador t
      inner join ENOC.TT_REPORTE_JAR tt on tt.id_trabajador=t.id_trabajador
      inner join enoc.vw_ent_dep_area_ccosto cc on cc.ID_SEDEAREA=t.ID_SEDEAREA
      inner join moises.tipo_documento tdc on tdc.ID_TIPODOCUMENTO=t.ID_TIPODOCUMENTO
      inner join enoc.vw_perfil_puesto ppp on ppp.id_perfil_puesto=t.id_perfil_puesto
      inner join moises.condicion_laboral cl on cl.id_condicion_laboral=t.id_condicion_laboral
      inner join moises.tipo_tiempo_trabajo tr on tr.id_tipo_tiempo_trabajo=t.id_tipo_tiempo_trabajo
      inner join moises.situacion_trabajador st on st.id_situacion_trabajador=t.id_situacion_trabajador
      order by paterno,materno,NOMBRE;

  END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enoc.pkg_compensacion_sp_reporte_jar ( P_ID_ENTIDAD bigint, P_ID_DEPTO text, P_ID_AREA bigint, P_ID_CONDICION_LABORAL text, P_ID_TIPO_TIEMPO_TRABAJO bigint, P_ID_ANHO bigint, P_ID_MES bigint, P_DATO text, P_RESTRINGIDO text, P_ID_ACCESO_NIVEL bigint, P_ID_AREAS_USER text, P_ID_USER bigint, OUT CURSOR REFCURSOR ) FROM PUBLIC;
