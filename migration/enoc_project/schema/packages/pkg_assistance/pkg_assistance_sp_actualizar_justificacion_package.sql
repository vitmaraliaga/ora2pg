-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = enoc,pkg_assistance,public;




CREATE OR REPLACE PROCEDURE enoc.pkg_assistance_sp_actualizar_justificacion ( P_ID_SOLIC_JUSTIF bigint, P_ID_ENTIDAD bigint, P_ID_DEPTO text, P_ID_TRABAJADOR bigint, P_ID_MOTIVO_JUSTIF bigint, P_FECHA timestamp(0), P_DESCRIPCION text, P_EVIDENCIA_ADJ text, P_ID_ESTADO_JUSTIF text, P_ID_USER bigint, P_ERROR OUT bigint, P_MSGERROR OUT text) AS $body$
DECLARE

	L_ID_SOLIC_JUSTIF bigint;
	
BEGIN
		P_ERROR:=0;
		P_MSGERROR := 'Se guardó correctamente.';
-- 		<<FIND_DATOS>>
		BEGIN
			SELECT ID_SOLIC_JUSTIF INTO STRICT L_ID_SOLIC_JUSTIF FROM ENOC.PLLA_SOLIC_JUSTIF WHERE ID_SOLIC_JUSTIF=P_ID_SOLIC_JUSTIF;
		EXCEPTION WHEN no_data_found THEN
            P_ERROR := 1;
            P_MSGERROR := 'No existe la justificación.';
            RETURN;
        END;
-- 		<<UPDATE_JUSTIFICACION>>
	    BEGIN
		    UPDATE ENOC.PLLA_SOLIC_JUSTIF SET ID_MOTIVO_JUSTIF=P_ID_MOTIVO_JUSTIF,DESCRIPCION=P_DESCRIPCION,
		    FECHA=P_FECHA,EVIDENCIA_ADJ=P_EVIDENCIA_ADJ,ID_ESTADO_JUSTIF=P_ID_ESTADO_JUSTIF,ID_USER_MOD=P_ID_USER,FECHA_MOD=clock_timestamp()
		    WHERE ID_SOLIC_JUSTIF = P_ID_SOLIC_JUSTIF;
	    EXCEPTION WHEN OTHERS THEN
		    P_MSGERROR:='No se pudo actualizar la justificación.';
	        P_ERROR := 2;
	       	RETURN;
		END;
  	END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enoc.pkg_assistance_sp_actualizar_justificacion ( P_ID_SOLIC_JUSTIF bigint, P_ID_ENTIDAD bigint, P_ID_DEPTO text, P_ID_TRABAJADOR bigint, P_ID_MOTIVO_JUSTIF bigint, P_FECHA timestamp(0), P_DESCRIPCION text, P_EVIDENCIA_ADJ text, P_ID_ESTADO_JUSTIF text, P_ID_USER bigint, P_ERROR OUT bigint, P_MSGERROR OUT text) FROM PUBLIC;
