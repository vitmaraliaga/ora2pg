-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = enoc,pkg_contract,public;




CREATE OR REPLACE PROCEDURE enoc.pkg_contract_sp_ptldatos (P_ID_CONTRATO bigint, P_PARAMETRO text,P_PARAMETRO_RET OUT text, P_ERROR OUT bigint,P_MSGERROR out text) AS $body$
DECLARE

        l_contar bigint;
        l_error bigint:=0;
        l_msgerror varchar(200):='';
        l_parametro text:='';
        l_id_persona bigint;
        l_id_ubigeo bigint;
        l_departamento varchar(200):='';
        l_provincia varchar(200):='';
        l_distrito varchar(200):='';

BEGIN
      
        SELECT id_persona into STRICT l_id_persona from plla_contrato where id_contrato=P_ID_CONTRATO;

        SELECT count(*) into STRICT l_contar FROM MOISES.PERSONA_DIRECCION X WHERE X.ID_PERSONA=l_id_persona AND X.ID_TIPODIRECCION=4 AND X.ES_ACTIVO=1  LIMIT 1;
        if l_contar>0 then
          SELECT X.id_ubigeo into STRICT  l_id_ubigeo  FROM MOISES.PERSONA_DIRECCION X WHERE X.ID_PERSONA=l_id_persona AND X.ID_TIPODIRECCION=4 AND X.ES_ACTIVO=1  LIMIT 1;

          select departamento,provincia,distrito into STRICT l_departamento,l_provincia,l_distrito from moises.vw_ubigeo where id_ubigeo=l_id_ubigeo;

          case P_PARAMETRO
           when 'DIST_DIR' then 
            l_parametro:=l_distrito;
           when 'PROV_DIR' then
            l_parametro:=l_provincia;
           when 'DEPA_DIR' then
            l_parametro:=l_departamento;
           else
            l_parametro:='';
         end case;
        end if;
        P_ERROR:=l_error;
        P_MSGERROR:=l_msgerror;
        P_PARAMETRO_RET:=l_parametro;
      END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enoc.pkg_contract_sp_ptldatos (P_ID_CONTRATO bigint, P_PARAMETRO text,P_PARAMETRO_RET OUT text, P_ERROR OUT bigint,P_MSGERROR out text) FROM PUBLIC;
