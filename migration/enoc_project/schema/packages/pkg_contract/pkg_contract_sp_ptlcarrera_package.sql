-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = enoc,pkg_contract,public;




CREATE OR REPLACE PROCEDURE enoc.pkg_contract_sp_ptlcarrera (P_ID_CONTRATO bigint, P_PARAMETRO text,P_PARAMETRO_RET OUT text, P_ERROR OUT bigint,P_MSGERROR out text) AS $body$
DECLARE

        l_contar bigint;
        l_error bigint:=0;
        l_msgerror varchar(200):='';
        l_parametro text:='';
        l_id_persona bigint;

BEGIN
        SELECT id_persona into STRICT l_id_persona from plla_contrato where id_contrato=P_ID_CONTRATO;

        select count(*) into STRICT l_contar
        from MOISES.situacion_educativa a inner join 
        MOISES.PERSONA_INFORMACION_ACADEMICA b  on b.id_situacion_educativa=A.id_situacion_educativo
        left join MOISES.CARRERA_PROFESIONAL c on c.ID_CARRERA_PROFESIONAL=b.ID_CARRERA
        where b.ID_SITUACION_EDUCATIVA in ('14','09','11')
        and b.id_persona=l_id_persona;

        if  l_contar>0 then
          select carrera into STRICT l_parametro from (
            SELECT case when (b.ID_CARRERA IS NOT NULL AND b.ID_CARRERA::text <> '') then c.nombre else b.denominacion_grado end carrera ,a.orden,b.id_persona
            from MOISES.situacion_educativa a inner join 
            MOISES.PERSONA_INFORMACION_ACADEMICA b  on b.id_situacion_educativa=A.id_situacion_educativo
            left join MOISES.CARRERA_PROFESIONAL c on c.ID_CARRERA_PROFESIONAL=b.ID_CARRERA
            where b.ID_SITUACION_EDUCATIVA in ('14','09','11')
            and b.id_persona=l_id_persona 
            order by b.id_persona, a.orden desc
          ) alias2 LIMIT 1;
        end if;
        P_ERROR:=l_error;
        P_MSGERROR:=l_msgerror;
        P_PARAMETRO_RET:=l_parametro;
      END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE enoc.pkg_contract_sp_ptlcarrera (P_ID_CONTRATO bigint, P_PARAMETRO text,P_PARAMETRO_RET OUT text, P_ERROR OUT bigint,P_MSGERROR out text) FROM PUBLIC;
