-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE eliseo.iudp_moneda (P_Modo integer, P_ID_MONEDA integer, P_COD_INTERNO text, P_NOMBRE text, P_SIGLAS text, P_SIMBOLO text, P_COD_SUNAT text) AS $body$
DECLARE


	S_SIGLAS           varchar(60);
	S_CANTIDAD            integer;
	S_ID_MONEDA            integer;

 
BEGIN
	 
IF P_Modo = 0 THEN

	S_SIGLAS := CASE WHEN P_SIGLAS IN ('@Symbol@') THEN '' ELSE P_SIGLAS END;

    SELECT COUNT(*) INTO STRICT S_CANTIDAD FROM Conta_Moneda WHERE COD_INTERNO = P_COD_INTERNO;
    
    IF S_CANTIDAD = 0 THEN
    
    	SELECT COALESCE(max(ID_MONEDA),0)+1 INTO STRICT S_ID_MONEDA FROM CONTA_MONEDA;

      INSERT INTO Conta_Moneda(ID_MONEDA, NOMBRE, SIGLAS, SIMBOLO, COD_INTERNO, COD_SUNAT)
        VALUES (S_ID_MONEDA, P_NOMBRE, S_SIGLAS, P_SIMBOLO, P_COD_INTERNO, P_COD_SUNAT);

    ELSE
      UPDATE Conta_Moneda SET
        NOMBRE      = P_NOMBRE,
        SIGLAS      = S_SIGLAS,
        SIMBOLO     = COALESCE(trim(both P_SIMBOLO), SIMBOLO) ,
        COD_SUNAT   = COALESCE(trim(both P_COD_SUNAT), COD_SUNAT),
        COD_INTERNO = P_COD_INTERNO
      WHERE ID_MONEDA = P_ID_MONEDA;
    END IF;

  END IF;


 end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.iudp_moneda (P_Modo integer, P_ID_MONEDA integer, P_COD_INTERNO text, P_NOMBRE text, P_SIGLAS text, P_SIMBOLO text, P_COD_SUNAT text) FROM PUBLIC;

