-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE eliseo.iudp_entidad_cuenta_corriente (P_Modo integer, P_ID_ENTIDAD integer, P_ID_CUENTACTE text, P_ID_MONEDA text, P_ID_TIPOCUENTACTE text, P_ID_TIPOCUENTABANCO integer, P_NOMBRE text) AS $body$
DECLARE

   S_MONEDA varchar(10);
   S_NOMBRE varchar(255);
   S_CANT   integer;

BEGIN
    S_MONEDA := CASE WHEN P_ID_MONEDA IN ('@CurrencyCode@') THEN '' ELSE P_ID_MONEDA END;
	S_NOMBRE := CASE WHEN P_NOMBRE = '@Name@' THEN '' ELSE P_NOMBRE END;

    IF P_Modo = 0 THEN
                     
        SELECT COUNT(ID_TIPOCTACTE) INTO STRICT S_CANT 
        FROM Tipo_Cta_Corriente 
        WHERE ID_TIPOCTACTE = P_ID_TIPOCUENTACTE;

        IF S_CANT = 0 THEN
            INSERT INTO Tipo_Cta_Corriente(ID_TIPOCTACTE, NOMBRE)
            VALUES (P_ID_TIPOCUENTACTE, P_ID_TIPOCUENTACTE);
        END IF;

        SELECT COUNT(*) INTO STRICT S_CANT 
        FROM CONTA_ENTIDAD_CTA_CTE 
        WHERE ID_ENTIDAD = P_ID_ENTIDAD 
        AND ID_TIPOCTACTE = P_ID_TIPOCUENTACTE 
        AND ID_CTACTE = P_ID_CUENTACTE;

        IF S_CANT = 0 THEN
            INSERT INTO CONTA_ENTIDAD_CTA_CTE(ID_ENTIDAD, ID_TIPOCTACTE, ID_CTACTE, ID_TIPOCUENTABANCO, ID_MONEDA, NOMBRE)
            VALUES (P_ID_ENTIDAD, P_ID_TIPOCUENTACTE, P_ID_CUENTACTE, P_ID_TIPOCUENTABANCO, coalesce(S_MONEDA, '7'), coalesce(S_NOMBRE,'-'));
        ELSE
            UPDATE CONTA_ENTIDAD_CTA_CTE SET
                    ID_TIPOCUENTABANCO = coalesce(P_ID_TIPOCUENTABANCO, ID_TIPOCUENTABANCO),
                    ID_MONEDA          = coalesce(S_MONEDA, '7'),
                    NOMBRE             = coalesce(S_NOMBRE,'-')
            WHERE ID_ENTIDAD = P_ID_ENTIDAD
            AND ID_TIPOCTACTE = P_ID_TIPOCUENTACTE
            AND ID_CTACTE = P_ID_CUENTACTE;
        END IF;
    END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.iudp_entidad_cuenta_corriente (P_Modo integer, P_ID_ENTIDAD integer, P_ID_CUENTACTE text, P_ID_MONEDA text, P_ID_TIPOCUENTACTE text, P_ID_TIPOCUENTABANCO integer, P_NOMBRE text) FROM PUBLIC;

