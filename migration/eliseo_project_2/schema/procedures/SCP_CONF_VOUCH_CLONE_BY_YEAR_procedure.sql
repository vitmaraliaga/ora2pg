-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE eliseo.scp_conf_vouch_clone_by_year ( v_ID_ENTIDAD bigint, v_ID_YEAR_FROM bigint, v_ID_YEAR_TO bigint, v_ERROR OUT bigint, v_MSGERROR OUT text ) AS $body$
DECLARE

    L_ERROR bigint :=0;
    L_MSGERROR varchar(100) :='';
    l_contar bigint := 0;


BEGIN

    SELECT count(1) into STRICT l_contar FROM CONTA_VOUCHER_CONFIG
    WHERE ID_ANHO = v_ID_YEAR_TO
    AND ID_ENTIDAD = v_ID_ENTIDAD;

    IF l_contar > 0 THEN
        L_ERROR := 1;
        L_MSGERROR := 'Alto: Ya existen configuraciones de vouchers en el a√±o : '||v_ID_YEAR_TO::text;
--         goto salida_rapida;
    END IF;

    IF L_ERROR = 0 THEN
        INSERT INTO CONTA_VOUCHER_CONFIG(ID_ENTIDAD, ID_DEPTO, ID_TIPOASIENTO, ID_ANHO, ID_MODULO, FECHA, AUTOMATICO,
            NOMBRE, ID_TIPOVOUCHER, ID_SISTEMAEXTERNO, ID_TIPOASIENTO_PARENT, ID_TIPOVOUCHER_PARENT )
        SELECT ID_ENTIDAD, ID_DEPTO, ID_TIPOASIENTO, v_ID_YEAR_TO, ID_MODULO, FECHA, AUTOMATICO,
        NOMBRE, ID_TIPOVOUCHER, ID_SISTEMAEXTERNO, ID_TIPOASIENTO_PARENT, ID_TIPOVOUCHER_PARENT 
        FROM CONTA_VOUCHER_CONFIG 
        WHERE 
        ID_ANHO=v_ID_YEAR_FROM
        AND ID_ENTIDAD = v_ID_ENTIDAD;
    END IF;

--     <<salida_rapida>>
    V_ERROR := L_ERROR;
    V_MSGERROR := L_MSGERROR;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.scp_conf_vouch_clone_by_year ( v_ID_ENTIDAD bigint, v_ID_YEAR_FROM bigint, v_ID_YEAR_TO bigint, v_ERROR OUT bigint, v_MSGERROR OUT text ) FROM PUBLIC;

