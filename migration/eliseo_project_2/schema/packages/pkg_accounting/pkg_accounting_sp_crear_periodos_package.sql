-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_accounting,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_accounting_sp_crear_periodos ( p_id_entidad integer, p_id_anho integer, p_id_plan integer, p_nombre text, p_fecha_ini timestamp(0), p_fecha_fin timestamp(0), p_id_user_ini integer DEFAULT NULL) AS $body$
DECLARE

        l_id_mes integer;
        meses CURSOR FOR
        SELECT
            id_mes
        FROM
            conta_mes;


BEGIN
        INSERT INTO conta_entidad_anho_config(
            id_entidad,
            id_anho,
            id_tipoplan,
            nombre,
            fecha_inicio,
            fecha_fin,
            activo,
            id_user_inicio
        ) VALUES (
            p_id_entidad,
            p_id_anho,
            p_id_plan,
            p_nombre,
            p_fecha_ini,
            p_fecha_fin,
            '1',
            p_id_user_ini
        );

        OPEN meses;
        FETCH meses INTO l_id_mes;
        WHILE meses%found LOOP
            INSERT INTO conta_entidad_mes_config(
                id_entidad,
                id_anho,
                id_mes,
                estado
            ) VALUES (
                p_id_entidad,
                p_id_anho,
                l_id_mes,
                '0'
            );

            FETCH meses INTO l_id_mes;
        END LOOP;

        CLOSE meses;
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_accounting_sp_crear_periodos ( p_id_entidad integer, p_id_anho integer, p_id_plan integer, p_nombre text, p_fecha_ini timestamp(0), p_fecha_fin timestamp(0), p_id_user_ini integer DEFAULT NULL) FROM PUBLIC;
