-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_presupuesto,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_presupuesto_sp_delete_posgrado_proyecccion (P_ID_PROYECCION bigint,P_ERROR OUT bigint,P_MSGERROR out text) AS $body$
DECLARE

    l_error bigint:=0;
    l_msgerror varchar(200):='';
    l_contar bigint;
    L_ID_ENTIDAD bigint;
    L_ID_ANHO bigint;
    L_ID_DEPTO_PADRE  varchar(10);
    L_ID_DEPTO varchar(10);
    L_ID_EAP bigint;
    L_ID_AUXILIAR bigint;

BEGIN
          SELECT 
          ID_ENTIDAD,
          ID_ANHO,
          ID_DEPTO_PADRE,
          ID_DEPTO,
          ID_EAP,
          ID_AUXILIAR
          INTO STRICT
          L_ID_ENTIDAD,
          L_ID_ANHO,
          L_ID_DEPTO_PADRE,
          L_ID_DEPTO,
          L_ID_EAP,
          L_ID_AUXILIAR
          FROM PSTO_PREGRADO_PROYECCCION
          WHERE ID_PROYECCION=P_ID_PROYECCION;

          
          SELECT COUNT(*) INTO STRICT l_contar FROM PSTO_PREGRADO_PROYECCCION
          WHERE ID_ENTIDAD=L_ID_ENTIDAD
          AND ID_ANHO=L_ID_ANHO
          AND ID_DEPTO_PADRE=L_ID_DEPTO_PADRE
          AND ID_DEPTO=L_ID_DEPTO
          AND ID_AUXILIAR=L_ID_AUXILIAR;

          IF l_contar=1 THEN
          
              DELETE FROM PSTO_PREGRADO_PROCESO_CONCEPTO 
              WHERE ID_PREGRADO_PROCESO IN (
                  SELECT ID_PREGRADO_PROCESO FROM PSTO_PREGRADO_PROCESO  
                  WHERE ID_ENTIDAD=L_ID_ENTIDAD
                  AND ID_ANHO=L_ID_ANHO
                  AND ID_DEPTO_PADRE=L_ID_DEPTO_PADRE
                  AND ID_DEPTO=L_ID_DEPTO
                  AND ID_AUXILIAR=L_ID_AUXILIAR
              );

              DELETE FROM PSTO_PREGRADO_PROCESO  
              WHERE ID_ENTIDAD=L_ID_ENTIDAD
              AND ID_ANHO=L_ID_ANHO
              AND ID_DEPTO_PADRE=L_ID_DEPTO_PADRE
              AND ID_DEPTO=L_ID_DEPTO
              AND ID_AUXILIAR=L_ID_AUXILIAR;

          END IF;

          DELETE FROM PSTO_PREGRADO_PROYECCCION  WHERE ID_PROYECCION=P_ID_PROYECCION;

          CALL pkg_presupuesto_sp_posgrado_proceso(L_ID_ENTIDAD,L_ID_DEPTO_PADRE, L_ID_ANHO ,L_ID_AUXILIAR ,l_error,l_msgerror);

          P_ERROR:=l_error;
          P_MSGERROR:=l_msgerror;

   END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_presupuesto_sp_delete_posgrado_proyecccion (P_ID_PROYECCION bigint,P_ERROR OUT bigint,P_MSGERROR out text) FROM PUBLIC;
