-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_presupuesto,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_presupuesto_sp_actualizar_tipoconcepto (P_ID_CONCEPTO_PRECIO bigint,P_ERROR OUT bigint,P_MSGERROR out text) AS $body$
DECLARE

      l_error bigint:=0;
      l_msgerror varchar(200):='';
      l_id_entidad bigint;
      l_id_anho bigint;
      l_id_depto_padre varchar(10);
      l_id_auxiliar bigint;
      l_msg varchar(200):='';

BEGIN
       
       
      SELECT ID_ENTIDAD,ID_ANHO,ID_DEPTO_PADRE,ID_AUXILIAR 
      INTO STRICT l_id_entidad,l_id_anho,l_id_depto_padre,l_id_auxiliar
      FROM PSTO_PREGRADO_CONCEPTO_PRECIO
      WHERE ID_CONCEPTO_PRECIO=P_ID_CONCEPTO_PRECIO;

      MERGE INTO PSTO_PREGRADO_PROCESO_CONCEPTO C 
      USING(
         SELECT 
         P.ID_PREGRADO_PROCESO,
         D.ID_CONCEPTO_PRECIO,
         R.TIPO
         FROM PSTO_PREGRADO_PROCESO_CONCEPTO D,PSTO_PREGRADO_PROCESO P,PSTO_PREGRADO_CONCEPTO_PRECIO R
         WHERE D.ID_PREGRADO_PROCESO=P.ID_PREGRADO_PROCESO
         AND D.ID_CONCEPTO_PRECIO=R.ID_CONCEPTO_PRECIO
         AND P.ID_ENTIDAD=l_id_entidad
         AND P.ID_ANHO=l_id_anho
         AND P.ID_DEPTO_PADRE=l_id_depto_padre
         AND P.ID_AUXILIAR=l_id_auxiliar
      )t
      ON (C.ID_PREGRADO_PROCESO=t.ID_PREGRADO_PROCESO AND C.ID_CONCEPTO_PRECIO=t.ID_CONCEPTO_PRECIO)
      WHEN  MATCHED THEN UPDATE SET
      C.TIPO=t.TIPO;

       
       P_ERROR:=l_error;
       P_MSGERROR:=l_msgerror;
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_presupuesto_sp_actualizar_tipoconcepto (P_ID_CONCEPTO_PRECIO bigint,P_ERROR OUT bigint,P_MSGERROR out text) FROM PUBLIC;
