-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_presupuesto,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_presupuesto_sp_residencia_concepto (P_ID_ENTIDAD bigint,P_ID_DEPTO_PADRE text,P_ID_ANHO bigint,P_ID_AUXILIAR bigint,P_ERROR OUT bigint,P_MSGERROR out text) AS $body$
DECLARE

    l_error bigint:=0;
    l_msgerror varchar(200):='';
    l_contar bigint;

    l_pregrado_proceso bigint;
    l_cuota_i decimal(10,2);
    l_cuota_ii decimal(10,2);
    l_res_i decimal(10,2);
    l_res_ii decimal(10,2);
    l_alim_i decimal(10,2);
    l_alim_ii decimal(10,2);
    l_lav_i decimal(10,2);
    l_lav_ii decimal(10,2);

      /*TOTAL_ENSE_I,--CUOTA I 
      TOTAL_ENSE_II, --CUOTA II
      IMP_MAT,--Costo Diario Resid
      CREDITO_1,--Costo Diario Alim
      CREDITO_2_5,--Costo Diario Lavander√≠a
      TOTAL_HORAS_I,-- DIAS I
      TOTAL_HORAS_II,--DIAS II*/
      
      
       
      
    cproc CURSOR FOR	
      SELECT 
        ID_PREGRADO_PROCESO,
        TOTAL_ENSE_I*TOTAL_ALUMNO_I AS CUOTA_I,
        TOTAL_ENSE_II*TOTAL_ALUMNO_II AS CUOTA_II,
        IMP_MAT*TOTAL_HORAS_I*TOTAL_ALUMNO_I AS RESIDENCIA_I,
        IMP_MAT*TOTAL_HORAS_II*TOTAL_ALUMNO_II AS RESIDENCIA_II,
        CREDITO_1*TOTAL_HORAS_I*TOTAL_ALUMNO_I AS ALIMENTACION_I,
        CREDITO_1*TOTAL_HORAS_II*TOTAL_ALUMNO_II AS ALIMENTACION_II,
        CREDITO_2_5*TOTAL_HORAS_I*TOTAL_ALUMNO_I AS LAVANDERIA_I,
        CREDITO_2_5*TOTAL_HORAS_II*TOTAL_ALUMNO_II AS LAVANDERIA_II
      FROM PSTO_PREGRADO_PROCESO
      WHERE ID_ENTIDAD=P_ID_ENTIDAD
      AND ID_DEPTO_PADRE=P_ID_DEPTO_PADRE
      AND ID_ANHO=P_ID_ANHO
      AND ID_AUXILIAR=P_ID_AUXILIAR;

    
BEGIN
    
       
      
        DELETE FROM PSTO_PREGRADO_PROCESO_CONCEPTO
        WHERE ID_PREGRADO_PROCESO IN (
          SELECT ID_PREGRADO_PROCESO FROM PSTO_PREGRADO_PROCESO
          WHERE ID_ENTIDAD=P_ID_ENTIDAD
          AND ID_ANHO=P_ID_ANHO
          AND ID_DEPTO_PADRE=P_ID_DEPTO_PADRE
          AND ID_AUXILIAR=P_ID_AUXILIAR	
        );

        OPEN cproc;
        FETCH cproc INTO l_pregrado_proceso,l_cuota_i,l_cuota_ii,l_res_i,l_res_ii,l_alim_i,l_alim_ii,l_lav_i,l_lav_ii;

        WHILE cproc%FOUND LOOP
        
          --CUOTA ALUMNO
           INSERT INTO PSTO_PREGRADO_PROCESO_CONCEPTO(
              ID_PREGRADO_PROCESO, 
              ID_CONCEPTO_PRECIO, 
              IMPORTE_I, 
              IMPORTE_II, 
              TOTAL_I, 
              TOTAL_II
          )
          SELECT
          l_pregrado_proceso,
          ID_CONCEPTO_PRECIO,
          0,
          0,
          l_cuota_i,
          l_cuota_ii
          FROM PSTO_PREGRADO_CONCEPTO_PRECIO 
          WHERE ID_ENTIDAD=P_ID_ENTIDAD
          AND ID_DEPTO_PADRE=P_ID_DEPTO_PADRE
          AND ID_ANHO=P_ID_ANHO
          AND ID_AUXILIAR=P_ID_AUXILIAR
          AND TIPO='M';

          --RESIDENCIA
           INSERT INTO PSTO_PREGRADO_PROCESO_CONCEPTO(
              ID_PREGRADO_PROCESO, 
              ID_CONCEPTO_PRECIO, 
              IMPORTE_I, 
              IMPORTE_II, 
              TOTAL_I, 
              TOTAL_II
          )
          SELECT
          l_pregrado_proceso,
          ID_CONCEPTO_PRECIO,
          0,
          0,
          l_res_i,
          l_res_ii
          FROM PSTO_PREGRADO_CONCEPTO_PRECIO 
          WHERE ID_ENTIDAD=P_ID_ENTIDAD
          AND ID_DEPTO_PADRE=P_ID_DEPTO_PADRE
          AND ID_ANHO=P_ID_ANHO
          AND ID_AUXILIAR=P_ID_AUXILIAR
          AND TIPO='RE';

          --alimentacion
           INSERT INTO PSTO_PREGRADO_PROCESO_CONCEPTO(
              ID_PREGRADO_PROCESO, 
              ID_CONCEPTO_PRECIO, 
              IMPORTE_I, 
              IMPORTE_II, 
              TOTAL_I, 
              TOTAL_II
          )
          SELECT
          l_pregrado_proceso,
          ID_CONCEPTO_PRECIO,
          0,
          0,
          l_alim_i,
          l_alim_ii
          FROM PSTO_PREGRADO_CONCEPTO_PRECIO 
          WHERE ID_ENTIDAD=P_ID_ENTIDAD
          AND ID_DEPTO_PADRE=P_ID_DEPTO_PADRE
          AND ID_ANHO=P_ID_ANHO
          AND ID_AUXILIAR=P_ID_AUXILIAR
          AND TIPO='SA';

          --lavanderia
           INSERT INTO PSTO_PREGRADO_PROCESO_CONCEPTO(
              ID_PREGRADO_PROCESO, 
              ID_CONCEPTO_PRECIO, 
              IMPORTE_I, 
              IMPORTE_II, 
              TOTAL_I, 
              TOTAL_II
          )
          SELECT
          l_pregrado_proceso,
          ID_CONCEPTO_PRECIO,
          0,
          0,
          l_lav_i,
          l_lav_ii
          FROM PSTO_PREGRADO_CONCEPTO_PRECIO 
          WHERE ID_ENTIDAD=P_ID_ENTIDAD
          AND ID_DEPTO_PADRE=P_ID_DEPTO_PADRE
          AND ID_ANHO=P_ID_ANHO
          AND ID_AUXILIAR=P_ID_AUXILIAR
          AND TIPO='SL';

          FETCH cproc INTO l_pregrado_proceso,l_cuota_i,l_cuota_ii,l_res_i,l_res_ii,l_alim_i,l_alim_ii,l_lav_i,l_lav_ii;

        END LOOP;
        CLOSE cproc;

  
      
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_presupuesto_sp_residencia_concepto (P_ID_ENTIDAD bigint,P_ID_DEPTO_PADRE text,P_ID_ANHO bigint,P_ID_AUXILIAR bigint,P_ERROR OUT bigint,P_MSGERROR out text) FROM PUBLIC;
