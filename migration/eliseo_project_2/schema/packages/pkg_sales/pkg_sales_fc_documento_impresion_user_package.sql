-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_sales,public;




CREATE OR REPLACE FUNCTION eliseo.pkg_sales_fc_documento_impresion_user (P_ID_PERSONA bigint,P_ID_COMPROBANTE text,P_ID_ENTIDAD bigint,P_ID_DEPTO text, P_ID_COMPROBANTE_AFECTO text DEFAULT NULL) RETURNS varchar AS $body$
DECLARE

    N_CANTIDAD bigint :=0;

BEGIN
    
	    IF coalesce(P_ID_COMPROBANTE_AFECTO::text, '') = '' THEN
	    
	        SELECT 
	                COUNT(A.ID) INTO STRICT N_CANTIDAD
	        FROM CONTA_DOCUMENTO_IP_USER A, CONTA_DOCUMENTO_IP B, CONTA_DOCUMENTO C
	        WHERE A.ID_DOCIP = B.ID_DOCIP
	        AND B.ID_DOCUMENTO = C.ID_DOCUMENTO
	        AND A.ID = P_ID_PERSONA
	        AND C.ID_COMPROBANTE = P_ID_COMPROBANTE
	        AND C.ID_ENTIDAD = P_ID_ENTIDAD
	        AND C.ID_DEPTO = P_ID_DEPTO;
	    ELSE
	    	SELECT 
                COUNT(A.ID) INTO STRICT N_CANTIDAD
	        FROM CONTA_DOCUMENTO_IP_USER A, CONTA_DOCUMENTO_IP B, CONTA_DOCUMENTO C
	        WHERE A.ID_DOCIP = B.ID_DOCIP
	        AND B.ID_DOCUMENTO = C.ID_DOCUMENTO
	        AND A.ID = P_ID_PERSONA
	        AND C.ID_COMPROBANTE = P_ID_COMPROBANTE
	        AND C.ID_ENTIDAD = P_ID_ENTIDAD
	        AND C.ID_DEPTO = P_ID_DEPTO
	        AND C.ID_COMPROBANTE_AFECTO = P_ID_COMPROBANTE_AFECTO;
	    END IF;

        RETURN(N_CANTIDAD);
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eliseo.pkg_sales_fc_documento_impresion_user (P_ID_PERSONA bigint,P_ID_COMPROBANTE text,P_ID_ENTIDAD bigint,P_ID_DEPTO text, P_ID_COMPROBANTE_AFECTO text DEFAULT NULL) FROM PUBLIC;
