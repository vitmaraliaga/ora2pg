-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_sales,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_sales_sp_procesar_efac (P_SERIE text,P_NUMERO text) AS $body$
DECLARE

        L_ID_VENTA bigint;
        L_ID_COMPROBANTE varchar(2);

        articulos CURSOR FOR	
        SELECT 
                ID_VENTA,ID_COMPROBANTE
        FROM VENTA 
        WHERE ID_ENTIDAD = 7124
        AND SERIE = P_SERIE
        --AND TO_CHAR(FECHA,'DDMMYYYY') = '13062020';
        AND NUMERO = P_NUMERO;
        	

BEGIN   
        
        OPEN articulos;
          FETCH articulos INTO L_ID_VENTA,L_ID_COMPROBANTE;
            WHILE articulos%FOUND LOOP

                DELETE FROM VENTA_ELECTRONICA
                WHERE ORIGENID = L_ID_VENTA;

                DELETE FROM UPEU_COMPROBANTE@DBL_ARON_APP
                WHERE ORIGENID = L_ID_VENTA::text;

                CALL pkg_sales_sp_venta_electronica(L_ID_VENTA,L_ID_COMPROBANTE);
                FETCH articulos INTO L_ID_VENTA,L_ID_COMPROBANTE;

            END LOOP;
        CLOSE articulos;

    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_sales_sp_procesar_efac (P_SERIE text,P_NUMERO text) FROM PUBLIC;
