-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_init_config,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_init_config_sp_anho_mes_contable (P_ID_ENTIDAD bigint, P_ID_ANHO bigint,P_ERROR OUT bigint,P_MSGERROR out text) AS $body$
DECLARE

        l_contar bigint := 0;

        l_id_entidad_base bigint := 72122;
        l_id_user bigint := 7932;
        L_ID_MES integer;	

        base_datas CURSOR FOR
        SELECT * from eliseo.CONTA_ENTIDAD_ANHO_CONFIG where id_entidad = l_id_entidad_base and id_anho = P_ID_ANHO;

        MESES CURSOR FOR		
        SELECT ID_MES FROM CONTA_MES;	



BEGIN
        FOR base_data in base_datas LOOP

            select count(1) into STRICT l_contar from eliseo.CONTA_ENTIDAD_ANHO_CONFIG 
                where id_entidad = P_ID_ENTIDAD
                and id_anho = P_ID_ANHO;

            if l_contar = 0 then
                INSERT INTO ELISEO.CONTA_ENTIDAD_ANHO_CONFIG(  ID_ENTIDAD,
                                                    ID_ANHO,
                                                    ID_TIPOPLAN,
                                                    NOMBRE,
                                                    FECHA_INICIO,
                                                    FECHA_FIN,
                                                    ACTIVO, 
                                                    ID_USER_INICIO)
                                            VALUES ( P_ID_ENTIDAD,
                                                    P_ID_ANHO,
                                                    base_data.ID_TIPOPLAN,
                                                    base_data.NOMBRE,
                                                    base_data.FECHA_INICIO,
                                                    base_data.FECHA_FIN,
                                                    '1',
                                                    l_id_user);
                RAISE NOTICE ' CONTA_ENTIDAD_ANHO_CONFIG creado!';
            end if;

            OPEN MESES;
                FETCH MESES INTO L_ID_MES;

                WHILE MESES%FOUND LOOP

                     select count(1) into STRICT l_contar from eliseo.CONTA_ENTIDAD_MES_CONFIG
                                    where id_entidad = P_ID_ENTIDAD
                                    and id_anho = P_ID_ANHO
                                    and id_mes = L_ID_MES;
                    if l_contar = 0 then
                        INSERT INTO CONTA_ENTIDAD_MES_CONFIG(  ID_ENTIDAD,
                                                            ID_ANHO,
                                                            ID_MES,
                                                            ESTADO)
                                                VALUES (    P_ID_ENTIDAD,
                                                            P_ID_ANHO,
                                                            L_ID_MES,
                                                            '0');
                    end if;
                    FETCH MESES INTO L_ID_MES;

                END LOOP;
            CLOSE MESES;

        end loop;
        P_ERROR := 0;
        P_MSGERROR := 'AÃ‘O y MES revisado y actualizado';
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_init_config_sp_anho_mes_contable (P_ID_ENTIDAD bigint, P_ID_ANHO bigint,P_ERROR OUT bigint,P_MSGERROR out text) FROM PUBLIC;
