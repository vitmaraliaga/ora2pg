-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,utils,public;




CREATE OR REPLACE FUNCTION eliseo.utils_str (P_EXPR bigint, P_LEN bigint DEFAULT 10, P_SCALE bigint DEFAULT 0) RETURNS varchar AS $body$
DECLARE

    v_ret_val varchar(50);
    v_temp_val bigint;
    v_format_str varchar(50);
    v_len bigint;
    v_val bigint;
    v_has_decimal boolean := FALSE;

BEGIN
      IF position('.' in p_expr::text) > 0 THEN
        v_has_decimal := TRUE;
        v_len := LENGTH(SUBSTR(p_expr::text, 1, position('.' in p_expr::text)-1));
      ELSE
        v_len := LENGTH(p_expr::text);
      END IF;
      
      IF p_len < v_len THEN
         RETURN trim(both LPAD(' ', p_len+1,'*'));
      END IF;

      v_temp_val := p_expr;
      IF p_len >= v_len THEN
         v_temp_val := ROUND(v_temp_val, p_scale);
      ELSE
         v_temp_val := round((v_temp_val)::numeric, 0);
      END IF;
      
      IF p_scale > 0 AND v_has_decimal THEN
         IF v_len >= (p_len - p_scale) THEN
             v_format_str := LPAD(' ', v_len+1, '9');
         ELSE
             v_format_str := LPAD(' ', (p_len - p_scale), '9');
         END IF;
         v_format_str := trim(both v_format_str);
         IF position('.' in p_expr::text) != p_len THEN
           v_format_str := v_format_str || '.';
           v_format_str := RPAD(v_format_str, p_len, '9');
         END IF;
      ELSE
         v_format_str := trim(both LPAD(' ', p_len+1, '9'));
      END IF;
      v_ret_val := TO_CHAR(v_temp_val, v_format_str);
      RETURN v_ret_val;
EXCEPTION
      WHEN OTHERS THEN
        RAISE EXCEPTION '%', DBMS_UTILITY.FORMAT_ERROR_STACK USING ERRCODE = '45000';
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eliseo.utils_str (P_EXPR bigint, P_LEN bigint DEFAULT 10, P_SCALE bigint DEFAULT 0) FROM PUBLIC;
