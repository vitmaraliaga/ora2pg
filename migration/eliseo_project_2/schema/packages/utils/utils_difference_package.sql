-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,utils,public;




CREATE OR REPLACE FUNCTION eliseo.utils_difference (p_expr1 text, p_expr2 text) RETURNS bigint AS $body$
DECLARE

    sound_ex_val_1 char(4);
    sound_ex_val_2 char(4);
    similarity bigint := 0;
    idx bigint := 1;

BEGIN
    IF coalesce(p_expr1::text, '') = '' OR coalesce(p_expr2::text, '') = '' THEN
       RETURN NULL;
    END IF;
    sound_ex_val_1 := SOUNDEX(p_expr1);
    sound_ex_val_2 := SOUNDEX(p_expr2);
    LOOP
       IF SUBSTR(sound_ex_val_1, idx, 1) = SUBSTR(sound_ex_val_2, idx, 1) THEN
          similarity := similarity + 1;
       END IF;

       idx := idx + 1;
       EXIT WHEN idx > 4;
    END LOOP;
    RETURN similarity;
EXCEPTION
    WHEN OTHERS THEN
       RAISE EXCEPTION '%', DBMS_UTILITY.FORMAT_ERROR_STACK USING ERRCODE = '45000';
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eliseo.utils_difference (p_expr1 text, p_expr2 text) FROM PUBLIC;
