-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_inventories,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_inventories_sp_add_kardex (P_ID_ANHO bigint, P_ID_ALMACEN bigint, P_ID_ARTICULO bigint, P_ID_TIPOORIGEN bigint, P_ID_MOVIMIENTO bigint,P_CANTIDAD bigint,P_COSTO_UNITARIO bigint,P_COSTO_TOTAL bigint, P_TIPO text) AS $body$
BEGIN
        INSERT INTO INVENTARIO_KARDEX(ID_ANHO,ID_ALMACEN,ID_ARTICULO,ID_TIPOORIGEN,ID_ORIGEN,CANTIDAD,COSTO_UNITARIO,COSTO_TOTAL,FECHA,TIPO) 
        VALUES (P_ID_ANHO,P_ID_ALMACEN,P_ID_ARTICULO,P_ID_TIPOORIGEN,P_ID_MOVIMIENTO,CASE WHEN P_TIPO='I' THEN P_CANTIDAD  ELSE P_CANTIDAD*-1 END ,P_COSTO_UNITARIO,CASE WHEN P_TIPO='I' THEN P_COSTO_TOTAL  ELSE P_COSTO_TOTAL*-1 END ,clock_timestamp(),P_TIPO);

        UPDATE INVENTARIO_ALMACEN_ARTICULO SET ESTADO = '1'
        WHERE ID_ALMACEN = P_ID_ALMACEN
        AND ID_ARTICULO = P_ID_ARTICULO
        AND ID_ANHO = P_ID_ANHO;

        
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_inventories_sp_add_kardex (P_ID_ANHO bigint, P_ID_ALMACEN bigint, P_ID_ARTICULO bigint, P_ID_TIPOORIGEN bigint, P_ID_MOVIMIENTO bigint,P_CANTIDAD bigint,P_COSTO_UNITARIO bigint,P_COSTO_TOTAL bigint, P_TIPO text) FROM PUBLIC;
