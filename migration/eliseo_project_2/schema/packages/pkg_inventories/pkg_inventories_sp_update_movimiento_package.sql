-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_inventories,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_inventories_sp_update_movimiento (P_ID_MOVIMIENTO bigint, P_ID_RECETA bigint, P_ID_TIPOOPERACION text,P_ID_DOCUMENTO bigint,P_TIPO text,P_CANTIDAD bigint) AS $body$
DECLARE

    L_TIPO varchar(1);
    L_CANTIDAD decimal(10,2);

BEGIN
        
        SELECT TIPO INTO STRICT L_TIPO FROM INVENTARIO_MOVIMIENTO
        WHERE ID_MOVIMIENTO = P_ID_MOVIMIENTO
        AND ESTADO = '0';

        IF L_TIPO = P_TIPO THEN
            L_TIPO := L_TIPO;
        ELSE
                IF L_CANTIDAD = P_CANTIDAD THEN
                    L_CANTIDAD :=L_CANTIDAD;
                ELSE
                    DELETE FROM INVENTARIO_DETALLE
                    WHERE ID_MOVIMIENTO = P_ID_MOVIMIENTO
                    AND ESTADO = '0';
                END IF;
        END IF;

        UPDATE INVENTARIO_MOVIMIENTO SET ID_RECETA = P_ID_RECETA, ID_TIPOOPERACION = P_ID_TIPOOPERACION, ID_DOCUMENTO = P_ID_DOCUMENTO,TIPO = P_TIPO, FECHA = clock_timestamp(), CANTIDAD = P_CANTIDAD
        WHERE ID_MOVIMIENTO = P_ID_MOVIMIENTO
        AND ESTADO = '0';

    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_inventories_sp_update_movimiento (P_ID_MOVIMIENTO bigint, P_ID_RECETA bigint, P_ID_TIPOOPERACION text,P_ID_DOCUMENTO bigint,P_TIPO text,P_CANTIDAD bigint) FROM PUBLIC;
