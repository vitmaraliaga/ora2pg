-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_inventories,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_inventories_sp_inventories_is_service (P_ID_ALMACEN bigint, P_ID_ARTICULO bigint,P_ID_ANHO bigint, IN_CONTEO bigint,OUT_CODIGO OUT text,OUT_RESPUESTA OUT text) AS $body$
DECLARE

        CUR_ARTICULO REFCURSOR;
        LOC_ID_ARTICULO bigint;
        LOC_ID_PARENT bigint;
        LOC_ID_CLASE bigint;
        LOC_CODIGO varchar(20);
        LOC_OUT_CONTEO bigint;
        L_CANT bigint :=0;

BEGIN
          LOC_OUT_CONTEO := IN_CONTEO+1;
          OUT_RESPUESTA := 'S';
            /*IF LOC_OUT_CONTEO < 100 THEN
                OPEN CUR_ARTICULO FOR
                SELECT ID_ARTICULO, ID_PARENT, ID_CLASE, CODIGO
                FROM INVENTARIO_ARTICULO
                WHERE ID_ARTICULO = IN_ID_ARTICULO;

                FETCH CUR_ARTICULO INTO
                LOC_ID_ARTICULO, LOC_ID_PARENT, LOC_ID_CLASE, OUT_CODIGO;

                WHILE CUR_ARTICULO%FOUND LOOP
                    IF LOC_ID_PARENT IS NOT NULL THEN
                        pkg_inventories_sp_inventories_is_service(LOC_ID_PARENT,LOC_OUT_CONTEO,OUT_CODIGO, OUT_RESPUESTA);
                    END IF;
                  
                    FETCH CUR_ARTICULO INTO LOC_ID_ARTICULO, LOC_ID_PARENT, LOC_ID_CLASE, LOC_CODIGO;
                END LOOP;
                CLOSE CUR_ARTICULO;
            END IF;*/
            SELECT COUNT(1) INTO STRICT L_CANT
            FROM INVENTARIO_ALMACEN_ARTICULO
            WHERE ID_ALMACEN = P_ID_ALMACEN
            AND ID_ARTICULO = P_ID_ARTICULO;

            IF L_CANT > 0 THEN
                SELECT coalesce(ES_SERVICIO,'N') INTO STRICT OUT_RESPUESTA 
                FROM INVENTARIO_ALMACEN_ARTICULO
                WHERE ID_ALMACEN = P_ID_ALMACEN
                AND ID_ARTICULO = P_ID_ARTICULO
                AND ID_ANHO = P_ID_ANHO;
            END IF;
      --    
            --IF OUT_CODIGO IS NULL THEN 
                --OUT_CODIGO := '70';
            --END IF;
            --IF OUT_CODIGO = '70' THEN
                --OUT_RESPUESTA := 'S';
            --END IF;
      -- X
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_inventories_sp_inventories_is_service (P_ID_ALMACEN bigint, P_ID_ARTICULO bigint,P_ID_ANHO bigint, IN_CONTEO bigint,OUT_CODIGO OUT text,OUT_RESPUESTA OUT text) FROM PUBLIC;
