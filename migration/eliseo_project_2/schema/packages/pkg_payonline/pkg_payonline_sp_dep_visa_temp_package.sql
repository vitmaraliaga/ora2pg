-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_payonline,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_payonline_sp_dep_visa_temp (P_ESTADO text,P_ERROR OUT bigint,P_MSGERROR OUT text) AS $body$
DECLARE

        L_ID_PERSONA bigint;
        L_OPERACION varchar(20);
        L_ID_ENTIDAD bigint;
        L_ID_DEPTO varchar(10);
        L_IMPORTE decimal(10,2);
        L_FECHA timestamp(0);
        L_IP varchar(36) :='192.168.23.241';
        L_ID_DINAMICA bigint;
        L_TARJETA bigint;
        L_ID_ORIGEN bigint;
        L_ID bigint;
        L_ERROR bigint;
        L_MSGERROR varchar(200);

        DEPOSITOS CURSOR FOR
        SELECT 
                ID_ENTIDAD,ID_DEPTO,ID_PERSONA,ID_DINAMICA,TARJETA,OPERACION,FECHA,IMPORTE
        FROM CAJA_VISA_TEMP
        WHERE ESTADO = '0'
        ORDER BY OPERACION;

        
BEGIN
            -- GENERA ITEM NUMERO DE LOS DETALLES
            OPEN DEPOSITOS;
                FETCH DEPOSITOS INTO L_ID_ENTIDAD,L_ID_DEPTO,L_ID_PERSONA,L_ID_DINAMICA,L_TARJETA,L_OPERACION,L_FECHA,L_IMPORTE;
                WHILE DEPOSITOS%FOUND LOOP
                    CALL pkg_payonline_sp_deposito_alum_visa_manual(L_ID_PERSONA,L_OPERACION,L_ID_ENTIDAD,L_ID_DEPTO,L_IMPORTE ,L_FECHA,L_IP,L_ID_DINAMICA,L_TARJETA,L_ID_ORIGEN,L_ID,L_ERROR,L_MSGERROR);
                FETCH DEPOSITOS INTO L_ID_ENTIDAD,L_ID_DEPTO,L_ID_PERSONA,L_ID_DINAMICA,L_TARJETA,L_OPERACION,L_FECHA,L_IMPORTE;
                END LOOP;
            CLOSE DEPOSITOS;
        UPDATE CAJA_VISA_TEMP SET ESTADO = '1' WHERE ESTADO = '0';
        P_ERROR:=L_ERROR;
        P_MSGERROR:=L_MSGERROR;

    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_payonline_sp_dep_visa_temp (P_ESTADO text,P_ERROR OUT bigint,P_MSGERROR OUT text) FROM PUBLIC;
