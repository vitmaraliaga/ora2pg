-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_informes,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_informes_sp_informe_zona (P_ID_INFORME bigint, P_CURSOR_DATOS OUT REFCURSOR) AS $body$
DECLARE

        L_ID_TIPOPAIS bigint;
        type array_t is table of bigint;
        L_PAISESDSA array_t;
        L_TIPO_VIATICOS bigint; -- 1=NACIONAL;-- 2=DSA;-- 3=INTERNACIONAL
        L_TIPO_DESCRIPCION varchar(150) := '';

        L_ENABLE_LEGAL bigint;
        L_ENABLE_NO_LEGAL bigint;
        L_ENABLE_DJ bigint;

        L_VERIFICADO bigint;
        L_AUTORIZADO bigint;

BEGIN 
            L_PAISESDSA:= array_t(
            32, -- BRASIL
            67, -- Ecuador
            241, -- Ecuador
            175, -- Paraguay
            46, -- Chile
            27, -- Bolivia
            11 -- Argentina
            );

            SELECT coalesce(ID_TIPOPAIS,0),
            CASE WHEN ESTADO_ACTUAL='V' THEN  1 WHEN ESTADO_ACTUAL='A' THEN  1  ELSE 0 END ,
            CASE WHEN ESTADO_ACTUAL='A' THEN  1  ELSE 0 END
            INTO STRICT L_ID_TIPOPAIS, L_VERIFICADO, L_AUTORIZADO
            FROM INFORME WHERE ID_INFORME=P_ID_INFORME;

            IF L_ID_TIPOPAIS=0 THEN   -- No tiene Pais.
                L_TIPO_VIATICOS := 0;
                L_TIPO_DESCRIPCION := 'Vi치ticos'; -- No tiene Pais.
                L_ENABLE_LEGAL := 0;
                L_ENABLE_NO_LEGAL := 0;
                L_ENABLE_DJ := 0;
            ELSIF L_ID_TIPOPAIS=176 THEN  -- PERU
                L_TIPO_VIATICOS := 1;
                L_TIPO_DESCRIPCION := 'Vi치ticos Nacionales';
                L_ENABLE_LEGAL := 1;
                L_ENABLE_NO_LEGAL := 0;
                L_ENABLE_DJ := 1;
            ELSIF L_ID_TIPOPAIS MEMBER OF L_PAISESDSA THEN
                L_TIPO_VIATICOS := 2;
                L_TIPO_DESCRIPCION := 'Vi치ticos DSA';
                L_ENABLE_LEGAL := 1;
                L_ENABLE_NO_LEGAL := 1;
                L_ENABLE_DJ := 1;
            ELSE
                L_TIPO_VIATICOS := 3;
                L_TIPO_DESCRIPCION := 'Vi치ticos Internacionales';
                L_ENABLE_LEGAL := 1;
                L_ENABLE_NO_LEGAL := 1;
                L_ENABLE_DJ := 1;
            END IF;

            OPEN P_CURSOR_DATOS FOR
            SELECT 
                L_TIPO_VIATICOS AS TIPO_VIATICOS,
                L_TIPO_DESCRIPCION AS TIPO_DESCRIPCION,
                L_ENABLE_LEGAL AS ENABLE_LEGAL,
                L_ENABLE_NO_LEGAL AS ENABLE_NO_LEGAL,
                L_ENABLE_DJ AS ENABLE_DJ,
                L_VERIFICADO AS VERIFICADO,
                L_AUTORIZADO AS AUTORIZADO
;

            
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_informes_sp_informe_zona (P_ID_INFORME bigint, P_CURSOR_DATOS OUT REFCURSOR) FROM PUBLIC;
