-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_setup,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_setup_sp_assign_themes (P_ID_PERSONA bigint,P_ID_ENTIDAD bigint,P_ID_DEPTO text) AS $body$
DECLARE

        L_MSN varchar(200);

BEGIN
        
            
        
            INSERT INTO LAMB_ENTIDAD_DEPTO_CONFIG(ID,ID_ENTIDAD,ID_DEPTO,ID_MODULO,ID_TEMA,FECHA)
            SELECT 
            	P_ID_PERSONA,P_ID_ENTIDAD,P_ID_DEPTO,ID_MODULO,
                    case when ID_MODULO = 129 then 1 else 4 end 
                    AS ID_TEMA,clock_timestamp()
            FROM (
            	SELECT ID_MODULO FROM LAMB_MODULO
            	WHERE ID_MODULO IN (SELECT ID_MODULO FROM LAMB_ROL_MODULO WHERE ID_ROL IN (SELECT ID_ROL FROM LAMB_USUARIO_ROL WHERE ID_PERSONA = P_ID_PERSONA) AND ID_MODULO IN ( SELECT ID_MODULO FROM LAMB_MODULO WHERE NIVEL = '1') ) 
            ) alias5 
           	WHERE ID_MODULO NOT IN (SELECT ID_MODULO FROM LAMB_ENTIDAD_DEPTO_CONFIG WHERE ID = P_ID_PERSONA AND ID_ENTIDAD = P_ID_ENTIDAD AND ID_DEPTO = P_ID_DEPTO)
           	AND ID_MODULO <> 417; -- SHELL SCHOOL
        EXCEPTION
            WHEN OTHERS THEN
            L_MSN := 'ERROR AL REGISTRAR EL TEMA'||SQLSTATE||' -ERROR- '||SQLERRM;
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_setup_sp_assign_themes (P_ID_PERSONA bigint,P_ID_ENTIDAD bigint,P_ID_DEPTO text) FROM PUBLIC;
