-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_bi,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_bi_spc_bi_asientos (OUT CURSOR REFCURSOR ) AS $body$
BEGIN
        OPEN CURSOR FOR
        SELECT 
                A.ID_ENTIDAD,A.ID_ANHO,A.ID_MES,
                SUBSTR(B.ID_DEPTO,1,1) AS LEVEL_1,
                SUBSTR(B.ID_DEPTO,1,2) AS LEVEL_2,
                SUBSTR(B.ID_DEPTO,1,4) AS LEVEL_4,
                SUBSTR(B.ID_DEPTO,1,6) AS LEVEL_6,
                B.ID_DEPTO,
                SUBSTR(B.ID_CUENTAAASI,1,3) ID_CUENTAAASI,
                ABS(SUM(B.COS_VALOR)) IMPORTE,
                FC_CUENTA(SUBSTR(B.ID_CUENTAAASI,1,3)) NAME_CTA,
                (CASE  
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3) BETWEEN 111 AND 116 THEN 'ACTIVO CORRIENTE' 
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3) BETWEEN 121 AND 124 THEN 'ACTIVO NO CORRIENTE' 
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3) BETWEEN 213 AND 216 THEN 'PASIVO CORRIENTE' 
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3) = 221 THEN 'PASIVO NO CORRIENTE'
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3) IN (231,232) THEN 'PATRIMONIO NETO'
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3) BETWEEN 313 AND 318 THEN 'INGRESOS'
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3) BETWEEN 411 AND 419 THEN 'GASTOS'
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3)= 319 THEN 'Ingresos Inter-Departamentos'
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3)= 419 THEN 'GASTOS Inter-Departamentos'
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3)= 321 THEN 'Ingresos No Recurrientes'
                WHEN SUBSTR(B.ID_CUENTAAASI,1,3)= 421 THEN 'GASTOS No Recurrientes'
                END) NAME_GRUPO
        FROM CONTA_DIARIO A,CONTA_DIARIO_DETALLE B
        WHERE A.ID_ENTIDAD = B.ID_ENTIDAD
        AND A.ID_DIARIO = B.ID_DIARIO
        AND A.ID_ENTIDAD = 7124
        GROUP BY A.ID_ENTIDAD,A.ID_ANHO,A.ID_MES,SUBSTR(B.ID_DEPTO,1,1),SUBSTR(B.ID_CUENTAAASI,1,3),SUBSTR(B.ID_DEPTO,1,2),SUBSTR(B.ID_DEPTO,1,4),SUBSTR(B.ID_DEPTO,1,6),B.ID_DEPTO,SUBSTR(B.ID_CUENTAAASI,1,3) 
        ORDER BY A.ID_ENTIDAD,A.ID_ANHO,A.ID_MES,ID_DEPTO,ID_CUENTAAASI;
    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_bi_spc_bi_asientos (OUT CURSOR REFCURSOR ) FROM PUBLIC;
