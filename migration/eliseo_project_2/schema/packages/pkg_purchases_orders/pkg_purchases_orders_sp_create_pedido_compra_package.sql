-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = eliseo,pkg_purchases_orders,public;




CREATE OR REPLACE PROCEDURE eliseo.pkg_purchases_orders_sp_create_pedido_compra ( P_ID_PEDIDO integer, P_FECHA timestamp(0), P_ID_PCOMPRA OUT bigint, P_ERROR OUT bigint, P_MSGERROR OUT text ) AS $body$
DECLARE


        L_ID_PCOMPRA bigint;

BEGIN
            INSERT INTO PEDIDO_COMPRA(
                ID_PEDIDO,
                FECHA,
                ESTADO,
                ID_MONEDA
            )VALUES (
                P_ID_PEDIDO,
                P_FECHA,
                0,
                7
            ) RETURNING ID_PCOMPRA INTO L_ID_PCOMPRA;
            P_ERROR :=0;
            P_MSGERROR := 'OK';
            P_ID_PCOMPRA := L_ID_PCOMPRA;

            CALL pkg_purchases_sp_pcompra_detalle(L_ID_PCOMPRA,P_ID_PEDIDO);
    
        EXCEPTION
            WHEN OTHERS THEN
            P_MSGERROR := 'ERROR AL REGISTRAR PEDIDO COMPRA'||SQLSTATE||' -ERROR- '||SQLERRM;
            P_ERROR :=1;

    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE eliseo.pkg_purchases_orders_sp_create_pedido_compra ( P_ID_PEDIDO integer, P_FECHA timestamp(0), P_ID_PCOMPRA OUT bigint, P_ERROR OUT bigint, P_MSGERROR OUT text ) FROM PUBLIC;
