-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION eliseo.fc_impuesto (P_ID_ENTIDAD bigint,P_FECHA timestamp(0)) RETURNS bigint AS $body$
DECLARE


	L_IMPUESTO decimal(10,2);
	L_DATOS CURSOR FOR
	SELECT CEI.VALOR FROM ELISEO.CONTA_EMPRESA_IMPUESTO CEI
	INNER JOIN ELISEO.CONTA_TIPO_IMPUESTO CTI ON CEI.ID_TIPOIMPUESTO = CTI.ID_TIPOIMPUESTO
	INNER JOIN(SELECT ID_EMPRESA FROM  ELISEO.CONTA_ENTIDAD WHERE ID_ENTIDAD = P_ID_ENTIDAD) CE ON CEI.ID_EMPRESA = CE.ID_EMPRESA
	INNER JOIN ELISEO.CONTA_EMPRESA CEM ON CE.ID_EMPRESA = CEM.ID_EMPRESA AND CTI.ID_TIPOPAIS = CEM.ID_TIPOPAIS
	AND (P_FECHA BETWEEN CEI.FECHA_INI AND COALESCE(CEI.FECHA_FIN,CURRENT_DATE))
	AND CTI.ID_TIPOIMPUESTO =1   LIMIT 1;


BEGIN

	OPEN L_DATOS;
	FETCH L_DATOS INTO L_IMPUESTO;
	IF NOT L_DATOS%FOUND THEN
		L_IMPUESTO := 0;
	END IF;
	CLOSE L_DATOS;

	RETURN(L_IMPUESTO);

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION eliseo.fc_impuesto (P_ID_ENTIDAD bigint,P_FECHA timestamp(0)) FROM PUBLIC;

