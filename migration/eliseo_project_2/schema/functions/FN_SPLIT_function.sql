-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION eliseo.fn_split ( iv_Texto text ) RETURNS SETOF FN_SPLIT_PKG.TT_V_TABLA_TYPE AS $body$
DECLARE

  v_Texto      varchar(4000) := iv_Texto;
  v_sSeparador char(1)        := ',';
  v_sItem      varchar(255);
  v_iPos       bigint;
  v_temp       smallint := 0;
  v_temp_1 REFCURSOR;
  v_temp_2 TT_V_TABLA%ROWTYPE;

BEGIN
  v_Texto     := RTRIM(LTRIM(v_Texto));
  v_iPos      := position(v_sSeparador in v_Texto);
  WHILE v_iPos > 0
  LOOP
    DECLARE
      v_temp smallint := 0;
    BEGIN
      v_sItem := NULLIF(RTRIM(LTRIM(SUBSTR(v_Texto, 1, v_iPos - 1))), ' ');
      v_Texto := SUBSTR(v_Texto, v_iPos || LENGTH(v_sSeparador), LENGTH(v_Texto));
      v_iPos  := position(v_sSeparador in v_Texto);
      BEGIN
        SELECT 1
        INTO STRICT v_temp

        WHERE NOT coalesce(v_sItem::text, '') = ''
        AND NOT EXISTS ( SELECT ITEM FROM tt_v_Tabla WHERE ITEM = v_sItem 
           LIMIT 1);
      EXCEPTION
      WHEN OTHERS THEN
        NULL;
      END;
      IF v_temp = 1 THEN
        INSERT INTO tt_v_Tabla VALUES ( v_sItem
          );
      END IF;
    END;
  END LOOP;
  BEGIN
    SELECT 1
    INTO STRICT v_temp

    WHERE NOT coalesce(NULLIF(v_Texto, ' ')::text, '') = ''
    AND NOT EXISTS ( SELECT ITEM FROM tt_v_Tabla WHERE ITEM = v_Texto 
       LIMIT 1);
  EXCEPTION
  WHEN OTHERS THEN
    NULL;
  END;
  IF v_temp = 1 THEN
    INSERT INTO tt_v_Tabla VALUES ( v_Texto
      );
  END IF;
  OPEN v_temp_1 FOR SELECT * FROM tt_v_Tabla;
  LOOP
    FETCH v_temp_1 INTO v_temp_2;
    EXIT WHEN NOT FOUND;/* apply on v_temp_1 */
    RETURN NEXT  v_temp_2;
  END LOOP;
EXCEPTION
WHEN OTHERS THEN
  CALL utils.handleerror(SQLSTATE,SQLERRM);
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION eliseo.fn_split ( iv_Texto text ) FROM PUBLIC;

