-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_proceso_residencia (id_pregrado_proceso, id_entidad, id_depto, id_anho, id_depto_padre, departamento, seccion, costo_redidencia, costo_alimentacion, costo_lavavderia, costo_cuota_i, costo_cuota_ii, total_alumno_i, total_alumno_ii, numdias_i, numdias_ii, id_auxiliar, id_eap_depto_area, total_cuota_i, total_cuota_ii, total_redidencia_i, total_redidencia_ii, total_alimentacion_i, total_alimentacion_ii, total_lavavderia_i, total_lavavderia_ii) AS SELECT
A.ID_PREGRADO_PROCESO,
A.ID_ENTIDAD,
A.ID_DEPTO,
A.ID_ANHO,
A.ID_DEPTO_PADRE,
B.NOMBRE AS DEPARTAMENTO,
C.NOMBRE AS SECCION,
A.IMP_MAT AS COSTO_REDIDENCIA,
A.CREDITO_1 AS COSTO_ALIMENTACION,
A.CREDITO_2_5 AS COSTO_LAVAVDERIA,
A.TOTAL_ENSE_I AS COSTO_CUOTA_I,
A.TOTAL_ENSE_II AS COSTO_CUOTA_II,
A.TOTAL_ALUMNO_I,
A.TOTAL_ALUMNO_II,
A.TOTAL_HORAS_I AS NUMDIAS_I, 
A.TOTAL_HORAS_II AS NUMDIAS_II,
A.ID_AUXILIAR, 
A.ID_EAP_DEPTO_AREA,
COALESCE(SUM(CASE WHEN DE.TIPO='M' THEN DE.TOTAL_I ELSE 0 END),0) AS TOTAL_CUOTA_I,
COALESCE(SUM(CASE WHEN DE.TIPO='M' THEN DE.TOTAL_II ELSE 0 END),0) AS TOTAL_CUOTA_II,
COALESCE(SUM(CASE WHEN DE.TIPO='RE' THEN DE.TOTAL_I ELSE 0 END),0) AS TOTAL_REDIDENCIA_I,
COALESCE(SUM(CASE WHEN DE.TIPO='RE' THEN DE.TOTAL_II ELSE 0 END),0) AS TOTAL_REDIDENCIA_II,
COALESCE(SUM(CASE WHEN DE.TIPO='SA' THEN DE.TOTAL_I ELSE 0 END),0) AS TOTAL_ALIMENTACION_I,
COALESCE(SUM(CASE WHEN DE.TIPO='SA' THEN DE.TOTAL_II ELSE 0 END),0) AS TOTAL_ALIMENTACION_II,
COALESCE(SUM(CASE WHEN DE.TIPO='SL' THEN DE.TOTAL_I ELSE 0 END),0) AS TOTAL_LAVAVDERIA_I,
COALESCE(SUM(CASE WHEN DE.TIPO='SL' THEN DE.TOTAL_II ELSE 0 END),0) AS TOTAL_LAVAVDERIA_II
FROM PSTO_PREGRADO_PROCESO A,PSTO_PREGRADO_PROCESO_CONCEPTO DE, CONTA_ENTIDAD_DEPTO B,VW_DPTO_EAP C
WHERE A.ID_PREGRADO_PROCESO=DE.ID_PREGRADO_PROCESO
AND A.ID_ENTIDAD=B.ID_ENTIDAD
AND A.ID_DEPTO=B.ID_DEPTO
AND A.ID_EAP_DEPTO_AREA=C.ID_EAP_DEPTO_AREA
--AND A.ID_ENTIDAD=7124
--AND A.ID_DEPTO_PADRE='1'
--AND A.ID_ANHO=2018
--AND A.ID_AUXILIAR=2
GROUP BY 
A.ID_PREGRADO_PROCESO,
A.ID_ENTIDAD,
A.ID_DEPTO,
A.ID_ANHO,
A.ID_DEPTO_PADRE,
B.NOMBRE,
C.NOMBRE,
A.IMP_MAT,
A.CREDITO_1,
A.CREDITO_2_5,
A.TOTAL_ENSE_I,
A.TOTAL_ENSE_II,
A.TOTAL_ALUMNO_I,
A.TOTAL_ALUMNO_II,
A.TOTAL_HORAS_I , 
A.TOTAL_HORAS_II,
A.ID_AUXILIAR, 
A.ID_EAP_DEPTO_AREA;

