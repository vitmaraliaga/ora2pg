-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_saldo_alumno_mes_dia (id_entidad, id_depto, id_anho, id_mes, dia, id_cliente, credito, debito, saldo) AS SELECT ID_ENTIDAD,
            ID_DEPTO,
            ID_ANHO,
            ID_MES,
            DIA,
            ID_CLIENTE,
            SUM(CREDITO) AS CREDITO,
            SUM(DEBITO) AS DEBITO,
            SUM(TOTAL) AS SALDO
       FROM (SELECT ID_ENTIDAD,
                    ID_DEPTO,
                    ID_ANHO,
                    ID_MES,
                    (TO_CHAR(FECHA,'DD'))::numeric  AS DIA,
                    ID_CLIENTE,
                    (CASE WHEN TOTAL < 0 THEN TOTAL ELSE 0 END) AS CREDITO,
                    (CASE WHEN TOTAL > 0 THEN TOTAL ELSE 0 END) AS DEBITO,
                    TOTAL
               FROM VW_SALES_MOV
              WHERE ID_TIPOVENTA IN (1,
                                     2,
                                     3,
                                     4)
                                       ) alias8 
   GROUP BY ID_ENTIDAD,
            ID_DEPTO,
            ID_ANHO,
            ID_MES,DIA,
            ID_CLIENTE;

