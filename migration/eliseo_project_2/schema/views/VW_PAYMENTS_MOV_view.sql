-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_payments_mov (id_pago, id_entidad, id_depto, id_anho, id_mes, id_user, id_voucher, id_ctabancaria, id_chequera, id_tipoorigen, id_origen, numero, fecha, id_compra, id_proveedor, importe, importe_me, detalle) AS SELECT
A.ID_PAGO,A.ID_ENTIDAD,A.ID_DEPTO,A.ID_ANHO,A.ID_MES,A.ID_USER,A.ID_VOUCHER,
(CASE WHEN coalesce(A.ID_VALE::text, '') = '' THEN A.ID_CTABANCARIA ELSE NULL END) AS ID_CTABANCARIA,
A.ID_CHEQUERA,
B.ID_TIPOORIGEN,B.ID_PCOMPRA AS ID_ORIGEN,
A.NUMERO,A.FECHA,
B.ID_COMPRA,B.ID_PROVEEDOR,B.IMPORTE,B.IMPORTE_ME,B.DETALLE
FROM CAJA_PAGO A JOIN CAJA_PAGO_COMPRA B
ON A.ID_PAGO = B.ID_PAGO
WHERE A.ESTADO = '1'

UNION ALL

SELECT 
A.ID_PAGO,A.ID_ENTIDAD,A.ID_DEPTO,A.ID_ANHO,A.ID_MES,A.ID_USER,A.ID_VOUCHER,
(CASE WHEN coalesce(A.ID_VALE::text, '') = '' THEN A.ID_CTABANCARIA ELSE NULL END) AS ID_CTABANCARIA,
--A.ID_CTABANCARIA,
A.ID_CHEQUERA,
B.ID_TIPOORIGEN,B.ID_PGASTO AS ID_ORIGEN,
A.NUMERO,A.FECHA,
0 ID_COMPRA,B.ID_PERSONA,B.IMPORTE,B.IMPORTE_ME,B.DETALLE
FROM CAJA_PAGO A JOIN CAJA_PAGO_GASTO B
ON A.ID_PAGO = B.ID_PAGO
WHERE A.ESTADO = '1'

UNION ALL

SELECT 
A.ID_PAGO,A.ID_ENTIDAD,A.ID_DEPTO,A.ID_ANHO,A.ID_MES,A.ID_USER,A.ID_VOUCHER,
(CASE WHEN coalesce(A.ID_VALE::text, '') = '' THEN A.ID_CTABANCARIA ELSE NULL END) AS ID_CTABANCARIA,
--A.ID_CTABANCARIA,
A.ID_CHEQUERA,
B.ID_TIPOORIGEN,B.ID_PVENTA AS ID_ORIGEN,
A.NUMERO,A.FECHA,
B.ID_VENTA,B.ID_CLIENTE,B.IMPORTE,B.IMPORTE_ME,B.DETALLE
FROM CAJA_PAGO A JOIN CAJA_PAGO_VENTA B
ON A.ID_PAGO = B.ID_PAGO
WHERE A.ESTADO = '1';

