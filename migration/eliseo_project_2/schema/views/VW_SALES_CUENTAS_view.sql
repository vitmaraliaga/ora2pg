-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_sales_cuentas (id_venta, id_entidad, id_depto, id_anho, id_cliente, id_mes, id_comprobante, cuenta, cuenta_cte, tipo, fecha, lote, numero, total, alumno, codigo, debito, credito) AS SELECT A.ID_VENTA,A.ID_ENTIDAD,A.ID_DEPTO,A.ID_ANHO,A.ID_CLIENTE,A.ID_MES,A.ID_COMPROBANTE,X.CUENTA,X.CUENTA_CTE,'VENTAS' AS TIPO,
A.FECHA,C.LOTE,A.SERIE||'-'||A.NUMERO AS NUMERO,A.TOTAL,D.NOMBRE||' '||D.PATERNO||' '||D.MATERNO AS ALUMNO,E.CODIGO,
(CASE WHEN(X.IMPORTE) > 0 THEN (X.IMPORTE) ELSE 0 END) AS DEBITO,
(CASE WHEN(X.IMPORTE) < 0 THEN (X.IMPORTE) ELSE 0 END) AS CREDITO
FROM VENTA A JOIN VENTA_DETALLE B
ON A.ID_VENTA = B.ID_VENTA
JOIN CONTA_VOUCHER C ON A.ID_VOUCHER = C.ID_VOUCHER
JOIN MOISES.PERSONA D ON A.ID_CLIENTE = D.ID_PERSONA
JOIN MOISES.PERSONA_NATURAL_ALUMNO E ON A.ID_CLIENTE = E.ID_PERSONA
JOIN CONTA_ASIENTO X ON A.ID_VOUCHER = X.VOUCHER
AND B.ID_TIPOORIGEN = X.ID_TIPOORIGEN
AND B.ID_VDETALLE = X.ID_ORIGEN
WHERE A.ID_TIPOVENTA <> 5

UNION ALL

SELECT
DISTINCT A.ID_TRANSFERENCIA,A.ID_ENTIDAD,A.ID_DEPTO,A.ID_ANHO,A.ID_CLIENTE,A.ID_MES,'99' AS ID_COMPROBANTE,X.CUENTA,X.CUENTA_CTE,'TRANSFERENCIAS' AS TIPO,
A.FECHA,C.LOTE,A.SERIE||'-'||A.NUMERO AS NUMERO,A.IMPORTE AS TOTAL ,D.NOMBRE||' '||D.PATERNO||' '||D.MATERNO AS ALUMNO,E.CODIGO,
(CASE WHEN(X.IMPORTE) > 0 THEN (X.IMPORTE) ELSE 0 END) AS DEBITO,
(CASE WHEN(X.IMPORTE) < 0 THEN (X.IMPORTE) ELSE 0 END) AS CREDITO
FROM VENTA_TRANSFERENCIA A JOIN VENTA_TRANSFERENCIA_DETALLE B
ON A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
JOIN CONTA_VOUCHER C ON A.ID_VOUCHER = C.ID_VOUCHER
JOIN MOISES.PERSONA D ON A.ID_CLIENTE = D.ID_PERSONA
JOIN MOISES.PERSONA_NATURAL_ALUMNO E ON A.ID_CLIENTE = E.ID_PERSONA
JOIN CONTA_ASIENTO X ON A.ID_VOUCHER = X.VOUCHER
AND A.ID_TIPOORIGEN = X.ID_TIPOORIGEN
AND B.ID_TRANSFERENCIA = X.ID_ORIGEN 

UNION ALL

SELECT DISTINCT A.ID_DEPOSITO,
A.ID_ENTIDAD,A.ID_DEPTO,A.ID_ANHO,A.ID_CLIENTE,A.ID_MES,'00' AS ID_COMPROBANTE,X.CUENTA,X.CUENTA_CTE,'DEPOSITOS' AS TIPO,
A.FECHA,C.LOTE,A.SERIE||'-'||A.NUMERO AS NUMERO,A.IMPORTE,D.NOMBRE||' '||D.PATERNO||' '||D.MATERNO AS ALUMNO,E.CODIGO,
(CASE WHEN(X.IMPORTE) > 0 THEN (X.IMPORTE) ELSE 0 END) AS DEBITO,
(CASE WHEN(X.IMPORTE) < 0 THEN (X.IMPORTE) ELSE 0 END) AS CREDITO
FROM CAJA_DEPOSITO A JOIN CAJA_DEPOSITO_DETALLE B ON A.ID_DEPOSITO = B.ID_DEPOSITO
JOIN CONTA_VOUCHER C ON A.ID_VOUCHER = C.ID_VOUCHER
JOIN MOISES.PERSONA D ON A.ID_CLIENTE = D.ID_PERSONA
JOIN MOISES.PERSONA_NATURAL_ALUMNO E ON A.ID_CLIENTE = E.ID_PERSONA
JOIN CONTA_ASIENTO X ON A.ID_VOUCHER = X.VOUCHER
AND A.ID_TIPOORIGEN = X.ID_TIPOORIGEN
AND A.ID_DEPOSITO = X.ID_ORIGEN
WHERE A.ID_TIPODEPOSITO <> 5 

UNION ALL

SELECT DISTINCT A.ID_PAGO,
A.ID_ENTIDAD,A.ID_DEPTO,A.ID_ANHO,B.ID_CLIENTE,A.ID_MES,'00' AS ID_COMPROBANTE,X.CUENTA,X.CUENTA_CTE,'TLC' AS TIPO,
A.FECHA,C.LOTE,A.NUMERO AS NUMERO,A.IMPORTE,D.NOMBRE||' '||D.PATERNO||' '||D.MATERNO AS ALUMNO,E.CODIGO,
(CASE WHEN(X.IMPORTE) > 0 THEN (X.IMPORTE) ELSE 0 END) AS DEBITO,
(CASE WHEN(X.IMPORTE) < 0 THEN (X.IMPORTE) ELSE 0 END) AS CREDITO
FROM CAJA_PAGO A JOIN CAJA_PAGO_VENTA B ON A.ID_PAGO = B.ID_PAGO
JOIN CONTA_VOUCHER C ON A.ID_VOUCHER = C.ID_VOUCHER
JOIN MOISES.PERSONA D ON B.ID_CLIENTE = D.ID_PERSONA
JOIN MOISES.PERSONA_NATURAL_ALUMNO E ON B.ID_CLIENTE = E.ID_PERSONA
JOIN CONTA_ASIENTO X ON A.ID_VOUCHER = X.VOUCHER
AND B.ID_TIPOORIGEN = X.ID_TIPOORIGEN
AND B.ID_PVENTA = X.ID_ORIGEN

UNION ALL

SELECT 
ID_SALDO,ID_ENTIDAD,ID_DEPTO,ID_ANHO,A.ID_CLIENTE,A.ID_MES,'' AS ID_COMPROBANTE,'1132006' AS CUENTA ,'' AS CUENTA_CTE,'SALDO A FAVOR' AS TIPO,FECHA,'' AS LOTE,SERIE||'-'||NUMERO AS NUMERO,TOTAL,
B.NOMBRE||' '||B.PATERNO||' '||B.MATERNO AS ALUMNO,C.CODIGO,0 AS DEBITO,A.TOTAL AS CREDITO
FROM VENTA_SALDO A JOIN MOISES.PERSONA B ON A.ID_CLIENTE = B.ID_PERSONA
JOIN MOISES.PERSONA_NATURAL_ALUMNO C ON B.ID_PERSONA = C.ID_PERSONA
WHERE A.ID_ENTIDAD = 7124 
AND A.TOTAL < 0;

