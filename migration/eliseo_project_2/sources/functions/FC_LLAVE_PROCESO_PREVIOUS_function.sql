-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

FUNCTION        FC_LLAVE_PROCESO_PREVIOUS(P_ID_REGISTRO NUMBER) RETURN VARCHAR2 IS
    L_LLAVE VARCHAR2(20);
BEGIN
    SELECT 
            FC_GET_LLAVE_COMPONENTE(A.ID_REGISTRO,A.ID_PASO,1) INTO L_LLAVE
    FROM PROCESS_PASO_RUN A, PROCESS_PASO B
    WHERE A.ID_PASO = B.ID_PASO
    AND A.ID_REGISTRO = P_ID_REGISTRO
    AND B.ID_TIPOPASO = 2
    AND A.ID_DETALLE = (SELECT MAX(ID_DETALLE) FROM PROCESS_PASO_RUN WHERE ID_REGISTRO = P_ID_REGISTRO AND ESTADO = '1');
    
    RETURN L_LLAVE;
END FC_LLAVE_PROCESO_PREVIOUS;

