-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

PROCEDURE        spc_user_session_valida_app (
    p_token       varchar2,
    cursor       OUT SYS_REFCURSOR
)
IS
    l_id_user varchar2(50) :='0';
    l_cant INT;
BEGIN

    update USERS_SESSION_ACADEMICO set LAST_UPDATE = current_timestamp where token = p_token and status = '1';
    
    select count(PER_ID) into l_cant
    from USERS_SESSION_ACADEMICO where token = p_token and status = '1';
    
    IF l_cant > 0 THEN
        select PER_ID into l_id_user
        from USERS_SESSION_ACADEMICO where token = p_token and status = '1';
    END IF;
        
    OPEN cursor FOR 
    select decode(l_id_user,'0','NO','SI') as active, l_id_user as id_user from dual;
END;

