-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

PROCEDURE        IU_CONTA_CTA_EMPRESARIAL_C AS
	S_EXIST_CTA     	INT := 0;
	S_EXIST_CTA_PARENT  INT := 0;
    BEGIN

	   FOR ITEM IN (SELECT cced.ID_CUENTAEMPRESARIAL, cced.ID_PARENT, cced.NOMBRE FROM conta_cta_empresarial_d7421 cced ORDER BY cced.ID_CUENTAEMPRESARIAL)
		LOOP

		  	SELECT count(ID_CUENTAEMPRESARIAL) INTO S_EXIST_CTA FROM CONTA_CTA_EMPRESARIAL cce
		  	WHERE cce.ID_CUENTAEMPRESARIAL = ITEM.ID_CUENTAEMPRESARIAL; 
			  IF S_EXIST_CTA >= 1 THEN
                IF ITEM.ID_PARENT IS NULL THEN
                    UPDATE CONTA_CTA_EMPRESARIAL  SET ID_PARENT =ITEM.ID_PARENT, NOMBRE = ITEM.NOMBRE
                    WHERE ID_CUENTAEMPRESARIAL=ITEM.ID_CUENTAEMPRESARIAL;
                else
                    SELECT count(ID_CUENTAEMPRESARIAL) INTO S_EXIST_CTA_PARENT FROM CONTA_CTA_EMPRESARIAL cce
                    WHERE cce.ID_CUENTAEMPRESARIAL = ITEM.ID_PARENT;
                    IF S_EXIST_CTA_PARENT >= 1 THEN
                        UPDATE CONTA_CTA_EMPRESARIAL  SET ID_PARENT =ITEM.ID_PARENT, NOMBRE = ITEM.NOMBRE
                        WHERE ID_CUENTAEMPRESARIAL=ITEM.ID_CUENTAEMPRESARIAL;
                    END IF;
                END IF;
			  ELSE
			  	SELECT count(ID_CUENTAEMPRESARIAL) INTO S_EXIST_CTA_PARENT FROM CONTA_CTA_EMPRESARIAL cce
		  		WHERE cce.ID_CUENTAEMPRESARIAL = ITEM.ID_PARENT;
		  		IF S_EXIST_CTA_PARENT >= 1 THEN
				  	INSERT INTO CONTA_CTA_EMPRESARIAL (ID_CUENTAEMPRESARIAL, ID_PARENT,NOMBRE)
		            VALUES (ITEM.ID_CUENTAEMPRESARIAL, ITEM.ID_PARENT, ITEM.NOMBRE); 
	            END IF;
	          END IF;
		END LOOP;

END;

