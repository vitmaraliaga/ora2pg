-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

PROCEDURE        IUDP_PERSONA_CUENTA_BANCARIA (P_ID_PERSONA INT, P_ID_BANCO VARCHAR2,  P_ID_TIPOCTABANCO INT, P_CUENTA varchar2, P_ACTIVO INT) AS
	l_count int;
	l_count1 int;
	R_ID_PBANCARIA int;
	R1_ID_PBANCARIA int;
BEGIN
	l_count :=0;
	l_count1 :=0;
	SELECT COUNT(*) INTO l_count 
	FROM moises.PERSONA_CUENTA_BANCARIA WHERE ID_TIPOCTABANCO = P_ID_TIPOCTABANCO AND ID_PERSONA = P_ID_PERSONA AND ACTIVO = 1;
	IF l_count > 0 THEN
   		FOR LIST_PCUENTAB IN (SELECT * FROM moises.PERSONA_CUENTA_BANCARIA WHERE ID_TIPOCTABANCO = P_ID_TIPOCTABANCO AND ID_PERSONA = P_ID_PERSONA AND ACTIVO = 1)
			LOOP
				UPDATE moises.PERSONA_CUENTA_BANCARIA
				SET ACTIVO = 0, FEC_FIN = SYSDATE
				WHERE ID_PBANCARIA = LIST_PCUENTAB.ID_PBANCARIA;
			END LOOP;
	END IF;
		--SELECT COUNT(*) INTO l_count1 
		--FROM moises.PERSONA_CUENTA_BANCARIA WHERE ID_TIPOCTABANCO = P_ID_TIPOCTABANCO AND ID_BANCO = P_ID_BANCO AND CUENTA = P_CUENTA AND ID_PERSONA = P_ID_PERSONA AND FEC_FIN IS NULL;
		--IF l_count1 = 0 THEN
			--INSERT INTO moises.PERSONA_CUENTA_BANCARIA
			--(ID_PERSONA, ID_BANCO, ID_TIPOCTABANCO, CUENTA, FEC_INICIO, ACTIVO) 
			--VALUES (P_ID_PERSONA, P_ID_BANCO, P_ID_TIPOCTABANCO, P_CUENTA, SYSDATE, 1);
		--END IF;
 -- ELSE
			INSERT INTO moises.PERSONA_CUENTA_BANCARIA
			(ID_PERSONA, ID_BANCO, ID_TIPOCTABANCO, CUENTA, FEC_INICIO, ACTIVO)
			VALUES
			(P_ID_PERSONA, P_ID_BANCO, P_ID_TIPOCTABANCO, P_CUENTA, SYSDATE, 1);
  --END IF;
END;

