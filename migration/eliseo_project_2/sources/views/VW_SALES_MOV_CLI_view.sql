-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_sales_mov_cli (id_entidad, id_depto, id_anho, id_mes, id_venta, id_cliente, id_sucursal, id_comprobante, id_moneda, serie, numero, fecha, glosa, total, total_me, id_tipotransaccion, id_tipoventa, tipo, mov, voucher, lote) AS SELECT 	  A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          A.ID_VENTA,
          A.ID_CLIENTE,
          B.ID_SUCURSAL,
          A.ID_COMPROBANTE,
          A.ID_MONEDA,
          A.SERIE,
          A.NUMERO,
          A.FECHA,
          B.GLOSA,
          A.TOTAL,
          A.TOTAL_ME,
          B.ID_TIPOTRANSACCION,
          A.ID_TIPOVENTA,
          'V' AS TIPO,
          'SI: '||A.SERIE||'-'||A.NUMERO AS MOV,
          '' AS VOUCHER,'' AS LOTE
   FROM VENTA_SALDO A, VENTA B
   WHERE A.ID_VENTA = B.ID_VENTA
   AND A.ID_CLIENTE = B.ID_CLIENTE
   AND A.TOTAL <> 0
   UNION ALL --VENTAS QUERY 1
    SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          A.ID_VENTA,
          A.ID_CLIENTE,
          A.ID_SUCURSAL,
          A.ID_COMPROBANTE,
          A.ID_MONEDA,
          A.SERIE,
          A.NUMERO,
          A.FECHA,
          A.GLOSA,
          A.TOTAL,
          A.TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          A.ID_TIPOVENTA,
          'V' AS TIPO,
          'VNT: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(B.NUMERO) AS VOUCHER,B.LOTE
   FROM VENTA A LEFT JOIN CONTA_VOUCHER B ON A.ID_VOUCHER = B.ID_VOUCHER
   WHERE A.ID_COMPROBANTE NOT IN ('07','08')
   AND A.ESTADO = 1
   AND A.TOTAL <> 0
   UNION ALL --DEPOSITOS PAGAN VENTAS QUERY 1.1
   SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          0 as ID_VENTA,
          A.ID_CLIENTE,
          null as ID_SUCURSAL,
          null as ID_COMPROBANTE,
          A.ID_MONEDA,
          A.SERIE,
          A.NUMERO,
          A.FECHA,
          A.GLOSA,
          A.IMPORTE * -1,
          A.IMPORTE_ME * -1,
          A.ID_TIPOTRANSACCION,
          null as ID_TIPOVENTA,
          'V' AS TIPO,
          'DEP: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(D.NUMERO) AS VOUCHER,D.LOTE
     FROM CAJA_DEPOSITO A, CONTA_VOUCHER D
    WHERE A.ID_VOUCHER = D.ID_VOUCHER AND A.IMPORTE <> 0
    AND A.ID_DEPOSITO in (
    SELECT B.ID_DEPOSITO FROM CAJA_DEPOSITO_DETALLE B WHERE B.ID_DEPOSITO = A.ID_DEPOSITO
    )
    UNION ALL --NOTAS DE CREDITO AFECTAN A VENTAS QUERY 1.2
    SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          B.ID_VENTA,
          A.ID_CLIENTE,
          B.ID_SUCURSAL,
          B.ID_COMPROBANTE,
          A.ID_MONEDA,
          B.SERIE,
          B.NUMERO,
          A.FECHA,
          A.GLOSA,
          DECODE(A.ID_COMPROBANTE,'07',-1,1)*A.TOTAL AS TOTAL,
          DECODE(A.ID_COMPROBANTE,'07',-1,1)*A.TOTAL_ME AS TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          B.ID_TIPOVENTA,
          'V' AS TIPO,
          'NCD: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(C.NUMERO) AS VOUCHER,C.LOTE
   FROM VENTA A JOIN VENTA B
   ON A.ID_PARENT = B.ID_VENTA
   AND A.ID_CLIENTE = B.ID_CLIENTE
   LEFT JOIN CONTA_VOUCHER C
   ON A.ID_VOUCHER = C.ID_VOUCHER
   WHERE A.ID_COMPROBANTE IN ('07','08')
   --FROM VENTA A, VENTA B
   --WHERE A.ID_PARENT = B.ID_VENTA
   --AND A.ID_CLIENTE = B.ID_CLIENTE
   AND A.ID_COMPROBANTE IN ('07','08')
   AND A.ESTADO = 1
   AND A.TOTAL <> 0
   UNION ALL --TRANSFERENCIAS AFECTAN A VENTAS QUERY 1.3
    SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          B.ID_VENTA,
          A.ID_CLIENTE,
          C.ID_SUCURSAL,
          C.ID_COMPROBANTE,
          A.ID_MONEDA,
          C.SERIE,
          C.NUMERO,
          A.FECHA,
          A.GLOSA,
          sum(DECODE(B.DC,'C',-1,1)*B.IMPORTE) AS TOTAL,
          sum(DECODE(B.DC,'C',-1,1)*B.IMPORTE_ME) AS TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          C.ID_TIPOVENTA,
          'V' AS TIPO,
          'TRAN: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(D.NUMERO) AS VOUCHER,D.LOTE
     FROM VENTA_TRANSFERENCIA A JOIN VENTA_TRANSFERENCIA_DETALLE B
     ON A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
     JOIN VENTA C
     ON B.ID_VENTA = C.ID_VENTA AND A.ID_CLIENTE = C.ID_CLIENTE
     LEFT JOIN CONTA_VOUCHER D
     ON A.ID_VOUCHER = D.ID_VOUCHER 
     --FROM VENTA_TRANSFERENCIA A, VENTA_TRANSFERENCIA_DETALLE B, VENTA C
    --WHERE A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA AND B.ID_VENTA = C.ID_VENTA AND A.ID_CLIENTE = C.ID_CLIENTE AND 
    WHERE B.IMPORTE <> 0 AND A.ESTADO = '1'
    and A.ES_ENTRECLIENTES = 'N'
    GROUP BY A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          B.ID_VENTA,
          A.ID_CLIENTE,
          C.ID_SUCURSAL,
          C.ID_COMPROBANTE,
          A.ID_MONEDA,
          C.SERIE,
          C.NUMERO,
          A.FECHA,
          A.GLOSA,
          A.ID_TIPOTRANSACCION,
          C.ID_TIPOVENTA,
          A.SERIE,
          A.NUMERO,
          TO_CHAR(D.NUMERO),
          D.LOTE 
     UNION ALL --TRANSFERENCIAS AFECTAN A VENTAS QUERY 1.3  
   SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          C.ID_VENTA,
          A.ID_CLIENTE,
          C.ID_SUCURSAL,
          C.ID_COMPROBANTE,
          A.ID_MONEDA,
          C.SERIE,
          C.NUMERO,
          A.FECHA,
          A.GLOSA,
          DECODE(B.DC,'C',-1,1)*B.IMPORTE AS TOTAL,
          DECODE(B.DC,'C',-1,1)*B.IMPORTE_ME AS TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          C.ID_TIPOVENTA,
          'V' AS TIPO,
          'TRAN: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(D.NUMERO) AS VOUCHER,D.LOTE
     FROM VENTA_TRANSFERENCIA A JOIN VENTA_TRANSFERENCIA_DETALLE B
     ON A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
     JOIN VENTA C
     ON B.ID_VENTA = C.ID_VENTA AND A.ID_CLIENTE = C.ID_CLIENTE
     JOIN VENTA C2
     ON B.ID_VENTA_DESTINO = C2.ID_VENTA
     LEFT JOIN CONTA_VOUCHER D
     ON A.ID_VOUCHER = D.ID_VOUCHER 
     --FROM VENTA_TRANSFERENCIA A, VENTA_TRANSFERENCIA_DETALLE B, VENTA C
    --WHERE A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA AND B.ID_VENTA = C.ID_VENTA AND A.ID_CLIENTE = C.ID_CLIENTE AND 
    WHERE B.IMPORTE <> 0 AND A.ESTADO = '1' 
    AND A.ES_ENTRECLIENTES = 'S'
    AND NOT c.ID_CLIENTE = c2.ID_CLIENTE 
   UNION ALL   
   --TRANSFERENCIAS AFECTAN A ENTRECLIENTES
   SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          C.ID_VENTA,
          C.ID_CLIENTE,
          C.ID_SUCURSAL,
          C.ID_COMPROBANTE,
          A.ID_MONEDA,
          C.SERIE,
          C.NUMERO,
          A.FECHA,
          A.GLOSA,
          DECODE(B.DC,'C',1,-1)*B.IMPORTE AS TOTAL,
          DECODE(B.DC,'C',1,-1)*B.IMPORTE_ME AS TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          C.ID_TIPOVENTA,
          'V' AS TIPO,
          'TRAN: '||A.SERIE||'-'||A.NUMERO AS MOV,
          '' AS VOUCHER,'' AS LOTE
     FROM VENTA_TRANSFERENCIA A, VENTA_TRANSFERENCIA_DETALLE B, VENTA C, VENTA C1
    WHERE A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA 
    	AND B.ID_VENTA_DESTINO = C.ID_VENTA 
    	AND B.ID_VENTA = C1.ID_VENTA 
        AND B.IMPORTE <> 0 AND A.ESTADO = '1'
    	AND A.ES_ENTRECLIENTES = 'S'   
    	AND NOT c.ID_CLIENTE = c1.ID_CLIENTE 
UNION ALL
-- DEVOLUCION
SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          C.ID_VENTA,
          B.ID_CLIENTE,
          C.ID_SUCURSAL,
          C.ID_COMPROBANTE,
          A.ID_MONEDA,
          C.SERIE,
          C.NUMERO,
          A.FECHA,
          C.GLOSA,
          B.IMPORTE,
          B.IMPORTE_ME,
          A.ID_TIPOTRANSACCION,
          C.ID_TIPOVENTA,
          'P' AS TIPO,
          'DEV: OP.'||A.NUMERO AS MOV,
          '' AS VOUCHER,'' AS LOTE
     FROM CAJA_PAGO A
        INNER JOIN CAJA_PAGO_VENTA B ON A.ID_PAGO = B.ID_PAGO
        INNER JOIN VENTA C ON B.ID_VENTA = C.ID_VENTA
        LEFT OUTER JOIN TIPO_COMPROBANTE T ON T.ID_COMPROBANTE = C.ID_COMPROBANTE
     WHERE A.ESTADO = '1'
UNION ALL
--SALDO INICIAL SISTEMA EXTERNO QUERY 2
SELECT 	  A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          NVL(A.ID_VENTA,ID_SALDO) AS ID_VENTA,
          A.ID_CLIENTE,
          NULL AS ID_SUCURSAL,
          A.ID_COMPROBANTE,
          A.ID_MONEDA,
          A.SERIE,
          A.NUMERO,
          A.FECHA,
          'Saldo Incial' AS GLOSA,
          A.TOTAL,
          A.TOTAL_ME,
          NULL AS ID_TIPOTRANSACCION,
          A.ID_TIPOVENTA,
          'S' AS TIPO,
          'SIN: '||A.SERIE||'-'||A.NUMERO AS MOV,
          '' AS VOUCHER,'' AS LOTE
   FROM VENTA_SALDO A 
   WHERE ID_VENTA IS NULL
   AND A.TOTAL > 0
   UNION ALL --DEPOSITOS QUE PAGAN SALDOS QUERY 2.1
   SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          C.ID_SALDO AS ID_VENTA,
          A.ID_CLIENTE,
          null AS ID_SUCURSAL,
          C.ID_COMPROBANTE,
          A.ID_MONEDA,
          C.SERIE,
          C.NUMERO,
          A.FECHA,
          A.GLOSA,
          B.IMPORTE * -1,
          B.IMPORTE_ME * -1,
          A.ID_TIPOTRANSACCION,
          C.ID_TIPOVENTA,
          'S' AS TIPO,
          'DEP: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(D.NUMERO) AS VOUCHER,D.LOTE
     FROM CAJA_DEPOSITO A, CAJA_DEPOSITO_DETALLE B, VENTA_SALDO C, CONTA_VOUCHER D
    WHERE A.ID_DEPOSITO = B.ID_DEPOSITO AND B.ID_SALDO = C.ID_SALDO AND A.ID_CLIENTE = C.ID_CLIENTE AND A.ID_VOUCHER = D.ID_VOUCHER
    AND ESTADO = '1' AND B.IMPORTE <> 0
    UNION ALL --NOTAS DE CREDITO AFECTAN AL SALOD QUERY 2.2
    SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          B.ID_SALDO AS ID_VENTA,
          A.ID_CLIENTE,
          A.ID_SUCURSAL,
          B.ID_COMPROBANTE,
          A.ID_MONEDA,
          B.SERIE,
          B.NUMERO,
          A.FECHA,
          A.GLOSA,
          DECODE(A.ID_COMPROBANTE,'07',-1,1)*A.TOTAL AS TOTAL,
          DECODE(A.ID_COMPROBANTE,'07',-1,1)*A.TOTAL_ME AS TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          A.ID_TIPOVENTA,
          'S' AS TIPO,
          'NCD: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(C.NUMERO) AS VOUCHER,C.LOTE 
   FROM VENTA A, VENTA_SALDO B, CONTA_VOUCHER C
   WHERE A.ID_SALDO = B.ID_SALDO
   AND A.ID_CLIENTE = B.ID_CLIENTE
   AND A.ID_VOUCHER = C.ID_VOUCHER
   AND A.ID_COMPROBANTE IN ('07','08')
   AND A.ESTADO = 1
   AND A.TOTAL <> 0
    UNION ALL
   SELECT --TRANSFERENCIAS QUE AFECTAN AL SALDO QUERY 2.3
         A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          C.ID_SALDO AS ID_VENTA,
          A.ID_CLIENTE,
          NULL AS ID_SUCURSAL,
          C.ID_COMPROBANTE,
          A.ID_MONEDA,
          C.SERIE,
          C.NUMERO,
          A.FECHA,
          A.GLOSA,
          DECODE (B.DC, 'C', -1, 1) * B.IMPORTE AS TOTAL,
          DECODE (B.DC, 'C', -1, 1) * B.IMPORTE_ME AS TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          C.ID_TIPOVENTA,
          'S' AS TIPO,
          'TRAN: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(D.NUMERO) AS VOUCHER,D.LOTE
     FROM VENTA_TRANSFERENCIA A
          JOIN VENTA_TRANSFERENCIA_DETALLE B
             ON A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
          JOIN VENTA_SALDO C
             ON A.ID_CLIENTE = C.ID_CLIENTE AND B.ID_SALDO = C.ID_SALDO
    LEFT JOIN CONTA_VOUCHER D
    ON A.ID_VOUCHER = D.ID_VOUCHER
    WHERE A.ESTADO = 1 AND A.ES_ANTICIPO IN ('S','N') --AND A.ES_ANTICIPO = 'N' 
    AND B.IMPORTE <> 0
    UNION ALL --TRANSFERENCIAS QUE SON DOCUMENTOS A PAGAR QUERY 3
    SELECT DISTINCT A.ID_ENTIDAD,
                   A.ID_DEPTO,
                   A.ID_ANHO,
                   A.ID_MES,
                   A.ID_TRANSFERENCIA AS ID_VENTA,
                   A.ID_CLIENTE,
                   null AS ID_SUCURSAL,
                   '99' AS ID_COMPROBANTE,
                   A.ID_MONEDA,
                   A.SERIE,
                   A.NUMERO,
                   A.FECHA,
                   A.GLOSA,
                   A.IMPORTE AS TOTAL,
                   A.IMPORTE_ME AS TOTAL_ME,
                   A.ID_TIPOTRANSACCION,
                   A.ID_TIPOVENTA,
                   'T' AS TIPO,
                   'TRAN: '||A.SERIE||'-'||A.NUMERO AS MOV,
                   TO_CHAR(C.NUMERO) AS VOUCHER,C.LOTE
     FROM VENTA_TRANSFERENCIA A
          JOIN VENTA_TRANSFERENCIA_DETALLE B
             ON A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
    JOIN CONTA_VOUCHER C
    ON A.ID_VOUCHER = C.ID_VOUCHER
    WHERE A.ES_ANTICIPO = 'N' AND B.ID_VENTA IS NULL AND B.ID_SALDO IS NULL AND B.ID_TRANSFERENCIA_P IS NULL
    AND A.ESTADO = 1 AND A.IMPORTE <> 0
    UNION ALL --DEPOSITOS PAGAN TRANSFERENCIAS QUERY 3.1
    SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          C.ID_TRANSFERENCIA AS ID_VENTA,
          A.ID_CLIENTE,
          null AS ID_SUCURSAL,
          '99' AS ID_COMPROBANTE,
          A.ID_MONEDA,
          C.SERIE,
          C.NUMERO,
          A.FECHA,
          A.GLOSA,
          B.IMPORTE * -1,
          B.IMPORTE_ME * -1,
          A.ID_TIPOTRANSACCION,
          C.ID_TIPOVENTA,
          'T' AS TIPO,
          'DEP: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(D.NUMERO) AS VOUCHER,D.LOTE
     FROM CAJA_DEPOSITO A, CAJA_DEPOSITO_DETALLE B, VENTA_TRANSFERENCIA C, CONTA_VOUCHER D
    WHERE A.ID_DEPOSITO = B.ID_DEPOSITO AND B.ID_TRANSFERENCIA = C.ID_TRANSFERENCIA AND A.ID_CLIENTE = C.ID_CLIENTE AND A.ID_VOUCHER = D.ID_VOUCHER
    AND A.ESTADO = '1' AND B.IMPORTE <> 0
    UNION ALL --NOTAS DE CREDITO AFECTAN A TRANSFERENCIAS QUERY 3.2
    SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          B.ID_TRANSFERENCIA AS ID_VENTA,
          A.ID_CLIENTE,
          A.ID_SUCURSAL,
          '99' AS ID_COMPROBANTE,
          A.ID_MONEDA,
          B.SERIE,
          B.NUMERO,
          A.FECHA,
          A.GLOSA,
          DECODE(A.ID_COMPROBANTE,'07',-1,1)*A.TOTAL AS TOTAL,
          DECODE(A.ID_COMPROBANTE,'07',-1,1)*A.TOTAL_ME AS TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          A.ID_TIPOVENTA,
          'T' AS TIPO,
          'NCD: '||A.SERIE||'-'||A.NUMERO AS MOV,
           TO_CHAR(C.NUMERO) AS VOUCHER,C.LOTE
   FROM VENTA A, VENTA_TRANSFERENCIA B, CONTA_VOUCHER C
   WHERE A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
   AND A.ID_CLIENTE = B.ID_CLIENTE
   AND A.ID_VOUCHER = C.ID_VOUCHER
   AND A.ID_COMPROBANTE IN ('07','08')
   AND A.ESTADO = 1
   AND A.TOTAL <> 0
    UNION ALL
    SELECT A.ID_ENTIDAD, --ANTICIPO (AUTOMATICO) QUE PAGA UNA TRANSFERENCIA QUERY 3.3
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          C.ID_TRANSFERENCIA,
          A.ID_CLIENTE,
          NULL AS ID_SUCURSAL,
          '99' AS ID_COMPROBANTE,
          A.ID_MONEDA,
          C.SERIE,
          C.NUMERO,
          A.FECHA,
          A.GLOSA,
          DECODE (B.DC, 'C', -1, 1) * B.IMPORTE AS TOTAL,
          DECODE (B.DC, 'C', -1, 1) * B.IMPORTE_ME AS TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          C.ID_TIPOVENTA,
          'T' AS TIPO,
          'TRAN: '||A.SERIE||'-'||A.NUMERO AS MOV,
          TO_CHAR(D.NUMERO) AS VOUCHER,D.LOTE
FROM VENTA_TRANSFERENCIA A JOIN VENTA_TRANSFERENCIA_DETALLE B
ON A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
JOIN VENTA_TRANSFERENCIA C
ON A.ID_CLIENTE = C.ID_CLIENTE
AND B.ID_TRANSFERENCIA_P = C.ID_TRANSFERENCIA
LEFT JOIN CONTA_VOUCHER D
ON A.ID_VOUCHER = D.ID_VOUCHER
WHERE --A.ES_ANTICIPO = 'S'
--AND B.DC = 'C'
--AND 
A.ESTADO = 1
AND B.IMPORTE <> 0
UNION ALL
SELECT A.ID_ENTIDAD,
          A.ID_DEPTO,
          A.ID_ANHO,
          A.ID_MES,
          A.ID_VENTA,
          A.ID_CLIENTE,
          A.ID_SUCURSAL,
          A.ID_COMPROBANTE,
          A.ID_MONEDA,
          A.SERIE,
          A.NUMERO,
          A.FECHA,
          A.GLOSA,
          DECODE (A.ID_COMPROBANTE, '07', -1, 1) * A.TOTAL AS TOTAL,
          DECODE (A.ID_COMPROBANTE, '07', -1, 1) * A.TOTAL_ME AS TOTAL_ME,
          A.ID_TIPOTRANSACCION,
          A.ID_TIPOVENTA,
          'V' AS TIPO,
          'NCD: ' || A.SERIE || '-' || A.NUMERO AS MOV,
          TO_CHAR(B.NUMERO) AS VOUCHER,B.LOTE
     FROM VENTA A LEFT JOIN CONTA_VOUCHER B
     ON A.ID_VOUCHER = B.ID_VOUCHER
    WHERE     A.ID_COMPROBANTE IN ('07', '08')
          AND A.ID_PARENT IS NULL
          AND A.ID_SALDO IS NULL
          AND A.ID_TRANSFERENCIA IS NULL
          AND A.ESTADO = 1
          AND A.TOTAL <> 0;

