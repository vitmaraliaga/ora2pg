-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_mat_saldo_alumno (id_entidad, id_depto, id_anho, id_cliente, total) AS SELECT
ID_ENTIDAD,
ID_DEPTO,
ID_ANHO,
ID_CLIENTE,
TOTAL
FROM VW_SALES_MOV
WHERE 
ID_TIPOVENTA IN (1,2,3,4)
UNION ALL
SELECT 
ID_ENTIDAD,
ID_DEPTO,
ID_ANHO,
ID_CLIENTE,
SUM(IMPORTE)*DECODE(SIGN(SUM(IMPORTE)),1,-1,0) AS TOTAL
FROM VW_SALES_ADVANCES
GROUP BY 
ID_ENTIDAD,
ID_DEPTO,
ID_ANHO,
ID_CLIENTE
HAVING SUM(IMPORTE)*DECODE(SIGN(SUM(IMPORTE)),1,-1,0)<>0;

