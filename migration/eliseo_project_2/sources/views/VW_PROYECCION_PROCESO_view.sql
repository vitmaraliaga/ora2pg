-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_proyeccion_proceso (id_entidad, id_depto, id_anho, id_depto_padre, id_auxiliar, credito1_i, credito2a5_i, cantidad_i, credito1_ii, credito2a5_ii, cantidad_ii, horas_i, horas_ii, convoca) AS SELECT 
        ID_ENTIDAD,
        ID_DEPTO,
        ID_ANHO,
        ID_DEPTO_PADRE,
        ID_AUXILIAR,
        COALESCE(SUM(CASE WHEN CICLO IN(1,2) THEN CANTIDAD_I*CREDITO_I   ELSE 0 END),0) AS  CREDITO1_I,
        COALESCE(SUM(CASE WHEN CICLO NOT IN(1,2) THEN CANTIDAD_I*CREDITO_I  ELSE 0 END),0) AS  CREDITO2A5_I,
        COALESCE(SUM(CANTIDAD_I),0) AS CANTIDAD_I,
        COALESCE(SUM(CASE WHEN CICLO IN(1,2) THEN CANTIDAD_II*CREDITO_II ELSE 0 END),0) AS  CREDITO1_II,
        COALESCE(SUM(CASE WHEN CICLO NOT IN(1,2) THEN CANTIDAD_II*CREDITO_II ELSE 0 END),0) AS  CREDITO2A5_II,
        COALESCE(SUM(CANTIDAD_II),0) AS CANTIDAD_II,
        COALESCE(SUM(HORAS_I),0) AS HORAS_I,
        COALESCE(SUM(HORAS_II),0) AS HORAS_II,
        '' AS CONVOCA
        FROM PSTO_PREGRADO_PROYECCCION
        WHERE BECA='N'
        AND (CANTIDAD_I+CANTIDAD_II+CREDITO_I+CREDITO_II)>0
        GROUP BY ID_ENTIDAD,
        ID_DEPTO,
        ID_ANHO,
        ID_DEPTO_PADRE,
        ID_AUXILIAR
        UNION
        SELECT 
        ID_ENTIDAD,
        ID_DEPTO,
        ID_ANHO,
        ID_DEPTO_PADRE,
        ID_AUXILIAR,
        COALESCE(SUM(CASE WHEN CICLO IN(1,2) THEN CANTIDAD_I*CREDITO_I   ELSE 0 END),0) AS  CREDITO1_I,
        COALESCE(SUM(CASE WHEN CICLO NOT IN(1,2) THEN CANTIDAD_I*CREDITO_I  ELSE 0 END),0) AS  CREDITO2A5_I,
        COALESCE(SUM(CANTIDAD_I),0) AS CANTIDAD_I,
        COALESCE(SUM(CASE WHEN CICLO IN(1,2) THEN CANTIDAD_II*CREDITO_II ELSE 0 END),0) AS  CREDITO1_II,
        COALESCE(SUM(CASE WHEN CICLO NOT IN(1,2) THEN CANTIDAD_II*CREDITO_II ELSE 0 END),0) AS  CREDITO2A5_II,
        COALESCE(SUM(CANTIDAD_II),0) AS CANTIDAD_II,
        COALESCE(SUM(HORAS_I),0) AS HORAS_I,
        COALESCE(SUM(HORAS_II),0) AS HORAS_II,
        '2015' AS CONVOCA
        FROM PSTO_PREGRADO_PROYECCCION
        WHERE  BECA='S'
        AND (CANTIDAD_I+CANTIDAD_II+CREDITO_I+CREDITO_II)>0
        AND (ID_ANHO-CASE WHEN CICLO IN(1,2)  THEN 1 WHEN CICLO IN(3,4)  THEN 2 WHEN CICLO IN(5,6)  THEN 3 WHEN CICLO IN(7,8)  THEN 4 WHEN CICLO IN(9,10)  THEN 5 END)>2013
        GROUP BY ID_ENTIDAD,
        ID_DEPTO,
        ID_ANHO,
        ID_DEPTO_PADRE,
        ID_AUXILIAR
        UNION
        SELECT 
        ID_ENTIDAD,
        ID_DEPTO,
        ID_ANHO,
        ID_DEPTO_PADRE,
        ID_AUXILIAR,
        COALESCE(SUM(CASE WHEN CICLO IN(1,2) THEN CANTIDAD_I*CREDITO_I   ELSE 0 END),0) AS  CREDITO1_I,
        COALESCE(SUM(CASE WHEN CICLO NOT IN(1,2) THEN CANTIDAD_I*CREDITO_I  ELSE 0 END),0) AS  CREDITO2A5_I,
        COALESCE(SUM(CANTIDAD_I),0) AS CANTIDAD_I,
        COALESCE(SUM(CASE WHEN CICLO IN(1,2) THEN CANTIDAD_II*CREDITO_II ELSE 0 END),0) AS  CREDITO1_II,
        COALESCE(SUM(CASE WHEN CICLO NOT IN(1,2) THEN CANTIDAD_II*CREDITO_II ELSE 0 END),0) AS  CREDITO2A5_II,
        COALESCE(SUM(CANTIDAD_II),0) AS CANTIDAD_II,
        COALESCE(SUM(HORAS_I),0) AS HORAS_I,
        COALESCE(SUM(HORAS_II),0) AS HORAS_II,
        '2013' AS CONVOCA
        FROM PSTO_PREGRADO_PROYECCCION
        WHERE  BECA='S'
        AND (CANTIDAD_I+CANTIDAD_II+CREDITO_I+CREDITO_II)>0
        AND (ID_ANHO-CASE WHEN CICLO IN(1,2)  THEN 1 WHEN CICLO IN(3,4)  THEN 2 WHEN CICLO IN(5,6)  THEN 3 WHEN CICLO IN(7,8)  THEN 4 WHEN CICLO IN(9,10)  THEN 5 END)<=2013
        GROUP BY ID_ENTIDAD,
        ID_DEPTO,
        ID_ANHO,
        ID_DEPTO_PADRE,
        ID_AUXILIAR;

