-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_conta_informe (id_informe, id_actividad, id_tipoestado, id_persona, id_anho, id_mes, id_actividadconcepto, valor, es_control, es_entidad, id_tipodato, es_obligatorio, es_editable, val_minimo, val_maximo, comentario, nom_concepto, nom_tipoconcepto, id_personaconcepto, id_entidad, id_entidadconcepto) AS SELECT
  CONTA_Informe.ID_Informe,
  CONTA_Informe.ID_Actividad,
  CONTA_Informe.ID_TIPOESTADO,
  CONTA_Informe.ID_PERSONA,
  CONTA_Informe.ID_ANHO,
  CONTA_Informe.ID_MES,
  CONTA_Informe_Concepto.ID_ActividadCONCEPTO, 
  CONTA_Informe_Concepto.VALOR,
  CONTA_Actividad.ES_CONTROL,
  CONTA_Actividad.ES_Entidad,
  CONTA_Actividad_Concepto.ID_TIPODATO,
  CONTA_Actividad_Concepto.ES_OBLIGATORIO,
  CONTA_Actividad_Concepto.ES_EDITABLE, 
  CONTA_Actividad_Concepto.VAL_MINIMO,
  CONTA_Actividad_Concepto.VAL_MAXIMO,
  CONTA_Actividad_Concepto.COMENTARIO,
  CONTA_Actividad_Concepto.NOMBRE as NOM_CONCEPTO, 
  Tipo_Actividad_Concepto.NOMBRE as NOM_TIPOCONCEPTO,
  CONTA_Informe_Concepto.ID_PERSONA as ID_PERSONACONCEPTO,
  CASE WHEN CONTA_Actividad.ES_Entidad = 1 THEN CONTA_Entidad.ID_Entidad ELSE CONTA_Informe.ID_PERSONA END as ID_Entidad, 
  CASE WHEN CONTA_Actividad.ES_Entidad = 1 THEN CONTA_Entidad_Concepto.ID_Entidad ELSE CONTA_Informe_Concepto.ID_PERSONA END AS ID_EntidadCONCEPTO
FROM CONTA_Informe
INNER JOIN CONTA_Informe_Concepto ON
  CONTA_Informe.ID_Informe = CONTA_Informe_Concepto.ID_Informe
INNER JOIN CONTA_Actividad ON
  CONTA_Informe.ID_Actividad = CONTA_Actividad.ID_Actividad
INNER JOIN CONTA_Actividad_Concepto ON
  CONTA_Informe_Concepto.ID_ActividadCONCEPTO = CONTA_Actividad_Concepto.ID_ActividadCONCEPTO
INNER JOIN Tipo_Actividad_Concepto ON
 CONTA_Actividad_Concepto.ID_TIPOActividadCONCEPTO = Tipo_Actividad_Concepto.ID_TIPOActividadCONCEPTO
LEFT OUTER JOIN CONTA_Entidad ON
  CONTA_Informe.ID_PERSONA = CONTA_Entidad.ID_PERSONA
LEFT OUTER JOIN CONTA_Entidad CONTA_Entidad_Concepto ON
  CONTA_Informe_Concepto.ID_PERSONA = CONTA_Entidad_Concepto.ID_PERSONA
WHERE CONTA_Informe.ID_TIPOESTADO IN (1, 2);

