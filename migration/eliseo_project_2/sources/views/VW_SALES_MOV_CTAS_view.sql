-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_sales_mov_ctas (id_entidad, id_depto, id_transferencia, id_comprobante, id_cliente, id_anho, id_mes, fecha, lote, numero, total, alumno, codigo, cuenta, cuenta_cte, debito, credito, depto) AS SELECT DISTINCT A.ID_ENTIDAD,A.ID_DEPTO,A.ID_TRANSFERENCIA,'99' AS ID_COMPROBANTE,A.ID_CLIENTE,A.ID_ANHO,A.ID_MES,
A.FECHA,C.LOTE,A.SERIE||'-'||A.NUMERO AS NUMERO,A.IMPORTE AS TOTAL ,D.NOMBRE||' '||D.PATERNO||' '||D.MATERNO AS ALUMNO,E.CODIGO,X.CUENTA,X.CUENTA_CTE,
(CASE WHEN (X.IMPORTE) > 0 THEN (X.IMPORTE) ELSE 0 END) AS DEBITO,
(CASE WHEN (X.IMPORTE) < 0 THEN (X.IMPORTE) ELSE 0 END) AS CREDITO,X.DEPTO
FROM VENTA_TRANSFERENCIA A JOIN VENTA_TRANSFERENCIA_DETALLE B
ON A.ID_TRANSFERENCIA = B.ID_TRANSFERENCIA
JOIN CONTA_VOUCHER C
ON A.ID_VOUCHER = C.ID_VOUCHER
JOIN MOISES.PERSONA D
ON A.ID_CLIENTE = D.ID_PERSONA
JOIN MOISES.PERSONA_NATURAL_ALUMNO E
ON A.ID_CLIENTE = E.ID_PERSONA
JOIN CONTA_ASIENTO X
ON A.ID_VOUCHER = X.VOUCHER
AND A.ID_TIPOORIGEN = X.ID_TIPOORIGEN
AND B.ID_TRANSFERENCIA = X.ID_ORIGEN 
UNION ALL
SELECT A.ID_ENTIDAD,A.ID_DEPTO,A.ID_VENTA,A.ID_COMPROBANTE,A.ID_CLIENTE,A.ID_ANHO,A.ID_MES,
A.FECHA,C.LOTE,A.SERIE||'-'||A.NUMERO AS NUMERO,A.TOTAL,D.NOMBRE||' '||D.PATERNO||' '||D.MATERNO AS ALUMNO,E.CODIGO,X.CUENTA,X.CUENTA_CTE,
(CASE WHEN (X.IMPORTE) > 0 THEN (X.IMPORTE) ELSE 0 END) AS DEBITO,
(CASE WHEN (X.IMPORTE) < 0 THEN (X.IMPORTE) ELSE 0 END) AS CREDITO,X.DEPTO
FROM VENTA A JOIN VENTA_DETALLE B
ON A.ID_VENTA = B.ID_VENTA
JOIN CONTA_VOUCHER C
ON A.ID_VOUCHER = C.ID_VOUCHER
JOIN MOISES.PERSONA D
ON A.ID_CLIENTE = D.ID_PERSONA
JOIN MOISES.PERSONA_NATURAL_ALUMNO E
ON A.ID_CLIENTE = E.ID_PERSONA
JOIN CONTA_ASIENTO X
ON A.ID_VOUCHER = X.VOUCHER
AND B.ID_TIPOORIGEN = X.ID_TIPOORIGEN
AND B.ID_VDETALLE = X.ID_ORIGEN
UNION ALL
SELECT DISTINCT A.ID_ENTIDAD,A.ID_DEPTO,A.ID_DEPOSITO,A.ID_MEDIOPAGO,A.ID_CLIENTE,A.ID_ANHO,A.ID_MES,
A.FECHA,C.LOTE,A.SERIE||'-'||A.NUMERO AS NUMERO,A.IMPORTE,D.NOMBRE||' '||D.PATERNO||' '||D.MATERNO AS ALUMNO,E.CODIGO,X.CUENTA,X.CUENTA_CTE,
(CASE WHEN (X.IMPORTE) > 0 THEN (X.IMPORTE) ELSE 0 END) AS DEBITO,
(CASE WHEN (X.IMPORTE) < 0 THEN (X.IMPORTE) ELSE 0 END) AS CREDITO,X.DEPTO
FROM CAJA_DEPOSITO A JOIN CAJA_DEPOSITO_DETALLE B
ON A.ID_DEPOSITO = B.ID_DEPOSITO
JOIN CONTA_VOUCHER C
ON A.ID_VOUCHER = C.ID_VOUCHER
JOIN MOISES.PERSONA D
ON A.ID_CLIENTE = D.ID_PERSONA
JOIN MOISES.PERSONA_NATURAL_ALUMNO E
ON A.ID_CLIENTE = E.ID_PERSONA
JOIN CONTA_ASIENTO X
ON A.ID_VOUCHER = X.VOUCHER
AND A.ID_TIPOORIGEN = X.ID_TIPOORIGEN
AND A.ID_DEPOSITO = X.ID_ORIGEN 
UNION ALL
SELECT DISTINCT A.ID_ENTIDAD,A.ID_DEPTO,A.ID_PAGO,A.ID_MEDIOPAGO,B.ID_CLIENTE,A.ID_ANHO,A.ID_MES,
A.FECHA,C.LOTE,A.NUMERO AS NUMERO,A.IMPORTE,D.NOMBRE||' '||D.PATERNO||' '||D.MATERNO AS ALUMNO,E.CODIGO,X.CUENTA,X.CUENTA_CTE,
(CASE WHEN (X.IMPORTE) > 0 THEN (X.IMPORTE) ELSE 0 END) AS DEBITO,
(CASE WHEN (X.IMPORTE) < 0 THEN (X.IMPORTE) ELSE 0 END) AS CREDITO,X.DEPTO
FROM CAJA_PAGO A JOIN CAJA_PAGO_VENTA B
ON A.ID_PAGO = B.ID_PAGO
JOIN CONTA_VOUCHER C
ON A.ID_VOUCHER = C.ID_VOUCHER
JOIN MOISES.PERSONA D
ON B.ID_CLIENTE = D.ID_PERSONA
JOIN MOISES.PERSONA_NATURAL_ALUMNO E
ON B.ID_CLIENTE = E.ID_PERSONA
JOIN CONTA_ASIENTO X
ON A.ID_VOUCHER = X.VOUCHER
AND B.ID_TIPOORIGEN = X.ID_TIPOORIGEN
AND B.ID_PVENTA = X.ID_ORIGEN;

