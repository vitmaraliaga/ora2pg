-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = eliseo,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_users_estudiantes_semestre (estudiante_id, program_code, sede, modalidad_estudio, program_short_name, card_number, contract_expiry_date, country, creation_date, date_of_birth, email, emailpro, sigla_facultad, first_name, gender, last_name, locality, postal_address, region, telephone_number, username, password) AS select aac.id_persona estudiante_id,Ape.Id_Programa_Estudio program_code,aac.Sede,Ape.Modalidad_Estudio,
Ape.Nombre_Certificado as program_short_name,pa.Codigo card_number,fecha_fin contract_expiry_date,
pa.pais country,nvl(aac.Fecha_Actualizacion,aac.Fecha_Registro) creation_date,
pa.fec_nacimiento date_of_birth,pa.correo_upeu email, pa.correo emailpro,
oa.sigla sigla_facultad,pa.nombre first_name,pa.sexo gender,pa.paterno||' '||pa.materno last_name,
aac.sede locality,pd.Direccion postal_address,decode(aac.id_sede,1,'Lima',2,'Puno',3,'San Mart√¨n') region,
pa.celular telephone_number,u.email username,U.Contrasenha password
FROM DAVID.Vw_Acad_Alumno_Contrato aac inner join david.vw_persona_alumno pa on pa.id_persona=aac.id_persona
inner join david.vw_acad_programa_estudio ape on ape.id_programa_estudio=aac.id_programa_estudio
inner join eliseo.org_area oa on oa.id_area=Ape.Id_Facultad
inner join (select Id_Semestre_Programa,max(Fecha_Fin) fecha_fin from DAVID.Acad_Modulo_Detalle
            group by Id_Semestre_Programa) ff on ff.Id_Semestre_Programa=aac.Id_Semestre_Programa
left join eliseo.users u on u.id=aac.id_persona
left join (select id_persona,pd.Direccion
          from moises.persona_direccion pd
          where id_direccion=(select max(id_direccion) from moises.persona_direccion a where a.id_persona=pd.id_persona)) pd
        on pd.id_persona=aac.id_persona
where aac.id_semestre=(select id_semestre from david.acad_semestre where estado_adviser='1');

