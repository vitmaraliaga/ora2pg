-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = moises,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_persona_natural_pariente (id_pariente, id_persona, nom_persona, id_tipodocumento, num_documento, p_email, p_telefono, fec_nacimiento, id_tipoparentesco, tipo_parentesco) AS SELECT 
PNP.ID_PARIENTE,
PNP.ID_PERSONA,
vw_pn.NOM_PERSONA,
vw_pn.ID_TIPODOCUMENTO,
vw_pn.NUM_DOCUMENTO,
FC_OBTENER_EMAIL(PN.ID_PERSONA) as p_email,
FC_OBTENER_PHONO(PN.ID_PERSONA) as p_telefono,
vw_pn.FEC_NACIMIENTO,
PNP.ID_TIPOPARENTESCO,
TP.NOMBRE as TIPO_PARENTESCO
FROM PERSONA_NATURAL PN
INNER JOIN PERSONA_NATURAL_PARENTESCO  PNP 
ON PN.ID_PERSONA = PNP.ID_PARIENTE
INNER JOIN vw_Persona_Natural vw_pn 
ON (vw_pn.ID_PERSONA = PN.ID_PERSONA AND vw_pn.ID_TIPODOCUMENTO = 1)
INNER JOIN TIPO_PARENTESCO TP 
ON TP.ID_TIPOPARENTESCO = PNP.ID_TIPOPARENTESCO;

