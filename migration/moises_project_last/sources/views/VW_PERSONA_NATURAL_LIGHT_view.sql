-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = moises,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_persona_natural_light (id_persona, paterno, materno, nombre, sexo, tipo_sexo, fec_nacimiento, nom_persona, id_tipodocumento, num_documento, id_tipoestadocivil, tipo_estado_civil, id_tipotratamiento, tipo_tratamiento, num_telefono, email, id_tipopais, pais) AS SELECT DISTINCT
  PERSONA.ID_PERSONA,
  PERSONA.PATERNO,
  PERSONA.MATERNO,
  PERSONA.NOMBRE,
  PERSONA_NATURAL.SEXO,
  CASE WHEN PERSONA_NATURAL.SEXO='1' THEN 'Masculino' ELSE 'Femenino' END AS TIPO_SEXO,
  PERSONA_NATURAL.FEC_NACIMIENTO,
  UPPER(NVL(PERSONA.PATERNO || ' ' , '') || NVL(PERSONA.MATERNO || ', ', '')) || /*DBO.FN_NOMPROPIO(*/
PERSONA.NOMBRE/*)*/
 AS NOM_PERSONA,
  PERSONA_DOCUMENTO.ID_TIPODOCUMENTO,
  PERSONA_DOCUMENTO.NUM_DOCUMENTO,
  PERSONA_NATURAL.ID_TIPOESTADOCIVIL,
  TEC.NOMBRE AS TIPO_ESTADO_CIVIL,
  PERSONA_NATURAL.ID_TIPOTRATAMIENTO,
  TT.NOMBRE AS TIPO_TRATAMIENTO,
  PT.NUM_TELEFONO,
  -- PV.DIRECCION AS EMAIL,
  FC_OBTENER_EMAIL(PERSONA.ID_PERSONA) AS EMAIL,
  TP.ID_TIPOPAIS,
  TP.NOMBRE AS PAIS
FROM MOISES.PERSONA
INNER JOIN  MOISES.PERSONA_NATURAL ON
  PERSONA.ID_PERSONA = PERSONA_NATURAL.ID_PERSONA
LEFT JOIN MOISES.PERSONA_DOCUMENTO ON (
  PERSONA.ID_PERSONA = PERSONA_DOCUMENTO.ID_PERSONA AND PERSONA_DOCUMENTO.ID_TIPODOCUMENTO IN ('1', '4','7'))
LEFT JOIN TIPO_ESTADO_CIVIL TEC ON TEC.ID_TIPOESTADOCIVIL = PERSONA_NATURAL.ID_TIPOESTADOCIVIL
LEFT JOIN TIPO_TRATAMIENTO TT ON TT.ID_TIPOTRATAMIENTO = PERSONA_NATURAL.ID_TIPOTRATAMIENTO
LEFT JOIN MOISES.PERSONA_TELEFONO PT ON PERSONA_NATURAL.ID_PERSONA=PT.ID_PERSONA
-- LEFT JOIN MOISES.PERSONA_VIRTUAL PV ON PERSONA_NATURAL.ID_PERSONA=PV.ID_PERSONA
LEFT JOIN MOISES.TIPO_PAIS TP ON TP.ID_TIPOPAIS = PERSONA_NATURAL.ID_TIPOPAIS
-- AND CASE WHEN NVL(PERSONA_NATURAL.ID_TIPOPAIS, 176) = 176 THEN 1 ELSE 4 END = PERSONA_DOCUMENTO.ID_TIPODOCUMENTO
;

