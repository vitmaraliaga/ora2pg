-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = moises,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE PACKAGE        VERIFICACION_VALOR AS 

function ft_insert_verificacion(
      p_id_persona in integer,
      p_valor in varchar2,
      p_estado in varchar2,
      p_id_usuario_reg in integer,
      p_fecha_registro in date,
      p_tipo in varchar2
    ) 
    
    return sys_refcursor;

END VERIFICACION_VALOR;


CREATE OR REPLACE package body        verificacion_valor as

function ft_insert_verificacion(
      p_id_persona in integer,
      p_valor in varchar2,
      p_estado in varchar2,
      p_id_usuario_reg in integer,
      p_fecha_registro in date,
      p_tipo in varchar2
    ) 
    
    return sys_refcursor
      as
      
      refcursor sys_refcursor;
      p_res varchar2(5);
      
    begin
        
      select nvl(ft_verificacion(p_valor,'2'),'n') into p_res
        from dual;  
      
      if(substr(p_res,0,1)='s') then
      
        if(substr(p_res,2)='0') then
        
          update moises.verificacion set 
                  id_persona=p_id_persona,
                  id_usuario_act=p_id_usuario_reg,
                  fecha_actualizacion=p_fecha_registro
          where valor=p_valor;
            
        end if;
        
      end if;
        
      if(substr(p_res,0,1)='n') then
      
        insert into moises.verificacion (id_persona,valor,estado,id_usuario_reg,fecha_registro,tipo)
        values (p_id_persona,p_valor,p_estado,p_id_usuario_reg,p_fecha_registro,p_tipo);
        
      end if;
      
      commit;
          
          
      open refcursor for select id_verificacion,id_persona,valor,codigo_verificacion,estado,id_usuario_reg,fecha_registro,id_usuario_act,fecha_actualizacion,tipo
                          from moises.verificacion 
                          where valor=p_valor;
          
      return refcursor;
          
  end ft_insert_verificacion;
  
  
end verificacion_valor;