-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_horario_docente (id_carga_curso, id_carga_curso_docente, fecha_inicio, fecha_fin, horario, dia, nombre_dia, hora_inicio, hora_fin) AS select accd.Id_Carga_Curso,accd.Id_Carga_Curso_Docente,amd.Fecha_Inicio,amd.Fecha_Fin,accd.horario,
Ds.Dia,ds.nombre nombre_dia,Hora_Inicio,hf.Hora_fin
FROM Acad_Carga_Curso_Docente accd inner join Acad_Modulo_Detalle amd on amd.Id_Modulo_Detalle=accd.Id_Modulo_Detalle
LEFT JOIN dia_semana DS on DIA_HORA_CURSO2(HORARIO) like '%'||ds.codigo||'%'
inner join Acad_Semestre_Programa asp on asp.Id_Semestre_Programa=amd.Id_Semestre_Programa
inner join (select ah.Id_Horario,Tn.Codigo,hd.Periodo,
              (CASE WHEN (SUBSTR(hd.Hora_Inicio,0,2))::numeric <6 AND hd.Id_Tipo_Turno=1
                  then (SUBSTR(hd.Hora_Inicio,0,2))::numeric +12||SUBSTR(Hora_Inicio,-3)
                when (SUBSTR(hd.Hora_Inicio,0,2))::numeric <12 AND hd.Id_Tipo_Turno>1  
                  then (SUBSTR(hd.Hora_Inicio,0,2))::numeric +12||SUBSTR(hd.Hora_Inicio,-3)
                else hd.Hora_Inicio 
                end) Hora_Inicio, hd.PARTICION
            from acad_horario ah 
            inner join(select Id_Horario,row_number() OVER (
                                Partition BY Id_Horario
                                ORDER BY Id_Tipo_Turno,Periodo
                                ) PARTICION ,Id_Tipo_Turno,Periodo,Hora_Inicio
                        from Acad_Horario_Detalle) hd 
                        on hd.Id_Horario=ah.Id_Horario
            inner join tipo_turno tn on Tn.Id_Tipo_Turno=hd.Id_Tipo_Turno ) hi 
        ON hi.Id_Horario=asp.Id_Horario 
            and hi.Codigo=substr(DIA_HORA_CURSO3(HORARIO,asp.id_horario),position(ds.codigo in DIA_HORA_CURSO3(HORARIO,asp.id_horario))+1,1) 
            and hi.Periodo=substr(DIA_HORA_CURSO3(HORARIO,asp.id_horario),position(ds.codigo in DIA_HORA_CURSO3(HORARIO,asp.id_horario))+2,1)
inner join (select ah.Id_Horario,
                    (CASE WHEN (SUBSTR(hd.hora_fin,0,2))::numeric <6 AND hd.Id_Tipo_Turno=1 
                        then (SUBSTR(hd.hora_fin,0,2))::numeric +12||SUBSTR(hd.hora_fin,-3)
                      when (SUBSTR(hd.hora_fin,0,2))::numeric <12 AND hd.Id_Tipo_Turno>1 
                        then (SUBSTR(hd.hora_fin,0,2))::numeric +12||SUBSTR(hd.hora_fin,-3)
                      else hd.hora_fin 
                      end) Hora_fin, hd.PARTICION
            from acad_horario ah 
            inner join(select Id_Horario,row_number() OVER (
                                Partition BY Id_Horario
                                ORDER BY Id_Tipo_Turno,Periodo
                                ) PARTICION ,Id_Tipo_Turno,Periodo,Hora_fin
                        from Acad_Horario_Detalle) hd 
                        on hd.Id_Horario=ah.Id_Horario
            inner join tipo_turno tn on Tn.Id_Tipo_Turno=hd.Id_Tipo_Turno ) hf
        ON hf.Id_Horario=asp.Id_Horario
            and hf.PARTICION=hi.PARTICION+ft_HORA_CURSO_N(HORARIO,Ds.Dia)-1
--where accd.id_carga_curso in (162806)
;

