-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_periodo_letivo_superior_div (id_aluno, id_curso, id_escola, id_niveis_ensino, id_modalidade_ensino, id_turno, dtmatricula, dtfim, anoletivo, semestreano, anio) AS select distinct aac.Id_Persona id_aluno,aac.Id_Escuela id_Curso,aac.Id_Facultad id_Escola,aac.Id_Nivel_Ensenanza id_Niveis_Ensino,
aac.Id_Modalidad_Estudio id_Modalidade_Ensino,ahd.Id_Tipo_Turno id_Turno,
coalesce(aac.Fecha_Actualizacion,aac.Fecha_Registro) dtMatricula,ff.fecha_fin dtFim,ceil(aac.Ciclo/2) AnoLetivo,
aac.Semestre SemestreAno,substr(aac.semestre,0,4) anio
FROM Vw_Acad_Alumno_Contrato aac inner join Vw_Acad_Programa_Estudio ape on ape.Id_Programa_Estudio=aac.id_programa_estudio
inner join Acad_Semestre_Programa asp on Asp.Id_Programa_Estudio=ape.Id_Programa_Estudio and Asp.Id_Semestre=aac.Id_Semestre
inner join(select id_semestre_programa,max(fecha_fin) fecha_fin from acad_modulo_detalle group by id_semestre_programa) ff on ff.id_semestre_programa=Asp.Id_Semestre_Programa
inner join Acad_Horario ah on Ah.Id_Horario=Asp.Id_Horario
inner join(select id_horario,Id_Tipo_Turno from Acad_Horario_Detalle group by id_horario,Id_Tipo_Turno) ahd on ahd.Id_Horario=Ah.Id_Horario
where aac.estado='1' and aac.id_modo_contrato=1
and ape.id_nivel_ensenanza in (1,2) and ape.Id_Facultad not in (676,777,150,673,309,308) and ape.estado='1'
and ape.Id_Escuela not in (228,234,255,253,164,419,179,181,196,197,188,189,190,191,192,193,194,195,180,236,235,232,204,168,169,166,165,219)
and ape.Id_Tipo_Contrato in (1,2,3,4) and ape.Id_Modalidad_Estudio not in (3)
and ape.Nombre_Certificado not like 'Unidad de Posgrado%' 
order by aac.Id_Persona ,aac.Id_Facultad,aac.Id_Escuela,ahd.Id_Tipo_Turno;

