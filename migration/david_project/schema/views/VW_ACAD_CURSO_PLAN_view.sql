-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_acad_curso_plan (id_plan, nombre_plan, id_parent, nombre_area_padre, id_area, nombre_area, escuela_profesional, id_area_estudio, area_estudio, codigo, nivel, id_curso, id_curso_detalle, curso, estado_curso, ciclo, credito, hp, ht, hnp, ct, cp, id_plan_curso_electivo, id_plan_curso, nota_aprobatoria, id_tipo_curso, codigo_curso, estado, modo) AS select ap.id_plan,ap.nombre nombre_plan,
coalesce(CASE WHEN op.id_parent=8 THEN 8  ELSE null END , op.id_area) id_parent, CASE WHEN CASE WHEN op.id_parent=8 THEN 8  ELSE null coalesce(END::text, '') = '' THEN op.nombre  ELSE opp.nombre END  nombre_area_padre,
oa.id_area, oa.nombre nombre_area,coalesce(nep.Nombre,oa.Nombre) escuela_profesional,
aae.id_area_estudio,aae.nombre area_estudio, aae.codigo, 
CASE WHEN coalesce(apc.Id_Plan_Curso_Electivo::text, '') = '' THEN 0  ELSE 1 END  nivel,ac.id_curso,acd.id_curso_detalle,CASE WHEN coalesce(apc.Id_Plan_Curso_Electivo::text, '') = '' THEN ''  ELSE ace.nombre||' ' END ||ac.nombre curso,ac.estado estado_curso,
apc.ciclo, acd.credito, acd.hp, acd.ht, acd.hnp,acd.ct, acd.cp, apc.Id_Plan_Curso_Electivo, apc.Id_Plan_Curso, ap.nota_aprobatoria, apc.id_tipo_curso,apc.codigo codigo_curso,
apc.estado,apc.modo
FROM acad_plan ap inner join acad_plan_curso apc on apc.id_plan=ap.id_plan
inner join acad_curso_detalle acd on acd.id_curso_detalle=apc.id_curso_detalle
inner join acad_curso ac on ac.id_curso=acd.id_curso
inner join acad_area_estudio aae on aae.id_area_estudio=ac.id_area_estudio
inner join eliseo.org_area oa on oa.id_area=ap.id_area
left join eliseo.org_escuela_profesional ep on Ep.Id_Area=oa.Id_Area
left join eliseo.org_area nep on nep.Id_Area=Ep.Id_Ep
left join eliseo.org_area op on op.id_area=oa.id_parent
left join eliseo.org_area opp on opp.Id_Area=CASE WHEN op.id_parent=8 THEN 8  ELSE null END 

left join acad_plan_curso apce on apce.id_plan_curso=apc.Id_Plan_Curso_Electivo
left join acad_curso_detalle acde on acde.id_curso_detalle=apce.id_curso_detalle
left join acad_curso ace on ace.id_curso=acde.id_curso

--where ap.id_plan in (4,5)
order by apc.ciclo,
CASE WHEN coalesce(apc.Id_Plan_Curso_Electivo::text, '') = '' THEN apc.Id_Plan_Curso  ELSE apc.Id_Plan_Curso_Electivo END ,
CASE WHEN coalesce(apc.Id_Plan_Curso_Electivo::text, '') = '' THEN 1  ELSE 0 END  desc,ac.nombre;

