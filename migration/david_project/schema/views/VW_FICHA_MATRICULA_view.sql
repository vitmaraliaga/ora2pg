-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_ficha_matricula (id_alumno, id_tipo_condicion, tipo_movimiento, tipo_condicion, nota, id_programa_estudio_plan, id_programa_estudio, total_horas, id_carga_curso, id_curso_alumno, nombre_curso, nombre_docente, credito, ht, hp, ciclo, hnp, grupo, id_curso_detalle, id_semestre, label_estado, label_condicion, id_persona, estado, nombre_docente_practica, horario_practica, nombre_practica, codigo_practica, fecha_inicio_p, fecha_fin_p, id_modulo_p, id_formato_modulo_p, ciclo_p, nombre_p, id_carga_curso_docente, nombre_escuela, estado_curso) AS select distinct
aca.ID_PERSONA  AS id_alumno,
aca.ID_TIPO_CONDICION ,
coalesce(Tmv.Nombre,'Regular') tipo_movimiento,
tcc.NOMBRE AS tipo_condicion,
aca.promedio AS nota,
app.ID_PROGRAMA_ESTUDIO ,
asp.ID_PROGRAMA_ESTUDIO,
(acd.hp + acd.ht + acd.hnp) AS total_horas,
                    acc.id_carga_curso,aca.Id_Curso_Alumno,ac.nombre nombre_curso,DAVID.ft_profesor_teoria(aca.Id_Carga_Curso) nombre_docente,
                    acd.credito, acd.ht, acd.hp,apc.ciclo, acd.hnp,coalesce(acc.grupo,'Único') grupo,aca.id_curso_detalle,
               		asm.ID_SEMESTRE ,
                    CASE WHEN aca.estado='1' THEN 'Matriculado' WHEN aca.estado='M' THEN 'Confirmado' WHEN aca.estado='0' THEN 'En proceso' WHEN aca.estado='3' THEN 'Retirado' WHEN aca.estado='4' THEN  'Retirado por variación' END  as label_estado,
                    tcc.NOMBRE AS label_condicion,
                    p.id_persona,aca.estado,
                    trim(both P.Paterno||' '||P.Materno||' '||P.Nombre) nombre_docente_practica,accd.horario horario_practica,
                    th.Nombre nombre_practica, th.Codigo codigo_practica,amd.Fecha_Inicio fecha_inicio_p, amd.Fecha_Inicio fecha_fin_p,
                    am.id_modulo id_modulo_p,am.Id_Tipo_Formato_Modulo id_formato_modulo_p,
                    amd.ciclo ciclo_p,Am.nombre nombre_p, Accd.Id_Carga_Curso_Docente, vape.Nombre_Escuela, aca.estado as ESTADO_CURSO
                    FROM DAVID.Acad_Alumno_Contrato_Curso aacc
                    inner join DAVID.acad_curso_alumno aca on aca.Id_Curso_Alumno=aacc.Id_Curso_Alumno
                    inner join DAVID.acad_carga_curso acc on acc.id_carga_curso=aca.id_carga_curso
                    INNER JOIN DAVID.TIPO_CONDICION tcc ON tcc.ID_TIPO_CONDICION = aca.ID_TIPO_CONDICION 
                    left join DAVID.Acad_Carga_Curso_Docente accd on Accd.Id_Carga_Curso_Docente=aca.Id_Horario_Practica
                    left join DAVID.Acad_Modulo_Detalle amd on amd.Id_Modulo_Detalle=accd.Id_Modulo_Detalle
                    left join DAVID.Acad_Modulo am on Am.Id_Modulo=amd.Id_Modulo
                    inner join DAVID.acad_curso_detalle acd on acd.id_curso_detalle=aca.id_curso_detalle
                    inner join DAVID.acad_curso ac on ac.id_curso=acd.id_curso
                    left join DAVID.Acad_Plan_Programa app on app.Id_Plan_Programa=aca.Id_Plan_Programa
                    left join DAVID.Acad_Plan_Curso apc on Apc.Id_Plan=app.Id_Plan and Apc.Id_Curso_Detalle=aca.Id_Curso_Detalle
                    left join DAVID.tipo_horario th on th.Id_Tipo_Horario=Accd.Id_Tipo_Horario
                    left join moises.persona p on p.id_persona=Accd.Id_persona
                    inner join DAVID.acad_semestre_programa asp on asp.Id_Semestre_Programa=Acc.Id_Semestre_Programa
                    inner join DAVID.acad_semestre asm on asm.id_semestre=asp.id_semestre
                    inner join DAVID.vw_acad_programa_estudio vape on vape.Id_Programa_Estudio=asp.Id_Programa_Estudio
                 
                    left join DAVID.Tipo_Movimiento_Var tmv on Tmv.Id_Tipo_Movimiento_Var=aacc.Id_Tipo_Movimiento_Var
                    WHERE  aca.id_tipo_condicion IN (1,2,3,7,13) AND (aca.estado='1' OR aca.estado='4' OR aca.estado='3');

