-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_persona_grado (id_persona, persona, id_situacion_educativo, nombre, nombre_corto, comentario, vigencia, tipo, condicion, cod_tregistro, orden, codigo_acad, codigo_contrato_familia, abreviatura, cod_academico) AS select distinct p.id_persona,P.Paterno||' '||P.Materno||' '||P.Nombre persona, se.ID_SITUACION_EDUCATIVO,se.NOMBRE,se.NOMBRE_CORTO,se.COMENTARIO,se.VIGENCIA,se.TIPO,se.CONDICION,se.COD_TREGISTRO,se.ORDEN,se.CODIGO_ACAD,se.CODIGO_CONTRATO_FAMILIA,se.ABREVIATURA,se.COD_ACADEMICO
FROM Moises.Persona_informacion_academica ia 
inner join moises.situacion_educativa se on se.id_situacion_educativo = ia.Id_Situacion_Educativa and (se.condicion = 'G' or se.condicion = 'T')
inner join moises.situacion_educativa setr on setr.id_situacion_educativo = se.cod_tregistro
inner join moises.persona p on p.Id_Persona=ia.Id_Persona
where /*ia.id_persona=7472 and*/
 setr.Orden=(select max(setr2.orden) from Moises.Persona_informacion_academica ia2 
                                            inner join moises.situacion_educativa se2 on se2.id_situacion_educativo = Ia2.Id_Situacion_Educativa and (se2.condicion = 'G' or se2.condicion = 'T')
                                            inner join moises.situacion_educativa setr2 on setr2.id_situacion_educativo = se2.cod_tregistro 
                                      where ia2.id_persona=ia.id_persona);

