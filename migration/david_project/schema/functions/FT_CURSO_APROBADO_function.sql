-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION david.ft_curso_aprobado (V_ID_PERSONA integer,V_ID_CURSO_DETALLE integer) RETURNS varchar AS $body$
DECLARE

P_RESULTADO varchar(500);

BEGIN

  SELECT DISTINCT 'S' INTO STRICT P_RESULTADO
  FROM (
  SELECT coalesce(APC.ID_CURSO_DETALLE,ACA.ID_CURSO_DETALLE) ID_CURSO_DETALLE
  FROM ACAD_CURSO_ALUMNO ACA INNER JOIN ACAD_PLAN_PROGRAMA APP
                          ON APP.ID_PLAN_PROGRAMA=ACA.ID_PLAN_PROGRAMA AND (ACA.ID_PLAN_PROGRAMA IS NOT NULL AND ACA.ID_PLAN_PROGRAMA::text <> '')
                          AND ACA.ID_PERSONA=V_ID_PERSONA AND ACA.ID_TIPO_CONDICION=1
  LEFT JOIN ACAD_PLAN_CURSO APC ON APC.ID_PLAN=APP.ID_PLAN AND APC.ID_CURSO_DETALLE=ACA.ID_CURSO_DETALLE 
  
UNION

  SELECT APCE.ID_CURSO_DETALLE
  FROM ACAD_CURSO_ALUMNO ACA INNER JOIN ACAD_PLAN_PROGRAMA APP ON APP.ID_PLAN_PROGRAMA=ACA.ID_PLAN_PROGRAMA
                          AND ACA.ID_PERSONA=V_ID_PERSONA AND ACA.ID_TIPO_CONDICION=1
  LEFT JOIN ACAD_PLAN_CURSO APC ON APC.ID_PLAN=APP.ID_PLAN AND APC.ID_CURSO_DETALLE=ACA.ID_CURSO_DETALLE
  LEFT JOIN ACAD_PLAN_CURSO APCE ON APCE.ID_PLAN_CURSO=APC.ID_PLAN_CURSO_ELECTIVO 
  WHERE (APCE.ID_CURSO_DETALLE IS NOT NULL AND APCE.ID_CURSO_DETALLE::text <> '') 
  
UNION

  SELECT ACA.ID_CURSO_DETALLE
  FROM ACAD_CURSO_ALUMNO ACA WHERE ACA.ID_PERSONA=V_ID_PERSONA AND ACA.ID_TIPO_CONDICION=1 AND coalesce(ID_PLAN_PROGRAMA::text, '') = '' 
  ) APC
  INNER JOIN VW_CURSO_EQUIVALENTE VCE ON VCE.CURSO_EQUIV=APC.ID_CURSO_DETALLE 
  WHERE VCE.ID_CURSO_DETALLE=V_ID_CURSO_DETALLE;

  return  P_RESULTADO;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION david.ft_curso_aprobado (V_ID_PERSONA integer,V_ID_CURSO_DETALLE integer) FROM PUBLIC;

