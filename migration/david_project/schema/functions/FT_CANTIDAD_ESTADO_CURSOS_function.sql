-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION david.ft_cantidad_estado_cursos (v_id_persona integer, v_id_plan_programa integer, v_id_semestre integer, v_tipo text) RETURNS bigint AS $body$
DECLARE

  p_res	  bigint;		


BEGIN
    
    if (v_tipo='SA') then
    
      select count(*) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=1 
        and id_plan_programa=v_id_plan_programa and estado<>'4';

    elsif (v_tipo='SD') then
    
      select count(*)  into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_plan_programa=v_id_plan_programa and estado<>'4';

    elsif (v_tipo='CA') then
    
      select sum(credito) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=1 
        and id_plan_programa=v_id_plan_programa and estado<>'4';

    elsif (v_tipo='CD') then
    
      select sum(credito)  into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_plan_programa=v_id_plan_programa and estado<>'4';

    elsif (v_tipo='CNA') then
    
      select sum(CASE WHEN ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle)='S' THEN 0  ELSE credito END ) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=1 
        and id_plan_programa=v_id_plan_programa and estado<>'4';

    elsif (v_tipo='CND') then
    
      select sum(CASE WHEN ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle)='S' THEN 0  ELSE credito END ) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_plan_programa=v_id_plan_programa and estado<>'4';

    elsif (v_tipo='CRA') then
    
      select sum(CASE WHEN ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle)='S' THEN credito  ELSE 0 END ) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=1 
        and id_plan_programa=v_id_plan_programa and estado<>'4';

    elsif (v_tipo='CRD') then
    
      select sum(CASE WHEN ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle)='S' THEN credito  ELSE 0 END ) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_plan_programa=v_id_plan_programa and estado<>'4';

    elsif (v_tipo='CSD2') then
    
      
      select sum(CASE WHEN ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle)='S' THEN 1  ELSE 0 END ) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_plan_programa=v_id_plan_programa and estado<>'4'
      and ft_cant_cur_veces_repetidos(id_persona, id_plan_curso)=2;

    elsif (v_tipo='CSD3') then
    
      
      select sum(CASE WHEN ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle)='S' THEN 1  ELSE 0 END ) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_plan_programa=v_id_plan_programa and estado<>'4'
      and ft_cant_cur_veces_repetidos(id_persona, id_plan_curso)=3;

    elsif (v_tipo='TC') then    
    
    
      select sum(credito) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre
        and id_plan_programa=v_id_plan_programa and estado<>'4';
        
    elsif (v_tipo='TS') then    
    
    
      select count(*) into STRICT p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre
        and id_plan_programa=v_id_plan_programa and estado<>'4';
      
    end if;


  return p_res;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION david.ft_cantidad_estado_cursos (v_id_persona integer, v_id_plan_programa integer, v_id_semestre integer, v_tipo text) FROM PUBLIC;

