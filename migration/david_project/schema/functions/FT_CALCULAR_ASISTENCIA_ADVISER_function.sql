-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION david.ft_calcular_asistencia_adviser (v_id_carga_curso bigint, v_id_persona bigint) RETURNS varchar AS $body$
DECLARE


    num_asistencia bigint;
    p_res varchar(200);


BEGIN

select sum(CASE WHEN Asd.Id_Tipo_Asistencia=5 THEN 2 WHEN Asd.Id_Tipo_Asistencia=6 THEN 2  ELSE Asd.Id_Tipo_Asistencia END )/count(aa.id_asistencia) into STRICT num_asistencia
from acad_asistencia aa inner join acad_carga_curso_docente accd on Accd.Id_Carga_Curso_Docente=Aa.Id_Carga_Curso_Docente
inner join acad_asistencia_det asd on Asd.Id_Asistencia=Aa.Id_Asistencia
where Accd.Id_Carga_Curso=v_id_carga_curso
and asd.id_persona=v_id_persona;

select (case when num_asistencia=0 or coalesce(num_asistencia::text, '') = '' then 'NO Registrada'
             when num_asistencia>0 and num_asistencia<=1.5 then 'Buena'
             when num_asistencia>1.5 and num_asistencia<=2 then 'Regular'
             when num_asistencia>2 then 'Mala'
             end) into STRICT p_res
;

return p_res;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION david.ft_calcular_asistencia_adviser (v_id_carga_curso bigint, v_id_persona bigint) FROM PUBLIC;

