-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION david.ft_tiene_regular (v_id_persona integer,v_id_plan_programa integer) RETURNS bigint AS $body$
DECLARE

  p_res bigint;
  p_ciclo bigint;

BEGIN

  select coalesce((select max(Ciclo)
              from vw_acad_alumno_contrato where id_persona=v_id_persona and Id_Modo_Contrato=1
              and Id_Plan_Programa=v_id_plan_programa and estado='1'),0) into STRICT p_ciclo 
;

  select CASE WHEN(select count(*)                      from acad_plan_programa app inner join vw_acad_curso_plan acpe on Acpe.Id_Plan=app.id_plan                      where app.id_plan_programa=v_id_plan_programa and acpe.ciclo<=p_ciclo and coalesce(Acpe.Id_Plan_Curso_Electivo::text, '') = ''                      and not Exists (select 1                                      from acad_curso_alumno aca inner join acad_plan_curso acp on Acp.Id_Plan_Curso=Aca.Id_Plan_Curso                                      where aca.id_persona=v_id_persona and aca.Id_Plan_Programa=app.id_plan_programa and acp.ciclo=acpe.ciclo and Aca.Id_Tipo_Condicion in (1,13,17)                                      and CASE WHEN coalesce(Acp.Id_Plan_Curso_Electivo::text, '') = '' THEN Acp.Id_Plan_Curso  ELSE Acp.Id_Plan_Curso_Electivo END =Acpe.Id_Plan_Curso ) )=0 THEN 0  ELSE 1 END  into STRICT p_res
;

  return p_res;
      
end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION david.ft_tiene_regular (v_id_persona integer,v_id_plan_programa integer) FROM PUBLIC;

