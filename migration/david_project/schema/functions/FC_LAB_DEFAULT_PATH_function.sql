-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION david.fc_lab_default_path ( P_COURSE_LOAD_ID DAVID.LAB_OCURRENCIA.ID_CARGA_CURSO%TYPE) RETURNS varchar AS $body$
DECLARE

    PATH          varchar(700);
    PATH_BASE     varchar(700) := '/pages/course-scheduler/';
    OCCURRENCE_ID DAVID.LAB_OCURRENCIA.ID_OCURRENCIA%TYPE;



BEGIN

    IF (P_COURSE_LOAD_ID IS NOT NULL AND P_COURSE_LOAD_ID::text <> '') THEN

        BEGIN
            SELECT A.ID_OCURRENCIA
            INTO STRICT OCCURRENCE_ID
            FROM (SELECT LO.ID_OCURRENCIA
                  FROM DAVID.LAB_OCURRENCIA LO
                  WHERE LO.ID_CARGA_CURSO = P_COURSE_LOAD_ID
                  ORDER BY LO.ID_OCURRENCIA DESC) A LIMIT 1;
        EXCEPTION
            WHEN no_data_found
                THEN
                    OCCURRENCE_ID := NULL;
        END;


        IF (OCCURRENCE_ID IS NOT NULL AND OCCURRENCE_ID::text <> '') THEN
            PATH := PATH_BASE || P_COURSE_LOAD_ID || '/occurrences?occurrenceId=' || OCCURRENCE_ID;
        ELSE
            PATH := PATH_BASE || P_COURSE_LOAD_ID || '/occurrences-add';
        END IF;


    END IF;

    RETURN PATH;
EXCEPTION
    WHEN no_data_found
        THEN
            RAISE NOTICE '%', SQLERRM;
            RETURN NULL;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION david.fc_lab_default_path ( P_COURSE_LOAD_ID DAVID.LAB_OCURRENCIA.ID_CARGA_CURSO%TYPE) FROM PUBLIC;

