-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION david.calc_dia_mat_ant (P_CONTRATO text, P_FECHA timestamp(0)) RETURNS varchar AS $body$
DECLARE

DIA_CONTRATO varchar(3):=0;

BEGIN

    SELECT LPAD(X.CANT,2,0) INTO STRICT DIA_CONTRATO FROM (
    SELECT row_number() OVER () AS CANT, A.FECHA FROM (
        SELECT distinct TO_CHAR(FECHA, 'DD/MM/YYYY') FECHA from AATEMP_ALUMNO_CONTRATO WHERE CODIGO_CONTRATO=P_CONTRATO
        AND ESTADO='1' and (TO_CHAR(FECHA, 'DD/MM/YYYY') IS NOT NULL AND (TO_CHAR(FECHA, 'DD/MM/YYYY'))::text <> '') group by TO_CHAR(FECHA, 'DD/MM/YYYY') ) A  ) X
    WHERE X.FECHA=TO_CHAR(P_FECHA,'DD/MM/YYYY');

    RETURN DIA_CONTRATO;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION david.calc_dia_mat_ant (P_CONTRATO text, P_FECHA timestamp(0)) FROM PUBLIC;

