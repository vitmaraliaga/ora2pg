-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION david.ft_cantidad_cursos_desap (v_id_persona integer, v_id_plan_programa integer) RETURNS bigint AS $body$
DECLARE

  p_res	  bigint;	
  p_area	  bigint;

BEGIN

    select id_escuela into STRICT p_area from Vw_Plan_Programa where Id_Plan_Programa=v_id_plan_programa;

    SELECT Distinct 1 INTO STRICT p_res
    FROM (
          SELECT ACA.NOMBRE_CURSO,ACA.ID_CURSO_DETALLE
          FROM VW_ACAD_CURSO_ALUMNO ACA INNER JOIN ACAD_PLAN_PROGRAMA APP ON APP.ID_PLAN_PROGRAMA=ACA.ID_PLAN_PROGRAMA
                                      AND ACA.ID_PERSONA=v_id_persona AND ACA.ID_TIPO_CONDICION=2
          INNER JOIN ACAD_PLAN AP ON AP.ID_PLAN=APP.ID_PLAN
          INNER JOIN(SELECT APC.CURSO FROM ACAD_PLAN_PROGRAMA APP INNER JOIN ACAD_PLAN AP ON AP.ID_PLAN=APP.ID_PLAN
                      INNER JOIN VW_ACAD_CURSO_PLAN APC ON APC.ID_PLAN=AP.ID_PLAN
                      WHERE ID_PLAN_PROGRAMA=v_id_plan_programa) NC ON NC.CURSO=ACA.NOMBRE_CURSO
          WHERE AP.ID_AREA=p_area
          AND coalesce(coalesce(FT_CURSO_APROBADO_NOM(v_id_persona,ACA.NOMBRE_CURSO),FT_CURSO_APROBADO(v_id_persona,ACA.ID_CURSO_DETALLE)),'N')='N'
          GROUP BY ACA.NOMBRE_CURSO,ACA.ID_CURSO_DETALLE
          HAVING COUNT(*)>=2 ) alias6 
;
    RETURN p_res;

END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION david.ft_cantidad_cursos_desap (v_id_persona integer, v_id_plan_programa integer) FROM PUBLIC;

