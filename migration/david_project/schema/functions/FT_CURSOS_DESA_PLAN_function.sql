-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE FUNCTION david.ft_cursos_desa_plan (p_id_persona integer,p_id_plan_programa integer,p_cantidad integer) RETURNS bigint AS $body$
DECLARE

  p_plan bigint;
  p_num bigint;

BEGIN

  select Id_Plan into STRICT p_plan from Vw_Plan_Programa where id_plan_programa=p_id_plan_programa;

  select count(*) into STRICT p_num
  from ( SELECT Id_Plan_Curso,ciclo,curso, count(*) num
        from (select Distinct acp.id_curso_detalle,acp.Id_Plan_Curso,acp.ciclo,curso,Aca.Promedio,aca.id_tipo_condicion,Acp.Credito
              from acad_plan_programa app inner join Vw_Acad_Curso_Plan acp on Acp.Id_Plan=App.Id_Plan
              inner join acad_curso_alumno aca on aca.id_persona=p_id_persona 
                        and aca.Id_Plan_Curso=CASE WHEN coalesce(acp.Id_Plan_Curso_Electivo::text, '') = '' THEN acp.Id_Plan_Curso  ELSE acp.Id_Plan_Curso_Electivo END 
                        and aca.estado='1' and aca.Id_Tipo_Condicion = 2
              where app.ID_PLAN_PROGRAMA=p_id_plan_programa and coalesce(Acp.Id_Plan_Curso_Electivo::text, '') = '' ) alias4 
          group by Id_Plan_Curso,ciclo,curso) alias5 
    where num>=p_cantidad;

  return p_num;

end;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION david.ft_cursos_desa_plan (p_id_persona integer,p_id_plan_programa integer,p_cantidad integer) FROM PUBLIC;

