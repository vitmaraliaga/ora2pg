-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = david,pk_procedure,public;




CREATE OR REPLACE PROCEDURE david.pk_procedure_sp_student_took_practice ( P_STUDENT_PLAN_ID bigint, P_CURSOR OUT REFCURSOR) AS $body$
DECLARE

        P_RET bigint := 0;
        P_STATUS
              smallint;
        P_MESSAGE
              varchar(200);

BEGIN


        SELECT (CASE
                    WHEN EXISTS (SELECT PA.ID_PPP_ALUMNO
                                FROM DAVID.PPP_ALUMNO PA
                                WHERE PA.ID_ALUMNO_PLAN = P_STUDENT_PLAN_ID
                                  AND PA.CUMPLIO = 1) THEN 1
                    ELSE 0 END)
        INTO STRICT P_RET
;

        IF
            P_RET = 0 THEN
            P_STATUS := 0;
            P_MESSAGE
                :=
                    'Requisito no aprobado, no se cumplió con las prácticas preprofesionales o no fueron registradas.';
        ELSE
            P_STATUS := 1;
            P_MESSAGE
                := 'Requisito aprobado.';
        END IF;

        OPEN P_CURSOR FOR
            SELECT P_STATUS as status, P_MESSAGE as message
;

    EXCEPTION
        WHEN no_data_found THEN
            RAISE NOTICE 'ERROR no_data_found';
        WHEN OTHERS THEN
            RAISE NOTICE 'ERROR: %', SQLERRM;

    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE david.pk_procedure_sp_student_took_practice ( P_STUDENT_PLAN_ID bigint, P_CURSOR OUT REFCURSOR) FROM PUBLIC;
