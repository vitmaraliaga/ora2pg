-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = david,pk_tr_validation,public;




CREATE OR REPLACE PROCEDURE david.pk_tr_validation_sp_has_ppp ( P_STUDENT_PLAN_ID bigint, P_CURSOR OUT REFCURSOR) AS $body$
DECLARE

        P_STATUS  smallint;
        P_MESSAGE text;

BEGIN

        IF (P_STUDENT_PLAN_ID IS NOT NULL AND P_STUDENT_PLAN_ID::text <> '') THEN

            SELECT (CASE
                        WHEN EXISTS (SELECT PA.ID_PPP_ALUMNO
                                    FROM DAVID.PPP_ALUMNO PA
                                    WHERE PA.ID_ALUMNO_PLAN = P_STUDENT_PLAN_ID
                                      AND PA.CUMPLIO = 1) THEN 1
                        ELSE 0 END)
            INTO STRICT P_STATUS
;

            IF P_STATUS = 0 THEN
                P_MESSAGE := 'Aún no hemos recibido el registro de tus prácticas pre profesionales.';
            ELSE
                P_MESSAGE := 'Prácticas pre profesionales registrado.';
            END IF;

            OPEN P_CURSOR FOR
                SELECT P_STATUS as STATUS, P_MESSAGE as MESSAGE
;

        ELSE
            OPEN P_CURSOR FOR
                SELECT 0 as STATUS, 'Plan de estudios requerido para validar.' as MESSAGE
;
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            OPEN P_CURSOR FOR
                SELECT 0 as STATUS, 'Se ha producido un error en la base de datos.' as MESSAGE
;


    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE david.pk_tr_validation_sp_has_ppp ( P_STUDENT_PLAN_ID bigint, P_CURSOR OUT REFCURSOR) FROM PUBLIC;
