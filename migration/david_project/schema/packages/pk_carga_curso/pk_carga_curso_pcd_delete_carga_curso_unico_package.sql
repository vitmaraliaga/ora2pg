-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = david,pk_carga_curso,public;




CREATE OR REPLACE PROCEDURE david.pk_carga_curso_pcd_delete_carga_curso_unico (p_id_carga_curso integer, out CURSOR REFCURSOR) AS $body$
DECLARE


      v_num integer:=0;
      resultado exception;
      l_contar bigint:=0;
      l_error varchar(200);

      
BEGIN 
        l_error:= '';

        select count(id_alumno_contrato_curso) into STRICT v_num
        from acad_alumno_contrato_curso aacc inner join acad_curso_alumno aaca
        on aaca.id_curso_alumno=aacc.id_curso_alumno
        and aaca.id_carga_curso=p_id_carga_curso;

        if (v_num=0) then
        
          delete FROM acad_curso_alumno where id_carga_curso=p_id_carga_curso;
          delete FROM acad_carga_curso_det where id_carga_curso=p_id_carga_curso;
          delete FROM acad_carga_curso_docente where id_carga_curso=p_id_carga_curso;
          delete FROM acad_carga_curso where id_carga_curso=p_id_carga_curso;

          l_contar :=1;

        else
        
          l_contar :=0;
          l_error :='Existen alumnos confirmaron la matr√≠cula este curso';

        end if;

        open CURSOR FOR
            SELECT l_contar as resultado, l_error as msg_error;

   
   END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE david.pk_carga_curso_pcd_delete_carga_curso_unico (p_id_carga_curso integer, out CURSOR REFCURSOR) FROM PUBLIC;
