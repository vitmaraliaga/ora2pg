-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = david,pk_procedure_doc,public;




CREATE OR REPLACE PROCEDURE david.pk_procedure_doc_sp_student ( P_PERSON_ID bigint, P_CURSOR OUT REFCURSOR) AS $body$
BEGIN


        IF (P_PERSON_ID IS NOT NULL AND P_PERSON_ID::text <> '') THEN

            OPEN P_CURSOR FOR SELECT VPNA.CODIGO                                              AS CODE,
                                     (INITCAP(VPNA.NOMBRE) || ' ' || INITCAP(VPNA.PATERNO) || ' ' ||
                                      INITCAP(VPNA.MATERNO))                                  AS FULL_NAME,
                                     VPNA.SEXO                                                AS GENDER,
                                     (CASE
                                          WHEN (PN.FOTO IS NOT NULL AND PN.FOTO::text <> '') THEN 'lamb-academic/photos/fotodb/' ||
                                                                        REPLACE(PN.FOTO, 'lamb-academic/fotodb/', '') ||
                                                                        '.jpg'
                                          ELSE 'lamb-academic/photos/fotodb/sinfoto.jpg' END) AS PHOTO
                              FROM MOISES.VW_PERSONA_NATURAL_ALUMNO VPNA
                                       INNER JOIN MOISES.PERSONA_NATURAL PN ON VPNA.ID_PERSONA = PN.ID_PERSONA
                              WHERE VPNA.ID_PERSONA = P_PERSON_ID;
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            RAISE NOTICE 'ERROR: %', SQLERRM;

    END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE david.pk_procedure_doc_sp_student ( P_PERSON_ID bigint, P_CURSOR OUT REFCURSOR) FROM PUBLIC;
