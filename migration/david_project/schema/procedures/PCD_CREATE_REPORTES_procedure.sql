-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE david.pcd_create_reportes (v_id_persona integer) AS $body$
BEGIN

  insert into aatemp_reportar
  SELECT Aac.Codigo,Aac.Paterno||' '||Aac.Materno||' '||nombre as estudiante, Aac.Sede,Aac.Nombre_Facultad,Aac.Nombre_Escuela,
  coalesce(ft_calcular_ciclo_programa('2022-1',aac.id_persona,aac.id_plan_programa)+1,1) Ciclo, Aac.Celular,Aac.Correo,'NO' Ingresante,
  coalesce((SELECT distinct 'MATRICULADO' from Vw_Acad_Alumno_Contrato where id_persona=aac.id_persona and id_plan_programa=Aac.Id_Plan_Programa and id_semestre=181 and estado='1' and id_modo_contrato=1),'NO MATRICULADO') estado,
  ft_deuda_alumno(aac.id_persona,2022) deuda
  from Vw_Acad_Alumno_Contrato aac
  where id_semestre=175 and estado='1' and id_modo_contrato=1 and Aac.Id_Nivel_Ensenanza=1
  
union

  select Pa.Codigo,Pa.Apellido_Nombre,App.Sede,App.Nom_Facultad,App.Nom_Escuela,
  coalesce(ft_calcular_ciclo_programa('2022-1',pa.id_persona,app.id_plan_programa)+1,1),Pa.Celular,Pa.Correo,'SI' ingresante, 
  coalesce((select distinct 'MATRICULADO' from Vw_Acad_Alumno_Contrato where id_persona=pa.id_persona and id_plan_programa=app.Id_Plan_Programa and id_semestre=181 and estado='1' and id_modo_contrato=1),'NO MATRICULADO') estado,
  ft_deuda_alumno(pa.id_persona,2022) deuda
  from Vw_Alumno_Plan_Programa app 
  inner join vw_persona_alumno pa on Pa.Id_Persona=App.Id_Persona 
  where App.Nombre_Plan like '2022%';

  commit;

end;
$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON PROCEDURE david.pcd_create_reportes (v_id_persona integer) FROM PUBLIC;

