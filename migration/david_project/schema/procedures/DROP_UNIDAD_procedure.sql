-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE david.drop_unidad ( V_ID_CARGA_UNIDAD bigint ) AS $body$
BEGIN
  DELETE FROM acad_plan_clase_evaluacion WHERE id_plan_clase_evaluacion in (
            SELECT id_plan_clase_evaluacion from acad_plan_clase_evaluacion
            where id_plan_clase_evidencia in (
                SELECT id_plan_clase_evidencia
                from
                 acad_plan_clase_evidencia where id_plan_clase_resultado in (
                select id_plan_clase_resultado from
                acad_plan_clase_resultado apc
                inner join david.acad_carga_tema ct on ct.id_Carga_tema=apc.id_carga_tema
                INNER JOIN david.acad_carga_unidad  acu ON acu.ID_CARGA_UNIDAD = ct.ID_CARGA_UNIDAD
                where  acu.ID_CARGA_UNIDAD=V_ID_CARGA_UNIDAD)
                ) 
            );




 DELETE FROM ACAD_PLAN_CLASE_RECURSO WHERE id_plan_clase_recurso in (

    SELECT id_plan_clase_recurso from ACAD_PLAN_CLASE_RECURSO where id_plan_clase_resultado in (
    SELECT id_plan_clase_resultado from
    acad_plan_clase_resultado apc
    inner join david.acad_carga_tema ct on ct.id_Carga_tema=apc.id_carga_tema
     INNER JOIN david.acad_carga_unidad  acu ON acu.ID_CARGA_UNIDAD = ct.ID_CARGA_UNIDAD
                where  acu.ID_CARGA_UNIDAD=V_ID_CARGA_UNIDAD
       ) 
    );


        DELETE FROM ACAD_PLAN_CLASE_ACTIVIDAD WHERE id_plan_clase_actividad in (

            SELECT id_plan_clase_actividad from ACAD_PLAN_CLASE_ACTIVIDAD where id_plan_clase_resultado in (
            SELECT id_plan_clase_resultado from
            acad_plan_clase_resultado apc
            inner join david.acad_carga_tema ct on ct.id_Carga_tema=apc.id_carga_tema
             INNER JOIN david.acad_carga_unidad  acu ON acu.ID_CARGA_UNIDAD = ct.ID_CARGA_UNIDAD
                where  acu.ID_CARGA_UNIDAD=V_ID_CARGA_UNIDAD
          )
            );


    DELETE FROM acad_plan_clase_evidencia WHERE id_plan_clase_evidencia in (

            SELECT id_plan_clase_evidencia from acad_plan_clase_evidencia where id_plan_clase_resultado in (
            SELECT id_plan_clase_resultado from
            acad_plan_clase_resultado apc
            inner join david.acad_carga_tema ct on ct.id_Carga_tema=apc.id_carga_tema
             INNER JOIN david.acad_carga_unidad  acu ON acu.ID_CARGA_UNIDAD = ct.ID_CARGA_UNIDAD
                where  acu.ID_CARGA_UNIDAD=V_ID_CARGA_UNIDAD
             )
            );


DELETE FROM acad_plan_clase_resultado WHERE id_plan_clase_resultado in (
            SELECT id_plan_clase_resultado from
            acad_plan_clase_resultado apc
            inner join david.acad_carga_tema ct on ct.id_Carga_tema=apc.id_carga_tema
             INNER JOIN david.acad_carga_unidad  acu ON acu.ID_CARGA_UNIDAD = ct.ID_CARGA_UNIDAD
                where  acu.ID_CARGA_UNIDAD=V_ID_CARGA_UNIDAD
             );

  DELETE FROM acad_plan_clase_resultado WHERE id_plan_clase_resultado in (
            SELECT id_plan_clase_resultado from
            acad_plan_clase_resultado apc
            inner join david.acad_carga_tema ct on ct.id_Carga_tema=apc.id_carga_tema
             INNER JOIN david.acad_carga_unidad  acu ON acu.ID_CARGA_UNIDAD = ct.ID_CARGA_UNIDAD
                where  acu.ID_CARGA_UNIDAD=V_ID_CARGA_UNIDAD);

 DELETE FROM acad_carga_plan_tarea WHERE id_plan_tarea in (
    SELECT id_plan_tarea from
    acad_carga_plan_tarea apc
    inner join david.acad_carga_tema ct on ct.id_Carga_tema=apc.id_carga_tema
     INNER JOIN david.acad_carga_unidad  acu ON acu.ID_CARGA_UNIDAD = ct.ID_CARGA_UNIDAD
                where  acu.ID_CARGA_UNIDAD=V_ID_CARGA_UNIDAD);


 DELETE FROM acad_carga_plan_classroom WHERE id_plan_classroom in (
    SELECT id_plan_classroom from
    acad_carga_plan_classroom apc
    inner join david.acad_carga_tema ct on ct.id_Carga_tema=apc.id_carga_tema
     INNER JOIN david.acad_carga_unidad  acu ON acu.ID_CARGA_UNIDAD = ct.ID_CARGA_UNIDAD
                where  acu.ID_CARGA_UNIDAD=V_ID_CARGA_UNIDAD);

DELETE FROM ACAD_CURSO_METODOLOGIA
WHERE ID_CARGA_UNIDAD  = v_id_carga_unidad;

 DELETE FROM acad_carga_plan_clase WHERE id_plan_clase in (
    SELECT id_plan_clase from
    acad_carga_plan_clase apc
    inner join david.acad_carga_tema ct on ct.id_Carga_tema=apc.id_carga_tema
     INNER JOIN david.acad_carga_unidad  acu ON acu.ID_CARGA_UNIDAD = ct.ID_CARGA_UNIDAD
                where  acu.ID_CARGA_UNIDAD=V_ID_CARGA_UNIDAD);


               
DELETE FROM ACAD_CURSO_METODOLOGIA
WHERE id_curso_metodologia IN (
SELECT id_curso_metodologia FROM ACAD_CURSO_METODOLOGIA cc
INNER JOIN ACAD_CARGA_TEMA act ON act.ID_CARGA_TEMA = cc.ID_CARGA_TEMA 
WHERE act.ID_CARGA_UNIDAD =v_id_carga_unidad);

  DELETE FROM ACAD_CARGA_TEMA  WHERE id_carga_unidad=v_id_carga_unidad;

  DELETE FROM ACAD_CARGA_EVALUACION where ID_CARGA_EVALUACION  IN (
   SELECT ID_CARGA_EVALUACION
   FROM david.ACAD_CARGA_EVALUACION ace
	WHERE ace.ID_EVIDENCIA_RESULTADO IN ( 
	SELECT ID_EVIDENCIA_RESULTADO 
	FROM david.SILABO_EVIDENCIA_RESULTADO ser 
	WHERE ID_CARGA_UNIDAD = v_id_carga_unidad
   ) 
) 
;

 DELETE FROM SILABO_EVIDENCIA_RESULTADO WHERE ID_CARGA_UNIDAD =v_id_carga_unidad;

 DELETE FROM ACAD_CARGA_CURSO_TAREA WHERE ID_CARGA_CURSO_TAREA in (
        SELECT ID_CARGA_CURSO_TAREA from
        ACAD_CARGA_CURSO_TAREA ct
        inner join acad_carga_unidad cu2 on cu2.id_carga_unidad=ct.id_carga_unidad
        where cu2.id_carga_unidad=v_id_Carga_unidad);


DELETE FROM ACAD_CARGA_INSTRUMENTO WHERE ID_CARGA_INSTRUMENTO in (
            SELECT ID_CARGA_INSTRUMENTO from
            ACAD_CARGA_INSTRUMENTO aci
            inner join ACAD_CARGA_UNID_RA_EV rev  on rev.ID_CARGA_UNID_RA_EV=aci.ID_CARGA_UNID_RA_EV
            inner join acad_carga_unidad_ra raa2 on rev.id_carga_unidad_ra = raa2.id_carga_unidad_ra
            inner join acad_carga_unidad cu2 on cu2.id_carga_unidad=raa2.id_carga_unidad
            where cu2.ID_CARGA_UNIDAD =v_id_carga_unidad);


 DELETE FROM ACAD_CARGA_UNID_RA_EV WHERE ID_CARGA_UNID_RA_EV in (
            SELECT ID_CARGA_UNID_RA_EV from
            ACAD_CARGA_UNID_RA_EV rev
            inner join acad_carga_unidad_ra raa2 on rev.id_carga_unidad_ra = raa2.id_carga_unidad_ra
            inner join acad_carga_unidad cu2 on cu2.id_carga_unidad=raa2.id_carga_unidad
            where cu2.id_carga_unidad=v_id_carga_unidad);


 DELETE FROM ACAD_CARGA_UNIDAD_RA WHERE id_carga_unidad_ra in (
            SELECT id_Carga_unidad_ra from acad_carga_unidad_ra raa2 inner join
            acad_carga_unidad cu2 on cu2.id_carga_unidad=raa2.id_carga_unidad
            where cu2.id_carga_unidad=v_id_carga_unidad);

   DELETE FROM ACAD_CARGA_UNIDAD WHERE id_carga_unidad= v_id_carga_unidad;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE david.drop_unidad ( V_ID_CARGA_UNIDAD bigint ) FROM PUBLIC;

