-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE david.proc_lab_eliminar_ocurrencia (P_OCCURRENCE_ID DAVID.LAB_OCURRENCIA.ID_OCURRENCIA%TYPE) AS $body$
BEGIN
    --- LAB_CONSENT_OCURRENCIA
    DELETE
    FROM DAVID.LAB_ARCHIVO A2
    WHERE A2.ID_CONSENT_OCURRENCIA IN (SELECT LCO.ID_CONSENT_OCURRENCIA
                                       FROM DAVID.LAB_CONSENT_OCURRENCIA LCO
                                       WHERE LCO.ID_OCURRENCIA = P_OCCURRENCE_ID);
    DELETE
    FROM DAVID.LAB_CONSENT_OCURR_PERSONA P
    WHERE P.ID_CONSENT_OCURRENCIA IN (SELECT LCO.ID_CONSENT_OCURRENCIA
                                      FROM DAVID.LAB_CONSENT_OCURRENCIA LCO
                                      WHERE LCO.ID_OCURRENCIA = P_OCCURRENCE_ID);
    DELETE
    FROM DAVID.LAB_CONSENT_OCURRENCIA LCO
    WHERE LCO.ID_OCURRENCIA = P_OCCURRENCE_ID;

    --- LAB_INCIDENCIA_OCURRENCIA
    DELETE
    FROM DAVID.LAB_INCIDENCIA_OCURRENCIA LIO
    WHERE LIO.ID_OCURRENCIA = P_OCCURRENCE_ID;

    --- LAB_INCIDENCIA_PROGRAMACION
    DELETE
    FROM DAVID.LAB_INCIDENCIA_REQUISITO LIR
    WHERE LIR.ID_INCIDENCIA_PROGRAMACION IN (SELECT LIP.ID_INCIDENCIA_PROGRAMACION
                                             FROM DAVID.LAB_INCIDENCIA_PROGRAMACION LIP
                                             WHERE LIP.ID_OCURRENCIA = P_OCCURRENCE_ID);
    DELETE
    FROM DAVID.LAB_INCIDENCIA_REGLA LIR
    WHERE LIR.ID_INCIDENCIA_PROGRAMACION IN (SELECT LIP.ID_INCIDENCIA_PROGRAMACION
                                             FROM DAVID.LAB_INCIDENCIA_PROGRAMACION LIP
                                             WHERE LIP.ID_OCURRENCIA = P_OCCURRENCE_ID);

    DELETE
    FROM DAVID.LAB_INCIDENCIA_CONTROL_REQ LICR
    WHERE LICR.ID_INCIDENCIA_CONTROL IN (SELECT LIC.ID_INCIDENCIA_CONTROL
                                         FROM DAVID.LAB_INCIDENCIA_CONTROL LIC
                                         WHERE LIC.ID_INCIDENCIA_PROGRAMACION IN (SELECT LIP.ID_INCIDENCIA_PROGRAMACION
                                                                                  FROM DAVID.LAB_INCIDENCIA_PROGRAMACION LIP
                                                                                  WHERE LIP.ID_OCURRENCIA = P_OCCURRENCE_ID) );
    DELETE
    FROM DAVID.LAB_INCIDENCIA_CONTROL LIC
    WHERE LIC.ID_INCIDENCIA_PROGRAMACION IN (SELECT LIP.ID_INCIDENCIA_PROGRAMACION
                                             FROM DAVID.LAB_INCIDENCIA_PROGRAMACION LIP
                                             WHERE LIP.ID_OCURRENCIA = P_OCCURRENCE_ID);

    DELETE
    FROM DAVID.LAB_INCIDENCIA_PROGRAMACION LIP
    WHERE LIP.ID_OCURRENCIA = P_OCCURRENCE_ID;


    --- LAB_REGLA
    DELETE
    FROM DAVID.LAB_CONTROL_REGLA LCR
    WHERE LCR.ID_REGLA IN (SELECT LR.ID_REGLA
                           FROM LAB_REGLA LR
                           WHERE LR.ID_OCURRENCIA = P_OCCURRENCE_ID);
    DELETE
    FROM LAB_REGLA LR
    WHERE LR.ID_OCURRENCIA = P_OCCURRENCE_ID;

    --- LAB_CONTROL_OCURRENCIA
    DELETE
    FROM DAVID.LAB_CONTROL_OCURRENCIA LCO
    WHERE LCO.ID_OCURRENCIA = P_OCCURRENCE_ID;

    DELETE
    FROM DAVID.LAB_CONTROL_PERSONA LCP
    WHERE LCP.ID_CONTROL_OCURRENCIA IN (SELECT LCO.ID_CONTROL_OCURRENCIA
                                        FROM DAVID.LAB_CONTROL_OCURRENCIA LCO
                                        WHERE LCO.ID_OCURRENCIA = P_OCCURRENCE_ID);

    --- LAB_OCURRENCIA
    DELETE
    FROM DAVID.LAB_OCURRENCIA LO
    WHERE LO.ID_OCURRENCIA = P_OCCURRENCE_ID;


END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE david.proc_lab_eliminar_ocurrencia (P_OCCURRENCE_ID DAVID.LAB_OCURRENCIA.ID_OCURRENCIA%TYPE) FROM PUBLIC;

