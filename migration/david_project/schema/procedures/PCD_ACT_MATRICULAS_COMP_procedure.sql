-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE david.pcd_act_matriculas_comp () AS $body$
BEGIN
  EXECUTE 'truncate table aatemp_matriculas_verificar';
    commit;
  insert into aatemp_matriculas_verificar
  SELECT distinct aac.id_persona,semestre,id_sede,id_escuela,id_programa_estudio
  from Vw_Acad_Alumno_Contrato aac inner join Vw_Persona_Alumno pa on pa.id_persona=aac.id_persona
  where aac.semestre>='2007-1' and estado='1' and Aac.Id_tipo_contrato in (1,2);
  commit;

  delete FROM aatemp_matriculas_verificar where semestre in (SELECT semestre from acad_semestre where ESTADO_ADVISER=1);
  commit;

  delete FROM aatemp_matriculas_verificar where semestre like '%V%';

  delete FROM aatemp_matriculas_verificar where (semestre,id_persona,id_escuela)  
  not in (SELECT max(semestre),id_persona,id_escuela FROM aatemp_matriculas_verificar group by id_persona,id_escuela);
  commit;

  delete FROM aatemp_matriculas_verificar where (id_persona,id_escuela)  
  not in (SELECT id_persona,id_escuela FROM moises.persona_natural_egresado pne inner join Vw_Plan_Programa vpp on Vpp.Id_Plan_Programa=pne.id_plan_programa);
  commit;


end;
$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON PROCEDURE david.pcd_act_matriculas_comp () FROM PUBLIC;

