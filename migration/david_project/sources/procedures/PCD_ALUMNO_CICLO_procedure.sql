-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

procedure       pcd_alumno_ciclo(p_id_semestre integer)
 is
  
  v_num integer :=0;
   --p_id_semestre integer;
    
 begin 
 


    delete aatemp_alumno_ciclo where semestre=(select semestre from acad_semestre where id_semestre=p_id_semestre);
    commit;
    
    insert into aatemp_alumno_ciclo
    select Aac.Id_Persona,Asm.Semestre,Ape.Id_Programa_Estudio,Ape.Nombre_Corto,Pna.Codigo,
    P.Nombre||' '||P.Paterno||' '||P.Materno estudiante,
    nvl(Ft_Calcular_Ciclo(asm.semestre,aac.id_persona,Aac.Id_Nivel_Ensenanza),1) ciclo,
    decode(Ape.Id_Facultad,8,'FACIHED',9,'FIA',10,'FCS',11,'FACTEO',12,'FCE') facultad,
    /*ft_deuda_alumno(aac.id_persona, substr(asm.semestre,0,4))*/
 0 deuda,
    nvl(ft_desaprobado_ciclo(aac.id_persona,asp.id_semestre,Ape.Id_Nivel_Ensenanza),0) SD,
    aac.id_plan_programa,1
    from acad_alumno_contrato aac
    inner join acad_semestre_programa asp on Asp.Id_Semestre_Programa=Aac.Id_Semestre_Programa and aac.estado in ('1')
    and asp.id_semestre=p_id_semestre
    inner join acad_semestre asm on asm.id_semestre=Asp.Id_Semestre
    inner join vw_acad_programa_estudio ape on Ape.Id_Programa_Estudio=Asp.Id_Programa_Estudio
    inner join Acad_Matricula_Detalle amd on Amd.Id_Matricula_Detalle=Aac.Id_Matricula_Detalle and Amd.Id_Modo_Contrato=1
    inner join moises.persona_natural_alumno pna on Pna.Id_Persona=aac.id_persona
    inner join moises.persona_natural pn on Pn.Id_Persona=pna.id_persona
    inner join moises.persona p on P.Id_Persona=pn.id_persona
    where Ape.id_tipo_contrato in (1,2,3,4,5);
    commit;
    
end;

