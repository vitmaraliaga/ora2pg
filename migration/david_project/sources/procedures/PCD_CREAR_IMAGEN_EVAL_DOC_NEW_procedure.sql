-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

procedure       PCD_CREAR_IMAGEN_EVAL_DOC_NEW
(  
	p_id_semestre in varchar2, 
	p_id_sede in varchar2, 
	p_id_nivel_ensenanza in varchar2,
	p_id_persona_reg in varchar2
) AS 
l_semestre varchar2(100);
l_id_reporte_bi_informe number;
begin 
	SELECT 'Reporte del semestre '|| semestre into l_semestre FROM david.ACAD_SEMESTRE WHERE ID_SEMESTRE = p_id_semestre;

	INSERT INTO DAVID.REPORTE_BI_INFORME (ID_SEMESTRE, NOMBRE , ESTADO, ID_USUARIO_REG, FECHA_REGISTRO)
								  VALUES (p_id_semestre, l_semestre, '1', p_id_persona_reg , sysdate);
    commit;
   
   SELECT max(ID_REPORTE_BI_INFORME) into l_id_reporte_bi_informe FROM david.REPORTE_BI_INFORME;
   
   	INSERT INTO david.REPORTE_EVAL_DOC_MES_R 
		(ID_CARGA_CURSO, ID_CARGA_CURSO_DOCENTE, NUM_MES_SEMANA, MES_SEMANA, ID_TIPO_DOCENTE, ID_SEMESTRE, ID_SEDE, ID_NIVEL_ENSENANZA, ID_TIPO_CONTRATO, ID_UNIDAD_ACADEMICA, ID_PROGRAMA_ESTUDIO, CICLO, GRUPO, PROMEDIO_TRABAJOS, PROMEDIO_ENLACES, PROMEDIO_VIDEOS, PROMEDIO_DOCUMENTOS, PROMEDIO_FOROS, PROMEDIO_RECURSOS_PATMOS, PERCEPCION, PROMEDIO_ASISTENCIA, PROMEDIO_NOTAS_SEMANA, PROMEDIO_DESEMPENIO_DOC, BIMESTRE, PROMEDIO_ASISTENCIA_DOCENTE, PROMEDIO_EVAL_DOCENTE_EAP, ESTADO, ID_REPORTE_BI_INFORME)
		SELECT ID_CARGA_CURSO, ID_CARGA_CURSO_DOCENTE, NUM_MES_SEMANA, MES_SEMANA, ID_TIPO_DOCENTE, ID_SEMESTRE, ID_SEDE, ID_NIVEL_ENSENANZA, ID_TIPO_CONTRATO, ID_UNIDAD_ACADEMICA, ID_PROGRAMA_ESTUDIO, CICLO, GRUPO, PROMEDIO_TRABAJOS, PROMEDIO_ENLACES, PROMEDIO_VIDEOS, PROMEDIO_DOCUMENTOS, PROMEDIO_FOROS, PROMEDIO_RECURSOS_PATMOS, PERCEPCION, PROMEDIO_ASISTENCIA, PROMEDIO_NOTAS_SEMANA, PROMEDIO_DESEMPENIO_DOC, BIMESTRE, PROMEDIO_ASISTENCIA_DOCENTE, PROMEDIO_EVAL_DOCENTE_EAP, ESTADO, ID_REPORTE_BI_INFORME 
		FROM (
			SELECT DISTINCT  redm.*, l_id_reporte_bi_informe AS ID_REPORTE_BI_INFORME
			FROM reportbi.REPORTE_EVALUACION_DOC_MES redm
			INNER JOIN david.ACAD_CARGA_CURSO_DOCENTE accd ON redm.ID_CARGA_CURSO_DOCENTE = accd.ID_CARGA_CURSO_DOCENTE
		    INNER JOIN david.VW_ACAD_CARGA_ACADEMICA vaca ON vaca.ID_CARGA_CURSO =accd.ID_CARGA_CURSO  AND origen='O'
		    INNER JOIN moises.persona pe ON pe.ID_PERSONA =accd.ID_PERSONA
		    INNER JOIN DAVID.ACAD_PERSONA_CONTRATO PC on PC.id_semestre = p_id_semestre and pc.id_persona=pe.id_persona
		    inner join david.vw_acad_programa_estudio vape on vape.id_programa_estudio=pc.id_programa_estudio
		    WHERE 
		    PC.id_Semestre=nvl(p_id_semestre,PC.id_semestre)
		    AND vape.ID_SEDE =vape.ID_SEDE 
		    AND vape.id_nivel_ensenanza =nvl(p_id_nivel_ensenanza, vape.ID_NIVEL_ENSENANZA)
	    );
	   
	INSERT INTO REPORTE_EVAL_DOCENTE_R
	    ( ID_CARGA_CURSO, ID_CARGA_CURSO_DOCENTE, SEMANA, ID_TIPO_DOCENTE, ID_SEMESTRE, ID_SEDE, ID_NIVEL_ENSENANZA, ID_TIPO_CONTRATO, ID_UNIDAD_ACADEMICA, ID_PROGRAMA_ESTUDIO, CICLO, GRUPO, N_TRABAJOS_SUBIDOS, N_TRABAJOS_VISTOS, N_TRABAJOSXALUMNOS, N_TRABAJOS_VISXALUMNOS, PROMEDIO_TRABAJOS, N_ENLACES_SUBIDOS, N_ENLACES_VISTOS, N_ENLACESXALUMNOS, N_ENLACES_VISXALUMNOS, PROMEDIO_ENLACES, N_VIDEOS_SUBIDOS, N_VIDEOS_VISTOS, N_VIDEOSXALUMNOS, N_VIDEOS_VISXALUMNOS, PROMEDIO_VIDEOS, N_DOCUMENTOS_SUBIDOS, N_DOCUMENTOS_VISTOS, N_DOCUMENTOSXALUMNOS, N_DOCUMENTOS_VISXALUMNOS, PROMEDIO_DOCUMENTOS, N_FOROS_SUBIDOS, N_FOROS_VISTOS, N_FOROSXALUMNOS, N_FOROS_VISXALUMNOS, PROMEDIO_FOROS, PROMEDIO_RECURSOS_PATMOS, PONDERADO_PERCEPCION, REGISTRADAS_ASISTENCIA, PROGRAMADAS_ASISTENCIA, PROMEDIO_ASISTENCIA, REGISTRADAS_EVALUACION, PROGRAMADAS_EVALUACION, PROMEDIO_NOTAS_SEMANA, MES_SEMANA, NUM_MES_SEMANA, BIMESTRE, PROMEDIO_ASISTENCIA_DOCENTE, PROMEDIO_EVAL_DOCENTE_EAP, ID_REPORTE_BI_INFORME)
	    SELECT ID_CARGA_CURSO, ID_CARGA_CURSO_DOCENTE, SEMANA, ID_TIPO_DOCENTE, ID_SEMESTRE, ID_SEDE, ID_NIVEL_ENSENANZA, ID_TIPO_CONTRATO, ID_UNIDAD_ACADEMICA, ID_PROGRAMA_ESTUDIO, CICLO, GRUPO, N_TRABAJOS_SUBIDOS, N_TRABAJOS_VISTOS, N_TRABAJOSXALUMNOS, N_TRABAJOS_VISXALUMNOS, PROMEDIO_TRABAJOS, N_ENLACES_SUBIDOS, N_ENLACES_VISTOS, N_ENLACESXALUMNOS, N_ENLACES_VISXALUMNOS, PROMEDIO_ENLACES, N_VIDEOS_SUBIDOS, N_VIDEOS_VISTOS, N_VIDEOSXALUMNOS, N_VIDEOS_VISXALUMNOS, PROMEDIO_VIDEOS, N_DOCUMENTOS_SUBIDOS, N_DOCUMENTOS_VISTOS, N_DOCUMENTOSXALUMNOS, N_DOCUMENTOS_VISXALUMNOS, PROMEDIO_DOCUMENTOS, N_FOROS_SUBIDOS, N_FOROS_VISTOS, N_FOROSXALUMNOS, N_FOROS_VISXALUMNOS, PROMEDIO_FOROS, PROMEDIO_RECURSOS_PATMOS, PONDERADO_PERCEPCION, REGISTRADAS_ASISTENCIA, PROGRAMADAS_ASISTENCIA, PROMEDIO_ASISTENCIA, REGISTRADAS_EVALUACION, PROGRAMADAS_EVALUACION, PROMEDIO_NOTAS_SEMANA, MES_SEMANA, NUM_MES_SEMANA, BIMESTRE, PROMEDIO_ASISTENCIA_DOCENTE, PROMEDIO_EVAL_DOCENTE_EAP, ID_REPORTE_BI_INFORME
	    FROM (
			SELECT  DISTINCT redm.* , l_id_reporte_bi_informe AS ID_REPORTE_BI_INFORME
		    FROM REPORTBI.REPORTE_EVALUACION_DOCENTE redm
		    INNER JOIN david.ACAD_SEMESTRE as2 ON as2.ID_SEMESTRE =redm.ID_SEMESTRE
		    INNER JOIN eliseo.org_sede se ON se.id_sede=redm.ID_SEDE
		    INNER JOIN eliseo.ORG_SEDE_AREA osa ON osa.ID_SEDEAREA =redm.ID_UNIDAD_ACADEMICA
		    INNER JOIN david.VW_ACAD_PROGRAMA_ESTUDIO vape ON vape.id_programa_estudio=redm.ID_PROGRAMA_ESTUDIO
		    INNER JOIN david.acad_carga_curso_Docente accd ON accd.ID_CARGA_CURSO_DOCENTE =redm.ID_CARGA_CURSO_DOCENTE
		    INNER JOIN moises.persona pe ON pe.id_persona = accd.ID_PERSONA
		    INNER JOIN david.VW_ACAD_CARGA_ACADEMICA vaca ON vaca.ID_CARGA_CURSO =redm.ID_CARGA_CURSO
		    INNER JOIN ACAD_CURSO_DETALLE acd ON  acd.ID_CURSO_DETALLE = vaca.ID_CURSO_DETALLE 
		    INNER JOIN ACAD_CURSO ac ON ac.ID_CURSO = acd.ID_CURSO
		    WHERE    vaca.ORIGEN ='O' 
		    AND as2.ID_SEMESTRE = nvl(p_id_semestre, as2.id_Semestre)
		    AND vape.ID_SEDE = vape.ID_SEDE
		    --AND vape.id_nivel_ensenanza =nvl(p_id_nivel_ensenanza, vape.ID_NIVEL_ENSENANZA)
	    );
	    
	COMMIT; 

end;

