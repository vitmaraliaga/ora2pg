-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

procedure pcd_act_alc_contr_beca ( val integer) AS  

v_id_semestre integer;

begin 

  SELECT MAX(ID_SEMESTRE) into v_id_semestre
  FROM DAVID.ACAD_SEMESTRE WHERE ESTADO_ADVISER=1;
  
  insert into aatemp_alumno_contrato_beca
    select Distinct *
    from  (select id_persona,(select id_tipo_beca_estatal from acad_alumno_beca where id_persona=aac.id_persona and id_tipo_requisito_beca=33) id_tipo_beca_estatal,id_semestre
            from vw_acad_alumno_contrato aac where tipo_alumno='B18' and id_semestre=v_id_semestre)
    where (id_persona,id_tipo_beca_estatal,id_semestre) not in (select id_persona,id_tipo_beca_estatal,id_semestre from aatemp_alumno_contrato_beca)
    and id_tipo_beca_estatal is not null;

end;

