-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

procedure pcd_cerrar_semestre_prog(p_id_semestre_programa integer)
 is
  
  v_id_programa_estudio integer;
    
 begin 
 
    update Acad_Semestre_Programa set cerrado='S' where id_semestre_programa=p_id_semestre_programa;
    commit;
    
    update acad_carga_curso set cerrado='S' where id_semestre_programa=p_id_semestre_programa;
    commit;    
    
    update acad_curso_alumno aca
    set Promedio=(select Ft_Calcular_Promedio(id_carga_curso,id_persona,id_programa_estudio) from Vw_Acad_Curso_Alumno where Id_Curso_Alumno=aca.Id_Curso_Alumno)
    where Id_Curso_Alumno in (select Id_Curso_Alumno from acad_carga_curso where id_semestre_programa=p_id_semestre_programa and Id_Tipo_Condicion=7 and estado='1');
    commit;
    
    update acad_curso_alumno aca
    set Id_Tipo_Condicion=(case when promedio>=13 then 1 else 2 end )
    where Id_Curso_Alumno in (select Id_Curso_Alumno from acad_carga_curso where id_semestre_programa=p_id_semestre_programa and Id_Tipo_Condicion=7 and estado='1');
    commit;
    
    commit;
    
 end;

