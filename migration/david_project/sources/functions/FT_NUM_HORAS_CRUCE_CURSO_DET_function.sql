-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

FUNCTION ft_num_horas_cruce_curso_det( p_id_carga_curso_docente integer,p_id_semestre integer, p_id_programa_estudio integer, p_ciclo integer, p_grupo varchar2) RETURN varchar2 IS
   horario_t varchar2(4000);
   horario_b varchar2(4000);
   horario_f varchar2(4000);
   horas number(30);
   curso_cruce varchar2(4000);
   cursocruce varchar2(4000);
   cursos_cruce varchar2(4000);
   letra varchar2(1);
   
   cursor curso is     
    select aca.Nombre_Curso||' - '||Th.Nombre curso,
    nvl(Accd.Horario,'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000') horario_t 
    from vw_acad_carga_academica aca inner join acad_carga_curso_docente accd on Accd.Id_Carga_Curso=Aca.Id_Carga_Curso
    inner join Tipo_Horario th on Th.Id_Tipo_Horario=Accd.Id_Tipo_Horario
    where aca.id_semestre=p_id_semestre and Aca.Id_Programa_Estudio=p_id_programa_estudio 
    and Accd.Id_Carga_Curso_docente<>p_id_carga_curso_docente
    and aca.ciclo=p_ciclo and (aca.grupo is null or nvl(aca.grupo,'999')=nvl(p_grupo,'999'));

BEGIN

    select wm_concat(nvl(Accd.Horario,'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000')) into horario_f 
          from vw_acad_carga_academica aca inner join acad_carga_curso_docente accd on Accd.Id_Carga_Curso=Aca.Id_Carga_Curso and aca.origen='O' and Accd.Id_Carga_Curso_docente=p_id_carga_curso_docente;

	 horas := 0;
   curso_cruce :='';

	 FOR curCab in curso LOOP
	 	   for i in 1..134 loop

			   if ( substr(curCab.horario_t,i,1) = '1') and ( substr(horario_f,i,1) = '1') then
            if(curso_cruce=curCab.curso) then
              cursocruce :='';
            else
              curso_cruce :=curCab.curso;
              cursocruce :=','||curCab.curso;
            end if;
            cursos_cruce := cursos_cruce||cursocruce;
			   	  horas := horas + 1;
			   end if;

		   end loop;
       
	 end loop;
   
	 RETURN( cursos_cruce );
END;

