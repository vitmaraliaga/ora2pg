-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

function ft_calcular_likert(
 v_id_ejecucion number, 
 v_id_programa_estudio number, 
 v_valor_respuesta NUMBER, 
 v_id_pregunta NUMBER )
 return number
 
 is

    valor_calculado number;

 

begin
 
	
		SELECT nvl(contador,0) AS contador INTO   valor_calculado
		FROM ( 
		SELECT vaac.sede, 
		vaac.NOMBRE_FACULTAD ,
		vaac.NOMBRE_ESCUELA ,
		iii.TITULO ,
		ii3.TITULO ,
		count(1) AS contador 
		FROM 
		david.INS_PARTICIPANTE ip 
		INNER JOIN david.VW_ACAD_ALUMNO_CONTRATO vaac ON vaac.ID_ALUMNO_CONTRATO = ip.IDENTIFICADOR 
		INNER JOIN lucas.INSTRUMENTO_CUESTIONARIO ic ON ic.ID_CUESTIONARIO = ip.ID_CUESTIONARIO 
		INNER JOIN lucas.INSTRUMENTO_INSTRUMENTO ii2 ON ii2.ID_INSTRUMENTO = ic.ID_INSTRUMENTO 
		INNER JOIN lucas.instrumento_item iii ON iii.ID_INSTRUMENTO = ic.ID_INSTRUMENTO 
		INNER JOIN lucas.INSTRUMENTO_PREGUNTA ip2 ON ip2.ID_ITEM =iii.ID_ITEM 
		INNER JOIN lucas.INSTRUMENTO_RESPUESTA ir ON        ir.ID_CUESTIONARIO = ic.ID_CUESTIONARIO 
		AND ip2.ID_ITEM = ir.ID_PREGUNTA 
		INNER JOIN lucas.INSTRUMENTO_ALTERNATIVA ia ON ia.ID_ITEM = ir.ID_ALTERNATIVA  
		INNER JOIN lucas.instrumento_item ii3 ON ii3.ID_ITEM = ia.ID_ITEM 
		WHERE ip.ID_EJECUCION = v_id_ejecucion AND ir.ID_PREGUNTA =v_id_pregunta
		AND ir.VALOR_RESPUESTA = v_valor_respuesta
		AND vaac.ID_PROGRAMA_ESTUDIO =v_id_programa_estudio
		GROUP BY 
		vaac.sede, 
		vaac.NOMBRE_FACULTAD ,
		vaac.NOMBRE_ESCUELA ,
		iii.TITULO ,
		ii3.TITULO  
		ORDER BY 3,4); 
    return valor_calculado;

end;

