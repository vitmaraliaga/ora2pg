-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

function ft_cant_estado_cursos_ciclo(v_id_persona integer, v_id_nivel_ensenanza integer, v_id_plan_programa integer, v_id_semestre integer, v_tipo varchar2)
RETURN number IS
  p_res	  number;		 

BEGIN
    
    if(v_tipo='CNA') then
      select sum(decode(ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle),'S',0,credito)) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=1 
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';
    elsif(v_tipo='CND') then
      select sum(decode(ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle),'S',0,credito)) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';
    elsif(v_tipo='CRA') then
      select sum(decode(ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle),'S',credito,0)) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=1 
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';
    elsif(v_tipo='CRD') then
      select sum(decode(ft_verif_cursos_repetidos(id_persona, v_id_plan_programa, id_curso_detalle),'S',credito,0)) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';
    elsif(v_tipo='CA') then    
      select sum(credito) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=1
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';
    elsif(v_tipo='CD') then    
      select sum(credito) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';      
    elsif(v_tipo='TC') then    
      select sum(credito) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion<>3 
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';   
    elsif(v_tipo='SA') then    
      select count(*) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=1
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';
    elsif(v_tipo='SD') then    
      select count(*) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion=2 
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';      
    elsif(v_tipo='TS') then    
      select count(*) into p_res
      from vw_acad_curso_alumno where id_persona=v_id_persona and id_semestre=v_id_semestre and id_tipo_condicion<>3 
        and id_nivel_ensenanza=v_id_nivel_ensenanza and estado<>'4';    
    end if;

  
  return p_res;

END;

