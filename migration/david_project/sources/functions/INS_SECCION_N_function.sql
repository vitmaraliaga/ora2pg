-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

FUNCTION       ins_seccion_n(p_id_seccion VARCHAR2, p_identificador NUMBER ,p_id_ejecucion number) 



RETURN NUMBER



IS



    r_puntaje NUMBER := 0;



BEGIN







    SELECT avg(temp1.puntaje)



    INTO r_puntaje



    FROM  (   



            SELECT 



            ip.identificador,



            sec.id_ITEM,



            Ii.Titulo,



            sum(Ir.Valor_Respuesta ) AS puntaje



            FROM LUCAS.INSTRUMENTO_RESPUESTA IR



            INNER JOIN LUCAS.INSTRUMENTO_PREGUNTA PR ON Pr.Id_Item = IR.Id_Pregunta



            INNER JOIN LUCAS.INSTRUMENTO_ITEM II ON Ii.Id_Item=Pr.Id_Item



            INNER JOIN LUCAS.INSTRUMENTO_SECCION SEC ON Sec.Id_Item = Ii.Id_Parent



            INNER JOIN LUCAS.INSTRUMENTO_PREGUNTA PRG ON Prg.Id_Item = IR.Id_Pregunta



            inner join lucas.Instrumento_Cuestionario ic on Ic.Id_Cuestionario=Ir.Id_Cuestionario



            INNER JOIN INS_PARTICIPANTE ip ON IP.Identificador=IC.Identificador and IP.Id_Cuestionario=IC.Id_Cuestionario



            INNER JOIN ACAD_CARGA_CURSO_DOCENTE ACCD ON ACCD.ID_CARGA_CURSO_DOCENTE = IP.IDENTIFICADOR 



            INNER JOIN VW_ACAD_CARGA_ACADEMICA VACA ON VACA.ID_CARGA_CURSO =ACCD.ID_CARGA_CURSO  AND ORIGEN='O'



            INNER JOIN ACAD_SEMESTRE AS2 ON AS2.ID_SEMESTRE = VACA.ID_SEMESTRE 



            INNER JOIN MOISES.PERSONA PE ON PE.ID_PERSONA = ACCD.ID_PERSONA 



  


            INNER JOIN  INS_EJECUCION EJ ON EJ.ID_EJECUCION =ip.ID_EJECUCION 



            INNER JOIN ELISEO.ORG_SEDE SE ON SE.ID_SEDE  = VACA.ID_SEDE 



            WHERE EJ.ID_EJECUCION = p_id_ejecucion AND Ic.Id_Estado_Evaluacion = 3



            AND sec.id_ITEM=p_id_seccion AND ip.IDENTIFICADOR =p_identificador



            GROUP BY ip.IDENTIFICADOR, Ii.Titulo, sec.id_ITEM



    ) temp1	;







    RETURN r_puntaje;







END;

