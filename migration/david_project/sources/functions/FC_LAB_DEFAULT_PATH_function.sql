-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

FUNCTION       FC_LAB_DEFAULT_PATH(
    P_COURSE_LOAD_ID IN DAVID.LAB_OCURRENCIA.ID_CARGA_CURSO%TYPE)
    RETURN VARCHAR2
    IS
    PATH          VARCHAR2(700);
    PATH_BASE     VARCHAR2(700) := '/pages/course-scheduler/';
    OCCURRENCE_ID DAVID.LAB_OCURRENCIA.ID_OCURRENCIA%TYPE;


BEGIN

    IF P_COURSE_LOAD_ID IS NOT NULL THEN

        BEGIN
            SELECT A.ID_OCURRENCIA
            INTO OCCURRENCE_ID
            FROM (SELECT LO.ID_OCURRENCIA
                  FROM DAVID.LAB_OCURRENCIA LO
                  WHERE LO.ID_CARGA_CURSO = P_COURSE_LOAD_ID
                  ORDER BY LO.ID_OCURRENCIA DESC) A
            WHERE ROWNUM <= 1;
        EXCEPTION
            WHEN NO_DATA_FOUND
                THEN
                    OCCURRENCE_ID := NULL;
        END;


        IF OCCURRENCE_ID IS NOT NULL THEN
            PATH := PATH_BASE || P_COURSE_LOAD_ID || '/occurrences?occurrenceId=' || OCCURRENCE_ID;
        ELSE
            PATH := PATH_BASE || P_COURSE_LOAD_ID || '/occurrences-add';
        END IF;


    END IF;

    RETURN PATH;
EXCEPTION
    WHEN NO_DATA_FOUND
        THEN
            DBMS_OUTPUT.PUT_LINE(SQLERRM);
            RETURN NULL;
END FC_LAB_DEFAULT_PATH;

