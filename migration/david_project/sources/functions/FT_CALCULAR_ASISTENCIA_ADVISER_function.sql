-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

function ft_calcular_asistencia_adviser(v_id_carga_curso number, v_id_persona number)
return varchar2
is

    num_asistencia number;
    p_res varchar2(200);
    
begin

select sum(decode(Asd.Id_Tipo_Asistencia,5,2,6,2,Asd.Id_Tipo_Asistencia))/count(aa.id_asistencia) into num_asistencia
from acad_asistencia aa inner join acad_carga_curso_docente accd on Accd.Id_Carga_Curso_Docente=Aa.Id_Carga_Curso_Docente
inner join acad_asistencia_det asd on Asd.Id_Asistencia=Aa.Id_Asistencia
where Accd.Id_Carga_Curso=v_id_carga_curso
and asd.id_persona=v_id_persona;

select (case when num_asistencia=0 or num_asistencia is null then 'NO Registrada'
             when num_asistencia>0 and num_asistencia<=1.5 then 'Buena' 
             when num_asistencia>1.5 and num_asistencia<=2 then 'Regular'
             when num_asistencia>2 then 'Mala'
             end) into p_res
from dual;

return p_res;

end;

