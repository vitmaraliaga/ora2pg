-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

function ft_tiene_aprobado(v_id_persona integer,v_id_plan_programa integer)
return number
is
  p_res number;
  p_monto number;
  p_id_escuela varchar2(50);
  p_estado number;
  p_promedio number;
begin

  select id_escuela into p_id_escuela
  from Vw_Plan_Programa 
  where Id_Plan_Programa=v_id_plan_programa;

      select decode(ft_desaprobado_ciclo_ant(v_id_persona,p_id_escuela,'t'),'S',2,1),ft_promedio_ant(v_id_persona,p_id_escuela)
      into p_estado,p_promedio
      from dual;
      
      if(p_estado=2 and p_promedio<14) then
        p_res:=1;
      elsif(p_estado=2 and p_promedio>=14) then
        p_res:=1;
      elsif(p_estado=1 and p_promedio>=14) then
        p_res:=0;
      elsif(p_estado=1 and p_promedio<14) then
        p_res:=0;
      end if;
  
  return p_res;    
      
end;

