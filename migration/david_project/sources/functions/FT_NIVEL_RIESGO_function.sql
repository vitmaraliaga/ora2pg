-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

function ft_nivel_riesgo(v_ponderado number, v_desaprobados number, v_tipo varchar2)
RETURN varchar2 IS
  p_res	  varchar2(500);		 

BEGIN
    
    if(v_tipo='R') then
    
      select (case when round(v_ponderado,0)<12 then 'MA' 
              when round(v_ponderado,0)>=12 
                    AND round(v_ponderado,0)<14
                    and v_desaprobados>1 then 'MA' 
              when round(v_ponderado,0)>=12 
                    and v_desaprobados>=1 then 'A' 
              when round(v_ponderado,0)=13 
                    and v_desaprobados=0 then 'A' 
              when round(v_ponderado,0)>=14 
                    and v_desaprobados>=1 and v_desaprobados<=2 then 'M' 
              when round(v_ponderado,0)=14 
                    and v_desaprobados=0 then 'M' 
              when round(v_ponderado,0)>=15 
                    and v_desaprobados=0 then 'B' else 'B' 
          end) into p_res
        from dual;
      
    elsif(v_tipo='C') then
    
      select (case when round(v_ponderado,0)<12 then 'Muy Alto' 
              when round(v_ponderado,0)>=12 
                    AND round(v_ponderado,0)<14
                    and v_desaprobados>1 then 'Muy Alto' 
              when round(v_ponderado,0)>=12 
                    and v_desaprobados>=1 then 'Alto' 
              when round(v_ponderado,0)=13 
                    and v_desaprobados=0 then 'Alto' 
              when round(v_ponderado,0)>=14 
                    and v_desaprobados>=1 and v_desaprobados<=2 then 'Medio' 
              when round(v_ponderado,0)=14 
                    and v_desaprobados=0 then 'Medio' 
              when round(v_ponderado,0)>=15 
                    and v_desaprobados=0 then 'Bajo' else 'Bajo' 
          end) into p_res
        from dual;
        
    end if;
  
 return p_res;

END;

