-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

function ft_anular_contrato_n(p_id_alumno_contrato integer) RETURN VARCHAR2 AS
  v_num integer :=0;

begin 
 
    delete ELISEO.Mat_Alumno_Contrato_Det where id_alumno_contrato=p_id_alumno_contrato;
  commit;
  
  delete ELISEO.Mat_Concepto_Asign_Alum where id_alumno_contrato=p_id_alumno_contrato;
  commit;
  
  delete Acad_Alumno_Contrato_Docs where id_alumno_contrato=p_id_alumno_contrato;
  commit;
  
  
  delete Acad_Alumno_Contrato_Curso where id_alumno_contrato=p_id_alumno_contrato;
  commit;
  
  delete ACUERDO_CONTRATO_CURSO where Id_Acuerdo_Contrato=(select Id_Acuerdo_Contrato from ACUERDO_CONTRATO where id_alumno_contrato=p_id_alumno_contrato);
  commit;
  
  delete ACUERDO_CONTRATO where id_alumno_contrato=p_id_alumno_contrato;
  commit;
  
  delete ACAD_DELEGADO where id_curso_alumno in (
  select id_curso_alumno from vw_acad_curso_alumno
  where (id_plan_programa,id_persona,id_semestre) in (
  select aac.id_plan_programa,aac.id_persona,Asp.Id_Semestre
  from acad_alumno_contrato aac inner join Acad_Semestre_Programa asp on Asp.Id_Semestre_Programa=Aac.Id_Semestre_Programa
  where id_alumno_contrato=p_id_alumno_contrato) and id_tipo_condicion=7 and estado in ('0','M'));
  commit;
  
  delete acad_curso_alumno where  id_curso_alumno in (
  select id_curso_alumno from vw_acad_curso_alumno
  where (id_plan_programa,id_persona,id_semestre) in (
  select aac.id_plan_programa,aac.id_persona,Asp.Id_Semestre
  from acad_alumno_contrato aac inner join Acad_Semestre_Programa asp on Asp.Id_Semestre_Programa=Aac.Id_Semestre_Programa
  where id_alumno_contrato=p_id_alumno_contrato) and id_tipo_condicion=7 and estado in ('0','M'));
  commit;
 
    delete ALUM_CONTR_BECA_SEM where id_alumno_contrato=p_id_alumno_contrato;
  commit;
  
  delete acad_alumno_contrato where id_alumno_contrato=p_id_alumno_contrato;
  commit;

end;

