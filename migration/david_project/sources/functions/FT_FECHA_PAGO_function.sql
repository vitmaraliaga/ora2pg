-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

FUNCTION       FT_FECHA_PAGO (P_ID_ALUMNO_CONTRATO VARCHAR2)
RETURN VARCHAR2
IS
l_fecha VARCHAR2(30);
BEGIN
	
	 SELECT (
				 SELECT to_char(ppr.FECHA , 'YYYY-MM-DD HH24:MI:SS')
			     FROM ELISEO.PROCESS_RUN pr 
			     INNER JOIN david.ACAD_ALUMNO_CONTRATO aac ON pr.ID_OPERACION  = aac.ID_ALUMNO_CONTRATO 
			     INNER JOIN eliseo.PROCESS_PASO_RUN ppr ON pr.ID_REGISTRO = ppr.ID_REGISTRO 
			     INNER JOIN ELISEO.PROCESS_PASO pp ON ppr.ID_PASO = PP.ID_PASO
			     WHERE 
			     aac.ID_ALUMNO_CONTRATO = P_ID_ALUMNO_CONTRATO
			     AND pp.ROUTE IN ('payment-v2', 'payment')
			     AND ROWNUM < 2 
		     ) INTO l_fecha
     FROM dual ;
     
    RETURN l_fecha;
END;

