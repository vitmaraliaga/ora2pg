-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

FUNCTION       ft_funcion_docente(
      
	p_id_persona NUMBER, 
	p_id_semestre NUMBER,
	p_id_nivel_ensenanza NUMBER,
	p_id_tipo_contrato NUMBER,
	p_id_unidad_academica NUMBER,
	p_id_programa_estudio NUMBER,
	p_id_sede NUMBER,
	p_bimestre NUMBER
) 

RETURN NUMBER

IS

    r_puntaje NUMBER := 0;

BEGIN



    SELECT avg(FUNCION_DOCENTE) * 0.20 / 100 * 100 AS FUNCION_DOCENTE INTO r_puntaje  FROM (
        
SELECT 
        programa_estudio,
        unidad_academica,sede,
        id_persona,bimestre, paterno,materno,nombre,
        num_documento,
        avg(funcion_docente) as funcion_docente
        
 	FROM (SELECT 
    programa_estudio,
    unidad_academica,sede,
    id_persona,paterno,materno,nombre,
    bimestre, num_documento,
     (NVL(sum( 0  + promedio_asistencia_docente + promedio_evaluacion + promedio_Recursos + promedio_asistencia),0) * 100 / 20) AS funcion_docente
            FROM  (
                    select  
                vape.nombre as programa_estudio,
                vape.nombre_facultad as unidad_academica,
                ose.nombre as sede,
                pe.id_persona,
                pe.PATERNO,
                pe.MATERNO,
                pe.NOMBRE,
                redm.bimestre,
                avg(redm.promedio_asistencia_docente*20/100) * 0.1 AS promedio_asistencia_docente,  
                avg(redm.promedio_notas_semana*20/100) * 0.3 AS promedio_evaluacion,  
                avg(redm.PROMEDIO_RECURSOS_PATMOS*20/100) * 0.5 AS promedio_Recursos,  
                avg(redm.promedio_asistencia*20/100) * 0.1 AS promedio_asistencia, 
                pn.NUM_DOCUMENTO 

                FROM reportbi.REPORTE_EVALUACION_DOC_MES redm 
                INNER JOIN david.ACAD_CARGA_CURSO_DOCENTE accd ON accd.ID_CARGA_CURSO_DOCENTE =redm.ID_CARGA_CURSO_DOCENTE 
                INNER JOIN david.VW_ACAD_CARGA_ACADEMICA vaca ON vaca.ID_CARGA_CURSO =accd.ID_CARGA_CURSO  AND origen='O'
                INNER JOIN moises.persona pe ON pe.ID_PERSONA =accd.ID_PERSONA 
                INNER JOIN MOISES.PERSONA_NATURAL pn ON pn.ID_PERSONA = pe.ID_PERSONA 
                INNER JOIN DAVID.ACAD_PERSONA_CONTRATO PC on PC.id_semestre = 175 and pc.id_persona=pe.id_persona
                 inner join david.vw_acad_programa_estudio vape on vape.id_programa_estudio=pc.id_programa_estudio
                 inner join eliseo.org_sede_area sa on sa.id_Sedearea=vape.id_unidad_academica
                 inner join eliseo.org_Sede ose on ose.id_Sede=sa.id_sede
                WHERE accd.ID_PERSONA = nvl(p_id_persona,accd.id_persona)
                and PC.id_Semestre=nvl(p_id_semestre,PC.id_semestre)
                AND vape.id_nivel_ensenanza =nvl(p_id_nivel_ensenanza, vape.ID_NIVEL_ENSENANZA)
                AND vape.ID_TIPO_CONTRATO =nvl(p_id_tipo_contrato,vape.ID_TIPO_CONTRATO)
                AND vape.ID_UNIDAD_ACADEMICA =nvl(p_id_unidad_academica,vape.ID_UNIDAD_ACADEMICA)
                AND vape.id_programa_estudio =nvl(p_id_programa_estudio,vape.id_programa_estudio)
                AND vape.ID_SEDE =nvl(p_id_sede,vape.ID_SEDE)
                AND redm.bimestre = nvl(p_bimestre,redm.bimestre)
                GROUP BY 
                vape.nombre ,
                vape.nombre_facultad ,
                ose.nombre ,
                pe.id_persona, 
                pe.PATERNO ,pe.MATERNO ,pe.NOMBRE,pn.NUM_DOCUMENTO 
                ,redm.bimestre

           
            )
            GROUP BY
            programa_estudio,
            unidad_academica,sede,
            id_persona, bimestre,
            paterno,
            materno,
            nombre,
            num_documento )
           
            GROUP BY  programa_estudio,
            unidad_academica,sede,
            id_persona ,bimestre, paterno,materno,nombre,
            num_documento );



    RETURN r_puntaje;



END;      

