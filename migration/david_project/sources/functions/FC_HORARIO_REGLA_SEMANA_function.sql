-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

FUNCTION       FC_HORARIO_REGLA_SEMANA(
    P_HORARIO IN VARCHAR2)
    RETURN VARCHAR2
    IS
    POR_SEMANA VARCHAR2(100) := '';
BEGIN
    IF P_HORARIO IS NOT NULL
    THEN
        SELECT LISTAGG(DAY, ',') WITHIN GROUP (ORDER BY DAY)
        INTO POR_SEMANA
        FROM (SELECT PARTE_N, ROWNUM AS DAY
              FROM (SELECT *
                    FROM (SELECT REGEXP_SUBSTR(P_HORARIO, '.', 1, LEVEL) AS PARTE_N, LEVEL AS DAY
                          FROM DUAL
                          CONNECT BY REGEXP_SUBSTR(P_HORARIO, '.', 1, LEVEL) IS NOT NULL)
                    WHERE DAY != 1
                    UNION ALL
                    SELECT *
                    FROM (SELECT REGEXP_SUBSTR(P_HORARIO, '.', 1, LEVEL) AS PARTE_N, LEVEL AS DAY
                          FROM DUAL
                          CONNECT BY REGEXP_SUBSTR(P_HORARIO, '.', 1, LEVEL) IS NOT NULL)
                    WHERE DAY = 1))
        WHERE PARTE_N = 1;

    END IF;

    RETURN POR_SEMANA;
END FC_HORARIO_REGLA_SEMANA;

