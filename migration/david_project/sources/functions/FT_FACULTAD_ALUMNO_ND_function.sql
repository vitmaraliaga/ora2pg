-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

FUNCTION       FT_FACULTAD_ALUMNO_ND(P_NUM_DOC IN Varchar2) 
RETURN VARCHAR2
IS
  P_FACULTAD VARCHAR2(500);
  CANTIDAD NUMBER;
BEGIN
    
   SELECT
	COUNT(1) INTO CANTIDAD
FROM
	(
	SELECT
		apc.campus_ads,
		apc.fac_ads,
		apc.eap_ads,
		accd.id_persona,
		PD.PATERNO,
		PD.MATERNO,
		PD.NOMBRE,
		decode(PD.CODIGO_SEXO, 'F', 'Femenino', 'M', 'Masculino') AS GENERO,
		Pd.Tipo_Doc,
		Pd.Num_Documento,
		apc.regimen_dedicacioN
	FROM
		vw_acad_carga_academica acc
	INNER JOIN eliseo.org_sede os ON
		os.id_sede = acc.id_sede
		AND acc.origen = 'O'
		AND acc.id_facultad BETWEEN 7 AND 12
	INNER JOIN acad_carga_curso_docente accd ON
		Accd.Id_Carga_Curso = Acc.Id_Carga_Curso
	LEFT JOIN Acad_Ambiente aa ON
		Aa.Id_Ambiente = Accd.Id_Ambiente
	LEFT JOIN Acad_Ambiente aaa ON
		Aaa.Id_Ambiente = Aa.Id_Parent
	INNER JOIN Vw_Persona_Docente pd ON
		pd.id_persona = accd.id_persona
	LEFT JOIN Tipo_Horario th ON
		Th.Id_Tipo_Horario = Accd.Id_Tipo_Horario
	INNER JOIN tipo_docente td ON
		Td.Id_Tipo_Docente = Accd.Id_Tipo_Docente
	INNER JOIN Acad_Programa_Estudio ape ON
		Ape.Id_Programa_Estudio = Acc.Id_Programa_Estudio
	INNER JOIN ELISEO.Org_Sede_Area osa ON
		Osa.Id_Sedearea = Ape.Id_Sedearea
	LEFT JOIN eliseo.Conta_Entidad_Depto ced ON
		Ced.Id_Depto = Osa.Id_Depto
		AND Ced.Id_Entidad = Osa.Id_Entidad
	LEFT JOIN vw_persona_grado pg ON
		pg.id_persona = accd.id_persona
	LEFT JOIN (
		SELECT
			sa.id_sede,
			a.id_area Id_Facultad,
			ape.id_nivel_ensenanza,
			ape.id_tipo_contrato,
			ape.id_escuela,
			apc.id_persona,
			apc.id_semestre,
			decode(Apc.Feligresia, 'S', 'SI', 'NO') ADVENTISTA,
			ttt.nombre regimen_dedicacion,
			Cl.Id_Condicion_Laboral condicion_lab,
			sed.nombre AS campus_ads,
			a.nombre AS fac_ads,
			Ape.Nombre_Escuela AS eap_ads
		FROM
			acad_persona_contrato apc
		LEFT JOIN MOISES.Condicion_Laboral cl ON
			Cl.Id_Condicion_Laboral = Apc.Id_Condicion_Laboral
		INNER JOIN eliseo.org_sede_area sa ON
			sa.id_sedearea = Apc.Id_Unidad_Academica
		INNER JOIN eliseo.org_sede sed ON
			sed.id_sede = sa.id_sede
		INNER JOIN eliseo.org_area a ON
			a.id_area = sa.id_area
		LEFT JOIN Vw_Acad_Programa_Estudio ape ON
			Ape.Id_Programa_Estudio = Apc.Id_Programa_Estudio
		LEFT JOIN moises.tipo_tiempo_trabajo ttt ON
			Ttt.Id_Tipo_Tiempo_Trabajo = Apc.Id_Tipo_Tiempo_Trabajo) apc
ON
		apc.id_persona = accd.id_persona
		AND apc.id_semestre = acc.id_semestre
	WHERE
		Acc.Id_Semestre = 199
		AND apc.id_sede IN (1, 2, 3)
		AND apc.id_nivel_ensenanza IN (1, 2)
		AND acc.id_escuela NOT IN (674)
		AND acc.id_facultad NOT IN (673)
		AND ACC.ID_CURSO_MODO NOT IN (2, 3)
		AND PD.Num_Documento = P_NUM_DOC
UNION ALL
	SELECT
		sed.nombre AS campus_ads,
		a.nombre AS fac_ads,
		Ape.Nombre_Escuela AS eap_ads,
		pc.id_persona,
		pnc.PATERNO,
		pnc.MATERNO,
		pnc.NOMBRE,
		decode(pnc.CODIGO_SEXO, 'F', 'Femenino', 'M', 'Masculino') AS GENERO,
		pnc.Tipo_Doc,
		pnc.Num_Documento,
		ttt.nombre regimen_dedicacion
	FROM
		acad_persona_contrato pc
	INNER JOIN VW_PERSONA_NATURAL_CARGA pnc ON
		pnc.id_persona = pc.id_persona
	INNER JOIN acad_persona_comision apc ON
		apc.id_persona_contrato = pc.id_persona_contrato
	INNER JOIN acad_semestre asm ON
		asm.id_semestre = pc.id_semestre
	INNER JOIN acad_comision_det acd ON
		Acd.Id_Comision_Det = Apc.Id_Comision_Det
	INNER JOIN acad_comision ac ON
		Ac.Id_Comision = Acd.Id_Comision
	LEFT JOIN MOISES.Condicion_Laboral cl ON
		Cl.Id_Condicion_Laboral = pc.Id_Condicion_Laboral
	INNER JOIN eliseo.org_sede_area sa ON
		sa.id_sedearea = pc.Id_Unidad_Academica
	INNER JOIN eliseo.org_sede sed ON
		sed.id_sede = sa.id_sede
	INNER JOIN eliseo.org_area a ON
		a.id_area = sa.id_area
	INNER JOIN eliseo.org_sede_area osac ON
		Osac.Id_Sedearea = apc.Id_Sedearea
	INNER JOIN eliseo.org_area oac ON
		Oac.Id_Area = Osac.Id_Area
	INNER JOIN eliseo.org_area oap ON
		Oap.Id_Area = Oac.Id_parent
	INNER JOIN eliseo.org_sede oas ON
		oas.id_sede = osac.id_sede
	INNER JOIN (
		SELECT
			Id_Unidad_Academica,
			min(DISTINCT id_nivel_ensenanza) id_nivel_ensenanza,
			min(DISTINCT id_tipo_contrato) id_tipo_contrato
		FROM
			vw_acad_programa_estudio
		GROUP BY
			Id_Unidad_Academica) ua ON
		Ua.Id_Unidad_Academica = pc.Id_Unidad_Academica
	LEFT JOIN Vw_Acad_Programa_Estudio ape ON
		Ape.Id_Programa_Estudio = pc.Id_Programa_Estudio
	LEFT JOIN moises.tipo_tiempo_trabajo ttt ON
		Ttt.Id_Tipo_Tiempo_Trabajo = pc.Id_Tipo_Tiempo_Trabajo
	LEFT JOIN eliseo.Conta_Entidad_Depto ced ON
		Ced.Id_Depto = '' || Apc.Id_Depto
		AND Ced.Id_Entidad = '' || Apc.Id_Entidad
	LEFT JOIN vw_persona_grado pg ON
		pg.id_persona = pc.id_persona
	WHERE
		Pc.Id_Semestre = 199
		AND SED.id_sede IN (1, 2, 3)
		AND UA.id_nivel_ensenanza IN (1, 2)
		AND pnc.Num_Documento = P_NUM_DOC
);

IF CANTIDAD>0 THEN 
	SELECT
	DISTINCT fac_ads INTO P_FACULTAD
FROM
	(
	SELECT
		apc.campus_ads,
		apc.fac_ads,
		apc.eap_ads,
		accd.id_persona,
		PD.PATERNO,
		PD.MATERNO,
		PD.NOMBRE,
		decode(PD.CODIGO_SEXO, 'F', 'Femenino', 'M', 'Masculino') AS GENERO,
		Pd.Tipo_Doc,
		Pd.Num_Documento,
		apc.regimen_dedicacioN
	FROM
		vw_acad_carga_academica acc
	INNER JOIN eliseo.org_sede os ON
		os.id_sede = acc.id_sede
		AND acc.origen = 'O'
		AND acc.id_facultad BETWEEN 7 AND 12
	INNER JOIN acad_carga_curso_docente accd ON
		Accd.Id_Carga_Curso = Acc.Id_Carga_Curso
	LEFT JOIN Acad_Ambiente aa ON
		Aa.Id_Ambiente = Accd.Id_Ambiente
	LEFT JOIN Acad_Ambiente aaa ON
		Aaa.Id_Ambiente = Aa.Id_Parent
	INNER JOIN Vw_Persona_Docente pd ON
		pd.id_persona = accd.id_persona
	LEFT JOIN Tipo_Horario th ON
		Th.Id_Tipo_Horario = Accd.Id_Tipo_Horario
	INNER JOIN tipo_docente td ON
		Td.Id_Tipo_Docente = Accd.Id_Tipo_Docente
	INNER JOIN Acad_Programa_Estudio ape ON
		Ape.Id_Programa_Estudio = Acc.Id_Programa_Estudio
	INNER JOIN ELISEO.Org_Sede_Area osa ON
		Osa.Id_Sedearea = Ape.Id_Sedearea
	LEFT JOIN eliseo.Conta_Entidad_Depto ced ON
		Ced.Id_Depto = Osa.Id_Depto
		AND Ced.Id_Entidad = Osa.Id_Entidad
	LEFT JOIN vw_persona_grado pg ON
		pg.id_persona = accd.id_persona
	LEFT JOIN (
		SELECT
			sa.id_sede,
			a.id_area Id_Facultad,
			ape.id_nivel_ensenanza,
			ape.id_tipo_contrato,
			ape.id_escuela,
			apc.id_persona,
			apc.id_semestre,
			decode(Apc.Feligresia, 'S', 'SI', 'NO') ADVENTISTA,
			ttt.nombre regimen_dedicacion,
			Cl.Id_Condicion_Laboral condicion_lab,
			sed.nombre AS campus_ads,
			a.nombre AS fac_ads,
			Ape.Nombre_Escuela AS eap_ads
		FROM
			acad_persona_contrato apc
		LEFT JOIN MOISES.Condicion_Laboral cl ON
			Cl.Id_Condicion_Laboral = Apc.Id_Condicion_Laboral
		INNER JOIN eliseo.org_sede_area sa ON
			sa.id_sedearea = Apc.Id_Unidad_Academica
		INNER JOIN eliseo.org_sede sed ON
			sed.id_sede = sa.id_sede
		INNER JOIN eliseo.org_area a ON
			a.id_area = sa.id_area
		LEFT JOIN Vw_Acad_Programa_Estudio ape ON
			Ape.Id_Programa_Estudio = Apc.Id_Programa_Estudio
		LEFT JOIN moises.tipo_tiempo_trabajo ttt ON
			Ttt.Id_Tipo_Tiempo_Trabajo = Apc.Id_Tipo_Tiempo_Trabajo) apc
ON
		apc.id_persona = accd.id_persona
		AND apc.id_semestre = acc.id_semestre
	WHERE
		Acc.Id_Semestre = 199
		AND apc.id_sede IN (1, 2, 3)
		AND apc.id_nivel_ensenanza IN (1, 2)
		AND acc.id_escuela NOT IN (674)
		AND acc.id_facultad NOT IN (673)
		AND ACC.ID_CURSO_MODO NOT IN (2, 3)
		AND PD.Num_Documento = P_NUM_DOC
UNION ALL
	SELECT
		sed.nombre AS campus_ads,
		a.nombre AS fac_ads,
		Ape.Nombre_Escuela AS eap_ads,
		pc.id_persona,
		pnc.PATERNO,
		pnc.MATERNO,
		pnc.NOMBRE,
		decode(pnc.CODIGO_SEXO, 'F', 'Femenino', 'M', 'Masculino') AS GENERO,
		pnc.Tipo_Doc,
		pnc.Num_Documento,
		ttt.nombre regimen_dedicacion
	FROM
		acad_persona_contrato pc
	INNER JOIN VW_PERSONA_NATURAL_CARGA pnc ON
		pnc.id_persona = pc.id_persona
	INNER JOIN acad_persona_comision apc ON
		apc.id_persona_contrato = pc.id_persona_contrato
	INNER JOIN acad_semestre asm ON
		asm.id_semestre = pc.id_semestre
	INNER JOIN acad_comision_det acd ON
		Acd.Id_Comision_Det = Apc.Id_Comision_Det
	INNER JOIN acad_comision ac ON
		Ac.Id_Comision = Acd.Id_Comision
	LEFT JOIN MOISES.Condicion_Laboral cl ON
		Cl.Id_Condicion_Laboral = pc.Id_Condicion_Laboral
	INNER JOIN eliseo.org_sede_area sa ON
		sa.id_sedearea = pc.Id_Unidad_Academica
	INNER JOIN eliseo.org_sede sed ON
		sed.id_sede = sa.id_sede
	INNER JOIN eliseo.org_area a ON
		a.id_area = sa.id_area
	INNER JOIN eliseo.org_sede_area osac ON
		Osac.Id_Sedearea = apc.Id_Sedearea
	INNER JOIN eliseo.org_area oac ON
		Oac.Id_Area = Osac.Id_Area
	INNER JOIN eliseo.org_area oap ON
		Oap.Id_Area = Oac.Id_parent
	INNER JOIN eliseo.org_sede oas ON
		oas.id_sede = osac.id_sede
	INNER JOIN (
		SELECT
			Id_Unidad_Academica,
			min(DISTINCT id_nivel_ensenanza) id_nivel_ensenanza,
			min(DISTINCT id_tipo_contrato) id_tipo_contrato
		FROM
			vw_acad_programa_estudio
		GROUP BY
			Id_Unidad_Academica) ua ON
		Ua.Id_Unidad_Academica = pc.Id_Unidad_Academica
	LEFT JOIN Vw_Acad_Programa_Estudio ape ON
		Ape.Id_Programa_Estudio = pc.Id_Programa_Estudio
	LEFT JOIN moises.tipo_tiempo_trabajo ttt ON
		Ttt.Id_Tipo_Tiempo_Trabajo = pc.Id_Tipo_Tiempo_Trabajo
	LEFT JOIN eliseo.Conta_Entidad_Depto ced ON
		Ced.Id_Depto = '' || Apc.Id_Depto
		AND Ced.Id_Entidad = '' || Apc.Id_Entidad
	LEFT JOIN vw_persona_grado pg ON
		pg.id_persona = pc.id_persona
	WHERE
		Pc.Id_Semestre = 199
		AND SED.id_sede IN (1, 2, 3)
		AND UA.id_nivel_ensenanza IN (1, 2)
		AND pnc.Num_Documento = P_NUM_DOC
);
		
ELSE 

SELECT C.NOMBRE INTO P_FACULTAD
FROM ELISEO.APS_TRABAJADOR A JOIN ELISEO.VW_SEDE_AREA B ON A.ID_DEPTO = B.ID_DEPTO
JOIN ELISEO.ORG_AREA C ON B.ID_AREA = C.ID_AREA
WHERE A.ID_ENTIDAD = 7124
AND A.ID_PERSONA IN (SELECT ID_PERSONA FROM MOISES.PERSONA_DOCUMENTO WHERE NUM_DOCUMENTO = P_NUM_DOC)
AND ROWNUM = 1;

END IF;
	/* SELECT NOM_FACULTAD INTO P_FACULTAD
    FROM DAVID.VW_ALUMNO_PLAN_PROGRAMA VPP INNER JOIN MOISES.PERSONA_DOCUMENTO PD ON PD.ID_PERSONA=VPP.ID_PERSONA
    WHERE  Pd.Num_Documento=P_NUM_DOC
    AND ID_PLAN_PROGRAMA = (SELECT  ID_PLAN_PROGRAMA
                            FROM (SELECT ID_PLAN_PROGRAMA,ID_PERSONA FROM DAVID.VW_ALUMNO_PLAN_PROGRAMA WHERE ESTADO=1 ORDER BY LPAD(decode(ID_NIVEL_ENSENANZA,1,9,2,9,3,9,4,9,1),2,'0')||NOMBRE_PLAN DESC)
                            WHERE ID_PERSONA=VPP.ID_PERSONA AND ROWNUM=1);
                            */
    RETURN P_FACULTAD;

    
END;

