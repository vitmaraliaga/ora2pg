-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

FUNCTION       FT_CURSOS_SOLICITUD(p_id_solicitud_mat_alum in integer,p_id_tipo_solicitud in integer)
RETURN VARCHAR2 IS

  resultado varchar2(2000);

begin

  SELECT cursos INTO resultado
  FROM(SELECT sma.id_solicitud_mat_alum, 
        LISTAGG(vacp.CURSO  || ', Ciclo: ' || vacp.CICLO , '|') WITHIN GROUP (ORDER BY vacp.curso) AS cursos
      FROM 
      david.solicitud_mat_alum sma 
      INNER JOIN david.SOLICITUD_CURSO_MATRICULA scm ON sma.ID_SOLICITUD_MAT_ALUM =scm.ID_SOLICITUD_MAT_ALUM
      INNER JOIN david.VW_ACAD_CURSO_PLAN vacp ON vacp.ID_PLAN_CURSO =scm.ID_PLAN_CURSO
      WHERE sma.ID_TIPO_SOLICITUD_MATRICULA =p_id_tipo_solicitud
      AND  sma.ID_SOLICITUD_MAT_ALUM =p_id_solicitud_mat_alum
      GROUP BY sma.id_solicitud_mat_alum);

	RETURN resultado;

end;

