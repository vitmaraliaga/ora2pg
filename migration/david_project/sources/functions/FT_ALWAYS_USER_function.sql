-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

function       ft_always_user(v_id_persona NUMBER, v_opcion number) RETURN VARCHAR2 AS



  p_users VARCHAR2(200);



BEGIN



    select 
    
    CASE 
	    WHEN 
	       v_opcion=1 THEN 
    nvl(

decode(u4.email,null, decode (u3.email,null, decode(u2.email,null, decode(u.email,null,/*1*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno))/*1*/
, 

                                                                                          /*2*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno||'.'||SUBSTR(p.paterno,0,1)))/*2*/
 ),

                                                                     /*3*/
sintilde_con_punto(replace(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,INSTR(p.nombres,' ')+1))||'.'||p.paterno),' ',''))/*3*/
 ),

                                              /*4*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||substr(p.paterno,0,1)||'.'||p.materno))/*4*/
),

                        /*5*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||substr(p.paterno,0,1)||'.'||p.materno))||round(dbms_random.value(1, 9))/*5*/
),

                        sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno))||round(dbms_random.value(1, 9))) 
                        
                        WHEN v_opcion=2
                         	THEN documentos
                        ELSE 'null'  
	END INTO p_users
    from (select Distinct p.id_persona,paterno,materno,nombre nombres, p.codigo codigo_personal,pn.num_documento documentos,id_tipodocumento tipo_documento 



          from moises.persona p inner join moises.persona_natural pn on pn.id_persona=p.id_persona where p.id_persona=v_id_persona) p

 
    left join eliseo.users u on u.email=sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno))

    left join eliseo.users u2 on u2.email=decode(u.email,null,/*1*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno))/*1*/
, 

                                                              /*2*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno||'.'||SUBSTR(p.paterno,0,1)))/*2*/
 )

    left join eliseo.users u3 on u3.email=decode(u2.email,null, decode(u.email,null,/*1*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno))/*1*/
, 

                                                                                     /*2*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno||'.'||SUBSTR(p.paterno,0,1)))/*2*/
 ),

                                                                 /*3*/
sintilde_con_punto(replace(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,INSTR(p.nombres,' ')+1))||'.'||p.paterno),' ',''))/*3*/
 )

    left join eliseo.users u4 on u4.email=decode (u3.email,null, decode(u2.email,null, decode(u.email,null,/*1*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno))/*1*/
, 

                                                                                                            /*2*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||p.paterno||'.'||SUBSTR(p.paterno,0,1)))/*2*/
 ),

                                                                                       /*3*/
sintilde_con_punto(replace(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,INSTR(p.nombres,' ')+1))||'.'||p.paterno),' ',''))/*3*/
 ),

                                                                /*4*/
sintilde_con_punto(lower(decode(INSTR(p.nombres,' '),'0',p.nombres,substr(p.nombres,0,INSTR(p.nombres,' ')-1))||'.'||substr(p.paterno,0,1)||'.'||p.materno))/*4*/
)

 
    ;



    return p_users;



end;

