-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

FUNCTION ft_num_horas_cruce_curso_med( p_id_carga_curso_docente integer,p_id_semestre integer, p_id_programa_estudio integer, p_ciclo integer, p_grupo varchar2, p_id_modulo_detalle integer) RETURN number IS
   horario_t varchar2(4000);
   horario_b varchar2(4000);
   horario_f varchar2(4000);
   horas number(30);
   letra varchar2(1);
   
   cursor curso is     
    select nvl(Accd.Horario,'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000') horario_t 
    from vw_acad_carga_academica aca inner join acad_carga_curso_docente accd on Accd.Id_Carga_Curso=Aca.Id_Carga_Curso
    where aca.id_semestre=p_id_semestre and Aca.Id_Programa_Estudio=p_id_programa_estudio 
    and Accd.Id_Carga_Curso_docente<>p_id_carga_curso_docente and Accd.Id_Modulo_Detalle=p_id_modulo_detalle
    and aca.ciclo=p_ciclo and (aca.grupo is null or nvl(aca.grupo,'999')=nvl(p_grupo,'999'));

BEGIN

    select wm_concat(nvl(Accd.Horario,'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000')) into horario_f 
          from vw_acad_carga_academica aca inner join acad_carga_curso_docente accd on Accd.Id_Carga_Curso=Aca.Id_Carga_Curso and aca.origen='O' and Accd.Id_Carga_Curso_docente=p_id_carga_curso_docente;

   --horario_f := '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
	 horario_t := '';
	 horas := 0;

	 open curso;
	 fetch curso into horario_b ;

	 while curso%found loop
	 	   for i in 1..134 loop

			   if ( substr(horario_b,i,1) = '1') and ( substr(horario_f,i,1) = '1') then
			   	  horas := horas + 1;
			   end if;

		   end loop;
       
		   horario_t := '';
	   	 fetch curso into horario_b;
	 end loop;

	 close curso;
	 RETURN( horas );
END;

