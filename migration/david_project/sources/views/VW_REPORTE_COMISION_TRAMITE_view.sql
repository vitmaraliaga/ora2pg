-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_reporte_comision_tramite (id_solicitud_mat_alum, codigo_solicitud, id_persona, codigo_estudiante, plan_origen, programa_origen, id_programa_origen, id_sede_origen, plan_destino, programa_destino, id_programa_destino, id_sede_destino, fecha_registro, id_semestre, semestre, id_tipo_tramite, descripcion, institucion, estudiante, estado) AS SELECT 
sma.id_solicitud_mat_alum,
sma.codigo AS codigo_solicitud,
pe.id_persona,
pna.codigo AS codigo_estudiante,
ap2.nombre AS plan_origen,
vape2.nombre AS programa_origen,
vape2.id_programa_estudio AS id_programa_origen,
vape2.id_sede AS id_sede_origen,
ap.nombre AS plan_destino,
vape.nombre AS programa_destino,
vape.id_programa_estudio AS id_programa_destino,
vape.id_sede AS id_sede_destino,
sma.fecha_registro,
as2.id_Semestre,
as2.nombre AS semestre,
sc.id_tipo_tramite,
sc.descripcion,
sc.institucion,
pe.nombre || ' ' || pe.paterno || ' ' || pe.materno AS estudiante,
sc.estado



FROM SOLICITUD_CONVALIDACION sc 
INNER JOIN SOLICITUD_MAT_ALUM sma ON sc.ID_SOLICITUD_CONVALIDACION =sma.ID_SOLICITUD_MAT_ALUM 
LEFT JOIN ACAD_PLAN_PROGRAMA app  ON app.ID_PLAN_PROGRAMA = sc.ID_PLAN_DESTINO
LEFT JOIN VW_ACAD_PROGRAMA_ESTUDIO vape ON vape.ID_PROGRAMA_ESTUDIO = app.ID_PROGRAMA_ESTUDIO 
LEFT JOIN ACAD_PLAN ap ON ap.ID_PLAN =app.ID_PLAN 
LEFT JOIN ACAD_PLAN_PROGRAMA app2 ON app2.ID_PLAN_PROGRAMA =sc.ID_PLAN_ORIGEN 
LEFT JOIN VW_ACAD_PROGRAMA_ESTUDIO vape2 ON vape2.ID_PROGRAMA_ESTUDIO =app2.ID_PROGRAMA_ESTUDIO 
LEFT JOIN ACAD_PLAN ap2 ON ap2.ID_PLAN =app2.ID_PLAN 
INNER JOIN MOISES.PERSONA pe ON pe.ID_PERSONA =sma.ID_PERSONA 
INNER JOIN MOISES.PERSONA_NATURAL_ALUMNO pna ON pna.ID_PERSONA =pe.ID_PERSONA 
INNER JOIN ACAD_SEMESTRE as2 ON as2.ID_SEMESTRE =sma.ID_SEMESTRE 
UNION ALL 
SELECT 
sma2.id_solicitud_mat_alum,
sma2.codigo AS codigo_solicitud,
pe2.id_persona,
pna2.codigo AS codigo_estudiante,
ap3.nombre AS plan_origen,
vape3.nombre AS programa_origen,
vape3.id_programa_estudio AS id_programa_origen,
vape3.id_sede AS id_sede_origen,
NULL AS plan_destino,
NULL AS programa_destino,
NULL AS id_programa_destino,
vape3.id_sede AS id_Sede_destino,
sma2.fecha_registro,
as3.id_Semestre,
as3.nombre AS semestre,
5 AS id_tipo_tramite,
'' AS descripcion,
'' AS institucion,
pe2.nombre || ' ' ||pe2.paterno || ' ' || pe2.materno AS estudiante,
sma2.estado

FROM 
SOLICITUD_MAT_ALUM sma2 
INNER JOIN TIPO_SOLICITUD_MATRICULA tsm ON sma2.ID_TIPO_SOLICITUD_MATRICULA =tsm.ID_TIPO_SOLICITUD_MATRICULA 
INNER JOIN ACAD_SEMESTRE as3 ON as3.ID_SEMESTRE =sma2.ID_SEMESTRE 
LEFT JOIN ACAD_PLAN_PROGRAMA app3  ON app3.ID_PLAN_PROGRAMA = sma2.ID_PLAN_PROGRAMA 
LEFT JOIN VW_ACAD_PROGRAMA_ESTUDIO vape3 ON vape3.ID_PROGRAMA_ESTUDIO = app3.ID_PROGRAMA_ESTUDIO 
LEFT JOIN ACAD_PLAN ap3 ON ap3.ID_PLAN =app3.ID_PLAN 
INNER JOIN MOISES.PERSONA pe2 ON pe2.ID_PERSONA = sma2.ID_PERSONA 
INNER JOIN MOISES.PERSONA_NATURAL_ALUMNO pna2 ON pna2.ID_PERSONA =pe2.ID_PERSONA 

WHERE sma2.id_tipo_solicitud_matricula=5;

