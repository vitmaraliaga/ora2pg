-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_persona_natural (id_persona, nombre, paterno, materno, id_tipotratamiento, tipo_tratamiento, id_tipoestadocivil, tipo_estado_civil, id_tiposangre, tipo_sangre, id_situacion_educativo, situacion_educativa, id_tipopais, tipo_pais, id_tiporeligion, tipo_religion, id_tipoautoridadiglesia, tipo_autoridad_iglesia, id_tipodocumento, num_documento, sexo, tipo_sexo, fec_nacimiento, fec_defuncion, vive, fec_caducidad, telefono, id_telefono, id_tipopais_celular, id_tipotelefono, num_telefono, id_virtual, email, correo_inst, iglesia, fecha_bautizo, tiene_cargo, cargo_iglesia, nombre_autoridad, tlf_autoridad, id_nacionalidad, id_direccion, direccion, id_ubigeo, tipo_ubigeo, verificacion_codigo_celular, verificacion_codigo_correo, correo) AS select p.id_persona,p.nombre,p.paterno,p.materno,
pn.id_tipotratamiento,(select nombre FROM moises.tipo_tratamiento where id_tipotratamiento=pn.id_tipotratamiento) tipo_tratamiento,
pn.id_tipoestadocivil,(select nombre from moises.tipo_estado_civil where id_tipoestadocivil=pn.id_tipoestadocivil) tipo_estado_civil,
pn.id_tiposangre,(select nombre from moises.tipo_sangre where id_tiposangre=pn.id_tiposangre) tipo_sangre,
pn.id_situacion_educativo,(select nombre from moises.situacion_educativa where id_situacion_educativo=pn.id_situacion_educativo) situacion_educativa,
pn.id_tipopais,(select nombre from moises.tipo_pais where id_tipopais=pn.id_tipopais) tipo_pais,
pn.id_tiporeligion,(select nombre from moises.tipo_religion where id_tiporeligion=pn.id_tiporeligion) tipo_religion,
pn.id_tipoautoridadiglesia,(select nombre from moises.tipo_autoridad_iglesia where id_tipoautoridadiglesia=pn.id_tipoautoridadiglesia) tipo_autoridad_iglesia,
pd.id_tipodocumento,pd.num_documento,
pn.sexo,(select nombre from moises.tipo_sexo where sexo=pn.sexo) tipo_sexo,
pn.fec_nacimiento,pn.fec_defuncion,pn.vive,pn.fec_caducidad,pn.telefono,
pt.id_telefono, pt.id_tipopais_celular, pt.id_tipotelefono, pt.num_telefono ,
pv.id_virtual, pv.direccion email,correo_inst,iglesia,fecha_bautizo,tiene_cargo,cargo_iglesia,nombre_autoridad,
tlf_autoridad,id_nacionalidad,
pp.id_direccion,pp.direccion,
pp.id_ubigeo,(select nombre from moises.ubigueo where id_ubigeo=pp.id_ubigeo) tipo_ubigeo,
(select estado from moises.verificacion v where v.tipo='C' and v.id_persona=p.id_persona and v.valor=pt.num_telefono and rownum=1) verificacion_codigo_celular,
(select estado from moises.verificacion v where v.tipo='V' and v.id_persona=p.id_persona and v.valor=pv.direccion and rownum=1) verificacion_codigo_correo,correo
from(select id_persona,
      (select id_telefono from moises.persona_telefono where es_activo = 1 and id_tipotelefono = 5 and id_persona=pn.id_persona and rownum=1) id_telefono,
      (select id_virtual from moises.persona_virtual where es_activo = 1 and id_tipovirtual = 1 and id_persona=pn.id_persona and rownum=1) id_virtual,
      (select id_direccion from moises.persona_direccion where es_activo = 1 and id_tipodireccion = 4 and id_persona=pn.id_persona and rownum=1) id_direccion,
      (select num_documento from moises.persona_documento where id_persona=pn.id_persona and rownum=1) num_documento, 
      id_tipotratamiento,id_tipoestadocivil,id_tiposangre,id_situacion_educativo,id_tipopais,id_ubigeo,id_tiporeligion,id_tipoautoridadiglesia,sexo,
      fec_nacimiento,fec_defuncion,vive,fec_caducidad,telefono,correo,correo_inst,iglesia,fecha_bautizo,tiene_cargo,cargo_iglesia,nombre_autoridad,
      tlf_autoridad,id_nacionalidad
    from moises.persona_natural pn ) pn
left join moises.persona_documento pd on pn.id_persona=pd.id_persona and pn.num_documento=pd.num_documento
left join moises.persona_telefono pt on pn.id_persona=pt.id_persona and pn.id_telefono=pt.id_telefono
left join moises.persona_virtual pv on pn.id_persona=pv.id_persona and pn.id_virtual=pv.id_virtual
left join moises.persona_direccion pp on pn.id_persona=pp.id_persona and pn.id_direccion=pp.id_direccion
inner join moises.persona p on pn.id_persona=p.id_persona;

