-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_acad_alumno_contrato (id_alumno_contrato, modo_contrato, semestre, modalidad, sede, id_facultad, nombre_facultad, id_escuela, nombre_escuela, escuela_profesional, ciclo, ciclo2, ciclo_plan, grupo, codigo, num_documento, nombre, paterno, materno, sexo, religion, creditos, id_resid_tipo_habitacion, residencia, beca, beca_ant, ingresante, mensual, id_semestre_programa, id_usuario_reg, id_usuario_act, fecha_actualizacion, fecha_registro, matriculador, situacion, celular, correo, correo_upeu, estado, id_semestre, id_persona, tipo_alumno, id_sede, id_unidad_academica, id_programa_estudio, id_tipo_contrato, id_nivel_ensenanza, id_modo_contrato, id_plan_programa, id_tipo_resp_financiero, id_resp_financiero, tipo_resp_financiero, resp_financiero, celular_resp, correo_resp, tipo_doc_resp, num_documento_resp, id_planpago_semestre, codigo_contrato, id_area, id_modalidad_estudio, origen, id_matricula_detalle, id_sexo, id_tiporeligion, plan_pago, cuotas, fecha_matricula) AS select aac.id_alumno_contrato,mc.nombre modo_contrato,asm.semestre,decode(ape.Id_Semipresencial,null,decode(ape.Nombre_Facultad,'EPG','Posgrado',tme.nombre),'Semipresencial') modalidad,
ape.sede,ape.id_facultad,ape.Nombre_Facultad,ape.id_escuela,ape.Nombre_Escuela,ape.Escuela_Profesional,
Ft_Calcular_Ciclo_Programa(asm.semestre,aac.id_persona,aac.Id_Plan_Programa) ciclo,
Ft_Calcular_Ciclo(asm.semestre,aac.id_persona,aac.Id_nivel_ensenanza) ciclo2,
ft_ciclo_plan_alumno(aac.id_persona,aac.Id_Plan_Programa)ciclo_plan,
Ft_Calcular_grupo_Programa(asm.semestre,aac.id_persona,aac.Id_Plan_Programa) grupo,pna.codigo,pn.num_documento,p.Nombre,p.Paterno,p.Materno,Ts.Nombre sexo,
nvl(tr.Nombre,'Otro') RELIGION,Ft_Calcular_Creditos_Semestre(asm.semestre,aac.id_persona,aac.Id_Plan_Programa) creditos,
Rth.Id_Resid_Tipo_Habitacion, nvl(Rth.Nombre,'Externo') RESIDENCIA,
nvl(decode(aac.Tipo_Alumno,'B18',tbe.Nombre),'Ninguna') BECA,
nvl(decode(aac.Tipo_Alumno,'B18',tbea.Nombre),'Ninguna') BECA_ant,
decode(Ft_Calcular_Ciclo_Programa(asm.semestre,aac.id_persona,aac.Id_Plan_Programa),1,'Ingresante','Antiguo') INGRESANTE,
aac.Mensual,aac.id_semestre_programa,aac.id_usuario_reg,aac.id_usuario_act,aac.Fecha_actualizacion,aac.Fecha_Registro,pm.Nombre||' '||pm.Paterno||' '||pm.Materno as Matriculador,
decode(aac.Estado,'1','Matriculados','0','En Proceso','M','Confirmado') situacion,
pn.celular,pn.correo,pn.correo_inst correo_upeu,aac.estado,asp.id_semestre,aac.id_persona,aac.tipo_alumno,
ape.id_sede,ape.Id_Unidad_Academica,ape.Id_Programa_Estudio,ape.Id_Tipo_Contrato,ape.Id_Nivel_Ensenanza,Amd.Id_Modo_Contrato,
aac.ID_PLAN_PROGRAMA,nvl(aac.Id_Tipo_Resp_Financiero,3) id_tipo_resp_financiero,nvl(aac.id_resp_financiero,aac.id_persona) id_resp_financiero,
Trf.Nombre tipo_resp_financiero,
decode(aac.ID_NIVEL_ENSENANZA, 9, genesis.ft_resp_financiero_nombre(pn.num_documento),pr.Nombre||' '||pr.Paterno||' '||pr.Materno) as Resp_financiero,
decode(aac.ID_NIVEL_ENSENANZA, 9, genesis.ft_resp_financiero_celular(pn.num_documento),pnr.celular)  celular_resp,
decode(aac.ID_NIVEL_ENSENANZA, 9, genesis.ft_resp_financiero_correo(pn.num_documento),pnr.correo)  correo_resp,
tdr.siglas tipo_doc_resp,pnr.num_documento num_documento_resp, aac.ID_PLANPAGO_SEMESTRE, aac.codigo AS codigo_contrato,
ape.id_area, ape.ID_MODALIDAD_ESTUDIO,aac.ORIGEN, aac.ID_MATRICULA_DETALLE,Ts.sexo id_sexo, tr.Id_Tiporeligion,
mp.nombre AS PLAN_PAGO,
mp.cuotas AS CUOTAS,
aac.FECHA_MATRICULA

FROM acad_alumno_contrato aac
inner join acad_semestre_programa asp on asp.Id_Semestre_Programa=aac.Id_Semestre_Programa --and aac.estado in ('1','M','0')
inner join acad_semestre asm on asm.id_semestre=asp.id_semestre
inner join vw_acad_programa_estudio ape on ape.Id_Programa_Estudio=asp.Id_Programa_Estudio
left join Tipo_Modalidad_Estudio tme on Tme.Id_Modalidad_Estudio=ape.Id_Modalidad_Estudio
inner join moises.persona_natural_alumno pna on pna.Id_Persona=aac.id_persona
inner join moises.persona_natural pn on Pn.Id_Persona=pna.id_persona
inner join moises.persona p on p.Id_Persona=pn.id_persona
inner join Acad_Matricula_Detalle amd on Amd.Id_Matricula_Detalle=aac.Id_Matricula_Detalle
inner join Modo_Contrato mc on mc.Id_Modo_Contrato=Amd.Id_Modo_Contrato
left join moises.tipo_sexo ts on Ts.Sexo=Pn.Sexo
left join moises.tipo_religion tr on tr.Id_Tiporeligion=Pn.Id_Tiporeligion
left join Acad_Alumno_Beca aab on Aab.Id_Persona=aac.Id_Persona and Aab.Estado='1' and Aab.Id_Tipo_Beca_Estatal is not null
left join Tipo_Beca_Estatal tbe on tbe.Id_Tipo_Beca_Estatal=Aab.Id_Tipo_Beca_Estatal
left join Acad_Alumno_Beca aaba on Aaba.Id_Persona=aac.Id_Persona and Aaba.Id_Tipo_Beca_Estatal is not null
left join Tipo_Beca_Estatal tbea on tbea.Id_Tipo_Beca_Estatal=Aaba.Id_Tipo_Beca_Estatal
left join Acad_Reserva_Residencia arr on Arr.Id_Persona=aac.id_persona and Arr.Id_Semestre=asp.id_semestre
left join Residencia_Habitacion rh on rh.Id_Habitacion=Arr.Id_Habitacion
left join Residencia_Tipo_Habitacion rth on Rth.Id_Resid_Tipo_Habitacion=nvl(rh.Id_Resid_Tipo_Habitacion,aac.Id_Resid_Tipo_Habitacion)
left join moises.persona pm on pm.Id_Persona=nvl(aac.Id_Usuario_Act,aac.Id_Usuario_Reg)
left join moises.persona pr on pr.Id_Persona=nvl(aac.Id_Resp_Financiero,aac.id_persona)
left join moises.persona_natural pnr on pnr.Id_Persona=pr.id_persona
LEFT JOIN eliseo.MAT_PLANPAGO_SEMESTRE mps ON mps.ID_PLANPAGO_SEMESTRE = aac.ID_PLANPAGO_SEMESTRE 
LEFT JOIN eliseo.MAT_PLANPAGO mp ON mp.ID_PLANPAGO = mps.ID_PLANPAGO 
left join Tipo_Resp_Financiero trf on Trf.Id_Tipo_Resp_Financiero=nvl(aac.Id_Tipo_Resp_Financiero,3)
left join MOISES.Tipo_Documento tdr on tdr.Id_Tipodocumento=pnr.id_tipodocumento;

