-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_solicitud_infra (id_semestre, email, firstname, surname, userid, sex, phone, dateofbirth, address, state, b_country, cardnumber, borrowernotes, sort1, sort2, dateexpiry, categorycode, fecha_de_matricula) AS select aac.id_semestre,aac.Correo email,pa.Nombre firstname, pa.paterno||' '||pa.materno surname,u.email userid,
pa.Codigo_Sexo sex, pa.Celular phone, pa.Fec_Nacimiento dateofbirth, pa.Direccion address, 
replace(replace(aac.Sede,'Sede ',''),'Filial ','') state,
tp.Gentilicio B_country, pa.Codigo cardnumber, pa.Num_Documento borrowernotes,
oa.Sigla sort1,nvl(Ape.codigo_sunedu2,ape.nombre_corto) sort2,asp.fecha_expiracion dateexpiry,'ESTUDI' categorycode,
nvl(aac.Fecha_Actualizacion,aac.Fecha_Registro) fecha_de_matricula
FROM vw_acad_alumno_contrato aac inner join Vw_Persona_Alumno pa on pa.id_persona=aac.id_persona
inner join Acad_Programa_Estudio ape on Ape.Id_Programa_Estudio=aac.Id_Programa_Estudio
inner join eliseo.org_area oa on oa.id_area=aac.Id_Facultad
left join eliseo.users u on u.id=pa.id_persona
left join MOISES.Tipo_Pais tp on tp.Id_Tipopais=pa.Id_Tipopais
left join (select Id_Semestre_Programa,max(fecha_fin) fecha_expiracion from Acad_Modulo_Detalle
            group by Id_Semestre_Programa) asp on asp.Id_Semestre_Programa=aac.Id_Semestre_Programa
where /*aac.id_semestre=225 and*/
 aac.estado='1' and aac.id_nivel_ensenanza in (1,2)
union
select Aca.Id_Semestre,pa.Correo email,pa.Nombre firstname, pa.paterno||' '||pa.materno surname,u.email userid,
pa.Codigo_Sexo sex, pa.Celular phone, pa.Fec_Nacimiento dateofbirth, pa.Direccion address, 
max(replace(replace(nvl(ape.Sede,apec.Sede),'Sede ',''),'Filial ','')) state,
tp.Gentilicio B_country, Pna.Codigo cardnumber, pa.Num_Documento borrowernotes,
max(nvl(oa.Sigla,oac.Sigla)) sort1,max(nvl(Ape2.Codigo_Sunedu2,nvl(Ape.Nombre_Corto,apec.Nombre_Corto))) sort2,max(Amd.Fecha_Fin) dateexpiry,'DOCEN' categorycode,
null fecha_de_matricula
from Vw_Acad_Carga_Academica aca inner join Acad_Carga_Curso_Docente accd on Accd.Id_Carga_Curso=Aca.Id_Carga_Curso
inner join Vw_Persona_Comun pa on pa.id_persona=accd.id_persona
inner join Acad_Modulo_Detalle amd on Amd.Id_Modulo_Detalle=Accd.Id_Modulo_Detalle
left join Acad_Persona_Contrato pc on pc.id_persona=accd.id_persona and Pc.Id_Semestre=aca.id_semestre
left join vw_Acad_Programa_Estudio ape on Ape.Id_Programa_Estudio=Pc.Id_Programa_Estudio
left join Acad_Programa_Estudio ape2 on Ape.Id_Programa_Estudio=Pc.Id_Programa_Estudio
left join eliseo.org_area oa on oa.id_area=Ape.Id_Facultad
left join eliseo.users u on u.id=pa.id_persona
left join moises.persona_natural_alumno pna on pna.id_persona=pa.id_persona
left join MOISES.Tipo_Pais tp on tp.Id_Tipopais=pa.Id_Tipopais
inner join vw_Acad_Programa_Estudio apec on Apec.Id_Programa_Estudio=aca.Id_Programa_Estudio
inner join eliseo.org_area oac on oac.id_area=aca.Id_Facultad
where /*Aca.Id_Semestre=225 and*/
 Aca.Id_Nivel_Ensenanza in (1,2) and aca.origen='O'
group by Aca.Id_Semestre,pa.Correo,pa.Nombre, pa.paterno||' '||pa.materno,u.email,
pa.Codigo_Sexo, pa.Celular, pa.Fec_Nacimiento, pa.Direccion, 
tp.Gentilicio, Pna.Codigo, pa.Num_Documento;

