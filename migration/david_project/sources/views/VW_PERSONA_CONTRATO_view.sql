-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_persona_contrato (id_persona, birthdate, firstname, fullname, gender, num_documento, middlename, lastname) AS select ID_PERSONA,BIRTHDATE,FIRSTNAME,FULLNAME,GENDER,NUM_DOCUMENTO,MIDDLENAME,LASTNAME FROM (select Distinct aac.id_persona,To_char(pa.Fec_Nacimiento,'yyyy-mm-dd') birthdate,pa.Nombre firstname,pa.Nombre_Apellido fullname,
                decode(aac.Sexo,'Varon','Male','Mujer','Female') gender,
                aac.Num_Documento Num_Documento,pa.Paterno middlename,pa.Materno lastname 
                from vw_acad_alumno_contrato aac inner join vw_persona_alumno pa on pa.id_persona=aac.id_persona
                where estado='1' and aac.Id_Tipo_Contrato=1
                and ft_calcular_anio_fecha(pa.Fec_Nacimiento)<ft_calcular_anio_actual(10) 
                and pa.Num_Documento is not null and pa.Sexo is not null
                union
                select p.id_persona, To_char(Pn.Fec_Nacimiento,'yyyy-mm-dd') birthdate,p.Nombre firstname,P.Nombre||' '||P.paterno||' '||p.materno fullname,
                decode(Pn.Sexo,'1','Male','2','Female') gender,
                pn.Num_Documento Num_Documento,p.Paterno middlename,p.Materno lastname 
                from vw_acad_alumno_contrato aac inner join vw_persona_alumno pa on pa.id_persona=aac.id_persona
                inner join moises.persona p on p.id_persona=aac.Id_Resp_Financiero
                inner join moises.persona_natural pn on pn.id_persona=p.id_persona
                where aac.id_semestre=167 and estado='1' and aac.Id_Tipo_Contrato=1
                and ft_calcular_edad(pa.Fec_Nacimiento)<18               
                and ft_calcular_anio_fecha(pa.Fec_Nacimiento)<ft_calcular_anio_actual(10) 
                and Pn.Num_Documento is not null and Pn.Sexo is not null);

