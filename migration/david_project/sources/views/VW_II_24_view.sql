-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = david,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW vw_ii_24 (id_equipo_taller, id_evento_participante, id_evento, evento, disciplina, institucion, jugadores, delegado, num_documento_delegado, jugador, documento_jugador, id_jugador, photo, id_iglesia, otra_iglesia, nombre_iglesia, nombre_iglesia_campo_dtto, nombre_iglesia_campo, nombre_iglesia_union) AS SELECT
            eet.ID_EQUIPO_TALLER  ,
            eep.ID_EVENTO_PARTICIPANTE ,
            ee.ID_EVENTO ,
            ee.nombre AS evento,
            ett.NOMBRE ||'-'||eet.id_equipo_taller AS disciplina,
            CASE WHEN ei.NOMBRE IS NULL THEN eep.OTRA_INSTITUCION WHEN  nvl(ei.CODIGO  , '-' ) = 'OTRO' THEN eep.OTRA_INSTITUCION ELSE ei.NOMBRE END AS institucion ,
            (SELECT count(1) AS contador FROM jonas.EVENTO_JUGADOR ej WHERE ej.ID_EQUIPO_TALLER = eet.ID_EQUIPO_TALLER ) AS jugadores,
            ep.NOMBRE || ' ' || ep.AP_PATERNO  || ' ' || ep.AP_MATERNO  AS delegado,
            ep.NUM_DOCUMENTO AS num_documento_delegado,
            nvl(ej2.NOMBRE, '') ||' ' || nvl(ej2.PATERNO , '') ||' ' || nvl(ej2.MATERNO , '') AS JUGADOR,
            nvl(ej2.NUMERO_DOCUMENTO,' ') AS documento_jugador,
            ej2.ID_JUGADOR ,
            ej2.PHOTO,
            case WHEN ei2.ID_IGLESIA IS NULL THEN 0 ELSE ei2.ID_IGLESIA end AS id_iglesia ,
            eu.sigla || ' - ' || ec.sigla || ' - ' || ecd.NOMBRE || ' - ' ||   eep.OTRA_IGLESIA AS otra_iglesia,
    		CASE WHEN eep.IGLESIA IS  NULL THEN eep.OTRA_IGLESIA
    		ELSE  ei2.NOMBRE END AS nombre_iglesia ,
    		ecd.NOMBRE AS  nombre_iglesia_campo_dtto,
    		ec.NOMBRE AS nombre_iglesia_campo,
    		eu.NOMBRE AS nombre_iglesia_union
        FROM jonas.EVENTO_EQUIPO_TALLER eet
        INNER JOIN jonas.EVENTO_PARTICIPANTE_TALLER ept ON ept.ID_PARTICIPANTE_TALLER =eet.ID_PARTICIPANTE_TALLER
        INNER JOIN jonas.EVENTO_EVENTO_PARTICIPANTE eep  ON eep.ID_EVENTO_PARTICIPANTE  = ept.ID_EVENTO_PARTICIPANTE
        INNER JOIN jonas.EVENTO_EVENTO_TALLER eet2 ON eet2.ID_EVENTO_TALLER =ept.ID_EVENTO_TALLER
        INNER JOIN jonas.EVENTO_TIPO_TALLER ett ON ett.ID_TIPO_TALLER =eet2.ID_TIPO_TALLER
        LEFT JOIN jonas.EVENTO_INSTITUCION ei ON ei.ID_INSTITUCION = eep.ID_INSTITUCION
        INNER JOIN jonas.EVENTO_EVENTO ee ON ee.ID_EVENTO = eep.ID_EVENTO
        LEFT JOIN jonas.evento_participante ep ON ep.id_participante = eep.id_participante
        LEFT JOIN jonas.EVENTO_JUGADOR ej2 ON eet.ID_EQUIPO_TALLER = ej2.ID_EQUIPO_TALLER
        LEFT  JOIN jonas.EVENTO_IGLESIA ei2  ON  eep.IGLESIA  = ei2.ID_IGLESIA
    	LEFT JOIN jonas.EVENTO_CAMPO_DTTO ecd ON eep.ID_CAMPO_DTTO = ecd.ID_CAMPO_DTTO  
    	LEFT JOIN jonas.EVENTO_CAMPO ec ON eep.ID_CAMPO  = ec.ID_CAMPO 
    	LEFT JOIN jonas.EVENTO_UNION eu ON eep.ID_UNION  = eu.ID_UNION
        WHERE ee.ID_EVENTO =221
        ;

