-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = moises,public;
\set ON_ERROR_STOP ON

procedure        insert_pers_nat_resp_fin(
    v_id_persona	in varchar2,
    v_nombre	in varchar2,
    v_paterno	in varchar2,
    v_materno	in varchar2,
    cursor       out sys_refcursor
) is

p_id_persona integer:=0;
p_id_persona_natural integer:=0;
p_id_persona_natural_resp_fin integer:=0;
 
begin

  select nvl((select p.id_persona
              from persona p
              where p.id_persona=v_id_persona),0) into  p_id_persona
  from dual;
  
  if(p_id_persona>0) then
    
    select nvl((select p.id_persona
              from persona_natural p 
              where p.id_persona=p_id_persona),0) into p_id_persona_natural
    from dual;
    
    if(p_id_persona_natural>0) then
    
        select nvl((select id_persona
                    from persona_natural_resp_fin p 
                    where p.id_persona=p_id_persona_natural),0) into p_id_persona_natural_resp_fin
        from dual;
        
        if(p_id_persona_natural_resp_fin=0) then
        
            insert into persona_natural_resp_fin(id_persona)
            values(p_id_persona_natural);
            
        end if;
    
    else
            
            insert into persona_natural(id_persona)
            values(p_id_persona);
            
            insert into persona_natural_resp_fin(id_persona)
            values(p_id_persona);
            
    end if;
  
  else
  
  select max(id_persona)+1 into p_id_persona
    from persona;
    
    insert into persona(id_persona,nombre,paterno,materno)
    values(p_id_persona,v_nombre,v_paterno,v_materno);
    
    insert into persona_natural(id_persona)
    values(p_id_persona);
    
    insert into persona_natural_resp_fin(id_persona)
    values(p_id_persona);
    
  end if;
  
  open cursor for 
    select pn.id_persona,p.nombre,p.paterno,p.materno,pn.id_tipodocumento,pn.num_documento
    from persona_natural pn inner join persona p on p.id_persona=pn.id_persona
    where pn.id_persona=p_id_persona;
  
end;

