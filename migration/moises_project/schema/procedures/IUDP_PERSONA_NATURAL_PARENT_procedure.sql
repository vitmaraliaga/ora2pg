-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = moises,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE moises.iudp_persona_natural_parent (P_Modo integer, P_ID_PERSONA integer, P_ID_PARIENTE integer, P_ID_TIPOPARENTESCO integer, P_COMENTARIO text DEFAULT NULL) AS $body$
DECLARE


	S_COMENTARIO varchar(50);
  S_CANTIDAD bigint:=0;

BEGIN
  IF P_Modo = 0 THEN
		S_COMENTARIO := trim(both coalesce(P_COMENTARIO, ''));

    IF (P_ID_PERSONA IS NOT NULL AND P_ID_PERSONA::text <> '') AND (P_ID_PARIENTE IS NOT NULL AND P_ID_PARIENTE::text <> '') THEN

    	SELECT COUNT(*) INTO STRICT S_CANTIDAD FROM moises.PERSONA_NATURAL_PARENTESCO WHERE ID_PERSONA = P_ID_PERSONA AND ID_PARIENTE = P_ID_PARIENTE;

	    IF S_CANTIDAD = 0 THEN
	    	INSERT INTO moises.PERSONA_NATURAL_PARENTESCO(ID_PERSONA,ID_PARIENTE, ID_TIPOPARENTESCO, COMENTARIO)
	            VALUES (P_ID_PERSONA,P_ID_PARIENTE, P_ID_TIPOPARENTESCO, S_COMENTARIO);

			ELSE
	        UPDATE moises.PERSONA_NATURAL_PARENTESCO SET
	          ID_TIPOPARENTESCO = P_ID_TIPOPARENTESCO, COMENTARIO=S_COMENTARIO
	        WHERE ID_PERSONA = P_ID_PERSONA AND ID_PARIENTE = P_ID_PARIENTE;

	    END IF;
    END IF;
  ELSE
		DELETE FROM moises.PERSONA_NATURAL_PARENTESCO WHERE ID_PERSONA = P_ID_PERSONA AND ID_PARIENTE = P_ID_PARIENTE;
  END IF;
END;
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE moises.iudp_persona_natural_parent (P_Modo integer, P_ID_PERSONA integer, P_ID_PARIENTE integer, P_ID_TIPOPARENTESCO integer, P_COMENTARIO text DEFAULT NULL) FROM PUBLIC;

