-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';
SET search_path = moises,verificacion_valor,public;




CREATE OR REPLACE FUNCTION moises.verificacion_valor_ft_insert_verificacion ( p_id_persona integer, p_valor text, p_estado text, p_id_usuario_reg integer, p_fecha_registro timestamp(0), p_tipo text ) RETURNS refcursor AS $body$
DECLARE


      refcursor REFCURSOR;
      p_res varchar(5);

    
BEGIN
        
      select coalesce(ft_verificacion(p_valor,'2'),'n') into STRICT p_res
;
      
      if (substr(p_res,0,1)='s') then
      
        if (substr(p_res,2)='0') then
        
          update moises.verificacion set 
                  id_persona=p_id_persona,
                  id_usuario_act=p_id_usuario_reg,
                  fecha_actualizacion=p_fecha_registro
          where valor=p_valor;

        end if;

      end if;

      if (substr(p_res,0,1)='n') then
      
        insert into moises.verificacion(id_persona,valor,estado,id_usuario_reg,fecha_registro,tipo)
        values (p_id_persona,p_valor,p_estado,p_id_usuario_reg,p_fecha_registro,p_tipo);

      end if;

      commit;

          
      open refcursor for SELECT id_verificacion,id_persona,valor,codigo_verificacion,estado,id_usuario_reg,fecha_registro,id_usuario_act,fecha_actualizacion,tipo
                          from moises.verificacion 
                          where valor=p_valor;

      return refcursor;

  END;
$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON FUNCTION moises.verificacion_valor_ft_insert_verificacion ( p_id_persona integer, p_valor text, p_estado text, p_id_usuario_reg integer, p_fecha_registro timestamp(0), p_tipo text ) FROM PUBLIC;
