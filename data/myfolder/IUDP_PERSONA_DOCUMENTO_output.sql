-- Generated by Ora2Pg, the Oracle database Schema converter, version 25.0
-- Copyright 2000-2025 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=10.174.11.5;sid=upeu;port=1521

SET client_encoding TO 'UTF8';

SET search_path = moises,public;
\set ON_ERROR_STOP ON





CREATE OR REPLACE PROCEDURE moises.iudp_persona_documento (P_Modo integer, P_ID_PERSONA integer, P_ID_TIPODOCUMENTO integer, P_NUM_DOCUMENTO text DEFAULT NULL) AS $body$
DECLARE


  S_NUM_DOCUMENTO varchar(100);
  S_CANTIDAD integer;

BEGIN

  IF P_Modo = 0 THEN
  
    S_NUM_DOCUMENTO := trim(both coalesce(P_NUM_DOCUMENTO, ''));

    -- IF S_NUM_DOCUMENTO <> '' THEN  -- ANTES
    IF NOT S_NUM_DOCUMENTO IS NULL THEN   --AHORA
    
    	SELECT COUNT(*) INTO STRICT S_CANTIDAD FROM PERSONA_DOCUMENTO WHERE ID_TIPODOCUMENTO = P_ID_TIPODOCUMENTO AND NUM_DOCUMENTO = S_NUM_DOCUMENTO;
     
	    IF S_CANTIDAD = 0 THEN
	    	INSERT INTO PERSONA_DOCUMENTO(ID_PERSONA, ID_TIPODOCUMENTO, NUM_DOCUMENTO, IMG_DOCUMENTO)
	            VALUES (P_ID_PERSONA, P_ID_TIPODOCUMENTO, S_NUM_DOCUMENTO, NULL);
	    /*ELSE
	        UPDATE PERSONA_DOCUMENTO SET
	          NUM_DOCUMENTO = S_NUM_DOCUMENTO
	        WHERE ID_PERSONA = P_ID_PERSONA
	          AND ID_TIPODOCUMENTO = P_ID_TIPODOCUMENTO;*/
	    END IF;

    END IF;

  ELSE
		DELETE FROM PERSONA_DOCUMENTO WHERE ID_PERSONA = P_ID_PERSONA AND ID_TIPODOCUMENTO = P_ID_TIPODOCUMENTO;
  END IF;

END;
$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON PROCEDURE moises.iudp_persona_documento (P_Modo integer, P_ID_PERSONA integer, P_ID_TIPODOCUMENTO integer, P_NUM_DOCUMENTO text DEFAULT NULL) FROM PUBLIC;

